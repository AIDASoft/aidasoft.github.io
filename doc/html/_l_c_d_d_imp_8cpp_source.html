<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCore/src/LCDDImp.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCore/src/LCDDImp.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCore/src/LCDDImp.cpp</h1><a href="_l_c_d_d_imp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id$</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_plugins_8h.html">DD4hep/Plugins.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_printout_8h.html">DD4hep/Printout.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_geo_handler_8h.html">DD4hep/GeoHandler.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_l_c_d_d_helper_8h.html">DD4hep/LCDDHelper.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_instance_count_8h.html">DD4hep/InstanceCount.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_volume_manager_interna_8h.html">DD4hep/objects/VolumeManagerInterna.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_detector_interna_8h.html">DD4hep/objects/DetectorInterna.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_l_c_d_d_imp_8h.html">LCDDImp.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// C/C++ include files</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;cerrno&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// ROOT inlcude files</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;TGeoCompositeShape.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;TGeoBoolNode.h&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;TGeoManager.h&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;TGeoMatrix.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;TGeoVolume.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;TGeoShape.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;TClass.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="_document_handler_8h.html">XML/DocumentHandler.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#if DD4HEP_USE_PYROOT</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &quot;TPython.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#ifndef __TIXML__</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#include &quot;xercesc/dom/DOMException.hpp&quot;</span>
<a name="l00045"></a>00045 <span class="keyword">namespace </span>DD4hep {
<a name="l00046"></a><a class="code" href="namespace_d_d4hep_1_1_x_m_l.html">00046</a>   <span class="keyword">namespace </span>XML {
<a name="l00047"></a><a class="code" href="namespace_d_d4hep_1_1_x_m_l.html#a60be75f70ac155f3f1a92aa1c69f085b">00047</a>     <span class="keyword">typedef</span> xercesc::DOMException <a class="code" href="namespace_d_d4hep_1_1_x_m_l.html#a60be75f70ac155f3f1a92aa1c69f085b">XmlException</a>;
<a name="l00048"></a>00048   }
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 <span class="preprocessor">#endif</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="keyword">using namespace </span>DD4hep::Geometry;
<a name="l00053"></a>00053 <span class="keyword">using namespace </span>DD4hep;
<a name="l00054"></a>00054 <span class="keyword">using namespace </span>std;
<a name="l00055"></a>00055 <span class="keyword">namespace </span>{
<a name="l00056"></a>00056   <span class="keyword">struct </span>TypePreserve {
<a name="l00057"></a>00057     <a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965fab" title="Detector description build types.">LCDDBuildType</a>&amp; m_t;
<a name="l00058"></a>00058     TypePreserve(<a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965fab" title="Detector description build types.">LCDDBuildType</a>&amp; t)
<a name="l00059"></a>00059       : m_t(t) {
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061     ~TypePreserve() {
<a name="l00062"></a>00062       m_t = <a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965faba640bf17b4ac1e133c23f07c8c983c6f7">BUILD_NONE</a>;
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064   };
<a name="l00065"></a>00065   <span class="keyword">static</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>* s_lcdd = 0;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="keywordtype">void</span> lcdd_unexpected()    {
<a name="l00068"></a>00068     <span class="keywordflow">try</span>  {
<a name="l00069"></a>00069       <span class="keywordflow">throw</span>;
<a name="l00070"></a>00070     }  <span class="keywordflow">catch</span>( std::exception&amp; e){
<a name="l00071"></a>00071       std::cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00072"></a>00072                 &lt;&lt; <span class="stringliteral">&quot;**************************************************** \n&quot;</span>
<a name="l00073"></a>00073                 &lt;&lt; <span class="stringliteral">&quot;*  A runtime error has occured :                     \n&quot;</span>
<a name="l00074"></a>00074                 &lt;&lt; <span class="stringliteral">&quot;*    &quot;</span> &lt;&lt; e.what()   &lt;&lt; std::endl
<a name="l00075"></a>00075                 &lt;&lt; <span class="stringliteral">&quot;*  the program will have to be terminated - sorry.   \n&quot;</span>
<a name="l00076"></a>00076                 &lt;&lt; <span class="stringliteral">&quot;**************************************************** \n&quot;</span>
<a name="l00077"></a>00077                 &lt;&lt; std::endl ;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079       std::set_unexpected( std::unexpected ) ;
<a name="l00080"></a>00080       std::set_terminate( std::terminate ) ;
<a name="l00081"></a>00081       <span class="comment">// this provokes ROOT seg fault and stack trace (comment out to avoid it)</span>
<a name="l00082"></a>00082       exit(1) ;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084   }
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a4ba28eb0e53e15856d7a773c4ff758b9">00087</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; LCDD::getInstance() {
<a name="l00088"></a>00088   <span class="keywordflow">if</span> (!s_lcdd)
<a name="l00089"></a>00089     s_lcdd = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html" title="Concrete implementation class of the LCDD interface.">LCDDImp</a>();
<a name="l00090"></a>00090   <span class="keywordflow">return</span> *s_lcdd;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00094"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a7470fc11102bacc2b486590de49a8017">00094</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a7470fc11102bacc2b486590de49a8017" title="Destroy the instance.">LCDD::destroyInstance</a>() {
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (s_lcdd)
<a name="l00096"></a>00096     <span class="keyword">delete</span> s_lcdd;
<a name="l00097"></a>00097   s_lcdd = 0;
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00101"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac9cfc0155701a769a74fcf67d58d8749">00101</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac9cfc0155701a769a74fcf67d58d8749" title="Default constructor.">LCDDImp::LCDDImp</a>() : <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html" title="Data implementation class of the LCDD interface.">LCDDData</a>(), <a class="code" href="class_d_d4hep_1_1_l_c_d_d_load.html" title="Data implementation class of the LCDD interface.">LCDDLoad</a>(this), m_buildType(<a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965faba640bf17b4ac1e133c23f07c8c983c6f7">BUILD_NONE</a>)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103 
<a name="l00104"></a>00104   std::set_unexpected( lcdd_unexpected ) ;
<a name="l00105"></a>00105   std::set_terminate( lcdd_unexpected ) ;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <a class="code" href="struct_d_d4hep_1_1_instance_count.html#aff4313ae357c0c3bcf3ce210eee4c470" title="Increment count according to type information.">InstanceCount::increment</a>(<span class="keyword">this</span>);
<a name="l00108"></a>00108   <span class="keywordflow">if</span> (0 == gGeoManager) {
<a name="l00109"></a>00109     gGeoManager = <span class="keyword">new</span> TGeoManager(<span class="stringliteral">&quot;world&quot;</span>, <span class="stringliteral">&quot;LCDD Geometry&quot;</span>);
<a name="l00110"></a>00110   }
<a name="l00111"></a>00111   {
<a name="l00112"></a>00112     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a> = gGeoManager;
<a name="l00113"></a>00113     <span class="comment">//m_manager-&gt;AddNavigator();</span>
<a name="l00114"></a>00114     <span class="comment">//m_manager-&gt;SetCurrentNavigator(0);</span>
<a name="l00115"></a>00115     <span class="comment">//cout &lt;&lt; &quot;Navigator:&quot; &lt;&lt; (void*)m_manager-&gt;GetCurrentNavigator() &lt;&lt; endl;</span>
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117   <span class="comment">//if ( 0 == gGeoIdentity )</span>
<a name="l00118"></a>00118   {
<a name="l00119"></a>00119     gGeoIdentity = <span class="keyword">new</span> TGeoIdentity();
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html" title="Handle class describing visualization attributes.">VisAttr</a> attr(<span class="stringliteral">&quot;invisible&quot;</span>);
<a name="l00122"></a>00122   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#aa9f0dec964e94cbb6df397e242ac57b5" title="Set object color.">setColor</a>(0.5, 0.5, 0.5);
<a name="l00123"></a>00123   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#aeca9848b297213098eac1fd882fd7680" title="Set alpha value.">setAlpha</a>(1);
<a name="l00124"></a>00124   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#ad86fa3158adc9cb58bdf7d72da8f1eee" title="Set line style.">setLineStyle</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630abb85e6313ec27720fcbae236740dd4c9">VisAttr::SOLID</a>);
<a name="l00125"></a>00125   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a37d208476b8631402fe4777061abfc81" title="Set drawing style.">setDrawingStyle</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630abb85e6313ec27720fcbae236740dd4c9">VisAttr::SOLID</a>);
<a name="l00126"></a>00126   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a499e3e8252f4abd62be3a3be521f10b4" title="Set visibility flag.">setVisible</a>(<span class="keyword">false</span>);
<a name="l00127"></a>00127   attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#af29f0854b9e6866b31830dd673f92df8" title="Set Flag to show/hide daughter elements.">setShowDaughters</a>(<span class="keyword">true</span>);
<a name="l00128"></a>00128   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a6b0b4c0f5d67a156215447e385820dc4" title="Add a new visualisation attribute by named reference to the detector description...">addVisAttribute</a>(attr);
<a name="l00129"></a>00129   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a081b9cb2c89e1b884993c83f78c2c257">m_invisibleVis</a> = attr;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00133"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a75a7b388970a2f18f79a8eddbc451411">00133</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a75a7b388970a2f18f79a8eddbc451411" title="Standard destructor.">LCDDImp::~LCDDImp</a>() {
<a name="l00134"></a>00134   <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a> == gGeoManager ) gGeoManager = 0;
<a name="l00135"></a>00135   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a8c54de26155fec96a884f912f9c7a0ee" title="Assignment operator.">destroyData</a>(<span class="keyword">false</span>);
<a name="l00136"></a>00136   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a686aca104b9460a62e5a89d8abbd3b7c" title="Definition of the extension type.">m_extensions</a>.<a class="code" href="class_d_d4hep_1_1_object_extensions.html#a8f55762fa8f1701f8fda19a25b027168" title="Clear all extensions.">clear</a>();
<a name="l00137"></a>00137   <a class="code" href="struct_d_d4hep_1_1_instance_count.html#a13975237d7100dab59a87dec2f67dc73" title="Decrement count according to type information.">InstanceCount::decrement</a>(<span class="keyword">this</span>);
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">// Load volume manager</span>
<a name="l00141"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#af1c734df7d03b3e7903e1c25c508d153">00141</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#af1c734df7d03b3e7903e1c25c508d153" title="Local method (no interface): Load volume manager.">LCDDImp::imp_loadVolumeManager</a>()   {
<a name="l00142"></a>00142   <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga613cd8eaf766f07c2abb80e73e618397" title="Helper to delete objects from heap and reset the handle.">destroyHandle</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a8a01d0ac487c537e9826d2900c95062a" title="Volume manager reference.">m_volManager</a>);
<a name="l00143"></a>00143   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a8a01d0ac487c537e9826d2900c95062a" title="Volume manager reference.">m_volManager</a> = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume_manager.html" title="Class to support the retrieval of detector elements and volumes given a valid identifier...">VolumeManager</a>(*<span class="keyword">this</span>, <span class="stringliteral">&quot;World&quot;</span>, <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a8aeb5997ee6b66d4207ccab82c2bf8f1" title="Return reference to the top-most (world) detector element.">world</a>(), <a class="code" href="class_d_d4hep_1_1_geometry_1_1_readout.html" title="Handle to the implementation of the readout structure of a subdetector.">Readout</a>(), <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume_manager.html#a1c25b37c1377654bf2fbe1cf4743ebdeaf55015e5bb5659a574e760177f74324f">VolumeManager::TREE</a>);
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00147"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a6a8e772cd986a1e6211b4e3b0b1ae997">00147</a> <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a6a8e772cd986a1e6211b4e3b0b1ae997" title="Add an extension object to the LCDD instance.">LCDDImp::addUserExtension</a>(<span class="keywordtype">void</span>* ptr, <span class="keyword">const</span> std::type_info&amp; info, <span class="keywordtype">void</span> (*destruct)(<span class="keywordtype">void</span>*)) {
<a name="l00148"></a>00148   <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a686aca104b9460a62e5a89d8abbd3b7c" title="Definition of the extension type.">m_extensions</a>.<a class="code" href="class_d_d4hep_1_1_object_extensions.html#acfe9fe435a30ca5fedd0678b867732a0" title="Add an extension object to the detector element.">addExtension</a>(ptr,info,destruct);
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00152"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a9e43af7ad956710acab4aead5a41dc13">00152</a> <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a9e43af7ad956710acab4aead5a41dc13" title="Remove an existing extension object from the LCDD instance. If not destroyed, the...">LCDDImp::removeUserExtension</a>(<span class="keyword">const</span> std::type_info&amp; info, <span class="keywordtype">bool</span> destroy)  {
<a name="l00153"></a>00153   <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a686aca104b9460a62e5a89d8abbd3b7c" title="Definition of the extension type.">m_extensions</a>.<a class="code" href="class_d_d4hep_1_1_object_extensions.html#a4ee557d0bcce3b57dd6f462a6967dd6b" title="Remove an existing extension object from the instance.">removeExtension</a>(info,destroy);
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00157"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#adfeb342464586b682c1da99b0c2e023b">00157</a> <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#adfeb342464586b682c1da99b0c2e023b" title="Access an existing extension object from the LCDD instance.">LCDDImp::userExtension</a>(<span class="keyword">const</span> std::type_info&amp; info, <span class="keywordtype">bool</span> alert)<span class="keyword"> const </span>{
<a name="l00158"></a>00158   <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a686aca104b9460a62e5a89d8abbd3b7c" title="Definition of the extension type.">m_extensions</a>.<a class="code" href="class_d_d4hep_1_1_object_extensions.html#ae1ea9d894574f33c63ea3d44427f4c0c" title="Access an existing extension object from the detector element.">extension</a>(info,alert);
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00162"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac8faeaaa5f56b48c6306cb3099f84568">00162</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac8faeaaa5f56b48c6306cb3099f84568" title="Register new mother volume using the detector name.">LCDDImp::declareMotherVolume</a>(<span class="keyword">const</span> std::string&amp; detector_name, <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a>&amp; vol)  {
<a name="l00163"></a>00163   <span class="keywordflow">if</span> ( !detector_name.empty() )  {
<a name="l00164"></a>00164     <span class="keywordflow">if</span> ( vol.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )  {
<a name="l00165"></a>00165       HandleMap::const_iterator i = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3d9a2d83bdb9c5784b51439c857f7f5f">m_motherVolumes</a>.find(detector_name);
<a name="l00166"></a>00166       <span class="keywordflow">if</span> (i == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3d9a2d83bdb9c5784b51439c857f7f5f">m_motherVolumes</a>.end())   {
<a name="l00167"></a>00167         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3d9a2d83bdb9c5784b51439c857f7f5f">m_motherVolumes</a>.insert(make_pair(detector_name,vol));
<a name="l00168"></a>00168         <span class="keywordflow">return</span>;
<a name="l00169"></a>00169       }
<a name="l00170"></a>00170       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD: A mother volume to the detector &quot;</span>+detector_name+<span class="stringliteral">&quot; was already registered.&quot;</span>);
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD: Attempt to register invalid mother volume for detector:&quot;</span>+detector_name+<span class="stringliteral">&quot; [Invalid-Handle].&quot;</span>);
<a name="l00173"></a>00173   }
<a name="l00174"></a>00174   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD: Attempt to register mother volume to invalid detector [Invalid-detector-name].&quot;</span>);
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00178"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac46cbee27ebc2412e82455305c54c25f">00178</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ac46cbee27ebc2412e82455305c54c25f" title="Access mother volume by detector element.">LCDDImp::pickMotherVolume</a>(<span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a>&amp; de)<span class="keyword"> const </span>{
<a name="l00179"></a>00179   <span class="keywordflow">if</span> ( de.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )   {
<a name="l00180"></a>00180     <span class="keywordtype">string</span> de_name = de.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>();
<a name="l00181"></a>00181     HandleMap::const_iterator i = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3d9a2d83bdb9c5784b51439c857f7f5f">m_motherVolumes</a>.find(de_name);
<a name="l00182"></a>00182     <span class="keywordflow">if</span> (i == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3d9a2d83bdb9c5784b51439c857f7f5f">m_motherVolumes</a>.end())   {
<a name="l00183"></a>00183       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">return</span> (*i).second;
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD: Attempt access mother volume of invalid detector [Invalid-handle]&quot;</span>);
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad0926dfc64d99cddfdec4990829d3622">00190</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad0926dfc64d99cddfdec4990829d3622" title="Add a new subdetector by named reference to the detector description.">LCDDImp::addDetector</a>(<span class="keyword">const</span> <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>&amp; ref_det) {
<a name="l00191"></a>00191   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> det_element(ref_det);
<a name="l00192"></a>00192   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_helper.html" title="LCDDHelper: class to shortcut certain questions to the DD4hep detector description...">LCDDHelper</a> helper(<span class="keyword">this</span>);
<a name="l00193"></a>00193   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> existing_det = helper.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_helper.html#a254105cb4c608b84d47b5dd0eb28f0f2" title="Find a detector element by it&amp;#39;s system ID.">detectorByID</a>(det_element.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#ab792b1e02d95042fd94897283df9f8fa" title="Get the detector identifier.">id</a>());
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="keywordflow">if</span> ( existing_det.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )   {
<a name="l00196"></a>00196     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html" title="Handle class to hold the information of a sensitive detector.">SensitiveDetector</a> sd = helper.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_helper.html#a0058b2f6c48397ed7883bbc7f1ad8fc2" title="Access the sensitive detector of a given subdetector (if the sub-detector is sensitive!)...">sensitiveDetector</a>(existing_det);
<a name="l00197"></a>00197     <span class="keywordflow">if</span> ( sd.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )   {
<a name="l00198"></a>00198       stringstream str;
<a name="l00199"></a>00199       str &lt;&lt; <span class="stringliteral">&quot;LCDD: The sensitive sub-detectors &quot;</span> &lt;&lt; det_element.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>() &lt;&lt; <span class="stringliteral">&quot; and &quot;</span>
<a name="l00200"></a>00200           &lt;&lt; existing_det.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>() &lt;&lt; <span class="stringliteral">&quot; have the identical ID:&quot;</span> &lt;&lt; det_element.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#ab792b1e02d95042fd94897283df9f8fa" title="Get the detector identifier.">id</a>() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00201"></a>00201       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a54d5c1b9254fdf017c456cb972d26f96">ERROR</a>,<span class="stringliteral">&quot;LCDD&quot;</span>,str.str());
<a name="l00202"></a>00202       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(str.str());
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data_1_1_object_handle_map.html#a8881f90a02ef95a6a2e558f092e8f81a">append</a>(ref_det);
<a name="l00206"></a>00206   det_element-&gt;flag |= <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element_object.html#a04115ec0fa8d9df9b7d47ed45e9b037da7fc93a02de387e3a443e7f900157f2dd">DetElement::Object::IS_TOP_LEVEL_DETECTOR</a>;
<a name="l00207"></a>00207   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> volume = det_element.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a32a39fbab7eeb59dd4ad2fc807e0b66d" title="Access to the physical volume of this detector element.">placement</a>()-&gt;GetMotherVolume();
<a name="l00208"></a>00208   <span class="keywordflow">if</span> ( volume == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a> )  {
<a name="l00209"></a>00209     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ad22cda76fc1b3a55bc359945db9c811c">DEBUG</a>,<span class="stringliteral">&quot;LCDD&quot;</span>,<span class="stringliteral">&quot;Added detector %s to the world instance.&quot;</span>,det_element.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00210"></a>00210     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a336e54ac88a2f3493f82138699899517" title="Add new child to the detector structure.">add</a>(det_element);
<a name="l00211"></a>00211     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213   <span class="comment">// The detector&apos;s placement must be one of the existing detectors</span>
<a name="l00214"></a>00214   <span class="keywordflow">for</span>(HandleMap::iterator i = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.begin(); i!=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.end(); ++i)  {
<a name="l00215"></a>00215     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> parent((*i).second);
<a name="l00216"></a>00216     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> vol = parent.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a32a39fbab7eeb59dd4ad2fc807e0b66d" title="Access to the physical volume of this detector element.">placement</a>().<a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html#a7896af4481e228014289900a8943a7da" title="Logical volume of this placement.">volume</a>();
<a name="l00217"></a>00217     <span class="keywordflow">if</span> ( vol == volume )  {
<a name="l00218"></a>00218       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;LCDD&quot;</span>,<span class="stringliteral">&quot;Added detector %s to the parent:%s.&quot;</span>,det_element.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(),parent.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00219"></a>00219       parent.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a336e54ac88a2f3493f82138699899517" title="Add new child to the detector structure.">add</a>(det_element);
<a name="l00220"></a>00220       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD: The detector &quot;</span> + <span class="keywordtype">string</span>(det_element.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>()) + <span class="stringliteral">&quot; has no known parent.&quot;</span>);
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00227"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aec684bd86c26b609a33668364f595d96">00227</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aec684bd86c26b609a33668364f595d96" title="Add a new constant by named reference to the detector description.">LCDDImp::addConstant</a>(<span class="keyword">const</span> <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>&amp; x) {
<a name="l00228"></a>00228   <span class="keywordflow">if</span> ( strcmp(x.name(),<span class="stringliteral">&quot;LCDD_InhibitConstants&quot;</span>) == 0 )   {
<a name="l00229"></a>00229     <span class="keyword">const</span> <span class="keywordtype">char</span>* title = x-&gt;GetTitle();
<a name="l00230"></a>00230     <span class="keywordtype">char</span> c = ::toupper(title[0]);
<a name="l00231"></a>00231     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a81f222787e773b64fd9c8898f5e0aa9b" title="Flag to inhibit the access to global constants. Value set by constants section &amp;#39;LCDD_InhibitCons...">m_inhibitConstants</a> = (c==<span class="charliteral">&apos;Y&apos;</span> || c==<span class="charliteral">&apos;T&apos;</span> || c==<span class="charliteral">&apos;1&apos;</span>);
<a name="l00232"></a>00232   }
<a name="l00233"></a>00233   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#ab24af8c4cd206da5d25f3186498530f7">m_define</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data_1_1_object_handle_map.html#a8881f90a02ef95a6a2e558f092e8f81a">append</a>(x, <span class="keyword">false</span>);
<a name="l00234"></a>00234   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00238"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aa67202d22d5ce08316bbbc6f7b00fa1c">00238</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_constant.html" title="Handle class describing a constant (define) object in lcdd.">Constant</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aa67202d22d5ce08316bbbc6f7b00fa1c" title="Retrieve a constant by it&amp;#39;s name from the detector description.">LCDDImp::constant</a>(<span class="keyword">const</span> std::string&amp; name)<span class="keyword"> const </span>{
<a name="l00239"></a>00239   <span class="keywordflow">if</span> ( !<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a81f222787e773b64fd9c8898f5e0aa9b" title="Flag to inhibit the access to global constants. Value set by constants section &amp;#39;LCDD_InhibitCons...">m_inhibitConstants</a> )   {
<a name="l00240"></a>00240     <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad8724d04e7a03a495f51edea402d318f">getRefChild</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#ab24af8c4cd206da5d25f3186498530f7">m_define</a>, name);
<a name="l00241"></a>00241   }
<a name="l00242"></a>00242   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD:constant(&quot;</span>+name+<span class="stringliteral">&quot;): Access to global constants is inhibited.&quot;</span>);
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00246"></a>00246 <span class="keywordtype">string</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a4f7a333b0a12119a8a5d64591b38a298" title="Typed access to constants: access string values.">LCDDImp::constantAsString</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name)<span class="keyword"> const </span>{
<a name="l00247"></a>00247   <span class="keywordflow">if</span> ( !<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a81f222787e773b64fd9c8898f5e0aa9b" title="Flag to inhibit the access to global constants. Value set by constants section &amp;#39;LCDD_InhibitCons...">m_inhibitConstants</a> )   {
<a name="l00248"></a>00248     <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a> c = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aa67202d22d5ce08316bbbc6f7b00fa1c" title="Retrieve a constant by it&amp;#39;s name from the detector description.">constant</a>(name);
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (c.isValid())
<a name="l00250"></a>00250       <span class="keywordflow">return</span> c-&gt;GetTitle();
<a name="l00251"></a>00251     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD:constantAsString: The constant &quot;</span> + name + <span class="stringliteral">&quot; is not known to the system.&quot;</span>);
<a name="l00252"></a>00252   }
<a name="l00253"></a>00253   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD:constantAsString(&quot;</span>+name+<span class="stringliteral">&quot;):: Access to global constants is inhibited.&quot;</span>);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00257"></a>00257 <span class="keywordtype">long</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a02ab7c49c65ba0c8c8df216b280ece39" title="Typed access to constants: long values.">LCDDImp::constantAsLong</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name)<span class="keyword"> const </span>{
<a name="l00258"></a>00258   <span class="keywordflow">if</span> ( !<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a81f222787e773b64fd9c8898f5e0aa9b" title="Flag to inhibit the access to global constants. Value set by constants section &amp;#39;LCDD_InhibitCons...">m_inhibitConstants</a> )   {
<a name="l00259"></a>00259     <span class="keywordflow">return</span> <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga76414f0a43017580942c20cd07143439" title="String conversions: string to long integer value.">_toLong</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a4f7a333b0a12119a8a5d64591b38a298" title="Typed access to constants: access string values.">constantAsString</a>(name));
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD:constantAsLong(&quot;</span>+name+<span class="stringliteral">&quot;): Access to global constants is inhibited.&quot;</span>);
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00265"></a>00265 <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a5d935f74487075d2297b2ae2884471b2" title="Typed access to constants: double values.">LCDDImp::constantAsDouble</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name)<span class="keyword"> const </span>{
<a name="l00266"></a>00266   <span class="keywordflow">if</span> ( !<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a81f222787e773b64fd9c8898f5e0aa9b" title="Flag to inhibit the access to global constants. Value set by constants section &amp;#39;LCDD_InhibitCons...">m_inhibitConstants</a> )   {
<a name="l00267"></a>00267     <span class="keywordflow">return</span> <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga76e95737ef946f88e7477f69f677a4e2" title="String conversions: string to double value.">_toDouble</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a4f7a333b0a12119a8a5d64591b38a298" title="Typed access to constants: access string values.">constantAsString</a>(name));
<a name="l00268"></a>00268   }
<a name="l00269"></a>00269   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;LCDD:constantAsDouble(&quot;</span>+name+<span class="stringliteral">&quot;): Access to global constants is inhibited.&quot;</span>);
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00273"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a94f5aafcc5fc95d0b15feb960f244019">00273</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a94f5aafcc5fc95d0b15feb960f244019" title="Add a field component by named reference to the detector description.">LCDDImp::addField</a>(<span class="keyword">const</span> <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>&amp; x) {
<a name="l00274"></a>00274   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d36b262bf1bf83780264efcd227bcd">m_field</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_overlayed_field.html#a035b1481dfc0a04b37a31795e3df0ba2" title="Add a new field component.">add</a>(x);
<a name="l00275"></a>00275   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a16e560764499fe2e5756b9317fcccacd">m_fields</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data_1_1_object_handle_map.html#a8881f90a02ef95a6a2e558f092e8f81a">append</a>(x);
<a name="l00276"></a>00276   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00280"></a>00280 <a class="code" href="class_d_d4hep_1_1_geometry_1_1_material.html" title="Handle class describing a material.">Material</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#acd3ac5d06042d6c1adda04ef5a974b62" title="Retrieve a matrial by it&amp;#39;s name from the detector description.">LCDDImp::material</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name)<span class="keyword"> const </span>{
<a name="l00281"></a>00281   TGeoMedium* mat = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;GetMedium(name.c_str());
<a name="l00282"></a>00282   <span class="keywordflow">if</span> (mat) {
<a name="l00283"></a>00283     <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_material.html" title="Handle class describing a material.">Material</a>(<a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(mat));
<a name="l00284"></a>00284   }
<a name="l00285"></a>00285   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Cannot find a material referenced by name:&quot;</span> + name);
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00289"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ade5422f804607ee686022a4a05bd3cff">00289</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ade5422f804607ee686022a4a05bd3cff" title="Internal helper to map detector types once the geometry is closed.">LCDDImp::mapDetectorTypes</a>()  {
<a name="l00290"></a>00290   <span class="keywordflow">for</span>(HandleMap::const_iterator i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.begin(); i!=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.end(); ++i)   {
<a name="l00291"></a>00291     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> det((*i).second);
<a name="l00292"></a>00292     <span class="keywordflow">if</span> ( det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a6a7a665630b1b3af6dd172d9166b8b8d" title="Access to the detector elements&amp;#39;s parent.">parent</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )  { <span class="comment">// Exclude &apos;world&apos;</span>
<a name="l00293"></a>00293       HandleMap::const_iterator j=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af86c69b812506c4e4543c7a845b040d0">m_sensitive</a>.find(det.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00294"></a>00294       <span class="keywordflow">if</span> ( j != <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af86c69b812506c4e4543c7a845b040d0">m_sensitive</a>.end() )  {
<a name="l00295"></a>00295         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html" title="Handle class to hold the information of a sensitive detector.">SensitiveDetector</a> sd((*j).second);
<a name="l00296"></a>00296         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>[sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#ad68e2f554ff61e15b9b54e9f01713d41" title="Access the type of the sensitive detector.">type</a>()].push_back(det);
<a name="l00297"></a>00297       }
<a name="l00298"></a>00298       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#ac3f1002c4b640a796ebd1854507496ac" title="Access detector type (structure, tracker, calorimeter, etc.).">type</a>() == <span class="stringliteral">&quot;compound&quot;</span> )  {
<a name="l00299"></a>00299         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>[det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#ac3f1002c4b640a796ebd1854507496ac" title="Access detector type (structure, tracker, calorimeter, etc.).">type</a>()].push_back(det);      
<a name="l00300"></a>00300       }
<a name="l00301"></a>00301       <span class="keywordflow">else</span>  {
<a name="l00302"></a>00302         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>[<span class="stringliteral">&quot;passive&quot;</span>].push_back(det);      
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00309"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a5d48161088950c2686eee7f28d58fde3">00309</a> <a class="code" href="classstd_1_1vector.html">vector&lt;string&gt;</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a5d48161088950c2686eee7f28d58fde3" title="Access the availible detector types.">LCDDImp::detectorTypes</a>()<span class="keyword"> const  </span>{
<a name="l00310"></a>00310   <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;IsClosed() ) {
<a name="l00311"></a>00311     <a class="code" href="classstd_1_1vector.html">vector&lt;string&gt;</a> <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>;
<a name="l00312"></a>00312     <span class="keywordflow">for</span>(DetectorTypeMap::const_iterator i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.begin(); i!=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.end(); ++i)  
<a name="l00313"></a>00313       v.push_back((*i).first);
<a name="l00314"></a>00314     <span class="keywordflow">return</span> v;
<a name="l00315"></a>00315   }
<a name="l00316"></a>00316   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;detectorTypes: Call only available once the geometry is closed!&quot;</span>);
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00320"></a>00320 <span class="keyword">const</span> <a class="code" href="classstd_1_1vector.html">vector&lt;DetElement&gt;</a>&amp; <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a7ec6dc28b69a23fcdaff59e73fc7c440" title="Accessor to the map of sub-detectors.">LCDDImp::detectors</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type, <span class="keywordtype">bool</span> throw_exc)  {
<a name="l00321"></a>00321   <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;IsClosed() ) {
<a name="l00322"></a>00322     <span class="keywordflow">if</span> ( throw_exc )  {
<a name="l00323"></a>00323       DetectorTypeMap::const_iterator i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type);
<a name="l00324"></a>00324       <span class="keywordflow">if</span> ( i != <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.end() ) <span class="keywordflow">return</span> (*i).second;
<a name="l00325"></a>00325       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;detectors(&quot;</span>+type+<span class="stringliteral">&quot;): Detectors of this type do not exist in the current setup!&quot;</span>);
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327     <span class="comment">// return empty vector instead of exception</span>
<a name="l00328"></a>00328     <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>[ type ] ;
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;detectors(&quot;</span>+type+<span class="stringliteral">&quot;): Detectors can only selected by type once the geometry is closed!&quot;</span>);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ab46d786f0e67c07c818b2e022ddd6dc4">00333</a> <a class="code" href="classstd_1_1vector.html">vector&lt;DetElement&gt;</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a7ec6dc28b69a23fcdaff59e73fc7c440" title="Accessor to the map of sub-detectors.">LCDDImp::detectors</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> includeFlag, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> excludeFlag )<span class="keyword"> const  </span>{
<a name="l00334"></a>00334   <span class="keywordflow">if</span>( ! <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;IsClosed() ) {
<a name="l00335"></a>00335     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;detectors(typeFlag): Detectors can only selected by typeFlag once the geometry is closed!&quot;</span>);
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337   <a class="code" href="classstd_1_1vector.html">vector&lt;DetElement&gt;</a> dets ;
<a name="l00338"></a>00338   dets.reserve( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.size() ) ;
<a name="l00339"></a>00339   
<a name="l00340"></a>00340   <span class="keywordflow">for</span>(HandleMap::const_iterator i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.begin(); i!=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.end(); ++i)   {
<a name="l00341"></a>00341     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> det((*i).second);
<a name="l00342"></a>00342     <span class="keywordflow">if</span> ( det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a6a7a665630b1b3af6dd172d9166b8b8d" title="Access to the detector elements&amp;#39;s parent.">parent</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>() )  { <span class="comment">// Exclude &apos;world&apos;</span>
<a name="l00343"></a>00343       
<a name="l00344"></a>00344       <span class="comment">//fixme: what to do with compounds - add their daughters  ?</span>
<a name="l00345"></a>00345       <span class="comment">// ...</span>
<a name="l00346"></a>00346 
<a name="l00347"></a>00347       <span class="keywordflow">if</span>( ( det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a7c6acb468c40a967e9e50a8efc2a620d">typeFlag</a>() &amp;  includeFlag ) == includeFlag &amp;&amp;
<a name="l00348"></a>00348           ( det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a7c6acb468c40a967e9e50a8efc2a620d">typeFlag</a>() &amp;  excludeFlag ) ==  0 )
<a name="l00349"></a>00349         dets.push_back( det ) ;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352   <span class="keywordflow">return</span> dets ;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00356"></a>00356 <a class="code" href="classstd_1_1vector.html">vector&lt;DetElement&gt;</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a7ec6dc28b69a23fcdaff59e73fc7c440" title="Accessor to the map of sub-detectors.">LCDDImp::detectors</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type1,
<a name="l00357"></a>00357                                       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type2,
<a name="l00358"></a>00358                                       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type3,
<a name="l00359"></a>00359                                       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type4,
<a name="l00360"></a>00360                                       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; type5 )  {
<a name="l00361"></a>00361   <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;IsClosed() ) {
<a name="l00362"></a>00362     <a class="code" href="classstd_1_1vector.html">vector&lt;DetElement&gt;</a> <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>;
<a name="l00363"></a>00363     DetectorTypeMap::const_iterator i, end=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.end();
<a name="l00364"></a>00364     <span class="keywordflow">if</span> ( !type1.empty() &amp;&amp; (i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type1)) != end )
<a name="l00365"></a>00365       v.insert(v.end(),(*i).second.begin(),(*i).second.end());
<a name="l00366"></a>00366     <span class="keywordflow">if</span> ( !type2.empty() &amp;&amp; (i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type2)) != end )
<a name="l00367"></a>00367       v.insert(v.end(),(*i).second.begin(),(*i).second.end());
<a name="l00368"></a>00368     <span class="keywordflow">if</span> ( !type3.empty() &amp;&amp; (i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type3)) != end )
<a name="l00369"></a>00369       v.insert(v.end(),(*i).second.begin(),(*i).second.end());
<a name="l00370"></a>00370     <span class="keywordflow">if</span> ( !type4.empty() &amp;&amp; (i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type4)) != end )
<a name="l00371"></a>00371       v.insert(v.end(),(*i).second.begin(),(*i).second.end());
<a name="l00372"></a>00372     <span class="keywordflow">if</span> ( !type5.empty() &amp;&amp; (i=<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae90ce0f851d3887bb833a42fa34c6aea" title="Inventory of detector types.">m_detectorTypes</a>.find(type5)) != end ) 
<a name="l00373"></a>00373       v.insert(v.end(),(*i).second.begin(),(*i).second.end());
<a name="l00374"></a>00374     <span class="keywordflow">return</span> v;
<a name="l00375"></a>00375   }
<a name="l00376"></a>00376   <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;detectors(&quot;</span>+type1+<span class="stringliteral">&quot;,&quot;</span>+type2+<span class="stringliteral">&quot;,...): Detectors can only selected by type once the geometry is closed!&quot;</span>);
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <a class="code" href="class_d_d4hep_1_1_handle.html" title="Handle: a templated class like a shared pointer, which allows specialized access...">Handle&lt;TObject&gt;</a> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad8724d04e7a03a495f51edea402d318f">LCDDImp::getRefChild</a>(<span class="keyword">const</span> <a class="code" href="class_l_c_d_d_1_1_handle_map.html">HandleMap</a>&amp; e, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keywordtype">bool</span> do_throw)<span class="keyword"> const </span>{
<a name="l00380"></a>00380   HandleMap::const_iterator i = e.find(name);
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (i != e.end()) {
<a name="l00382"></a>00382     <span class="keywordflow">return</span> (*i).second;
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (do_throw) {
<a name="l00385"></a>00385     <span class="keywordtype">int</span> cnt = 0;
<a name="l00386"></a>00386     cout &lt;&lt; <span class="stringliteral">&quot;GetRefChild: Failed to find child with name: &quot;</span> &lt;&lt; name
<a name="l00387"></a>00387          &lt;&lt; <span class="stringliteral">&quot; Map contains &quot;</span> &lt;&lt; e.size() &lt;&lt; <span class="stringliteral">&quot; elements.&quot;</span> &lt;&lt; endl;
<a name="l00388"></a>00388     <span class="keywordflow">for</span>(i=e.begin(); i!=e.end(); ++i)
<a name="l00389"></a>00389       cout &lt;&lt; <span class="stringliteral">&quot;   &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; (*i).first &lt;&lt; endl;
<a name="l00390"></a>00390     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Cannot find a child with the reference name:&quot;</span> + name);
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392   <span class="keywordflow">return</span> 0;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="keyword">namespace </span>{
<a name="l00396"></a>00396   <span class="keyword">struct </span>ShapePatcher: <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_scan.html" title="Geometry scanner (handle object).">GeoScan</a> {
<a name="l00397"></a>00397     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume_manager.html" title="Class to support the retrieval of detector elements and volumes given a valid identifier...">VolumeManager</a> m_volManager;
<a name="l00398"></a>00398     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> m_world;
<a name="l00399"></a>00399     ShapePatcher(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume_manager.html" title="Class to support the retrieval of detector elements and volumes given a valid identifier...">VolumeManager</a> <a class="code" href="namespacedd4hep.html#a443d1517e365c8f0c3a498bff0f09088">m</a>, <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> e)
<a name="l00400"></a>00400       : <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_scan.html" title="Geometry scanner (handle object).">GeoScan</a>(e), m_volManager(m), m_world(e) {
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402     <span class="keywordtype">void</span> patchShapes() {
<a name="l00403"></a>00403       <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types.html#a568935b7e878d3ea9fe97a2ecf33d641">GeoHandler::Data</a>&amp; data = *m_data;
<a name="l00404"></a>00404       <span class="keywordtype">char</span> text[32];
<a name="l00405"></a>00405       <span class="keywordtype">string</span> nam;
<a name="l00406"></a>00406       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;LCDD&quot;</span>,<span class="stringliteral">&quot;+++ Patching names of anonymous shapes....&quot;</span>);
<a name="l00407"></a>00407       <span class="keywordflow">for</span> (GeoHandler::Data::const_reverse_iterator i = data.rbegin(); i != data.rend(); ++i) {
<a name="l00408"></a>00408         <span class="keyword">const</span> GeoHandler::Data::mapped_type&amp; v = (*i).second;
<a name="l00409"></a>00409         <span class="keywordflow">for</span> (GeoHandler::Data::mapped_type::const_iterator j = v.begin(); j != v.end(); ++j) {
<a name="l00410"></a>00410           <span class="keyword">const</span> TGeoNode* n = *j;
<a name="l00411"></a>00411           TGeoVolume* vol = n-&gt;GetVolume();
<a name="l00412"></a>00412           TGeoShape*  <a class="code" href="_volumes_8cpp.html#a17ca6bfc8040d695d3cada22a4763d40">s</a>   = vol-&gt;GetShape();
<a name="l00413"></a>00413           <span class="keyword">const</span> <span class="keywordtype">char</span>* sn  = s-&gt;GetName();
<a name="l00414"></a>00414           ::snprintf(text,<span class="keyword">sizeof</span>(text),<span class="stringliteral">&quot;_shape_%p&quot;</span>,(<span class="keywordtype">void</span>*)s);
<a name="l00415"></a>00415           if (0 == sn || 0 == ::strlen(sn)) {
<a name="l00416"></a>00416             nam = vol-&gt;GetName();
<a name="l00417"></a>00417             nam += text;
<a name="l00418"></a>00418             s-&gt;SetName(nam.c_str());
<a name="l00419"></a>00419           }
<a name="l00420"></a>00420           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == ::strcmp(sn, s-&gt;IsA()-&gt;GetName())) {
<a name="l00421"></a>00421             nam = vol-&gt;GetName();
<a name="l00422"></a>00422             nam += text;
<a name="l00423"></a>00423             s-&gt;SetName(nam.c_str());
<a name="l00424"></a>00424           }
<a name="l00425"></a>00425           <span class="keywordflow">else</span> {
<a name="l00426"></a>00426             nam = sn;
<a name="l00427"></a>00427             <span class="keywordflow">if</span> (nam.find(<span class="stringliteral">&quot;_shape&quot;</span>) == string::npos)
<a name="l00428"></a>00428               nam += text;
<a name="l00429"></a>00429             s-&gt;SetName(nam.c_str());
<a name="l00430"></a>00430           }
<a name="l00431"></a>00431           <span class="keywordflow">if</span> (s-&gt;IsA() == TGeoCompositeShape::Class()) {
<a name="l00432"></a>00432             TGeoCompositeShape* c = (TGeoCompositeShape*) s;
<a name="l00433"></a>00433             <span class="keyword">const</span> TGeoBoolNode* <span class="keywordtype">boolean</span> = c-&gt;GetBoolNode();
<a name="l00434"></a>00434             s = <span class="keywordtype">boolean</span>-&gt;GetLeftShape();
<a name="l00435"></a>00435             sn = s-&gt;GetName();
<a name="l00436"></a>00436             <span class="keywordflow">if</span> (0 == sn || 0 == ::strlen(sn)) {
<a name="l00437"></a>00437               s-&gt;SetName((nam + <span class="stringliteral">&quot;_left&quot;</span>).c_str());
<a name="l00438"></a>00438             }
<a name="l00439"></a>00439             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == ::strcmp(sn, s-&gt;IsA()-&gt;GetName())) {
<a name="l00440"></a>00440               s-&gt;SetName((nam + <span class="stringliteral">&quot;_left&quot;</span>).c_str());
<a name="l00441"></a>00441             }
<a name="l00442"></a>00442             s = <span class="keywordtype">boolean</span>-&gt;GetRightShape();
<a name="l00443"></a>00443             sn = s-&gt;GetName();
<a name="l00444"></a>00444             <span class="keywordflow">if</span> (0 == sn || 0 == ::strlen(sn)) {
<a name="l00445"></a>00445               s-&gt;SetName((nam + <span class="stringliteral">&quot;_right&quot;</span>).c_str());
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == ::strcmp(s-&gt;GetName(), s-&gt;IsA()-&gt;GetName())) {
<a name="l00448"></a>00448               s-&gt;SetName((nam + <span class="stringliteral">&quot;_right&quot;</span>).c_str());
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450           }
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452       }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454   };
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aa3fa37aa7608b67f95aa644dc381389f">00458</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aa3fa37aa7608b67f95aa644dc381389f" title="Finalize the geometry.">LCDDImp::endDocument</a>() {
<a name="l00459"></a>00459   TGeoManager* mgr = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>;
<a name="l00460"></a>00460   <span class="keywordflow">if</span> (!mgr-&gt;IsClosed()) {
<a name="l00461"></a>00461 <span class="preprocessor">#if 0</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span>    <a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> trackingRegion(<span class="stringliteral">&quot;TrackingRegion&quot;</span>);
<a name="l00463"></a>00463     trackingRegion.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#a29293fa51db7f4469c51a7638a77043a">setThreshold</a>(1);
<a name="l00464"></a>00464     trackingRegion.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#a491be77e5c4a5098fa1ae6acb8fac442">setStoreSecondaries</a>(<span class="keyword">true</span>);
<a name="l00465"></a>00465     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aad80a2a7fab34d16dfdc2da299076dab" title="Add a new constant to the detector description.">add</a>(trackingRegion);
<a name="l00466"></a>00466     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a05d9a2147427574904e80936b009d5ec">m_trackingVol</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a4070385330a1c5200adaaa13ef4e6547" title="Set the regional attributes to the volume. Note: If the name string is empty, the...">setRegion</a>(trackingRegion);
<a name="l00467"></a>00467     <span class="comment">// Set the tracking volume to invisible.</span>
<a name="l00468"></a>00468     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html" title="Handle class describing visualization attributes.">VisAttr</a> trackingVis(<span class="stringliteral">&quot;TrackingVis&quot;</span>);
<a name="l00469"></a>00469     trackingVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a499e3e8252f4abd62be3a3be521f10b4" title="Set visibility flag.">setVisible</a>(<span class="keyword">false</span>);
<a name="l00470"></a>00470     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a05d9a2147427574904e80936b009d5ec">m_trackingVol</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a5db10a2a883d77b2654fe1875d5d7bb5" title="Set Visualization attributes to the volume.">setVisAttributes</a>(trackingVis);
<a name="l00471"></a>00471     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aad80a2a7fab34d16dfdc2da299076dab" title="Add a new constant to the detector description.">add</a>(trackingVis);
<a name="l00472"></a>00472 <span class="preprocessor">#endif</span>
<a name="l00475"></a>00475 <span class="preprocessor">    mgr-&gt;CloseGeometry();</span>
<a name="l00476"></a>00476 <span class="preprocessor"></span>    ShapePatcher patcher(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a8a01d0ac487c537e9826d2900c95062a" title="Volume manager reference.">m_volManager</a>, <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>);
<a name="l00477"></a>00477     patcher.patchShapes();
<a name="l00478"></a>00478     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ade5422f804607ee686022a4a05bd3cff" title="Internal helper to map detector types once the geometry is closed.">mapDetectorTypes</a>();
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#af0cf7ab83180ee15085bcc7e1383f561">00482</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#af0cf7ab83180ee15085bcc7e1383f561" title="Initialize geometry.">LCDDImp::init</a>() {
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (!<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>()) {
<a name="l00484"></a>00484     TGeoManager* mgr = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>;
<a name="l00485"></a>00485     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_box.html" title="Class describing a box shape.">Box</a> worldSolid(<span class="stringliteral">&quot;world_x&quot;</span>, <span class="stringliteral">&quot;world_y&quot;</span>, <span class="stringliteral">&quot;world_z&quot;</span>);
<a name="l00486"></a>00486     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;LCDD&quot;</span>,<span class="stringliteral">&quot; *********** created World volume with size : %7.0f %7.0f %7.0f&quot;</span>,
<a name="l00487"></a>00487              worldSolid-&gt;GetDX(), worldSolid-&gt;GetDY(), worldSolid-&gt;GetDZ());
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#ac4e5dcab68ed7a7e7799a5a2ae8705d8">m_materialAir</a> = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#acd3ac5d06042d6c1adda04ef5a974b62" title="Retrieve a matrial by it&amp;#39;s name from the detector description.">material</a>(<span class="stringliteral">&quot;Air&quot;</span>);
<a name="l00490"></a>00490     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#aa786b32f3e175bacb701cb50f164d144">m_materialVacuum</a> = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#acd3ac5d06042d6c1adda04ef5a974b62" title="Retrieve a matrial by it&amp;#39;s name from the detector description.">material</a>(<span class="stringliteral">&quot;Vacuum&quot;</span>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> world_vol(<span class="stringliteral">&quot;world_volume&quot;</span>, worldSolid, m_materialAir);
<a name="l00493"></a>00493     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a> = <a class="code" href="namespace_d_d4hep.html#a21dd977310ff183f61ca6ae14b59a989">DetElement</a>(<span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_world_object.html" title="Data class with properties of a detector element.">WorldObject</a>(*<span class="keyword">this</span>,<span class="stringliteral">&quot;world&quot;</span>));
<a name="l00494"></a>00494     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a> = world_vol;
<a name="l00495"></a>00495     <span class="comment">// Set the world volume to invisible.</span>
<a name="l00496"></a>00496     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html" title="Handle class describing visualization attributes.">VisAttr</a> worldVis(<span class="stringliteral">&quot;WorldVis&quot;</span>);
<a name="l00497"></a>00497     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#aeca9848b297213098eac1fd882fd7680" title="Set alpha value.">setAlpha</a>(1.0);
<a name="l00498"></a>00498     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a499e3e8252f4abd62be3a3be521f10b4" title="Set visibility flag.">setVisible</a>(<span class="keyword">false</span>);
<a name="l00499"></a>00499     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#af29f0854b9e6866b31830dd673f92df8" title="Set Flag to show/hide daughter elements.">setShowDaughters</a>(<span class="keyword">true</span>);
<a name="l00500"></a>00500     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#aa9f0dec964e94cbb6df397e242ac57b5" title="Set object color.">setColor</a>(1.0, 1.0, 1.0);
<a name="l00501"></a>00501     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#ad86fa3158adc9cb58bdf7d72da8f1eee" title="Set line style.">setLineStyle</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630abb85e6313ec27720fcbae236740dd4c9">VisAttr::SOLID</a>);
<a name="l00502"></a>00502     worldVis.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a37d208476b8631402fe4777061abfc81" title="Set drawing style.">setDrawingStyle</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630a0d68594c8595d3e08905204dc4262e4e">VisAttr::WIREFRAME</a>);
<a name="l00503"></a>00503     <span class="comment">//m_worldVol.setVisAttributes(worldVis);</span>
<a name="l00504"></a>00504     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>-&gt;SetVisibility(kFALSE);
<a name="l00505"></a>00505     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>-&gt;SetVisDaughters(kTRUE);
<a name="l00506"></a>00506     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>-&gt;SetVisContainers(kTRUE);
<a name="l00507"></a>00507     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#aad80a2a7fab34d16dfdc2da299076dab" title="Add a new constant to the detector description.">add</a>(worldVis);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="preprocessor">#if 0</span>
<a name="l00510"></a>00510 <span class="preprocessor"></span>    <a class="code" href="class_d_d4hep_1_1_geometry_1_1_tube.html" title="Class describing a tube shape of a section of a tube.">Tube</a> trackingSolid(0.,<span class="stringliteral">&quot;tracking_region_radius&quot;</span>,<span class="stringliteral">&quot;2*tracking_region_zmax&quot;</span>,2*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l00511"></a>00511     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> tracking(<span class="stringliteral">&quot;tracking_volume&quot;</span>,trackingSolid, m_materialAir);
<a name="l00512"></a>00512     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a0e76f8fc72b987e8b7e115fc7e9b7483">m_trackers</a> = TopDetElement(<span class="stringliteral">&quot;tracking&quot;</span>);
<a name="l00513"></a>00513     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a05d9a2147427574904e80936b009d5ec">m_trackingVol</a> = tracking;
<a name="l00514"></a>00514     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pv = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a61a47d1aa7dfeb411f663d7425aad1e6" title="Place daughter volume. The position and rotation are the identity.">placeVolume</a>(tracking);
<a name="l00515"></a>00515     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a0e76f8fc72b987e8b7e115fc7e9b7483">m_trackers</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a18640f84168adced73afd4eb2b84a798" title="Set the physical volumes of the detector element.">setPlacement</a>(pv);
<a name="l00516"></a>00516     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a336e54ac88a2f3493f82138699899517" title="Add new child to the detector structure.">add</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a0e76f8fc72b987e8b7e115fc7e9b7483">m_trackers</a>);
<a name="l00517"></a>00517 <span class="preprocessor">#endif</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>    <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#af9733efff6b4cb6c8db334a65bff61c7">m_detectors</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data_1_1_object_handle_map.html#a8881f90a02ef95a6a2e558f092e8f81a">append</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>);
<a name="l00519"></a>00519     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>-&gt;SetTopVolume(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>.<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>());
<a name="l00520"></a>00520     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a3ef048ff40cb10d7321edb4e128319c4">m_world</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a18640f84168adced73afd4eb2b84a798" title="Set the physical volumes of the detector element.">setPlacement</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a>(mgr-&gt;GetTopNode()));
<a name="l00521"></a>00521   }
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00525"></a>00525 <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a23921e95e2ba300135d635e58ecb0c51" title="Read any XML file.">LCDDImp::fromXML</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; xmlfile, <a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965fab" title="Detector description build types.">LCDDBuildType</a> build_type) {
<a name="l00526"></a>00526   TypePreserve build_type_preserve(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a5cd51ba18f6d2e7723acc93d9b7a90e4" title="VolumeManager m_volManager;.">m_buildType</a> = build_type);
<a name="l00527"></a>00527 <span class="preprocessor">#if DD4HEP_USE_PYROOT</span>
<a name="l00528"></a>00528 <span class="preprocessor"></span>  <span class="keywordtype">string</span> cmd;
<a name="l00529"></a>00529   TPython::Exec(<span class="stringliteral">&quot;import lcdd&quot;</span>);
<a name="l00530"></a>00530   cmd = <span class="stringliteral">&quot;lcdd.fromXML(&apos;&quot;</span> + xmlfile + <span class="stringliteral">&quot;&apos;)&quot;</span>;
<a name="l00531"></a>00531   TPython::Exec(cmd.c_str());
<a name="l00532"></a>00532 <span class="preprocessor">#else</span>
<a name="l00533"></a>00533 <span class="preprocessor"></span>  <a class="code" href="class_d_d4hep_1_1_l_c_d_d_load.html#ad66ecd500f706896d32c5dbd050292bb" title="Process XML unit and adopt all data from source structure.">processXML</a>(xmlfile,0);
<a name="l00534"></a>00534 <span class="preprocessor">#endif</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>}
<a name="l00536"></a>00536 
<a name="l00538"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ae1c435032cd33235cd6405ca8d8aae9b">00538</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a23921e95e2ba300135d635e58ecb0c51" title="Read any XML file.">LCDDImp::fromXML</a>(<span class="keyword">const</span> std::string&amp; fname, <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_uri_reader.html" title="Class supporting to read data given a URI.">UriReader</a>* entity_resolver, <a class="code" href="namespace_d_d4hep.html#acafe43ba4537ab6e999e808142965fab" title="Detector description build types.">LCDDBuildType</a> build_type)  {
<a name="l00539"></a>00539   TypePreserve build_type_preserve(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a5cd51ba18f6d2e7723acc93d9b7a90e4" title="VolumeManager m_volManager;.">m_buildType</a> = build_type);
<a name="l00540"></a>00540   <a class="code" href="class_d_d4hep_1_1_l_c_d_d_load.html#ad66ecd500f706896d32c5dbd050292bb" title="Process XML unit and adopt all data from source structure.">processXML</a>(fname,entity_resolver);
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad50f1540a6b3d99e049e1e4a91eabf8a">00543</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#ad50f1540a6b3d99e049e1e4a91eabf8a" title="Stupid legacy method.">LCDDImp::dump</a>()<span class="keyword"> const </span>{
<a name="l00544"></a>00544   TGeoManager* mgr = <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#afd2dd18b9befa7e8ebb9a9ecf4faca03">m_manager</a>;
<a name="l00545"></a>00545   mgr-&gt;SetVisLevel(4);
<a name="l00546"></a>00546   mgr-&gt;SetVisOption(1);
<a name="l00547"></a>00547   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_data.html#a42d6d627a9a04c95cda9bff9ef760abe">m_worldVol</a>-&gt;Draw(<span class="stringliteral">&quot;ogl&quot;</span>);
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00551"></a><a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a3dfdf0180fa0a61067bd1f12fa15ecd6">00551</a> <span class="keywordtype">long</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d_imp.html#a3dfdf0180fa0a61067bd1f12fa15ecd6" title="Manipulate geometry using facroy converter.">LCDDImp::apply</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* factory_type, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
<a name="l00552"></a>00552   <span class="keywordtype">string</span> fac = factory_type;
<a name="l00553"></a>00553   <span class="keywordflow">try</span> {
<a name="l00554"></a>00554     <span class="keywordtype">long</span> result = PluginService::Create&lt;long&gt;(fac, (<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>*) <span class="keyword">this</span>, argc, argv);
<a name="l00555"></a>00555     <span class="keywordflow">if</span> (0 == result) {
<a name="l00556"></a>00556       <a class="code" href="struct_d_d4hep_1_1_plugin_debug.html" title="Helper to debug plugin manager calls.">PluginDebug</a> dbg;
<a name="l00557"></a>00557       result = PluginService::Create&lt;long&gt;(fac, (<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>*) <span class="keyword">this</span>, argc, argv);
<a name="l00558"></a>00558       <span class="keywordflow">if</span> ( 0 == result )  {
<a name="l00559"></a>00559         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;DD4hep: apply-plugin: Failed to locate plugin &quot;</span> +
<a name="l00560"></a>00560                             fac + <span class="stringliteral">&quot;. &quot;</span> + dbg.<a class="code" href="struct_d_d4hep_1_1_plugin_debug.html#a93143c7d731e176fe8c7a791edf01c28" title="Helper to check factory existence.">missingFactory</a>(fac));
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563     result = *(<span class="keywordtype">long</span>*) result;
<a name="l00564"></a>00564     <span class="keywordflow">if</span> (result != 1) {
<a name="l00565"></a>00565       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;DD4hep: apply-plugin: Failed to execute plugin &quot;</span> + fac);
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567     <span class="keywordflow">return</span> result;
<a name="l00568"></a>00568   }
<a name="l00569"></a>00569   <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="namespace_d_d4hep_1_1_x_m_l.html#a60be75f70ac155f3f1a92aa1c69f085b">XML::XmlException</a>&amp; e) {
<a name="l00570"></a>00570     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<a class="code" href="group___d_d4_h_e_p___x_m_l.html#gad2124529d3b80b7896b4d5a370ee906e" title="Convert xml attribute to STL string.">XML::_toString</a>(e.msg) + <span class="stringliteral">&quot;\nDD4hep: XML-DOM Exception with plugin:&quot;</span> + fac);
<a name="l00571"></a>00571   }
<a name="l00572"></a>00572   <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classstd_1_1exception.html">exception</a>&amp; e) {
<a name="l00573"></a>00573     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="keywordtype">string</span>(e.what()) + <span class="stringliteral">&quot;\nDD4hep: with plugin:&quot;</span> + fac);
<a name="l00574"></a>00574   }
<a name="l00575"></a>00575   <span class="keywordflow">catch</span> (...) {
<a name="l00576"></a>00576     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;UNKNOWN exception from plugin:&quot;</span> + fac);
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578   <span class="keywordflow">return</span> EINVAL;
<a name="l00579"></a>00579 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
