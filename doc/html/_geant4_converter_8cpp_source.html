<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Converter.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Converter.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Converter.cpp</h1><a href="_geant4_converter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id$</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_l_c_d_d_8h.html">DD4hep/LCDD.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_plugins_8h.html">DD4hep/Plugins.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_volumes_8h.html">DD4hep/Volumes.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_printout_8h.html">DD4hep/Printout.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_d_d4hep_units_8h.html">DD4hep/DD4hepUnits.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_objects_interna_8h.html">DD4hep/objects/ObjectsInterna.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_detector_interna_8h.html">DD4hep/objects/DetectorInterna.h</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_field_8h.html">DDG4/Geant4Field.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_converter_8h.html">DDG4/Geant4Converter.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_sensitive_detector_8h.html">DDG4/Geant4SensitiveDetector.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">// ROOT includes</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;TROOT.h&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;TColor.h&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;TGeoNode.h&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;TGeoShape.h&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;TGeoCone.h&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;TGeoHype.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;TGeoPcon.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;TGeoEltu.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;TGeoPgon.h&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;TGeoSphere.h&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;TGeoTorus.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;TGeoTrd1.h&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;TGeoTrd2.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;TGeoTube.h&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;TGeoArb8.h&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;TGeoMatrix.h&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;TGeoBoolNode.h&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;TGeoParaboloid.h&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;TGeoCompositeShape.h&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;TGeoShapeAssembly.h&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;TGeoScaledShape.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;TGeoManager.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;TClass.h&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;TMath.h&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">// Geant4 include files</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;G4VisAttributes.hh&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;G4ProductionCuts.hh&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;G4VUserRegionInformation.hh&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;G4Element.hh&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;G4Box.hh&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;G4Trd.hh&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;G4Tubs.hh&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;G4Trap.hh&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;G4Cons.hh&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;G4Hype.hh&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;G4Torus.hh&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;G4Sphere.hh&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;G4Polycone.hh&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;G4Polyhedra.hh&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;G4UnionSolid.hh&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;G4Paraboloid.hh&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;G4Ellipsoid.hh&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;G4EllipticalTube.hh&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;G4SubtractionSolid.hh&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;G4IntersectionSolid.hh&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;G4Region.hh&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;G4UserLimits.hh&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;G4LogicalVolume.hh&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;G4Material.hh&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;G4Element.hh&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;G4Isotope.hh&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;G4Transform3D.hh&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;G4ThreeVector.hh&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;G4PVPlacement.hh&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;G4ElectroMagneticField.hh&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;G4FieldManager.hh&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;G4ReflectionFactory.hh&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;CLHEP/Units/SystemOfUnits.h&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">// C/C++ include files</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="keyword">using namespace </span>DD4hep::Simulation;
<a name="l00096"></a>00096 <span class="comment">//using namespace DD4hep::Simulation::Geant4GeometryMaps;</span>
<a name="l00097"></a>00097 <span class="keyword">using namespace </span>DD4hep::Geometry;
<a name="l00098"></a>00098 <span class="keyword">using namespace </span>DD4hep;
<a name="l00099"></a>00099 <span class="keyword">using namespace </span>std;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_assembly_volume_8h.html">DDG4/Geant4AssemblyVolume.h</a>&quot;</span>
<a name="l00102"></a>00102 <span class="preprocessor">#include &quot;<a class="code" href="_detector_tools_8h.html">DD4hep/DetectorTools.h</a>&quot;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#include &quot;G4RotationMatrix.hh&quot;</span>
<a name="l00104"></a>00104 <span class="preprocessor">#include &quot;G4AffineTransform.hh&quot;</span>
<a name="l00105"></a>00105 <span class="preprocessor">#include &quot;G4LogicalVolume.hh&quot;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &quot;G4VPhysicalVolume.hh&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &quot;G4ReflectionFactory.hh&quot;</span>
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#a5f445612042e1ff7a273e1c2fdb5111b">00109</a> <span class="keywordtype">void</span> Geant4AssemblyVolume::imprint(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info,
<a name="l00110"></a>00110                                    <span class="keyword">const</span> TGeoNode*   parent,
<a name="l00111"></a>00111                                    Chain chain,
<a name="l00112"></a>00112                                    <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>* pAssembly,
<a name="l00113"></a>00113                                    G4LogicalVolume*  pMotherLV,
<a name="l00114"></a>00114                                    G4Transform3D&amp;    transformation,
<a name="l00115"></a>00115                                    G4int copyNumBase,
<a name="l00116"></a>00116                                    G4bool surfCheck )
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118   TGeoVolume* vol = parent-&gt;GetVolume();
<a name="l00119"></a>00119   <span class="keyword">static</span> <span class="keywordtype">int</span> level=0;
<a name="l00120"></a>00120   ++level;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  numberOfDaughters;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <span class="keywordflow">if</span>( copyNumBase == 0 )
<a name="l00126"></a>00126   {
<a name="l00127"></a>00127     numberOfDaughters = pMotherLV-&gt;GetNoDaughters();
<a name="l00128"></a>00128   }
<a name="l00129"></a>00129   <span class="keywordflow">else</span>
<a name="l00130"></a>00130   {
<a name="l00131"></a>00131     numberOfDaughters = copyNumBase;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="comment">// We start from the first available index</span>
<a name="l00135"></a>00135   <span class="comment">//</span>
<a name="l00136"></a>00136   numberOfDaughters++;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   ImprintsCountPlus();
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   std::vector&lt;G4AssemblyTriplet&gt; triplets = pAssembly-&gt;fTriplets;
<a name="l00141"></a>00141   <span class="comment">//cout &lt;&lt; &quot; Assembly:&quot; &lt;&lt; DetectorTools::placementPath(chain) &lt;&lt; endl;</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; triplets.size(); i++ )  {
<a name="l00144"></a>00144     <span class="keyword">const</span> TGeoNode* node = pAssembly-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#a0d910d90aa651bf5ccb3816c5ce3641a">m_entries</a>[i];
<a name="l00145"></a>00145     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#ad79481b292635c219fcc03d160689211">Chain</a> new_chain = chain;
<a name="l00146"></a>00146     new_chain.push_back(node);
<a name="l00147"></a>00147     <span class="comment">//cout &lt;&lt; &quot; Assembly: Entry: &quot; &lt;&lt; DetectorTools::placementPath(new_chain) &lt;&lt; endl;</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     G4Transform3D Ta( *(triplets[i].GetRotation()),
<a name="l00150"></a>00150                       triplets[i].GetTranslation() );
<a name="l00151"></a>00151     <span class="keywordflow">if</span> ( triplets[i].IsReflection() )  { Ta = Ta * G4ReflectZ3D(); }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     G4Transform3D Tfinal = transformation * Ta;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">if</span> ( triplets[i].GetVolume() )
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       <span class="comment">// Generate the unique name for the next PV instance</span>
<a name="l00158"></a>00158       <span class="comment">// The name has format:</span>
<a name="l00159"></a>00159       <span class="comment">//</span>
<a name="l00160"></a>00160       <span class="comment">// av_WWW_impr_XXX_YYY_ZZZ</span>
<a name="l00161"></a>00161       <span class="comment">// where the fields mean:</span>
<a name="l00162"></a>00162       <span class="comment">// WWW - assembly volume instance number</span>
<a name="l00163"></a>00163       <span class="comment">// XXX - assembly volume imprint number</span>
<a name="l00164"></a>00164       <span class="comment">// YYY - the name of a log. volume we want to make a placement of</span>
<a name="l00165"></a>00165       <span class="comment">// ZZZ - the log. volume index inside the assembly volume</span>
<a name="l00166"></a>00166       <span class="comment">//</span>
<a name="l00167"></a>00167       std::stringstream pvName;
<a name="l00168"></a>00168       pvName &lt;&lt; <span class="stringliteral">&quot;av_&quot;</span>
<a name="l00169"></a>00169              &lt;&lt; GetAssemblyID()
<a name="l00170"></a>00170              &lt;&lt; <span class="stringliteral">&quot;_impr_&quot;</span>
<a name="l00171"></a>00171              &lt;&lt; GetImprintsCount()
<a name="l00172"></a>00172              &lt;&lt; <span class="stringliteral">&quot;_&quot;</span>
<a name="l00173"></a>00173              &lt;&lt; triplets[i].GetVolume()-&gt;GetName().c_str()
<a name="l00174"></a>00174              &lt;&lt; <span class="stringliteral">&quot;_pv_&quot;</span>
<a name="l00175"></a>00175              &lt;&lt; i
<a name="l00176"></a>00176              &lt;&lt; std::ends;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178       <span class="comment">// Generate a new physical volume instance inside a mother</span>
<a name="l00179"></a>00179       <span class="comment">// (as we allow 3D transformation use G4ReflectionFactory to</span>
<a name="l00180"></a>00180       <span class="comment">//  take into account eventual reflection)</span>
<a name="l00181"></a>00181       <span class="comment">//</span>
<a name="l00182"></a>00182       G4PhysicalVolumesPair pvPlaced
<a name="l00183"></a>00183         = G4ReflectionFactory::Instance()-&gt;Place( Tfinal,
<a name="l00184"></a>00184                                                   pvName.str().c_str(),
<a name="l00185"></a>00185                                                   triplets[i].GetVolume(),
<a name="l00186"></a>00186                                                   pMotherLV,
<a name="l00187"></a>00187                                                   <span class="keyword">false</span>,
<a name="l00188"></a>00188                                                   numberOfDaughters + i,
<a name="l00189"></a>00189                                                   surfCheck );
<a name="l00190"></a>00190 
<a name="l00191"></a>00191       <span class="comment">// Register the physical volume created by us so we can delete it later</span>
<a name="l00192"></a>00192       <span class="comment">//</span>
<a name="l00193"></a>00193       fPVStore.push_back( pvPlaced.first );
<a name="l00194"></a>00194       info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a62c7998ab4b27c040c67577a136e93e9">g4VolumeImprints</a>[vol].push_back(make_pair(new_chain,pvPlaced.first));
<a name="l00195"></a>00195 <span class="preprocessor">#if 0</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>      cout &lt;&lt; <span class="stringliteral">&quot; Assembly:Parent:&quot;</span> &lt;&lt; parent-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; node-&gt;GetName()
<a name="l00197"></a>00197            &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt;  (<span class="keywordtype">void</span>*)node &lt;&lt; <span class="stringliteral">&quot; G4:&quot;</span> &lt;&lt; pvName.str() &lt;&lt; <span class="stringliteral">&quot; Daughter:&quot;</span>
<a name="l00198"></a>00198            &lt;&lt; <a class="code" href="namespace_d_d4hep_1_1_geometry_1_1_detector_tools.html#a1ca0d88ab941b6dde4776c6b3b893fb6" title="Assemble the placement path from a given detector element to the world volume.">DetectorTools::placementPath</a>(new_chain) &lt;&lt; endl;
<a name="l00199"></a>00199       cout &lt;&lt; endl;
<a name="l00200"></a>00200 <span class="preprocessor">#endif</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a>00202       <span class="keywordflow">if</span> ( pvPlaced.second )  {
<a name="l00203"></a>00203         G4Exception(<span class="stringliteral">&quot;G4AssemblyVolume::MakeImprint(..)&quot;</span>, <span class="stringliteral">&quot;GeomVol0003&quot;</span>, FatalException,
<a name="l00204"></a>00204                     <span class="stringliteral">&quot;Fancy construct popping new mother from the stack!&quot;</span>);
<a name="l00205"></a>00205         <span class="comment">//fPVStore.push_back( pvPlaced.second );</span>
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( triplets[i].GetAssembly() )  {
<a name="l00209"></a>00209       <span class="comment">// Place volumes in this assembly with composed transformation</span>
<a name="l00210"></a>00210       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#a5f445612042e1ff7a273e1c2fdb5111b">imprint</a>(info, parent, new_chain, (<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>*)triplets[i].GetAssembly(), pMotherLV, Tfinal, i*100+copyNumBase, surfCheck );
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     <span class="keywordflow">else</span>   {
<a name="l00213"></a>00213       --level;
<a name="l00214"></a>00214       G4Exception(<span class="stringliteral">&quot;G4AssemblyVolume::MakeImprint(..)&quot;</span>,
<a name="l00215"></a>00215                   <span class="stringliteral">&quot;GeomVol0003&quot;</span>, FatalException,
<a name="l00216"></a>00216                   <span class="stringliteral">&quot;Triplet has no volume and no assembly&quot;</span>);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218   }
<a name="l00219"></a>00219   <span class="comment">//cout &lt;&lt; &quot;Imprinted assembly level:&quot; &lt;&lt; level &lt;&lt; &quot; in mother:&quot; &lt;&lt; pMotherLV-&gt;GetName() &lt;&lt; endl;</span>
<a name="l00220"></a>00220   --level;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="keyword">namespace </span>{
<a name="l00224"></a>00224   <span class="keyword">static</span> <span class="keywordtype">string</span> indent = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00225"></a>00225   <span class="keyword">static</span> Double_t s_identity_rot[] = { 1., 0., 0., 0., 1., 0., 0., 0., 1. };
<a name="l00226"></a>00226   <span class="keyword">struct </span>MyTransform3D : <span class="keyword">public</span> G4Transform3D {
<a name="l00227"></a>00227     MyTransform3D(<span class="keywordtype">double</span> XX, <span class="keywordtype">double</span> XY, <span class="keywordtype">double</span> XZ, <span class="keywordtype">double</span> DX, <span class="keywordtype">double</span> YX, <span class="keywordtype">double</span> YY, <span class="keywordtype">double</span> YZ, <span class="keywordtype">double</span> DY, <span class="keywordtype">double</span> ZX, <span class="keywordtype">double</span> ZY,
<a name="l00228"></a>00228                   <span class="keywordtype">double</span> ZZ, <span class="keywordtype">double</span> DZ)
<a name="l00229"></a>00229       : G4Transform3D(XX, XY, XZ, DX, YX, YY, YZ, DY, ZX, ZY, ZZ, DZ) {
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231     MyTransform3D(<span class="keyword">const</span> <span class="keywordtype">double</span>* t, <span class="keyword">const</span> <span class="keywordtype">double</span>* r = s_identity_rot)
<a name="l00232"></a>00232       : G4Transform3D(r[0],r[1],r[2],t[0]*<a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,r[3],r[4],r[5],t[1]*<a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,r[6],r[7],r[8],t[2]*<a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>)  {
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234   };
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="preprocessor">#if 0  // warning: unused function &apos;handleName&apos; [-Wunused-function]</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>  <span class="keywordtype">void</span> handleName(<span class="keyword">const</span> TGeoNode* n) {
<a name="l00238"></a>00238     TGeoVolume* <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a> = n-&gt;GetVolume();
<a name="l00239"></a>00239     TGeoMedium* <a class="code" href="namespacedd4hep.html#a443d1517e365c8f0c3a498bff0f09088">m</a> = v-&gt;GetMedium();
<a name="l00240"></a>00240     TGeoShape* <a class="code" href="_volumes_8cpp.html#a17ca6bfc8040d695d3cada22a4763d40">s</a> = v-&gt;GetShape();
<a name="l00241"></a>00241     <span class="keywordtype">string</span> nam;
<a name="l00242"></a>00242     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ad22cda76fc1b3a55bc359945db9c811c">DEBUG</a>, <span class="stringliteral">&quot;G4&quot;</span>, <span class="stringliteral">&quot;TGeoNode:&apos;%s&apos; Vol:&apos;%s&apos; Shape:&apos;%s&apos; Medium:&apos;%s&apos;&quot;</span>, n-&gt;GetName(), v-&gt;GetName(), s-&gt;GetName(),
<a name="l00243"></a>00243              m-&gt;GetName());
<a name="l00244"></a>00244   }
<a name="l00245"></a>00245 <span class="preprocessor">#endif</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00247"></a>00247   <span class="keyword">class </span>G4UserRegionInformation : <span class="keyword">public</span> G4VUserRegionInformation {
<a name="l00248"></a>00248   <span class="keyword">public</span>:
<a name="l00249"></a>00249     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> region;
<a name="l00250"></a>00250     <span class="keywordtype">double</span> threshold;
<a name="l00251"></a>00251     <span class="keywordtype">bool</span> storeSecondaries;
<a name="l00252"></a>00252     G4UserRegionInformation()
<a name="l00253"></a>00253       : threshold(0.0), storeSecondaries(false) {
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     <span class="keyword">virtual</span> ~G4UserRegionInformation() {
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Print()<span class="keyword"> const </span>{
<a name="l00258"></a>00258       <span class="keywordflow">if</span> (region.isValid())
<a name="l00259"></a>00259         <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ad22cda76fc1b3a55bc359945db9c811c">DEBUG</a>, <span class="stringliteral">&quot;Region&quot;</span>, <span class="stringliteral">&quot;Name:%s&quot;</span>, region.name());
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261   };
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00265"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#aaed2b0700c7bdbc747a7c5cf0b0e4b0e">00265</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#aaed2b0700c7bdbc747a7c5cf0b0e4b0e" title="Initializing Constructor.">Geant4Converter::Geant4Converter</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; lcdd_ref)
<a name="l00266"></a>00266   : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html" title="Geometry mapping from DD4hep to Geant 4.">Geant4Mapping</a>(lcdd_ref), m_checkOverlaps(true) {
<a name="l00267"></a>00267   this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a241f6e8f761d19caf370fe43fbf22015" title="Create and attach new data block. Delete old data block if present.">Geant4Mapping::init</a>();
<a name="l00268"></a>00268   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#a8fa03e76401899e921dffb88684e89be">m_propagateRegions</a> = <span class="keyword">true</span>;
<a name="l00269"></a>00269   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a> = <a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42">PrintLevel</a>(<a class="code" href="namespace_d_d4hep.html#abdbd705fe59353c8596e4ad5b7355814" title="Access the current printer level.">printLevel</a>() - 1);
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00273"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a102d0182df67257e795fde27d685b830">00273</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#aaed2b0700c7bdbc747a7c5cf0b0e4b0e" title="Initializing Constructor.">Geant4Converter::Geant4Converter</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">LCDD</a>&amp; lcdd_ref, <a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42">PrintLevel</a> level)
<a name="l00274"></a>00274   : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html" title="Geometry mapping from DD4hep to Geant 4.">Geant4Mapping</a>(lcdd_ref), m_checkOverlaps(true) {
<a name="l00275"></a>00275   this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a241f6e8f761d19caf370fe43fbf22015" title="Create and attach new data block. Delete old data block if present.">Geant4Mapping::init</a>();
<a name="l00276"></a>00276   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#a8fa03e76401899e921dffb88684e89be">m_propagateRegions</a> = <span class="keyword">true</span>;
<a name="l00277"></a>00277   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a> = level;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00281"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a7f6a35aaa5aa5609700e21a061c142e3">00281</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a7f6a35aaa5aa5609700e21a061c142e3" title="Standard destructor.">Geant4Converter::~Geant4Converter</a>() {
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00285"></a>00285 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ae0567fc7090fdc7ae74926c8a67f6536" title="Convert the geometry type element into the corresponding Geant4 object(s).">Geant4Converter::handleElement</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_atom.html" title="Handle class describing an element in the periodic table.">Atom</a> element)<span class="keyword"> const </span>{
<a name="l00286"></a>00286   G4Element* g4e = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a40b8d4041f5b89826971ffb9d1db9e1c">g4Elements</a>[element];
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (!g4e) {
<a name="l00288"></a>00288     g4e = G4Element::GetElement(name, <span class="keyword">false</span>);
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (!g4e) {
<a name="l00290"></a>00290       <span class="keywordflow">if</span> (element-&gt;GetNisotopes() &gt; 1) {
<a name="l00291"></a>00291         g4e = <span class="keyword">new</span> G4Element(name, element-&gt;GetTitle(), element-&gt;GetNisotopes());
<a name="l00292"></a>00292         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, n = element-&gt;GetNisotopes(); i &lt; n; ++i) {
<a name="l00293"></a>00293           TGeoIsotope* iso = element-&gt;GetIsotope(i);
<a name="l00294"></a>00294           G4Isotope* g4iso = G4Isotope::GetIsotope(iso-&gt;GetName(), <span class="keyword">false</span>);
<a name="l00295"></a>00295           <span class="keywordflow">if</span> (!g4iso) {
<a name="l00296"></a>00296             g4iso = <span class="keyword">new</span> G4Isotope(iso-&gt;GetName(), iso-&gt;GetZ(), iso-&gt;GetN(), iso-&gt;GetA());
<a name="l00297"></a>00297           }
<a name="l00298"></a>00298           g4e-&gt;AddIsotope(g4iso, element-&gt;GetRelativeAbundance(i));
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300       }
<a name="l00301"></a>00301       <span class="keywordflow">else</span> {
<a name="l00302"></a>00302         g4e = <span class="keyword">new</span> G4Element(element-&gt;GetTitle(), name, element-&gt;Z(), element-&gt;A() * (<a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">CLHEP::g</a> / <a class="code" href="namespacedd4hep.html#a09193b4505440f7f2a58f02fbea9120f">CLHEP::mole</a>));
<a name="l00303"></a>00303       }
<a name="l00304"></a>00304       stringstream str;
<a name="l00305"></a>00305       str &lt;&lt; (*g4e);
<a name="l00306"></a>00306       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Created G4 %s&quot;</span>, str.str().c_str());
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a40b8d4041f5b89826971ffb9d1db9e1c">g4Elements</a>[element] = g4e;
<a name="l00309"></a>00309   }
<a name="l00310"></a>00310   <span class="keywordflow">return</span> g4e;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00314"></a>00314 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac62685399e2c393c8d605d664353731c" title="Convert the geometry type material into the corresponding Geant4 object(s).">Geant4Converter::handleMaterial</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <a class="code" href="class_d_d4hep_1_1_geometry_1_1_material.html" title="Handle class describing a material.">Material</a> medium)<span class="keyword"> const </span>{
<a name="l00315"></a>00315   G4Material* mat = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a371057dc8aa3117cc3dfc465fd692cfb">g4Materials</a>[medium];
<a name="l00316"></a>00316   <span class="keywordflow">if</span> (!mat) {
<a name="l00317"></a>00317     mat = G4Material::GetMaterial(name, <span class="keyword">false</span>);
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (!mat) {
<a name="l00319"></a>00319       TGeoMaterial* material = medium-&gt;GetMaterial();
<a name="l00320"></a>00320       G4State state = kStateUndefined;
<a name="l00321"></a>00321       <span class="keywordtype">double</span> density = material-&gt;GetDensity() * (<a class="code" href="namespacedd4hep.html#ab7942148388bbfa1f47578732153f293">CLHEP::gram</a> / <a class="code" href="namespacedd4hep.html#a6464c11bda4aa7d6c4d42f70dbcaf803">CLHEP::cm3</a>);
<a name="l00322"></a>00322       <span class="keywordflow">if</span> (density &lt; 1e-25)
<a name="l00323"></a>00323         density = 1e-25;
<a name="l00324"></a>00324       <span class="keywordflow">switch</span> (material-&gt;GetState()) {
<a name="l00325"></a>00325       <span class="keywordflow">case</span> TGeoMaterial::kMatStateSolid:
<a name="l00326"></a>00326         state = kStateSolid;
<a name="l00327"></a>00327         <span class="keywordflow">break</span>;
<a name="l00328"></a>00328       <span class="keywordflow">case</span> TGeoMaterial::kMatStateLiquid:
<a name="l00329"></a>00329         state = kStateLiquid;
<a name="l00330"></a>00330         <span class="keywordflow">break</span>;
<a name="l00331"></a>00331       <span class="keywordflow">case</span> TGeoMaterial::kMatStateGas:
<a name="l00332"></a>00332         state = kStateGas;
<a name="l00333"></a>00333         <span class="keywordflow">break</span>;
<a name="l00334"></a>00334       <span class="keywordflow">default</span>:
<a name="l00335"></a>00335       <span class="keywordflow">case</span> TGeoMaterial::kMatStateUndefined:
<a name="l00336"></a>00336         state = kStateUndefined;
<a name="l00337"></a>00337         <span class="keywordflow">break</span>;
<a name="l00338"></a>00338       }
<a name="l00339"></a>00339       <span class="keywordflow">if</span> (material-&gt;IsMixture()) {
<a name="l00340"></a>00340         <span class="keywordtype">double</span> A_total = 0.0;
<a name="l00341"></a>00341         <span class="keywordtype">double</span> W_total = 0.0;
<a name="l00342"></a>00342         TGeoMixture* <a class="code" href="_geant4_event_seed_8h.html#afd9fa1747724ec6142812721997394c3">mix</a> = (TGeoMixture*) material;
<a name="l00343"></a>00343         <span class="keywordtype">int</span> nElements = mix-&gt;GetNelements();
<a name="l00344"></a>00344         mat = <span class="keyword">new</span> G4Material(name, density, nElements, state, 
<a name="l00345"></a>00345                              material-&gt;GetTemperature(), material-&gt;GetPressure());
<a name="l00346"></a>00346         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nElements; ++i)  {
<a name="l00347"></a>00347           A_total += (mix-&gt;GetAmixt())[i];
<a name="l00348"></a>00348           W_total += (mix-&gt;GetWmixt())[i];
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nElements; ++i) {
<a name="l00351"></a>00351           TGeoElement* e = mix-&gt;GetElement(i);
<a name="l00352"></a>00352           G4Element* g4e = (G4Element*) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ae0567fc7090fdc7ae74926c8a67f6536" title="Convert the geometry type element into the corresponding Geant4 object(s).">handleElement</a>(e-&gt;GetName(), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#aa33a3f44904c6184ee883c244baa9554">Atom</a>(e));
<a name="l00353"></a>00353           <span class="keywordflow">if</span> (!g4e) {
<a name="l00354"></a>00354             <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a54d5c1b9254fdf017c456cb972d26f96">ERROR</a>, <span class="stringliteral">&quot;Material&quot;</span>, 
<a name="l00355"></a>00355                      <span class="stringliteral">&quot;Missing component %s for material %s. A=%f W=%f&quot;</span>, 
<a name="l00356"></a>00356                      e-&gt;GetName(), mix-&gt;GetName(), A_total, W_total);
<a name="l00357"></a>00357           }
<a name="l00358"></a>00358           <span class="comment">//mat-&gt;AddElement(g4e, (mix-&gt;GetAmixt())[i] / A_total);</span>
<a name="l00359"></a>00359           mat-&gt;AddElement(g4e, (mix-&gt;GetWmixt())[i] / W_total);
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361       }
<a name="l00362"></a>00362       <span class="keywordflow">else</span> {
<a name="l00363"></a>00363         <span class="keywordtype">double</span> z = material-&gt;GetZ(), a = material-&gt;GetA();
<a name="l00364"></a>00364         <span class="keywordflow">if</span> ( z &lt; 1.0000001 ) z = 1.0;
<a name="l00365"></a>00365         <span class="keywordflow">if</span> ( a &lt; 0.5000001 ) a = 1.0;
<a name="l00366"></a>00366         mat = <span class="keyword">new</span> G4Material(name, z, a, density, state, 
<a name="l00367"></a>00367                              material-&gt;GetTemperature(), material-&gt;GetPressure());
<a name="l00368"></a>00368       }
<a name="l00369"></a>00369       stringstream str;
<a name="l00370"></a>00370       str &lt;&lt; (*mat);
<a name="l00371"></a>00371       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Created G4 %s&quot;</span>, str.str().c_str());
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a371057dc8aa3117cc3dfc465fd692cfb">g4Materials</a>[medium] = mat;
<a name="l00374"></a>00374   }
<a name="l00375"></a>00375   <span class="keywordflow">return</span> mat;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00379"></a>00379 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#abde5fd683b2ac0721f3c0274af4803b8" title="Convert the geometry type solid into the corresponding Geant4 object(s).">Geant4Converter::handleSolid</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keyword">const</span> TGeoShape* shape)<span class="keyword"> const </span>{
<a name="l00380"></a>00380   G4VSolid* solid = 0;
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (shape) {
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (0 != (solid = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().g4Solids[shape])) {
<a name="l00383"></a>00383       <span class="keywordflow">return</span> solid;
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoShapeAssembly::Class()) {
<a name="l00386"></a>00386       <span class="comment">// Assemblies have no corresponding &apos;shape&apos; in Geant4. Ignore the shape translation.</span>
<a name="l00387"></a>00387       <span class="comment">// It does not harm, since this &apos;shape&apos; is never accessed afterwards.</span>
<a name="l00388"></a>00388       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad35660bb944a3d8133ef17abeb898d0f">g4Solids</a>[shape] = solid;
<a name="l00389"></a>00389       <span class="keywordflow">return</span> solid;
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoBBox::Class()) {
<a name="l00392"></a>00392       <span class="keyword">const</span> TGeoBBox* s = (<span class="keyword">const</span> TGeoBBox*) shape;
<a name="l00393"></a>00393       solid = <span class="keyword">new</span> G4Box(name, s-&gt;GetDX() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDY() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDZ() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTube::Class()) {
<a name="l00396"></a>00396       <span class="keyword">const</span> TGeoTube* s = (<span class="keyword">const</span> TGeoTube*) shape;
<a name="l00397"></a>00397       solid = <span class="keyword">new</span> G4Tubs(name, s-&gt;GetRmin() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, 0, 2. * <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTubeSeg::Class()) {
<a name="l00400"></a>00400       <span class="keyword">const</span> TGeoTubeSeg* s = (<span class="keyword">const</span> TGeoTubeSeg*) shape;
<a name="l00401"></a>00401       solid = <span class="keyword">new</span> G4Tubs(name, s-&gt;GetRmin() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00402"></a>00402                          s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, (s-&gt;GetPhi2()-s-&gt;GetPhi1()) * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>);
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoEltu::Class()) {
<a name="l00405"></a>00405       <span class="keyword">const</span> TGeoEltu* s = (<span class="keyword">const</span> TGeoEltu*) shape;
<a name="l00406"></a>00406       solid = <span class="keyword">new</span> G4EllipticalTube(name,s-&gt;GetA() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetB() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTrd1::Class()) {
<a name="l00409"></a>00409       <span class="keyword">const</span> TGeoTrd1* s = (<span class="keyword">const</span> TGeoTrd1*) shape;
<a name="l00410"></a>00410       solid = <span class="keyword">new</span> G4Trd(name, s-&gt;GetDx1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDx2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDy() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDy() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00411"></a>00411                         s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTrd2::Class()) {
<a name="l00414"></a>00414       <span class="keyword">const</span> TGeoTrd2* s = (<span class="keyword">const</span> TGeoTrd2*) shape;
<a name="l00415"></a>00415       solid = <span class="keyword">new</span> G4Trd(name, s-&gt;GetDx1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDx2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDy1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDy2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00416"></a>00416                         s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoHype::Class()) {
<a name="l00419"></a>00419       <span class="keyword">const</span> TGeoHype* s = (<span class="keyword">const</span> TGeoHype*) shape;
<a name="l00420"></a>00420       solid = <span class="keyword">new</span> G4Hype(name, s-&gt;GetRmin() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00421"></a>00421                          s-&gt;GetStIn() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, s-&gt;GetStOut() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>,
<a name="l00422"></a>00422                          s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoPgon::Class()) {
<a name="l00425"></a>00425       <span class="keyword">const</span> TGeoPgon* s = (<span class="keyword">const</span> TGeoPgon*) shape;
<a name="l00426"></a>00426       <span class="keywordtype">double</span> phi_start = s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>;
<a name="l00427"></a>00427       <span class="keywordtype">double</span> phi_total = (s-&gt;GetDphi() + s-&gt;GetPhi1()) * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>;
<a name="l00428"></a>00428       <a class="code" href="classstd_1_1vector.html">vector&lt;double&gt;</a> rmin, rmax, z;
<a name="l00429"></a>00429       <span class="keywordflow">for</span> (Int_t i = 0; i &lt; s-&gt;GetNz(); ++i) {
<a name="l00430"></a>00430         rmin.push_back(s-&gt;GetRmin(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00431"></a>00431         rmax.push_back(s-&gt;GetRmax(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00432"></a>00432         z.push_back(s-&gt;GetZ(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00433"></a>00433       }
<a name="l00434"></a>00434       solid = <span class="keyword">new</span> G4Polyhedra(name, phi_start, phi_total, s-&gt;GetNedges(), s-&gt;GetNz(), &amp;z[0], &amp;rmin[0], &amp;rmax[0]);
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoPcon::Class()) {
<a name="l00437"></a>00437       <span class="keyword">const</span> TGeoPcon* s = (<span class="keyword">const</span> TGeoPcon*) shape;
<a name="l00438"></a>00438       <span class="keywordtype">double</span> phi_start = s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>;
<a name="l00439"></a>00439       <span class="keywordtype">double</span> phi_total = (s-&gt;GetDphi() + s-&gt;GetPhi1()) * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>;
<a name="l00440"></a>00440       <a class="code" href="classstd_1_1vector.html">vector&lt;double&gt;</a> rmin, rmax, z;
<a name="l00441"></a>00441       <span class="keywordflow">for</span> (Int_t i = 0; i &lt; s-&gt;GetNz(); ++i) {
<a name="l00442"></a>00442         rmin.push_back(s-&gt;GetRmin(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00443"></a>00443         rmax.push_back(s-&gt;GetRmax(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00444"></a>00444         z.push_back(s-&gt;GetZ(i) * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00445"></a>00445       }
<a name="l00446"></a>00446       solid = <span class="keyword">new</span> G4Polycone(name, phi_start, phi_total, s-&gt;GetNz(), &amp;z[0], &amp;rmin[0], &amp;rmax[0]);
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoCone::Class()) {
<a name="l00449"></a>00449       <span class="keyword">const</span> TGeoCone* s = (<span class="keyword">const</span> TGeoCone*) shape;
<a name="l00450"></a>00450       solid = <span class="keyword">new</span> G4Cons(name, s-&gt;GetRmin1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmin2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00451"></a>00451                          s-&gt;GetRmax2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, 0.0, 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoConeSeg::Class()) {
<a name="l00454"></a>00454       <span class="keyword">const</span> <a class="code" href="class_t_geo_cone_seg.html" title="Class of the ROOT toolkit. See http://root.cern.ch/root/htmldoc/ClassIndex.html.">TGeoConeSeg</a>* s = (<span class="keyword">const</span> <a class="code" href="class_t_geo_cone_seg.html" title="Class of the ROOT toolkit. See http://root.cern.ch/root/htmldoc/ClassIndex.html.">TGeoConeSeg</a>*) shape;
<a name="l00455"></a>00455       solid = <span class="keyword">new</span> G4Cons(name, s-&gt;GetRmin1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmin2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00456"></a>00456                          s-&gt;GetRmax2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, (s-&gt;GetPhi2()-s-&gt;GetPhi1()) * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>);
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoParaboloid::Class()) {
<a name="l00459"></a>00459       <span class="keyword">const</span> TGeoParaboloid* s = (<span class="keyword">const</span> TGeoParaboloid*) shape;
<a name="l00460"></a>00460       solid = <span class="keyword">new</span> G4Paraboloid(name, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRlo() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRhi() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 <span class="preprocessor">#if 0  </span><span class="comment">/* Not existent */</span>
<a name="l00463"></a>00463     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoEllisoid::Class()) {
<a name="l00464"></a>00464       <span class="keyword">const</span> TGeoParaboloid* s = (<span class="keyword">const</span> TGeoParaboloid*) shape;
<a name="l00465"></a>00465       solid = <span class="keyword">new</span> G4Paraboloid(name, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRlo() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRhi() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>);
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467 <span class="preprocessor">#endif</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoSphere::Class()) {
<a name="l00469"></a>00469       <span class="keyword">const</span> TGeoSphere* s = (<span class="keyword">const</span> TGeoSphere*) shape;
<a name="l00470"></a>00470       solid = <span class="keyword">new</span> G4Sphere(name, s-&gt;GetRmin() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>,
<a name="l00471"></a>00471                            s-&gt;GetPhi2() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, s-&gt;GetTheta1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, s-&gt;GetTheta2() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>);
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTorus::Class()) {
<a name="l00474"></a>00474       <span class="keyword">const</span> TGeoTorus* s = (<span class="keyword">const</span> TGeoTorus*) shape;
<a name="l00475"></a>00475       solid = <span class="keyword">new</span> G4Torus(name, s-&gt;GetRmin() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetRmax() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetR() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00476"></a>00476                           s-&gt;GetPhi1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>, s-&gt;GetDphi() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>);
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoTrap::Class()) {
<a name="l00479"></a>00479       <span class="keyword">const</span> TGeoTrap* s = (<span class="keyword">const</span> TGeoTrap*) shape;
<a name="l00480"></a>00480       solid = <span class="keyword">new</span> G4Trap(name, s-&gt;GetDz() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetTheta(), s-&gt;GetPhi(),
<a name="l00481"></a>00481                          s-&gt;GetH1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetBl1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetTl1() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetAlpha1() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>,
<a name="l00482"></a>00482                          s-&gt;GetH2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetBl2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetTl2() * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, s-&gt;GetAlpha2() * <a class="code" href="_handle_8h.html#a2dd86ad12ca3693ee64c502821b04b94">DEGREE_2_RAD</a>);
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shape-&gt;IsA() == TGeoCompositeShape::Class()) {
<a name="l00485"></a>00485       <span class="keyword">const</span> TGeoCompositeShape* s = (<span class="keyword">const</span> TGeoCompositeShape*) shape;
<a name="l00486"></a>00486       <span class="keyword">const</span> TGeoBoolNode* <span class="keywordtype">boolean</span> = s-&gt;GetBoolNode();
<a name="l00487"></a>00487       TGeoBoolNode::EGeoBoolType oper = <span class="keywordtype">boolean</span>-&gt;GetBooleanOperator();
<a name="l00488"></a>00488       TGeoMatrix* m = <span class="keywordtype">boolean</span>-&gt;GetRightMatrix();
<a name="l00489"></a>00489       G4VSolid* left = (G4VSolid*) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#abde5fd683b2ac0721f3c0274af4803b8" title="Convert the geometry type solid into the corresponding Geant4 object(s).">handleSolid</a>(name + <span class="stringliteral">&quot;_left&quot;</span>, boolean-&gt;GetLeftShape());
<a name="l00490"></a>00490       G4VSolid* right = (G4VSolid*) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#abde5fd683b2ac0721f3c0274af4803b8" title="Convert the geometry type solid into the corresponding Geant4 object(s).">handleSolid</a>(name + <span class="stringliteral">&quot;_right&quot;</span>, boolean-&gt;GetRightShape());
<a name="l00491"></a>00491 
<a name="l00492"></a>00492       <span class="keywordflow">if</span> (!left) {
<a name="l00493"></a>00493         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Converter: No left Geant4 Solid present for composite shape:&quot;</span> + name);
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495       <span class="keywordflow">if</span> (!right) {
<a name="l00496"></a>00496         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Converter: No right Geant4 Solid present for composite shape:&quot;</span> + name);
<a name="l00497"></a>00497       }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       <span class="comment">//specific case!</span>
<a name="l00500"></a>00500       <span class="comment">//Ellipsoid tag preparing</span>
<a name="l00501"></a>00501       <span class="comment">//if left == TGeoScaledShape AND right  == TGeoBBox</span>
<a name="l00502"></a>00502       <span class="comment">//   AND if TGeoScaledShape-&gt;GetShape == TGeoSphere</span>
<a name="l00503"></a>00503       TGeoShape* ls = <span class="keywordtype">boolean</span>-&gt;GetLeftShape();
<a name="l00504"></a>00504       TGeoShape* rs = <span class="keywordtype">boolean</span>-&gt;GetRightShape();
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (strcmp(ls-&gt;ClassName(), <span class="stringliteral">&quot;TGeoScaledShape&quot;</span>) == 0 &amp;&amp;
<a name="l00506"></a>00506           strcmp(rs-&gt;ClassName(), <span class="stringliteral">&quot;TGeoBBox&quot;</span>) == 0) {
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (strcmp(((TGeoScaledShape *)ls)-&gt;GetShape()-&gt;ClassName(), <span class="stringliteral">&quot;TGeoSphere&quot;</span>) == 0) {
<a name="l00508"></a>00508           <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoIntersection) {
<a name="l00509"></a>00509             TGeoScaledShape* lls = (TGeoScaledShape *)ls;
<a name="l00510"></a>00510             TGeoBBox* rrs = (TGeoBBox*)rs;
<a name="l00511"></a>00511             <span class="keywordtype">double</span> sx = lls-&gt;GetScale()-&gt;GetScale()[0];
<a name="l00512"></a>00512             <span class="keywordtype">double</span> sy = lls-&gt;GetScale()-&gt;GetScale()[1];
<a name="l00513"></a>00513             <span class="keywordtype">double</span> radius = ((TGeoSphere *)lls-&gt;GetShape())-&gt;GetRmax();
<a name="l00514"></a>00514             <span class="keywordtype">double</span> dz = rrs-&gt;GetDZ();
<a name="l00515"></a>00515             <span class="keywordtype">double</span> zorig = rrs-&gt;GetOrigin()[2];
<a name="l00516"></a>00516             <span class="keywordtype">double</span> zcut2 = dz + zorig;
<a name="l00517"></a>00517             <span class="keywordtype">double</span> zcut1 = 2 * zorig - zcut2;
<a name="l00518"></a>00518             solid = <span class="keyword">new</span> G4Ellipsoid(name,
<a name="l00519"></a>00519                                     sx * radius * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>,
<a name="l00520"></a>00520                                     sy * radius * CM_2_MM,
<a name="l00521"></a>00521                                     radius * CM_2_MM,
<a name="l00522"></a>00522                                     zcut1 * CM_2_MM,
<a name="l00523"></a>00523                                     zcut2 * CM_2_MM);
<a name="l00524"></a>00524             <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad35660bb944a3d8133ef17abeb898d0f">g4Solids</a>[shape] = solid;
<a name="l00525"></a>00525             <span class="keywordflow">return</span> solid;
<a name="l00526"></a>00526           }
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530       <span class="keywordflow">if</span> (m-&gt;IsRotation()) {
<a name="l00531"></a>00531         MyTransform3D transform(m-&gt;GetTranslation(),m-&gt;GetRotationMatrix());
<a name="l00532"></a>00532         <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoSubtraction)
<a name="l00533"></a>00533           solid = <span class="keyword">new</span> G4SubtractionSolid(name, left, right, transform);
<a name="l00534"></a>00534         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoUnion)
<a name="l00535"></a>00535           solid = <span class="keyword">new</span> G4UnionSolid(name, left, right, transform);
<a name="l00536"></a>00536         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoIntersection)
<a name="l00537"></a>00537           solid = <span class="keyword">new</span> G4IntersectionSolid(name, left, right, transform);
<a name="l00538"></a>00538       }
<a name="l00539"></a>00539       <span class="keywordflow">else</span> {
<a name="l00540"></a>00540         <span class="keyword">const</span> Double_t *t = m-&gt;GetTranslation();
<a name="l00541"></a>00541         G4ThreeVector transform(t[0] * <a class="code" href="_handle_8h.html#a6d214339b5b670b5aa094ee82481478a">CM_2_MM</a>, t[1] * CM_2_MM, t[2] * CM_2_MM);
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoSubtraction)
<a name="l00543"></a>00543           solid = <span class="keyword">new</span> G4SubtractionSolid(name, left, right, 0, transform);
<a name="l00544"></a>00544         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoUnion)
<a name="l00545"></a>00545           solid = <span class="keyword">new</span> G4UnionSolid(name, left, right, 0, transform);
<a name="l00546"></a>00546         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oper == TGeoBoolNode::kGeoIntersection)
<a name="l00547"></a>00547           solid = <span class="keyword">new</span> G4IntersectionSolid(name, left, right, 0, transform);
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (!solid) {
<a name="l00552"></a>00552       <span class="keywordtype">string</span> err = <span class="stringliteral">&quot;Failed to handle unknown solid shape:&quot;</span> + name + <span class="stringliteral">&quot; of type &quot;</span> + <a class="code" href="classstd_1_1string.html">string</a>(shape-&gt;IsA()-&gt;GetName());
<a name="l00553"></a>00553       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(err);
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad35660bb944a3d8133ef17abeb898d0f">g4Solids</a>[shape] = solid;
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557   <span class="keywordflow">return</span> solid;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00561"></a>00561 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ade3b2a14ae42910778397b07c26357db" title="Convert the geometry type logical volume into the corresponding Geant4 object(s)...">Geant4Converter::handleVolume</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keyword">const</span> TGeoVolume* volume)<span class="keyword"> const </span>{
<a name="l00562"></a>00562   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00563"></a>00563   Geant4GeometryMaps::VolumeMap::const_iterator volIt = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.find(volume);
<a name="l00564"></a>00564   <span class="keywordflow">if</span> (volIt == info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.end() ) {
<a name="l00565"></a>00565     <span class="keyword">const</span> TGeoVolume* v = volume;
<a name="l00566"></a>00566     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> _v = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(v);
<a name="l00567"></a>00567     <span class="keywordtype">string</span> n = v-&gt;GetName();
<a name="l00568"></a>00568     TGeoMedium* m = v-&gt;GetMedium();
<a name="l00569"></a>00569     TGeoShape* s = v-&gt;GetShape();
<a name="l00570"></a>00570     G4VSolid* solid = (G4VSolid*) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#abde5fd683b2ac0721f3c0274af4803b8" title="Convert the geometry type solid into the corresponding Geant4 object(s).">handleSolid</a>(s-&gt;GetName(), s);
<a name="l00571"></a>00571     G4Material* medium = 0;
<a name="l00572"></a>00572     <span class="keywordtype">bool</span> assembly = s-&gt;IsA() == TGeoShapeAssembly::Class() || v-&gt;IsA() == TGeoVolumeAssembly::Class();
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html" title="Handle class describing a set of limits as they are used for simulation.">LimitSet</a> lim = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#aeadd5c51ef8dc4c601e191beea40edbc" title="Access to the limit set.">limitSet</a>();
<a name="l00575"></a>00575     G4UserLimits* user_limits = 0;
<a name="l00576"></a>00576     <span class="keywordflow">if</span> (lim.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>()) {
<a name="l00577"></a>00577       user_limits = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6005f56c4ca13d015288ae645e58df69">g4Limits</a>[lim];
<a name="l00578"></a>00578       <span class="keywordflow">if</span> (!user_limits) {
<a name="l00579"></a>00579         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Cnv::volume[&quot;</span> + name + <span class="stringliteral">&quot;]:    + FATAL Failed to &quot;</span>
<a name="l00580"></a>00580                             <span class="stringliteral">&quot;access Geant4 user limits.&quot;</span>);
<a name="l00581"></a>00581       }
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html" title="Handle class describing visualization attributes.">VisAttr</a> vis = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a53c50a053aebaff28bb27a36c824db50" title="Access the visualisation attributes.">visAttributes</a>();
<a name="l00584"></a>00584     G4VisAttributes* vis_attr = 0;
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (vis.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>()) {
<a name="l00586"></a>00586       vis_attr = (G4VisAttributes*)<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac3cb66b2af9640e210c73ef9e3411abd" title="Convert the geometry visualisation attributes to the corresponding Geant4 object(s)...">handleVis</a>(vis.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(), vis);
<a name="l00587"></a>00587     }
<a name="l00588"></a>00588     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> reg = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a849db64ccfd2670fd485593f67ae2bb3" title="Access to the handle to the region structure.">region</a>();
<a name="l00589"></a>00589     G4Region* region = 0;
<a name="l00590"></a>00590     <span class="keywordflow">if</span> (reg.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>()) {
<a name="l00591"></a>00591       region = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aee8fb6dc1279abe93e73ccf67c41d011">g4Regions</a>[reg];
<a name="l00592"></a>00592       <span class="keywordflow">if</span> (!region) {
<a name="l00593"></a>00593         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Cnv::volume[&quot;</span> + name + <span class="stringliteral">&quot;]:    + FATAL Failed to &quot;</span>
<a name="l00594"></a>00594                             <span class="stringliteral">&quot;access Geant4 region.&quot;</span>);
<a name="l00595"></a>00595       }
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597     <a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42">PrintLevel</a> lvl = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>; <span class="comment">//string(det.name())==&quot;SiTrackerBarrel&quot; ? WARNING : m_outputLevel;</span>
<a name="l00598"></a>00598     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(lvl, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Convert Volume %-32s: %p %s/%s assembly:%s&quot;</span>,
<a name="l00599"></a>00599              n.c_str(), v, s-&gt;IsA()-&gt;GetName(), v-&gt;IsA()-&gt;GetName(), <a class="code" href="namespace_d_d4hep.html#a9b6e2c5ab00340e93017e18604b0cb85" title="Helper function to print booleans in format YES/NO.">yes_no</a>(assembly));
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (assembly) {
<a name="l00602"></a>00602       <span class="comment">//info.g4AssemblyVolumes[v] = new Geant4AssemblyVolume();</span>
<a name="l00603"></a>00603       <span class="keywordflow">return</span> 0;
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605     medium = (G4Material*) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac62685399e2c393c8d605d664353731c" title="Convert the geometry type material into the corresponding Geant4 object(s).">handleMaterial</a>(m-&gt;GetName(), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a2539031128388f894af24898eb6189a7">Material</a>(m));
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (!solid) {
<a name="l00607"></a>00607       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Converter: No Geant4 Solid present for volume:&quot;</span> + n);
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (!medium) {
<a name="l00610"></a>00610       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Converter: No Geant4 material present for volume:&quot;</span> + n);
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <span class="keywordflow">if</span> (user_limits) {
<a name="l00613"></a>00613       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Volume     + Apply LIMITS settings:%-24s to volume %s.&quot;</span>,
<a name="l00614"></a>00614                lim.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(), _v.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616     G4LogicalVolume* vol = <span class="keyword">new</span> G4LogicalVolume(solid, medium, n, 0, 0, user_limits);
<a name="l00617"></a>00617     <span class="keywordflow">if</span> (region) {
<a name="l00618"></a>00618       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Volume     + Apply REGION settings: %s to volume %s.&quot;</span>,
<a name="l00619"></a>00619                reg.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(), _v.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00620"></a>00620       vol-&gt;SetRegion(region);
<a name="l00621"></a>00621       region-&gt;AddRootLogicalVolume(vol);
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (vis_attr) {
<a name="l00624"></a>00624       vol-&gt;SetVisAttributes(vis_attr);
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>[v] = vol;
<a name="l00627"></a>00627     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Volume     + %s converted: %p ---&gt; G4: %p&quot;</span>, n.c_str(), v, vol);
<a name="l00628"></a>00628   }
<a name="l00629"></a>00629   <span class="keywordflow">return</span> 0;
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00633"></a>00633 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a5351cedc11f4e67a8786a6c013ff7cb1">Geant4Converter::collectVolume</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <span class="comment">/* name */</span>, <span class="keyword">const</span> TGeoVolume* volume)<span class="keyword"> const </span>{
<a name="l00634"></a>00634   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00635"></a>00635   <span class="keyword">const</span> TGeoVolume* v = volume;
<a name="l00636"></a>00636   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> _v = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(v);
<a name="l00637"></a>00637   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> reg = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a849db64ccfd2670fd485593f67ae2bb3" title="Access to the handle to the region structure.">region</a>();
<a name="l00638"></a>00638   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html" title="Handle class describing a set of limits as they are used for simulation.">LimitSet</a> lim = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#aeadd5c51ef8dc4c601e191beea40edbc" title="Access to the limit set.">limitSet</a>();
<a name="l00639"></a>00639   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html" title="Handle class to hold the information of a sensitive detector.">SensitiveDetector</a> det = _v.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html#a8dcf0ca9c159ed116f3f85fd67efa336" title="Access to the handle to the sensitive detector.">sensitiveDetector</a>();
<a name="l00640"></a>00640 
<a name="l00641"></a>00641   <span class="keywordflow">if</span> (lim.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>())
<a name="l00642"></a>00642     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a913c884fc30046a6eb65702d11f4383f">limits</a>[lim].insert(v);
<a name="l00643"></a>00643   <span class="keywordflow">if</span> (reg.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>())
<a name="l00644"></a>00644     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad224a954b07a8662bb57f3ee0355cdfa">regions</a>[reg].insert(v);
<a name="l00645"></a>00645   <span class="keywordflow">if</span> (det.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>())
<a name="l00646"></a>00646     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ab8c6e7272ad7cf326e06e5ea1f200418">sensitives</a>[det].insert(v);
<a name="l00647"></a>00647   <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*) v;
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00651"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a7705c4c5dfd0dc6cf119ef8340d2f9f6">00651</a> <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a7705c4c5dfd0dc6cf119ef8340d2f9f6" title="Dump volume placement in GDML format to output stream.">Geant4Converter::handleAssembly</a>(<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> TGeoNode* node)<span class="keyword"> const </span>{
<a name="l00652"></a>00652   TGeoVolume* mot_vol = node-&gt;GetVolume();
<a name="l00653"></a>00653   <span class="keywordflow">if</span> ( mot_vol-&gt;IsA() != TGeoVolumeAssembly::Class() )    {
<a name="l00654"></a>00654     <span class="keywordflow">return</span> 0;
<a name="l00655"></a>00655   }
<a name="l00656"></a>00656   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00657"></a>00657   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>* g4 = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a663f4e581a601fe42c81bd936c4d6960">g4AssemblyVolumes</a>[node];
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   <span class="keywordflow">if</span> ( !g4 )  {
<a name="l00660"></a>00660     g4 = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>();
<a name="l00661"></a>00661     <span class="keywordflow">for</span>(Int_t i=0; i &lt; mot_vol-&gt;GetNdaughters(); ++i)   {
<a name="l00662"></a>00662       TGeoNode*   d = mot_vol-&gt;GetNode(i);
<a name="l00663"></a>00663       TGeoVolume* dau_vol = d-&gt;GetVolume();
<a name="l00664"></a>00664       TGeoMatrix* tr = d-&gt;GetMatrix();
<a name="l00665"></a>00665       MyTransform3D transform(tr-&gt;GetTranslation(),tr-&gt;IsRotation() ? tr-&gt;GetRotationMatrix() : s_identity_rot);
<a name="l00666"></a>00666       <span class="keywordflow">if</span> ( dau_vol-&gt;IsA() == TGeoVolumeAssembly::Class() )  {
<a name="l00667"></a>00667         Geant4GeometryMaps::AssemblyMap::iterator assIt = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a663f4e581a601fe42c81bd936c4d6960">g4AssemblyVolumes</a>.find(d);
<a name="l00668"></a>00668         <span class="keywordflow">if</span> ( assIt == info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a663f4e581a601fe42c81bd936c4d6960">g4AssemblyVolumes</a>.end() )  {
<a name="l00669"></a>00669           <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a7bfb778cde0373aa4be752e638d8383b">FATAL</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Invalid child assembly at %s : %d  parent: %s child:%s&quot;</span>,
<a name="l00670"></a>00670                    __FILE__, __LINE__, name.c_str(), d-&gt;GetName());
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672         g4-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#adde18f645695f14e3ae08d7fed2451c1">placeAssembly</a>(d,(*assIt).second,transform);
<a name="l00673"></a>00673         <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Assembly: AddPlacedAssembly : dau:%s &quot;</span>
<a name="l00674"></a>00674                  <span class="stringliteral">&quot;to mother %s Tr:x=%8.3f y=%8.3f z=%8.3f&quot;</span>,
<a name="l00675"></a>00675                  dau_vol-&gt;GetName(), mot_vol-&gt;GetName(),
<a name="l00676"></a>00676                  transform.dx(), transform.dy(), transform.dz());
<a name="l00677"></a>00677       }
<a name="l00678"></a>00678       <span class="keywordflow">else</span>   {
<a name="l00679"></a>00679         Geant4GeometryMaps::VolumeMap::iterator volIt = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.find(dau_vol);
<a name="l00680"></a>00680         <span class="keywordflow">if</span> ( volIt == info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.end() )  {
<a name="l00681"></a>00681           <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a7bfb778cde0373aa4be752e638d8383b">FATAL</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Invalid child volume at %s : %d  parent: %s child:%s&quot;</span>,
<a name="l00682"></a>00682                    __FILE__, __LINE__, name.c_str(), d-&gt;GetName());
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684         g4-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#a7ab45077a09ab1397f437b167b097c94">placeVolume</a>(d,(*volIt).second, transform);
<a name="l00685"></a>00685         <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Assembly: AddPlacedVolume : dau:%s &quot;</span>
<a name="l00686"></a>00686                  <span class="stringliteral">&quot;to mother %s Tr:x=%8.3f y=%8.3f z=%8.3f&quot;</span>,
<a name="l00687"></a>00687                  dau_vol-&gt;GetName(), mot_vol-&gt;GetName(),
<a name="l00688"></a>00688                  transform.dx(), transform.dy(), transform.dz());
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a663f4e581a601fe42c81bd936c4d6960">g4AssemblyVolumes</a>[node] = g4;
<a name="l00692"></a>00692   }
<a name="l00693"></a>00693   <span class="keywordflow">return</span> g4;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00697"></a>00697 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a1a39afd969a6e73e22ea69229b06666c" title="Convert the geometry type volume placement into the corresponding Geant4 object(s)...">Geant4Converter::handlePlacement</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keyword">const</span> TGeoNode* node)<span class="keyword"> const </span>{
<a name="l00698"></a>00698   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00699"></a>00699   Geant4GeometryMaps::PlacementMap::const_iterator g4it = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aa99d9cc649a22de3dc3f05f07558951a">g4Placements</a>.find(node);
<a name="l00700"></a>00700   G4VPhysicalVolume* g4 = (g4it == info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aa99d9cc649a22de3dc3f05f07558951a">g4Placements</a>.end()) ? 0 : (*g4it).second;
<a name="l00701"></a>00701   if (!g4) {
<a name="l00702"></a>00702     TGeoVolume* mot_vol = node-&gt;GetMotherVolume();
<a name="l00703"></a>00703     TGeoVolume* vol = node-&gt;GetVolume();
<a name="l00704"></a>00704     TGeoMatrix* tr = node-&gt;GetMatrix();
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (!tr) {
<a name="l00706"></a>00706       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a7bfb778cde0373aa4be752e638d8383b">FATAL</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Attempt to handle placement without transformation:%p %s of type %s vol:%p&quot;</span>, node,
<a name="l00707"></a>00707                node-&gt;GetName(), node-&gt;IsA()-&gt;GetName(), vol);
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == vol) {
<a name="l00710"></a>00710       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a7bfb778cde0373aa4be752e638d8383b">FATAL</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Unknown G4 volume:%p %s of type %s ptr:%p&quot;</span>, node, node-&gt;GetName(),
<a name="l00711"></a>00711                node-&gt;IsA()-&gt;GetName(), vol);
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713     <span class="keywordflow">else</span> {
<a name="l00714"></a>00714       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_alignments_1_1_alignment_tools.html#a03e005e692b6427d78828d1785791a50" title="Copy alignment object from source object.">copy</a> = node-&gt;GetNumber();
<a name="l00715"></a>00715       <span class="keywordtype">bool</span> node_is_assembly = vol-&gt;IsA() == TGeoVolumeAssembly::Class();
<a name="l00716"></a>00716       <span class="keywordtype">bool</span> mother_is_assembly = mot_vol ? mot_vol-&gt;IsA() == TGeoVolumeAssembly::Class() : false;
<a name="l00717"></a>00717       MyTransform3D transform(tr-&gt;GetTranslation(),tr-&gt;IsRotation() ? tr-&gt;GetRotationMatrix() : s_identity_rot);
<a name="l00718"></a>00718       Geant4GeometryMaps::VolumeMap::const_iterator volIt = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.find(mot_vol);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720       <span class="keywordflow">if</span> ( mother_is_assembly )   {
<a name="l00721"></a>00721         <span class="comment">//</span>
<a name="l00722"></a>00722         <span class="comment">// Mother is an assembly:</span>
<a name="l00723"></a>00723         <span class="comment">// Nothing to do here, because:</span>
<a name="l00724"></a>00724         <span class="comment">// -- placed volumes were already added before in &quot;handleAssembly&quot;</span>
<a name="l00725"></a>00725         <span class="comment">// -- imprint cannot be made, because this requires a logical volume as a mother</span>
<a name="l00726"></a>00726         <span class="comment">//</span>
<a name="l00727"></a>00727         <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Assembly: **** : dau:%s &quot;</span>
<a name="l00728"></a>00728                  <span class="stringliteral">&quot;to mother %s Tr:x=%8.3f y=%8.3f z=%8.3f&quot;</span>,
<a name="l00729"></a>00729                  vol-&gt;GetName(), mot_vol-&gt;GetName(),
<a name="l00730"></a>00730                  transform.dx(), transform.dy(), transform.dz());
<a name="l00731"></a>00731         <span class="keywordflow">return</span> 0;
<a name="l00732"></a>00732       }
<a name="l00733"></a>00733       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( node_is_assembly )   {
<a name="l00734"></a>00734         <span class="comment">//</span>
<a name="l00735"></a>00735         <span class="comment">// Node is an assembly:</span>
<a name="l00736"></a>00736         <span class="comment">// Imprint the assembly. The mother MUST already be transformed.</span>
<a name="l00737"></a>00737         <span class="comment">//</span>
<a name="l00738"></a>00738         <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++ Assembly: makeImprint: dau:%s in mother %s &quot;</span>
<a name="l00739"></a>00739                  <span class="stringliteral">&quot;Tr:x=%8.3f y=%8.3f z=%8.3f&quot;</span>,
<a name="l00740"></a>00740                  node-&gt;GetName(), mot_vol-&gt;GetName(),
<a name="l00741"></a>00741                  transform.dx(), transform.dy(), transform.dz());
<a name="l00742"></a>00742         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>* ass = (<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html" title="Hack! Wrapper around G4AssemblyVolume to access protected members.">Geant4AssemblyVolume</a>*)info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a663f4e581a601fe42c81bd936c4d6960">g4AssemblyVolumes</a>[node];
<a name="l00743"></a>00743         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_assembly_volume.html#ad79481b292635c219fcc03d160689211">Geant4AssemblyVolume::Chain</a> chain;
<a name="l00744"></a>00744         chain.push_back(node);
<a name="l00745"></a>00745         ass-&gt;imprint(info,node,chain,ass,(*volIt).second, transform, copy, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a5afb918294afbed48b9c713f750fb017">m_checkOverlaps</a>);
<a name="l00746"></a>00746         <span class="keywordflow">return</span> 0;
<a name="l00747"></a>00747       }
<a name="l00748"></a>00748       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( node != gGeoManager-&gt;GetTopNode() &amp;&amp; volIt == info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.end() )  {
<a name="l00749"></a>00749         <span class="keywordflow">throw</span> logic_error(<span class="stringliteral">&quot;Geant4Converter: Invalid mother volume found!&quot;</span>);
<a name="l00750"></a>00750       }
<a name="l00751"></a>00751       G4LogicalVolume* g4vol = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>[vol];
<a name="l00752"></a>00752       G4LogicalVolume* g4mot = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>[mot_vol];
<a name="l00753"></a>00753       g4 = <span class="keyword">new</span> G4PVPlacement(transform,   <span class="comment">// no rotation</span>
<a name="l00754"></a>00754                              g4vol,     <span class="comment">// its logical volume</span>
<a name="l00755"></a>00755                              name,      <span class="comment">// its name</span>
<a name="l00756"></a>00756                              g4mot,     <span class="comment">// its mother (logical) volume</span>
<a name="l00757"></a>00757                              <span class="keyword">false</span>,     <span class="comment">// no boolean operations</span>
<a name="l00758"></a>00758                              copy,      <span class="comment">// its copy number</span>
<a name="l00759"></a>00759                              <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a5afb918294afbed48b9c713f750fb017">m_checkOverlaps</a>);
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aa99d9cc649a22de3dc3f05f07558951a">g4Placements</a>[node] = g4;
<a name="l00762"></a>00762   }
<a name="l00763"></a>00763   <span class="keywordflow">else</span> {
<a name="l00764"></a>00764     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a54d5c1b9254fdf017c456cb972d26f96">ERROR</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Attempt to DOUBLE-place physical volume: %s No:%d&quot;</span>, name.c_str(), node-&gt;GetNumber());
<a name="l00765"></a>00765   }
<a name="l00766"></a>00766   <span class="keywordflow">return</span> g4;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00770"></a>00770 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#aa64bdf48bc89f2af20a5470f0440a59a" title="Convert the geometry type region into the corresponding Geant4 object(s).">Geant4Converter::handleRegion</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> region, <span class="keyword">const</span> <a class="code" href="classstd_1_1set.html">set&lt;const TGeoVolume*&gt;</a>&amp; <span class="comment">/* volumes */</span>)<span class="keyword"> const </span>{
<a name="l00771"></a>00771   G4Region* g4 = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aee8fb6dc1279abe93e73ccf67c41d011">g4Regions</a>[region];
<a name="l00772"></a>00772   <span class="keywordflow">if</span> (!g4) {
<a name="l00773"></a>00773     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html" title="Handle class describing a region as used in simulation.">Region</a> r = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(region);
<a name="l00774"></a>00774     g4 = <span class="keyword">new</span> G4Region(r.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00775"></a>00775     <span class="comment">// set production cut</span>
<a name="l00776"></a>00776     G4ProductionCuts* cuts = <span class="keyword">new</span> G4ProductionCuts();
<a name="l00777"></a>00777     cuts-&gt;SetProductionCut(r.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#abdf2193e4fc5f8da3a001f36338b6d4e" title="Access cut value.">cut</a>()*<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">CLHEP::MeV</a>/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">dd4hep::MeV</a>);
<a name="l00778"></a>00778     g4-&gt;SetProductionCuts(cuts);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     <span class="comment">// create region info with storeSecondaries flag</span>
<a name="l00781"></a>00781     G4UserRegionInformation* info = <span class="keyword">new</span> G4UserRegionInformation();
<a name="l00782"></a>00782     info-&gt;region = r;
<a name="l00783"></a>00783     info-&gt;threshold = r.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#a4fee8a2258250ccb8e17c72964d2eaf7" title="Access production threshold.">threshold</a>()*<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">CLHEP::MeV</a>/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">dd4hep::MeV</a>;
<a name="l00784"></a>00784     info-&gt;storeSecondaries = r.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#a1f08466c4f3e0135dd3aaf8684aae623" title="Access secondaries flag.">storeSecondaries</a>();
<a name="l00785"></a>00785     g4-&gt;SetUserInformation(info);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Converted region settings of:%s.&quot;</span>, r.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>());
<a name="l00788"></a>00788     <a class="code" href="classstd_1_1vector.html">vector &lt; string &gt;</a> &amp;limits = r.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_region.html#a4507ab6d77f4775c83644aa117f5ef0b" title="Access references to user limits.">limits</a>();
<a name="l00789"></a>00789     <span class="keywordflow">for</span> (<a class="code" href="classstd_1_1vector.html">vector&lt;string&gt;::const_iterator</a> i = limits.begin(); i != limits.end(); ++i) {
<a name="l00790"></a>00790       <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; nam = *i;
<a name="l00791"></a>00791       <a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html" title="Handle class describing a set of limits as they are used for simulation.">LimitSet</a> ls = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a4c514a5fa835d901c01cf5a860960958">m_lcdd</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a7e98996675e9c00d6b64010415511813" title="Retrieve a limitset by it&amp;#39;s name from the detector description.">limitSet</a>(nam);
<a name="l00792"></a>00792       <span class="keywordflow">if</span> (ls.<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>()) {
<a name="l00793"></a>00793         <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00794"></a>00794         <span class="keyword">const</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_geant4_geometry_maps.html#a338013d6709b82358b8e2490cdba0ed2">Geant4GeometryMaps::LimitMap</a>&amp; lm = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6005f56c4ca13d015288ae645e58df69">g4Limits</a>;
<a name="l00795"></a>00795         <span class="keywordflow">for</span> (Geant4GeometryMaps::LimitMap::const_iterator j = lm.begin(); j != lm.end(); ++j) {
<a name="l00796"></a>00796           <span class="keywordflow">if</span> (nam == (*j).first-&gt;GetName()) {
<a name="l00797"></a>00797             g4-&gt;SetUserLimits((*j).second);
<a name="l00798"></a>00798             found = <span class="keyword">true</span>;
<a name="l00799"></a>00799             <span class="keywordflow">break</span>;
<a name="l00800"></a>00800           }
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802         <span class="keywordflow">if</span> (found)
<a name="l00803"></a>00803           <span class="keywordflow">continue</span>;
<a name="l00804"></a>00804       }
<a name="l00805"></a>00805       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;G4Region: Failed to resolve user limitset:&quot;</span> + *i);
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aee8fb6dc1279abe93e73ccf67c41d011">g4Regions</a>[region] = g4;
<a name="l00808"></a>00808   }
<a name="l00809"></a>00809   <span class="keywordflow">return</span> g4;
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00813"></a>00813 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ab2b11fdbfec73e218a533bb84f998679" title="Convert the geometry type LimitSet into the corresponding Geant4 object(s).">Geant4Converter::handleLimitSet</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html" title="Handle class describing a set of limits as they are used for simulation.">LimitSet</a> limitset, <span class="keyword">const</span> <a class="code" href="classstd_1_1set.html">set&lt;const TGeoVolume*&gt;</a>&amp; <span class="comment">/* volumes */</span>)<span class="keyword"> const </span>{
<a name="l00814"></a>00814   G4UserLimits* g4 = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6005f56c4ca13d015288ae645e58df69">g4Limits</a>[limitset];
<a name="l00815"></a>00815   <span class="keywordflow">if</span> (!g4) {
<a name="l00816"></a>00816     <a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html" title="Handle class describing a set of limits as they are used for simulation.">LimitSet</a> ls = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(limitset);
<a name="l00817"></a>00817     g4 = <span class="keyword">new</span> G4UserLimits(limitset-&gt;GetName());
<a name="l00818"></a>00818     <span class="keyword">const</span> <a class="code" href="classstd_1_1set.html">set&lt;Limit&gt;</a>&amp; limits = ls.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit_set.html#a5c175414806164d6cac89b749d08d909" title="Accessor to limits container.">limits</a>();
<a name="l00819"></a>00819     <span class="keywordflow">for</span> (LimitSet::Object::const_iterator i = limits.begin(); i != limits.end(); ++i) {
<a name="l00820"></a>00820       <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html" title="Small object describing a limit structure acting on a particle type.">Limit</a>&amp; l = *i;
<a name="l00821"></a>00821       <span class="keywordflow">if</span> (l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#ad1cec0ce58b0158ef8ba97d0a066cb28">name</a> == <span class="stringliteral">&quot;step_length_max&quot;</span>)
<a name="l00822"></a>00822         g4-&gt;SetMaxAllowedStep(l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#af3c5aac5f2991f137749634caf9e49cc">value</a>*<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">dd4hep::mm</a>);
<a name="l00823"></a>00823       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#ad1cec0ce58b0158ef8ba97d0a066cb28">name</a> == <span class="stringliteral">&quot;track_length_max&quot;</span>)
<a name="l00824"></a>00824         g4-&gt;SetMaxAllowedStep(l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#af3c5aac5f2991f137749634caf9e49cc">value</a>*<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">dd4hep::mm</a>);
<a name="l00825"></a>00825       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#ad1cec0ce58b0158ef8ba97d0a066cb28">name</a> == <span class="stringliteral">&quot;time_max&quot;</span>)
<a name="l00826"></a>00826         g4-&gt;SetUserMaxTime(l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#af3c5aac5f2991f137749634caf9e49cc">value</a>*<a class="code" href="namespacedd4hep.html#af8ce9b988119cb2c9b6b7397dbb34e97">CLHEP::ns</a>/<a class="code" href="namespacedd4hep.html#af8ce9b988119cb2c9b6b7397dbb34e97">dd4hep::ns</a>);
<a name="l00827"></a>00827       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#ad1cec0ce58b0158ef8ba97d0a066cb28">name</a> == <span class="stringliteral">&quot;ekin_min&quot;</span>)
<a name="l00828"></a>00828         g4-&gt;SetUserMinEkine(l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#af3c5aac5f2991f137749634caf9e49cc">value</a>*<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">CLHEP::MeV</a>/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">dd4hep::MeV</a>);
<a name="l00829"></a>00829       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#ad1cec0ce58b0158ef8ba97d0a066cb28">name</a> == <span class="stringliteral">&quot;range_min&quot;</span>)
<a name="l00830"></a>00830         g4-&gt;SetUserMinRange(l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#af3c5aac5f2991f137749634caf9e49cc">value</a>);
<a name="l00831"></a>00831       <span class="keywordflow">else</span>
<a name="l00832"></a>00832         <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Unknown Geant4 user limit: &quot;</span> + l.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_limit.html#a4457a562ae609ecb9dcec740d7270e89" title="Conversion to a string representation.">toString</a>());
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6005f56c4ca13d015288ae645e58df69">g4Limits</a>[limitset] = g4;
<a name="l00835"></a>00835   }
<a name="l00836"></a>00836   <span class="keywordflow">return</span> g4;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00840"></a>00840 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac3cb66b2af9640e210c73ef9e3411abd" title="Convert the geometry visualisation attributes to the corresponding Geant4 object(s)...">Geant4Converter::handleVis</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; <span class="comment">/* name */</span>, <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html" title="Handle class describing visualization attributes.">VisAttr</a> attr)<span class="keyword"> const </span>{
<a name="l00841"></a>00841   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00842"></a>00842   G4VisAttributes* g4 = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a1dc6d3c046072b0a6455c00e7fc76269">g4Vis</a>[attr];
<a name="l00843"></a>00843   <span class="keywordflow">if</span> (!g4) {
<a name="l00844"></a>00844     <span class="keywordtype">float</span> r = 0, <a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">g</a> = 0, b = 0;
<a name="l00845"></a>00845     <span class="keywordtype">int</span> style = attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a2fe1437a3f88a7e0629058a5d57cc046" title="Get line style.">lineStyle</a>();
<a name="l00846"></a>00846     attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a8480e8b84abfc922aff11be462dd3746" title="Get RGB values of the color (if valid).">rgb</a>(r, <a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">g</a>, b);
<a name="l00847"></a>00847     g4 = <span class="keyword">new</span> G4VisAttributes(attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a073240f217a17b7f23b30ad036b88f01" title="Get visibility flag.">visible</a>(), G4Colour(r, <a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">g</a>, b, attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a65411a5cd427ffb4aa07c93c23a26937" title="Get alpha value.">alpha</a>()));
<a name="l00848"></a>00848     <span class="comment">//g4-&gt;SetLineWidth(attr-&gt;GetLineWidth());</span>
<a name="l00849"></a>00849     g4-&gt;SetDaughtersInvisible(!attr.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#af782d624f358b2a86900ff588841d453" title="Get Flag to show/hide daughter elements.">showDaughters</a>());
<a name="l00850"></a>00850     <span class="keywordflow">if</span> (style == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630abb85e6313ec27720fcbae236740dd4c9">VisAttr::SOLID</a>) {
<a name="l00851"></a>00851       g4-&gt;SetLineStyle(G4VisAttributes::unbroken);
<a name="l00852"></a>00852       g4-&gt;SetForceWireframe(<span class="keyword">false</span>);
<a name="l00853"></a>00853       g4-&gt;SetForceSolid(<span class="keyword">true</span>);
<a name="l00854"></a>00854     }
<a name="l00855"></a>00855     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (style == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630a0d68594c8595d3e08905204dc4262e4e">VisAttr::WIREFRAME</a> || style == <a class="code" href="class_d_d4hep_1_1_geometry_1_1_vis_attr.html#a6b393ca7e14c69cf689ce7274f8a7630af20eddb2bef47dfd54509f51e7d8459a">VisAttr::DASHED</a>) {
<a name="l00856"></a>00856       g4-&gt;SetLineStyle(G4VisAttributes::dashed);
<a name="l00857"></a>00857       g4-&gt;SetForceSolid(<span class="keyword">false</span>);
<a name="l00858"></a>00858       g4-&gt;SetForceWireframe(<span class="keyword">true</span>);
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a1dc6d3c046072b0a6455c00e7fc76269">g4Vis</a>[attr] = g4;
<a name="l00861"></a>00861   }
<a name="l00862"></a>00862   <span class="keywordflow">return</span> g4;
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00866"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a18399813135c4547ae465e75dc620a8f">00866</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a18399813135c4547ae465e75dc620a8f" title="Handle the geant 4 specific properties.">Geant4Converter::handleProperties</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a89096744868821bf5dcb0c0560b348c9">LCDD::Properties</a>&amp; prp)<span class="keyword"> const </span>{
<a name="l00867"></a>00867   map &lt; string, string &gt; processors;
<a name="l00868"></a>00868   <span class="keyword">static</span> <span class="keywordtype">int</span> s_idd = 9999999;
<a name="l00869"></a>00869   <span class="keywordtype">string</span> id;
<a name="l00870"></a>00870   <span class="keywordflow">for</span> (LCDD::Properties::const_iterator i = prp.begin(); i != prp.end(); ++i) {
<a name="l00871"></a>00871     <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; nam = (*i).first;
<a name="l00872"></a>00872     <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a2a0388e0d76c73a3582439953ac3be53">LCDD::PropertyValues</a>&amp; vals = (*i).second;
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (nam.substr(0, 6) == <span class="stringliteral">&quot;geant4&quot;</span>) {
<a name="l00874"></a>00874       LCDD::PropertyValues::const_iterator id_it = vals.find(<span class="stringliteral">&quot;id&quot;</span>);
<a name="l00875"></a>00875       <span class="keywordflow">if</span> (id_it != vals.end()) {
<a name="l00876"></a>00876         <span class="keywordtype">id</span> = (*id_it).second;
<a name="l00877"></a>00877       }
<a name="l00878"></a>00878       <span class="keywordflow">else</span> {
<a name="l00879"></a>00879         <span class="keywordtype">char</span> txt[32];
<a name="l00880"></a>00880         ::snprintf(txt, <span class="keyword">sizeof</span>(txt), <span class="stringliteral">&quot;%d&quot;</span>, ++s_idd);
<a name="l00881"></a>00881         <span class="keywordtype">id</span> = txt;
<a name="l00882"></a>00882       }
<a name="l00883"></a>00883       processors.insert(make_pair(<span class="keywordtype">id</span>, nam));
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885   }
<a name="l00886"></a>00886   <span class="keywordflow">for</span> (map&lt;string, string&gt;::const_iterator i = processors.begin(); i != processors.end(); ++i) {
<a name="l00887"></a>00887     <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html" title="The base class for all DD4hep geometry crawlers.">Geometry::GeoHandler</a>* hdlr = <span class="keyword">this</span>;
<a name="l00888"></a>00888     <span class="keywordtype">string</span> nam = (*i).second;
<a name="l00889"></a>00889     <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a2a0388e0d76c73a3582439953ac3be53">LCDD::PropertyValues</a>&amp; vals = prp[nam];
<a name="l00890"></a>00890     <span class="keywordtype">string</span> type = vals.find(<span class="stringliteral">&quot;type&quot;</span>)-&gt;second;
<a name="l00891"></a>00891     <span class="keywordtype">string</span> tag = type + <span class="stringliteral">&quot;_Geant4_action&quot;</span>;
<a name="l00892"></a>00892     <span class="keywordtype">long</span> result = PluginService::Create&lt;long&gt;(tag, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a4c514a5fa835d901c01cf5a860960958">m_lcdd</a>, hdlr, &amp;vals);
<a name="l00893"></a>00893     <span class="keywordflow">if</span> (0 == result) {
<a name="l00894"></a>00894       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Failed to locate plugin to interprete files of type&quot;</span>
<a name="l00895"></a>00895                           <span class="stringliteral">&quot; \&quot;&quot;</span> + tag + <span class="stringliteral">&quot;\&quot; - no factory:&quot;</span> + type);
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897     result = *(<span class="keywordtype">long</span>*) result;
<a name="l00898"></a>00898     <span class="keywordflow">if</span> (result != 1) {
<a name="l00899"></a>00899       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Failed to invoke the plugin &quot;</span> + tag + <span class="stringliteral">&quot; of type &quot;</span> + type);
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++++ Executed Successfully Geant4 setup module *%s*.&quot;</span>, type.c_str());
<a name="l00902"></a>00902   }
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00906"></a>00906 <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0c4b85de4afdb9627b0adf76f033d4f5" title="Print the geometry type SensitiveDetector.">Geant4Converter::printSensitive</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html" title="Handle class to hold the information of a sensitive detector.">SensitiveDetector</a> sens_det, <span class="keyword">const</span> <a class="code" href="classstd_1_1set.html">set&lt;const TGeoVolume*&gt;</a>&amp; <span class="comment">/* volumes */</span>)<span class="keyword"> const </span>{
<a name="l00907"></a>00907   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00908"></a>00908   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types.html#ae294545274767eb8cf886a303033b351">ConstVolumeSet</a>&amp; volset = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ab8c6e7272ad7cf326e06e5ea1f200418">sensitives</a>[sens_det];
<a name="l00909"></a>00909   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html" title="Handle class to hold the information of a sensitive detector.">SensitiveDetector</a> sd = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(sens_det);
<a name="l00910"></a>00910   stringstream str;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ SensitiveDetector: %-18s %-20s Hits:%-16s&quot;</span>, sd.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(), (<span class="stringliteral">&quot;[&quot;</span> + sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#ad68e2f554ff61e15b9b54e9f01713d41" title="Access the type of the sensitive detector.">type</a>() + <span class="stringliteral">&quot;]&quot;</span>).c_str(),
<a name="l00913"></a>00913            sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a11b8c25eaa4c3da343abee5e796b62f7" title="Access the hits collection name.">hitsCollection</a>().c_str());
<a name="l00914"></a>00914   str &lt;&lt; <span class="stringliteral">&quot;                    | &quot;</span> &lt;&lt; <span class="stringliteral">&quot;Cutoff:&quot;</span> &lt;&lt; setw(6) &lt;&lt; left &lt;&lt; sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a07ed75fb993527ca9b2bc23e720c4098" title="Access energy cut off.">energyCutoff</a>() &lt;&lt; setw(5) &lt;&lt; right &lt;&lt; volset.size()
<a name="l00915"></a>00915       &lt;&lt; <span class="stringliteral">&quot; volumes &quot;</span>;
<a name="l00916"></a>00916   <span class="keywordflow">if</span> (sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#af7fd7953dddb6fce1f6dea711adbba46" title="Access to the region setting of the sensitive detector (not mandatory).">region</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>())
<a name="l00917"></a>00917     str &lt;&lt; <span class="stringliteral">&quot; Region:&quot;</span> &lt;&lt; setw(12) &lt;&lt; left &lt;&lt; sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#af7fd7953dddb6fce1f6dea711adbba46" title="Access to the region setting of the sensitive detector (not mandatory).">region</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>();
<a name="l00918"></a>00918   <span class="keywordflow">if</span> (sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a668c56c4c046721d0732de64df8cea14" title="Access to the limit set of the sensitive detector (not mandatory).">limits</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a4c5293aecb11989a708ec7615d0f0842" title="Check the validity of the object held by the handle.">isValid</a>())
<a name="l00919"></a>00919     str &lt;&lt; <span class="stringliteral">&quot; Limits:&quot;</span> &lt;&lt; setw(12) &lt;&lt; left &lt;&lt; sd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a668c56c4c046721d0732de64df8cea14" title="Access to the limit set of the sensitive detector (not mandatory).">limits</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>();
<a name="l00920"></a>00920   str &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00921"></a>00921   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, str.str().c_str());
<a name="l00922"></a>00922 
<a name="l00923"></a>00923   <span class="keywordflow">for</span> (ConstVolumeSet::iterator i = volset.begin(); i != volset.end(); ++i) {
<a name="l00924"></a>00924     map&lt;Volume, G4LogicalVolume*&gt;::iterator v = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>.find(*i);
<a name="l00925"></a>00925     G4LogicalVolume* vol = (*v).second;
<a name="l00926"></a>00926     str.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00927"></a>00927     str &lt;&lt; <span class="stringliteral">&quot;                                   | &quot;</span> &lt;&lt; <span class="stringliteral">&quot;Volume:&quot;</span> &lt;&lt; setw(24) &lt;&lt; left &lt;&lt; vol-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>
<a name="l00928"></a>00928         &lt;&lt; vol-&gt;GetNoDaughters() &lt;&lt; <span class="stringliteral">&quot; daughters.&quot;</span>;
<a name="l00929"></a>00929     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, str.str().c_str());
<a name="l00930"></a>00930   }
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a><a class="code" href="_geant4_converter_8cpp.html#ac5a01b817225c14295ef43363d867087">00933</a> <span class="keywordtype">string</span> <a class="code" href="_geant4_converter_8cpp.html#ac5a01b817225c14295ef43363d867087">printSolid</a>(G4VSolid* sol) {
<a name="l00934"></a>00934   stringstream str;
<a name="l00935"></a>00935   <span class="keywordflow">if</span> (<span class="keyword">typeid</span>(*sol) == <span class="keyword">typeid</span>(G4Box)) {
<a name="l00936"></a>00936     <span class="keyword">const</span> G4Box* b = (G4Box*) sol;
<a name="l00937"></a>00937     str &lt;&lt; <span class="stringliteral">&quot;++ Box: x=&quot;</span> &lt;&lt; b-&gt;GetXHalfLength() &lt;&lt; <span class="stringliteral">&quot; y=&quot;</span> &lt;&lt; b-&gt;GetYHalfLength() &lt;&lt; <span class="stringliteral">&quot; z=&quot;</span> &lt;&lt; b-&gt;GetZHalfLength();
<a name="l00938"></a>00938   }
<a name="l00939"></a>00939   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">typeid</span>(*sol) == <span class="keyword">typeid</span>(G4Tubs)) {
<a name="l00940"></a>00940     <span class="keyword">const</span> G4Tubs* t = (<span class="keyword">const</span> G4Tubs*) sol;
<a name="l00941"></a>00941     str &lt;&lt; <span class="stringliteral">&quot; Tubs: Ri=&quot;</span> &lt;&lt; t-&gt;GetInnerRadius() &lt;&lt; <span class="stringliteral">&quot; Ra=&quot;</span> &lt;&lt; t-&gt;GetOuterRadius() &lt;&lt; <span class="stringliteral">&quot; z/2=&quot;</span> &lt;&lt; t-&gt;GetZHalfLength() &lt;&lt; <span class="stringliteral">&quot; Phi=&quot;</span>
<a name="l00942"></a>00942         &lt;&lt; t-&gt;GetStartPhiAngle() &lt;&lt; <span class="stringliteral">&quot;...&quot;</span> &lt;&lt; t-&gt;GetDeltaPhiAngle();
<a name="l00943"></a>00943   }
<a name="l00944"></a>00944   <span class="keywordflow">return</span> str.str();
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00948"></a>00948 <span class="keywordtype">void</span>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a4a2bbac335aeb3926bf3eb2c62803f74" title="Print Geant4 placement.">Geant4Converter::printPlacement</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; name, <span class="keyword">const</span> TGeoNode* node)<span class="keyword"> const </span>{
<a name="l00949"></a>00949   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; info = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#ae4f8df1c20c159dc7e467119d16e964c" title="Access to the data pointer.">data</a>();
<a name="l00950"></a>00950   G4VPhysicalVolume* g4 = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#aa99d9cc649a22de3dc3f05f07558951a">g4Placements</a>[node];
<a name="l00951"></a>00951   G4LogicalVolume* vol = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>[node-&gt;GetVolume()];
<a name="l00952"></a>00952   G4LogicalVolume* mot = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a6699981243bf97abf6c16e51a72dcabb">g4Volumes</a>[node-&gt;GetMotherVolume()];
<a name="l00953"></a>00953   G4VSolid* sol = vol-&gt;GetSolid();
<a name="l00954"></a>00954   G4ThreeVector tr = g4-&gt;GetObjectTranslation();
<a name="l00955"></a>00955 
<a name="l00956"></a>00956   <a class="code" href="class_g4_v_sensitive_detector.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VSensitiveDetector</a>* sd = vol-&gt;GetSensitiveDetector();
<a name="l00957"></a>00957   <span class="keywordflow">if</span> (!sd)  {
<a name="l00958"></a>00958     <span class="keywordflow">return</span> g4;
<a name="l00959"></a>00959   }
<a name="l00960"></a>00960   stringstream str;
<a name="l00961"></a>00961   str &lt;&lt; <span class="stringliteral">&quot;G4Cnv::placement: + &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; No:&quot;</span> &lt;&lt; node-&gt;GetNumber() &lt;&lt; <span class="stringliteral">&quot; Vol:&quot;</span> &lt;&lt; vol-&gt;GetName() &lt;&lt; <span class="stringliteral">&quot; Solid:&quot;</span>
<a name="l00962"></a>00962       &lt;&lt; sol-&gt;GetName();
<a name="l00963"></a>00963   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;G4Placement&quot;</span>, str.str().c_str());
<a name="l00964"></a>00964   str.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00965"></a>00965   str &lt;&lt; <span class="stringliteral">&quot;                  |&quot;</span> &lt;&lt; <span class="stringliteral">&quot; Loc: x=&quot;</span> &lt;&lt; tr.x() &lt;&lt; <span class="stringliteral">&quot; y=&quot;</span> &lt;&lt; tr.y() &lt;&lt; <span class="stringliteral">&quot; z=&quot;</span> &lt;&lt; tr.z();
<a name="l00966"></a>00966   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;G4Placement&quot;</span>, str.str().c_str());
<a name="l00967"></a>00967   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;G4Placement&quot;</span>, <a class="code" href="_geant4_converter_8cpp.html#ac5a01b817225c14295ef43363d867087">printSolid</a>(sol).c_str());
<a name="l00968"></a>00968   str.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00969"></a>00969   str &lt;&lt; <span class="stringliteral">&quot;                  |&quot;</span> &lt;&lt; <span class="stringliteral">&quot; Ndau:&quot;</span> &lt;&lt; vol-&gt;GetNoDaughters() &lt;&lt; <span class="stringliteral">&quot; physvols.&quot;</span> &lt;&lt; <span class="stringliteral">&quot; Mat:&quot;</span> &lt;&lt; vol-&gt;GetMaterial()-&gt;GetName()
<a name="l00970"></a>00970       &lt;&lt; <span class="stringliteral">&quot; Mother:&quot;</span> &lt;&lt; (<span class="keywordtype">char</span>*) (mot ? mot-&gt;GetName().c_str() : <span class="stringliteral">&quot;---&quot;</span>);
<a name="l00971"></a>00971   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;G4Placement&quot;</span>, str.str().c_str());
<a name="l00972"></a>00972   str.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00973"></a>00973   str &lt;&lt; <span class="stringliteral">&quot;                  |&quot;</span> &lt;&lt; <span class="stringliteral">&quot; SD:&quot;</span> &lt;&lt; sd-&gt;GetName();
<a name="l00974"></a>00974   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;G4Placement&quot;</span>, str.str().c_str());
<a name="l00975"></a>00975   <span class="keywordflow">return</span> g4;
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00978"></a><a class="code" href="_geant4_converter_8cpp.html#a07e7659aecdf8fa88e159fd691c46bbe">00978</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> O, <span class="keyword">typename</span> C, <span class="keyword">typename</span> F&gt; <span class="keywordtype">void</span> <a class="code" href="_geant4_converter_8cpp.html#a07e7659aecdf8fa88e159fd691c46bbe">handleRefs</a>(<span class="keyword">const</span> O* o, <span class="keyword">const</span> C&amp; c, F pmf) {
<a name="l00979"></a>00979   <span class="keywordflow">for</span> (<span class="keyword">typename</span> C::const_iterator i = c.begin(); i != c.end(); ++i) {
<a name="l00980"></a>00980     <span class="comment">//(o-&gt;*pmf)((*i)-&gt;GetName(), *i);</span>
<a name="l00981"></a>00981     (o-&gt;*pmf)(<span class="stringliteral">&quot;&quot;</span>, *i);
<a name="l00982"></a>00982   }
<a name="l00983"></a>00983 }
<a name="l00984"></a><a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">00984</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> O, <span class="keyword">typename</span> C, <span class="keyword">typename</span> F&gt; <span class="keywordtype">void</span> <a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">handle</a>(<span class="keyword">const</span> O* o, <span class="keyword">const</span> C&amp; c, F pmf) {
<a name="l00985"></a>00985   <span class="keywordflow">for</span> (<span class="keyword">typename</span> C::const_iterator i = c.begin(); i != c.end(); ++i) {
<a name="l00986"></a>00986     (o-&gt;*pmf)((*i)-&gt;GetName(), *i);
<a name="l00987"></a>00987   }
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 
<a name="l00990"></a><a class="code" href="_geant4_converter_8cpp.html#a2ec5c72f110e5e4eeaac04f2fde81db3">00990</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> O, <span class="keyword">typename</span> C, <span class="keyword">typename</span> F&gt; <span class="keywordtype">void</span> <a class="code" href="_geant4_converter_8cpp.html#a2ec5c72f110e5e4eeaac04f2fde81db3">handleMap</a>(<span class="keyword">const</span> O* o, <span class="keyword">const</span> C&amp; c, F pmf) {
<a name="l00991"></a>00991   <span class="keywordflow">for</span> (<span class="keyword">typename</span> C::const_iterator i = c.begin(); i != c.end(); ++i)
<a name="l00992"></a>00992     (o-&gt;*pmf)((*i).first, (*i).second);
<a name="l00993"></a>00993 }
<a name="l00994"></a>00994 
<a name="l00995"></a><a class="code" href="_geant4_converter_8cpp.html#a7d7afa44a05c52b63ca8815b5f5ba063">00995</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> O, <span class="keyword">typename</span> C, <span class="keyword">typename</span> F&gt; <span class="keywordtype">void</span> <a class="code" href="_geant4_converter_8cpp.html#a7d7afa44a05c52b63ca8815b5f5ba063">handleRMap</a>(<span class="keyword">const</span> O* o, <span class="keyword">const</span> C&amp; c, F pmf) {
<a name="l00996"></a>00996   <span class="keywordflow">for</span> (<span class="keyword">typename</span> C::const_reverse_iterator i = c.rbegin(); i != c.rend(); ++i)  {
<a name="l00997"></a>00997     <span class="comment">//cout &lt;&lt; &quot;Handle RMAP [ &quot; &lt;&lt; (*i).first &lt;&lt; &quot; ]&quot; &lt;&lt; endl;</span>
<a name="l00998"></a>00998     <a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">handle</a>(o, (*i).second, pmf);
<a name="l00999"></a>00999   }
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01003"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ab43bb402a64c6647e47f4706097f8990">01003</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html" title="Geometry converter from DD4hep to Geant 4.">Geant4Converter</a>&amp; <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ab43bb402a64c6647e47f4706097f8990" title="Create geometry conversion.">Geant4Converter::create</a>(<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a> top) {
<a name="l01004"></a>01004   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html" title="Concreate class holding the relation information between geant4 objects and dd4hep...">Geant4GeometryInfo</a>&amp; geo = this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a241f6e8f761d19caf370fe43fbf22015" title="Create and attach new data block. Delete old data block if present.">init</a>();
<a name="l01005"></a>01005   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#a2ac33960ec9497e7a5f064c3ae0a0747">m_data</a>-&gt;clear();
<a name="l01006"></a>01006   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#acdff622f718b2f71d40744f4665b80e9" title="Collect geometry information from traversal.">collect</a>(top, geo);
<a name="l01007"></a>01007   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a5afb918294afbed48b9c713f750fb017">m_checkOverlaps</a> = <span class="keyword">false</span>;
<a name="l01008"></a>01008   <span class="comment">// We do not have to handle defines etc.</span>
<a name="l01009"></a>01009   <span class="comment">// All positions and the like are not really named.</span>
<a name="l01010"></a>01010   <span class="comment">// Hence, start creating the G4 objects for materials, solids and log volumes.</span>
<a name="l01011"></a>01011   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_material.html" title="Handle class describing a material.">Material</a> mat = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a4c514a5fa835d901c01cf5a860960958">m_lcdd</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#aec8adc99bc62ade78afd0a444a76fd04" title="Retrieve a matrial by it&amp;#39;s name from the detector description.">material</a>(<span class="stringliteral">&quot;Argon&quot;</span>);
<a name="l01012"></a>01012   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac62685399e2c393c8d605d664353731c" title="Convert the geometry type material into the corresponding Geant4 object(s).">handleMaterial</a>(mat.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>(), mat);
<a name="l01013"></a>01013   mat = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a4c514a5fa835d901c01cf5a860960958">m_lcdd</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#aec8adc99bc62ade78afd0a444a76fd04" title="Retrieve a matrial by it&amp;#39;s name from the detector description.">material</a>(<span class="stringliteral">&quot;Silicon&quot;</span>);
<a name="l01014"></a>01014   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac62685399e2c393c8d605d664353731c" title="Convert the geometry type material into the corresponding Geant4 object(s).">handleMaterial</a>(mat.name(), mat);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   <span class="comment">//m_outputLevel = WARNING;</span>
<a name="l01017"></a>01017   <span class="comment">//setPrintLevel(VERBOSE);</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   <a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">handle</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#a67842e3e45b1330e99a86b794f3b9427">volumes</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a5351cedc11f4e67a8786a6c013ff7cb1">Geant4Converter::collectVolume</a>);
<a name="l01020"></a>01020   <a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">handle</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#a121f17ff08f77f9eda63a704648f8994">solids</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#abde5fd683b2ac0721f3c0274af4803b8" title="Convert the geometry type solid into the corresponding Geant4 object(s).">Geant4Converter::handleSolid</a>);
<a name="l01021"></a>01021   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Handled %ld solids.&quot;</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#a121f17ff08f77f9eda63a704648f8994">solids</a>.size());
<a name="l01022"></a>01022   <a class="code" href="_geant4_converter_8cpp.html#a07e7659aecdf8fa88e159fd691c46bbe">handleRefs</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#ac11f2e847e838a2b6a60f2f8d0f9a64c">vis</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ac3cb66b2af9640e210c73ef9e3411abd" title="Convert the geometry visualisation attributes to the corresponding Geant4 object(s)...">Geant4Converter::handleVis</a>);
<a name="l01023"></a>01023   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Handled %ld visualization attributes.&quot;</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#ac11f2e847e838a2b6a60f2f8d0f9a64c">vis</a>.size());
<a name="l01024"></a>01024   <a class="code" href="_geant4_converter_8cpp.html#a2ec5c72f110e5e4eeaac04f2fde81db3">handleMap</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a913c884fc30046a6eb65702d11f4383f">limits</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ab2b11fdbfec73e218a533bb84f998679" title="Convert the geometry type LimitSet into the corresponding Geant4 object(s).">Geant4Converter::handleLimitSet</a>);
<a name="l01025"></a>01025   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Handled %ld limit sets.&quot;</span>, geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a913c884fc30046a6eb65702d11f4383f">limits</a>.size());
<a name="l01026"></a>01026   <a class="code" href="_geant4_converter_8cpp.html#a2ec5c72f110e5e4eeaac04f2fde81db3">handleMap</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad224a954b07a8662bb57f3ee0355cdfa">regions</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#aa64bdf48bc89f2af20a5470f0440a59a" title="Convert the geometry type region into the corresponding Geant4 object(s).">Geant4Converter::handleRegion</a>);
<a name="l01027"></a>01027   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Handled %ld regions.&quot;</span>, geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#ad224a954b07a8662bb57f3ee0355cdfa">regions</a>.size());
<a name="l01028"></a>01028   <a class="code" href="_geant4_converter_8cpp.html#ae67154a251a25b85bf28b62829a03c39">handle</a>(<span class="keyword">this</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#a67842e3e45b1330e99a86b794f3b9427">volumes</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#ade3b2a14ae42910778397b07c26357db" title="Convert the geometry type logical volume into the corresponding Geant4 object(s)...">Geant4Converter::handleVolume</a>);
<a name="l01029"></a>01029   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a0beb45875a3be411994a235aa545dbbc">m_outputLevel</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;++ Handled %ld volumes.&quot;</span>, geo.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler_types_1_1_geometry_info.html#a67842e3e45b1330e99a86b794f3b9427">volumes</a>.size());
<a name="l01030"></a>01030   <a class="code" href="_geant4_converter_8cpp.html#a7d7afa44a05c52b63ca8815b5f5ba063">handleRMap</a>(<span class="keyword">this</span>, *<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#a2ac33960ec9497e7a5f064c3ae0a0747">m_data</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a7705c4c5dfd0dc6cf119ef8340d2f9f6" title="Dump volume placement in GDML format to output stream.">Geant4Converter::handleAssembly</a>);
<a name="l01031"></a>01031   <span class="comment">// Now place all this stuff appropriately</span>
<a name="l01032"></a>01032   <a class="code" href="_geant4_converter_8cpp.html#a7d7afa44a05c52b63ca8815b5f5ba063">handleRMap</a>(<span class="keyword">this</span>, *<a class="code" href="class_d_d4hep_1_1_geometry_1_1_geo_handler.html#a2ac33960ec9497e7a5f064c3ae0a0747">m_data</a>, &amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a1a39afd969a6e73e22ea69229b06666c" title="Convert the geometry type volume placement into the corresponding Geant4 object(s)...">Geant4Converter::handlePlacement</a>);
<a name="l01033"></a>01033   <span class="comment">//==================== Fields</span>
<a name="l01034"></a>01034   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_converter.html#a18399813135c4547ae465e75dc620a8f" title="Handle the geant 4 specific properties.">handleProperties</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_mapping.html#a4c514a5fa835d901c01cf5a860960958">m_lcdd</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a15fac6166c5a16968cf9f60b515f4125" title="Access to properties map.">properties</a>());
<a name="l01035"></a>01035 
<a name="l01036"></a>01036   <span class="comment">//handleMap(this, geo.sensitives, &amp;Geant4Converter::printSensitive);</span>
<a name="l01037"></a>01037   <span class="comment">//handleRMap(this, *m_data, &amp;Geant4Converter::printPlacement);</span>
<a name="l01038"></a>01038 
<a name="l01039"></a>01039   geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a9ccd539edd7ae098b69bcb3b035b8daf" title="Set the world volume.">setWorld</a>(top.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a32a39fbab7eeb59dd4ad2fc807e0b66d" title="Access to the physical volume of this detector element.">placement</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>());
<a name="l01040"></a>01040   geo.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_geometry_info.html#a0bc71f53d762f58ec47c76dc5db8b075">valid</a> = <span class="keyword">true</span>;
<a name="l01041"></a>01041   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>, <span class="stringliteral">&quot;Geant4Converter&quot;</span>, <span class="stringliteral">&quot;+++  Successfully converted geometry to Geant4.&quot;</span>);
<a name="l01042"></a>01042   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01043"></a>01043 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
