<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4EventReaderHepMC.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4EventReaderHepMC.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4EventReaderHepMC.cpp</h1><a href="_geant4_event_reader_hep_m_c_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: $</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_io_streams_8h.html">DDG4/IoStreams.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_input_action_8h.html">DDG4/Geant4InputAction.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="comment">// C/C++ include files</span>
<a name="l00020"></a>00020 
<a name="l00022"></a>00022 <span class="keyword">namespace </span>DD4hep {
<a name="l00023"></a>00023 
<a name="l00025"></a>00025   <span class="keyword">namespace </span>Simulation {
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html">00027</a>     <span class="keyword">namespace </span>HepMC {  <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>;  }
<a name="l00029"></a>00029 
<a name="l00038"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html">00038</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html" title="Class to populate Geant4 primaries from StdHep files.">Geant4EventReaderHepMC</a> : <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html" title="Basic geant4 event reader class. This interface/base-class must be implemented by...">Geant4EventReader</a>  {
<a name="l00039"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a1a456562e141e47288810fb708fa3815">00039</a>       <span class="keyword">typedef</span> boost::iostreams::stream&lt;dd4hep_file_source&lt;int&gt; &gt; <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a1a456562e141e47288810fb708fa3815">in_stream</a>;
<a name="l00040"></a>00040       <span class="comment">//typedef boost::iostreams::stream&lt;dd4hep_file_source&lt;TFile*&gt; &gt; in_stream;</span>
<a name="l00041"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a260380eb48d2adb971aaade903a47da8">00041</a>       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">HepMC::EventStream</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>;
<a name="l00042"></a>00042     <span class="keyword">protected</span>:
<a name="l00043"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#ab5768f9462667c171c87dbb0ce830e36">00043</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a1a456562e141e47288810fb708fa3815">in_stream</a>    <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#ab5768f9462667c171c87dbb0ce830e36">m_input</a>;
<a name="l00044"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">00044</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>;
<a name="l00045"></a>00045     <span class="keyword">public</span>:
<a name="l00047"></a>00047       <span class="keyword">explicit</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#adc7e0e034d70567c3287a72121b21d0e" title="Initializing constructor.">Geant4EventReaderHepMC</a>(<span class="keyword">const</span> std::string&amp; nam);
<a name="l00049"></a>00049       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a437c86083e7da05be4821da864d8954a" title="Default destructor.">~Geant4EventReaderHepMC</a>();
<a name="l00051"></a>00051       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7" title="Status codes of the event reader object. Anything with NOT low-bit set is an error...">EventReaderStatus</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#acb5e3d21a1eea4870b3dd73649f363ae" title="Read an event and fill a vector of MCParticles.">readParticles</a>(<span class="keywordtype">int</span> event_number,
<a name="l00052"></a>00052                                               <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Vertex</a>&amp; primary_vertex,
<a name="l00053"></a>00053                                               std::vector&lt;Particle*&gt;&amp; particles);
<a name="l00054"></a>00054       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7" title="Status codes of the event reader object. Anything with NOT low-bit set is an error...">EventReaderStatus</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a95ba8736c8274f5b24b6cd0e0b424c33" title="skipEvents if required">moveToEvent</a>(<span class="keywordtype">int</span> event_number);
<a name="l00055"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a02a4d905385f3b587ffe953e129aad5f">00055</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7" title="Status codes of the event reader object. Anything with NOT low-bit set is an error...">EventReaderStatus</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a02a4d905385f3b587ffe953e129aad5f" title="Skip event. To be implemented for sequential sources.">skipEvent</a>() { <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7a13d6e75077901770699fb70535bd24f5">EVENT_READER_OK</a>; }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     };
<a name="l00058"></a>00058   }     <span class="comment">/* End namespace Simulation   */</span>
<a name="l00059"></a>00059 }       <span class="comment">/* End namespace DD4hep       */</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">// $Id: Geant4Converter.cpp 603 2013-06-13 21:15:14Z markus.frank $</span>
<a name="l00062"></a>00062 <span class="comment">//====================================================================</span>
<a name="l00063"></a>00063 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00064"></a>00064 <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00065"></a>00065 <span class="comment">//</span>
<a name="l00066"></a>00066 <span class="comment">//====================================================================</span>
<a name="l00067"></a>00067 <span class="comment">// #include &quot;DDG4/Geant4EventReaderHepMC&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">// Framework include files</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html">DDG4/Factories.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="_printout_8h.html">DD4hep/Printout.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_primary_8h.html">DDG4/Geant4Primary.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;CLHEP/Units/SystemOfUnits.h&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;CLHEP/Units/PhysicalConstants.h&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// C/C++ include files</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;cerrno&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">using namespace </span>std;
<a name="l00081"></a>00081 <span class="keyword">using namespace </span>CLHEP;
<a name="l00082"></a>00082 <span class="keyword">using namespace </span>DD4hep::Simulation;
<a name="l00083"></a><a class="code" href="_geant4_event_reader_hep_m_c_8cpp.html#a26571eca698a4610629e5036e207ee88">00083</a> <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html" title="Data structure to manipulate a bitmask held by reference and represented by an integer...">DD4hep::ReferenceBitMask&lt;int&gt;</a> <a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html" title="Data structure to manipulate a bitmask held by reference and represented by an integer...">PropertyMask</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">// Factory entry</span>
<a name="l00086"></a>00086 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a8c4a1f82b1694c013d102f8ee0aab46d" title="Plugin defintion to create event reader objects.">DECLARE_GEANT4_EVENT_READER</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html" title="Class to populate Geant4 primaries from StdHep files.">Geant4EventReaderHepMC</a>)
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 namespace DD4hep {
<a name="l00090"></a>00090 
<a name="l00092"></a>00092   <span class="keyword">namespace </span>Simulation {
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="keyword">namespace </span>HepMC {
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html">00096</a>       <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html">EventHeader</a>  {
<a name="l00097"></a>00097       <span class="keyword">public</span>:
<a name="l00098"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a221f01143ced151a262de45ca6749cc4">00098</a>         <span class="keywordtype">int</span>   id;
<a name="l00099"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a83354fc882a2fb46a053a524a7145eb1">00099</a>         <span class="keywordtype">int</span>   num_vertices;
<a name="l00100"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a4b3d20b78f49d539c6487d2a5eeb844c">00100</a>         <span class="keywordtype">int</span>   bp1, bp2;
<a name="l00101"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a339a52131b423a70529a66bae821906b">00101</a>         <span class="keywordtype">int</span>   signal_process_id;
<a name="l00102"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a22408536166a5457c2380e3a06c3ae0c">00102</a>         <span class="keywordtype">int</span>   signal_process_vertex;
<a name="l00103"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a68ba7289f036ebb18a5ae1d6c602bfa8">00103</a>         <span class="keywordtype">float</span> scale;
<a name="l00104"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#aa21d0c781608de75c13594b41011c043">00104</a>         <span class="keywordtype">float</span> alpha_qcd;
<a name="l00105"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a6ca0fb3012c13d65f7bc3ea095d41a73">00105</a>         <span class="keywordtype">float</span> alpha_qed;
<a name="l00106"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a21a1d471bc6ce75aedfdb9be2db5b0b2">00106</a>         vector&lt;float&gt;      weights;
<a name="l00107"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#af705e3b582d71aef2b82d27e1056952b">00107</a>         vector&lt;long&gt;       random;
<a name="l00108"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a7e32471a0f8b744e116a1ae9d0d7e620">00108</a>         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html">EventHeader</a>() : id(0), num_vertices(0), bp1(0), bp2(0), 
<a name="l00109"></a>00109                         signal_process_id(0), signal_process_vertex(0),
<a name="l00110"></a>00110                         scale(0.0), alpha_qcd(0.0), alpha_qed(0.0), weights(), random() {}
<a name="l00111"></a>00111       };
<a name="l00112"></a>00112 
<a name="l00114"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452c">00114</a>       <span class="keyword">enum</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452c" title="The known_io enum is used to track which type of input is being read.">known_io</a> { <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a>=1, <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452caa170d10707fb62bbdffdc5e2a65834fd">ascii</a>, <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a>, <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca17b19f25d74815dc415a5fde0f894f2d">ascii_pdt</a>, <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca951f0ef82695d1e0a1353c5237a3dbcc">extascii_pdt</a> };
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">00116</a>       <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> {
<a name="l00117"></a>00117       <span class="keyword">public</span>:
<a name="l00118"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3e270d38edde8369e52ad396615a2755">00118</a>         <span class="keyword">typedef</span> std::map&lt;int,Geant4Vertex*&gt; Vertices;
<a name="l00119"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a99e0260f816229d8ab3ebdd5487b3af1">00119</a>         <span class="keyword">typedef</span> std::map&lt;int,Geant4Particle*&gt; <a class="code" href="_geant4_r_o_o_t_dump_8cpp.html#a24e1766fcd30eeb6d44b2dd28b50afb6">Particles</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">00121</a>         istream&amp; instream;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="comment">// io information</span>
<a name="l00124"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ac17d00d243288f0b1dec90a167b57868">00124</a>         <span class="keywordtype">string</span> key;
<a name="l00125"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">00125</a>         <span class="keywordtype">double</span> mom_unit, pos_unit;
<a name="l00126"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">00126</a>         <span class="keywordtype">int</span>    io_type;
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab2ad757474584ec785c50c36181b2ae2">00128</a>         <span class="keywordtype">float</span>  xsection, xsection_err;
<a name="l00129"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ac60c5b73780a0d523e2042a93610dfe3">00129</a>         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html">EventHeader</a> header;
<a name="l00130"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a714f7fea3a85b72aa7c925c580a2fe36">00130</a>         Vertices m_vertices;
<a name="l00131"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a40291edf72d71405515c98ea77e6670c">00131</a>         <a class="code" href="_geant4_r_o_o_t_dump_8cpp.html#a24e1766fcd30eeb6d44b2dd28b50afb6">Particles</a> m_particles;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a73b3cc7b9dee4ad7e9e2dcf17a09e896">00134</a>         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>(istream&amp; in) : instream(in), mom_unit(0.0), pos_unit(0.0),
<a name="l00135"></a>00135                                    io_type(0), xsection(0.0), xsection_err(0.0)
<a name="l00136"></a>00136         { use_default_units();                       }
<a name="l00138"></a>00138         <span class="keywordtype">bool</span> ok()  <span class="keyword">const</span>;
<a name="l00139"></a>00139         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a3a13a13dbe2dce0cfbea9607895abf14">vertex</a>(<span class="keywordtype">int</span> i);
<a name="l00140"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">00140</a>         <a class="code" href="_geant4_r_o_o_t_dump_8cpp.html#a24e1766fcd30eeb6d44b2dd28b50afb6">Particles</a>&amp; <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>() { <span class="keywordflow">return</span> m_particles; }
<a name="l00141"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">00141</a>         Vertices&amp;  <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>()  { <span class="keywordflow">return</span> m_vertices;  }
<a name="l00142"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">00142</a>         <span class="keywordtype">void</span> set_io(<span class="keywordtype">int</span> typ, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; k)
<a name="l00143"></a>00143         { io_type = typ;    key = k;                 }
<a name="l00144"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acd5b712fdee97581ee70ce3365b11270">00144</a>         <span class="keywordtype">void</span> use_default_units()
<a name="l00145"></a>00145         { mom_unit = <a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">MeV</a>;   pos_unit = <a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">mm</a>;           }
<a name="l00146"></a>00146         <span class="keywordtype">bool</span> read();
<a name="l00147"></a>00147         <span class="keywordtype">void</span> clear();
<a name="l00148"></a>00148       };
<a name="l00149"></a>00149 
<a name="l00150"></a>00150       <span class="keywordtype">char</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">get_input</a>(istream&amp; is, istringstream&amp; iline);
<a name="l00151"></a>00151       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a433e938fb3dfef8ae2590fa16cdb2229">read_until_event_end</a>(istream &amp; is);
<a name="l00152"></a>00152       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a9a0a541fc8f48d5f9b80131b7f3b7e88">read_weight_names</a>(EventStream &amp;, istringstream&amp; iline);
<a name="l00153"></a>00153       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ab38b9307ace39b3227306e907c3f6840">read_particle</a>(EventStream &amp;info, istringstream&amp; iline, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a> * p);
<a name="l00154"></a>00154       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a05115a3e0b60dbe2ee86c5094cdd16bc">read_vertex</a>(EventStream &amp;info, istream&amp; is, istringstream &amp; iline);
<a name="l00155"></a>00155       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#aff50680cc4089a0f2c3b7a0218b3ed2e">read_event_header</a>(EventStream &amp;info, istringstream &amp; input, EventHeader&amp; header);
<a name="l00156"></a>00156       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a873025dee0b6f8a5ce8bd3485e518213">read_cross_section</a>(EventStream &amp;info, istringstream &amp; input);
<a name="l00157"></a>00157       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a35bd1c93d31d755bf0b911399c90c789">read_units</a>(EventStream &amp;info, istringstream &amp; input);
<a name="l00158"></a>00158       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a973a0fe661658598d3982e072e11f77d">read_heavy_ion</a>(EventStream &amp;, istringstream &amp; input);
<a name="l00159"></a>00159       <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a599dd238f1b1dc069a14f3bf57c09cfb">read_pdf</a>(EventStream &amp;, istringstream &amp; input);
<a name="l00160"></a>00160       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a3a13a13dbe2dce0cfbea9607895abf14">vertex</a>(EventStream&amp; info, <span class="keywordtype">int</span> i);
<a name="l00161"></a>00161       <span class="keywordtype">void</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a07b61ea67e59ff0e064a976336f7f3f3">fix_particles</a>(EventStream &amp;info);
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00167"></a>00167 Geant4EventReaderHepMC::Geant4EventReaderHepMC(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; nam)
<a name="l00168"></a>00168   : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html" title="Basic geant4 event reader class. This interface/base-class must be implemented by...">Geant4EventReader</a>(nam), m_input(), m_events(0)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170   <span class="comment">// Now open the input file:</span>
<a name="l00171"></a>00171   m_input.open(nam.c_str(),BOOST_IOS::in|BOOST_IOS::binary);
<a name="l00172"></a>00172   <span class="keywordflow">if</span> ( not m_input.is_open() )   {
<a name="l00173"></a>00173     <span class="keywordtype">string</span> err = <span class="stringliteral">&quot;+++ Geant4EventReaderHepMC: Failed to open input stream:&quot;</span>+nam+
<a name="l00174"></a>00174       <span class="stringliteral">&quot; Error:&quot;</span>+<a class="code" href="classstd_1_1string.html">string</a>(strerror(errno));
<a name="l00175"></a>00175     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(err);
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177   m_events = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a73b3cc7b9dee4ad7e9e2dcf17a09e896">HepMC::EventStream</a>(m_input);
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00181"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a437c86083e7da05be4821da864d8954a">00181</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a437c86083e7da05be4821da864d8954a" title="Default destructor.">Geant4EventReaderHepMC::~Geant4EventReaderHepMC</a>()    {
<a name="l00182"></a>00182   <span class="keyword">delete</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>;
<a name="l00183"></a>00183   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a> = 0;
<a name="l00184"></a>00184   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#ab5768f9462667c171c87dbb0ce830e36">m_input</a>.close();
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00188"></a>00188 <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7" title="Status codes of the event reader object. Anything with NOT low-bit set is an error...">Geant4EventReader::EventReaderStatus</a>
<a name="l00189"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a95ba8736c8274f5b24b6cd0e0b424c33">00189</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a95ba8736c8274f5b24b6cd0e0b424c33" title="skipEvents if required">Geant4EventReaderHepMC::moveToEvent</a>(<span class="keywordtype">int</span> event_number) {
<a name="l00190"></a>00190   <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a> == 0 &amp;&amp; event_number != 0 ) {
<a name="l00191"></a>00191     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;EventReaderHepMC::moveToEvent&quot;</span>,<span class="stringliteral">&quot;Skipping the first %d events&quot;</span>, event_number);
<a name="l00192"></a>00192     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;EventReaderHepMC::moveToEvent&quot;</span>,<span class="stringliteral">&quot;Event number before skipping: %d&quot;</span>, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a>);
<a name="l00193"></a>00193     <span class="keywordflow">while</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a> &lt; event_number ) {
<a name="l00194"></a>00194       <span class="keywordflow">if</span> ( not <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a0a565ef129dd64aae36e05efc29a4be4">read</a>() ) <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7aaeb5bf886e4f7638fadf42796cd8b771">EVENT_READER_ERROR</a>;
<a name="l00195"></a>00195       ++<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a>;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42aae10bc5a07787c36af0a4c9921b262d2">INFO</a>,<span class="stringliteral">&quot;EventReaderHepMC::moveToEvent&quot;</span>,<span class="stringliteral">&quot;Current event number: %d&quot;</span>,<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a>);
<a name="l00199"></a>00199   <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7a13d6e75077901770699fb70535bd24f5">EVENT_READER_OK</a>;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00203"></a>00203 <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7" title="Status codes of the event reader object. Anything with NOT low-bit set is an error...">Geant4EventReaderHepMC::EventReaderStatus</a>
<a name="l00204"></a>00204 <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#acb5e3d21a1eea4870b3dd73649f363ae" title="Read an event and fill a vector of MCParticles.">Geant4EventReaderHepMC::readParticles</a>(<span class="keywordtype">int</span> <span class="comment">/* ev_id */</span>,
<a name="l00205"></a>00205                                       Vertex&amp; primary_vertex,
<a name="l00206"></a>00206                                       <a class="code" href="_geant4_r_o_o_t_dump_8cpp.html#a24e1766fcd30eeb6d44b2dd28b50afb6">Particles</a>&amp; output) {
<a name="l00207"></a>00207   <span class="keywordflow">if</span> ( !<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a42014bf4f8f95b2c8b54ec5eede2be61" title="Check if data stream is in proper state and has data.">ok</a>() )  {
<a name="l00208"></a>00208     <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7a228cd68e3e7f8d4562f18996cae80e46">EVENT_READER_IO_ERROR</a>;
<a name="l00209"></a>00209   }
<a name="l00210"></a>00210   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a0a565ef129dd64aae36e05efc29a4be4">read</a>() )  {
<a name="l00211"></a>00211     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a99e0260f816229d8ab3ebdd5487b3af1">EventStream::Particles</a>&amp; parts = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>();
<a name="l00212"></a>00212     <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> pos(primary_vertex.x,primary_vertex.y,primary_vertex.z);
<a name="l00213"></a>00213     output.reserve(parts.size());
<a name="l00214"></a>00214     transform(parts.begin(),parts.end(),back_inserter(output),<a class="code" href="namespace_d_d4hep.html#ab09403d5ba66107d7e7af6952f6580bf">reference2nd</a>(parts));
<a name="l00215"></a>00215     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader_hep_m_c.html#a0e1d85baaaec0af5a18bb63ec3cdd20a">m_events</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a154b4f2355eac25743ec73982d588c39">clear</a>();
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (pos.mag2() &gt; numeric_limits&lt;double&gt;::epsilon() )  {
<a name="l00217"></a>00217       <span class="keywordflow">for</span>(Particles::iterator k=output.begin(); k != output.end(); ++k) {
<a name="l00218"></a>00218         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle_handle.html" title="Data structure to access derived MC particle information.">Geant4ParticleHandle</a> p(*k);
<a name="l00219"></a>00219         p-&gt;vsx += pos.x();
<a name="l00220"></a>00220         p-&gt;vsy += pos.y();
<a name="l00221"></a>00221         p-&gt;vsz += pos.z();
<a name="l00222"></a>00222         p-&gt;vex += pos.x();
<a name="l00223"></a>00223         p-&gt;vey += pos.y();
<a name="l00224"></a>00224         p-&gt;vez += pos.z();
<a name="l00225"></a>00225       }
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">for</span>(Particles::const_iterator k=output.begin(); k != output.end(); ++k) {
<a name="l00228"></a>00228       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle_handle.html" title="Data structure to access derived MC particle information.">Geant4ParticleHandle</a> p(*k);
<a name="l00229"></a>00229       <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a2c12bf245b6095423f62644ab1f5eedf">VERBOSE</a>,<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a0a6ea787174ce598d22ce1616c1f25af" title="File name to be opened and read.">m_name</a>,
<a name="l00230"></a>00230                <span class="stringliteral">&quot;+++ %s ID:%3d status:%08X typ:%9d Mom:(%+.2e,%+.2e,%+.2e)[MeV] &quot;</span>
<a name="l00231"></a>00231                <span class="stringliteral">&quot;time: %+.2e [ns] #Dau:%3d #Par:%1d&quot;</span>,
<a name="l00232"></a>00232                <span class="stringliteral">&quot;&quot;</span>,p-&gt;id,p-&gt;status,p-&gt;pdgID,
<a name="l00233"></a>00233                p-&gt;psx/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">MeV</a>,p-&gt;psy/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">MeV</a>,p-&gt;psz/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">MeV</a>,p-&gt;time/<a class="code" href="namespacedd4hep.html#af8ce9b988119cb2c9b6b7397dbb34e97">ns</a>,
<a name="l00234"></a>00234                p-&gt;daughters.size(),
<a name="l00235"></a>00235                p-&gt;parents.size());
<a name="l00236"></a>00236       <span class="comment">//output.push_back(p);</span>
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     ++<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#a3f1446121fae285cd2772ca9bd1d8af3" title="Current event number.">m_currEvent</a>;
<a name="l00239"></a>00239     <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7a13d6e75077901770699fb70535bd24f5">EVENT_READER_OK</a>;
<a name="l00240"></a>00240   }
<a name="l00241"></a>00241   <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_reader.html#ae4f4bc83ffcf5b0c1868ad78859851e7a228cd68e3e7f8d4562f18996cae80e46">EVENT_READER_IO_ERROR</a>;
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a07b61ea67e59ff0e064a976336f7f3f3">00244</a> <span class="keywordtype">void</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a07b61ea67e59ff0e064a976336f7f3f3">HepMC::fix_particles</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>&amp; info)  {
<a name="l00245"></a>00245   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a99e0260f816229d8ab3ebdd5487b3af1">EventStream::Particles</a>&amp; parts = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>();
<a name="l00246"></a>00246   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3e270d38edde8369e52ad396615a2755">EventStream::Vertices</a>&amp; verts = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>();
<a name="l00247"></a>00247   EventStream::Particles::iterator i;
<a name="l00248"></a>00248   std::set&lt;int&gt;::const_iterator id, ip;
<a name="l00249"></a>00249   <span class="keywordflow">for</span>(i=parts.begin(); i != parts.end(); ++i)  {
<a name="l00250"></a>00250     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle_handle.html" title="Data structure to access derived MC particle information.">Geant4ParticleHandle</a> p((*i).second);
<a name="l00251"></a>00251     <span class="keywordtype">int</span> end_vtx_id = p-&gt;secondaries;
<a name="l00252"></a>00252     p-&gt;secondaries = 0;
<a name="l00253"></a>00253     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a> = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a3a13a13dbe2dce0cfbea9607895abf14">vertex</a>(info,end_vtx_id);
<a name="l00254"></a>00254     <span class="keywordflow">if</span> ( v )   {
<a name="l00255"></a>00255       p-&gt;vex = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a0c73b563689113d23c51d5b5864a63f8" title="Vertex data.">x</a>;
<a name="l00256"></a>00256       p-&gt;vey = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#afbb9e4460c4c7a1610b5d3d0ccb37e25">y</a>;
<a name="l00257"></a>00257       p-&gt;vez = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#af2489a2b21e08b2cc0ffe1f4bf1937df">z</a>;
<a name="l00258"></a>00258       v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#acf382e2d22907f72105b2a107e167327" title="The list of incoming particles.">in</a>.insert(p-&gt;id);
<a name="l00259"></a>00259       <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a238ee91ad7a5d6230d58335af4af6d70" title="The list of outgoing particles.">out</a>.begin(); <span class="keywordtype">id</span>!=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a238ee91ad7a5d6230d58335af4af6d70" title="The list of outgoing particles.">out</a>.end();++id)
<a name="l00260"></a>00260         p-&gt;daughters.insert(*<span class="keywordtype">id</span>);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262   }
<a name="l00263"></a>00263   EventStream::Vertices::iterator j;
<a name="l00264"></a>00264   <span class="keywordflow">for</span>(j=verts.begin(); j != verts.end(); ++j)  {
<a name="l00265"></a>00265     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a> = (*j).second;
<a name="l00266"></a>00266     <span class="keywordflow">for</span> (ip=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a238ee91ad7a5d6230d58335af4af6d70" title="The list of outgoing particles.">out</a>.begin(); ip!=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a238ee91ad7a5d6230d58335af4af6d70" title="The list of outgoing particles.">out</a>.end();++ip)   {
<a name="l00267"></a>00267       EventStream::Particles::iterator ipp = parts.find(*ip);
<a name="l00268"></a>00268       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a>* p = (*ipp).second;
<a name="l00269"></a>00269       <span class="keywordflow">for</span> (<span class="keywordtype">id</span>=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#acf382e2d22907f72105b2a107e167327" title="The list of incoming particles.">in</a>.begin(); <span class="keywordtype">id</span>!=v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#acf382e2d22907f72105b2a107e167327" title="The list of incoming particles.">in</a>.end();++id)  {
<a name="l00270"></a>00270         p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a78909a136dade0e85770a6e0edb3bdad" title="The list of daughters of this MC particle.">parents</a>.insert(*<span class="keywordtype">id</span>);
<a name="l00271"></a>00271       }
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273   }
<a name="l00276"></a>00276   <a class="code" href="classstd_1_1vector.html">vector&lt;Geant4Particle*&gt;</a> beam;
<a name="l00277"></a>00277   <span class="keywordflow">for</span>(i=parts.begin(); i != parts.end(); ++i)  {
<a name="l00278"></a>00278     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle_handle.html" title="Data structure to access derived MC particle information.">Geant4ParticleHandle</a> p((*i).second);
<a name="l00279"></a>00279     <span class="keywordflow">if</span> ( p-&gt;parents.size() == 0 )  {
<a name="l00280"></a>00280       <span class="keywordflow">for</span>(<span class="keywordtype">id</span>=p-&gt;daughters.begin(); <span class="keywordtype">id</span>!=p-&gt;daughters.end();++id)  {
<a name="l00281"></a>00281         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a> *pp = parts[*id];
<a name="l00282"></a>00282         beam.push_back(pp);
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285   }
<a name="l00286"></a>00286   <span class="keywordflow">for</span>(<a class="code" href="classstd_1_1vector.html">vector&lt;Geant4Particle*&gt;::iterator</a> ipp=beam.begin(); ipp!=beam.end();++ipp)  {
<a name="l00287"></a>00287     <span class="comment">//cout &lt;&lt; &quot;Clear parents of &quot; &lt;&lt; (*ipp)-&gt;id &lt;&lt; endl;</span>
<a name="l00288"></a>00288     (*ipp)-&gt;parents.clear();
<a name="l00289"></a>00289     (*ipp)-&gt;status = <a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca3ac47e06eaf860de208f0b0411a85b13">G4PARTICLE_GEN_DECAYED</a>;
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a3a13a13dbe2dce0cfbea9607895abf14">00293</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a3a13a13dbe2dce0cfbea9607895abf14">HepMC::vertex</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>&amp; info, <span class="keywordtype">int</span> i)   {
<a name="l00294"></a>00294   EventStream::Vertices::iterator it=info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>().find(i);
<a name="l00295"></a>00295   <span class="keywordflow">return</span> (it==info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>().end()) ? 0 : (*it).second;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">00298</a> <span class="keywordtype">char</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">HepMC::get_input</a>(istream&amp; is, istringstream&amp; iline)  {
<a name="l00299"></a>00299   <span class="keywordtype">char</span> value = is.peek();
<a name="l00300"></a>00300   <span class="keywordflow">if</span> ( !is ) {        <span class="comment">// make sure the stream is valid</span>
<a name="l00301"></a>00301     cerr &lt;&lt; <span class="stringliteral">&quot;StreamHelpers: setting badbit.&quot;</span> &lt;&lt; endl;
<a name="l00302"></a>00302     is.clear(ios::badbit);
<a name="l00303"></a>00303     <span class="keywordflow">return</span> -1;
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305   <span class="keywordtype">string</span> line, firstc;
<a name="l00306"></a>00306   getline(is,line);
<a name="l00307"></a>00307   <span class="keywordflow">if</span> ( !is ) {        <span class="comment">// make sure the stream is valid</span>
<a name="l00308"></a>00308     cerr &lt;&lt; <span class="stringliteral">&quot;StreamHelpers: setting badbit.&quot;</span> &lt;&lt; endl;
<a name="l00309"></a>00309     is.clear(ios::badbit);
<a name="l00310"></a>00310     <span class="keywordflow">return</span> -1;
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312   iline.clear();
<a name="l00313"></a>00313   iline.str(line);
<a name="l00314"></a>00314   <span class="keywordflow">if</span> ( line.length()&gt;0 &amp;&amp; line[1] == <span class="charliteral">&apos; &apos;</span> ) iline &gt;&gt; firstc;
<a name="l00315"></a>00315   <span class="keywordflow">return</span> iline ? value : -1;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a433e938fb3dfef8ae2590fa16cdb2229">00318</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a433e938fb3dfef8ae2590fa16cdb2229">HepMC::read_until_event_end</a>(istream &amp; is) {
<a name="l00319"></a>00319   <span class="keywordtype">string</span> line;
<a name="l00320"></a>00320   <span class="keywordflow">while</span> ( is ) {
<a name="l00321"></a>00321     <span class="keywordtype">char</span> val = is.peek();
<a name="l00322"></a>00322     <span class="keywordflow">if</span>( val == <span class="charliteral">&apos;E&apos;</span> ) {  <span class="comment">// next event</span>
<a name="l00323"></a>00323       <span class="keywordflow">return</span> 1;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325     getline(is,line);
<a name="l00326"></a>00326     <span class="keywordflow">if</span> ( !is.good() ) <span class="keywordflow">return</span> 0;
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328   <span class="keywordflow">return</span> 0;
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a9a0a541fc8f48d5f9b80131b7f3b7e88">00331</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a9a0a541fc8f48d5f9b80131b7f3b7e88">HepMC::read_weight_names</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>&amp;, istringstream&amp;)   {
<a name="l00332"></a>00332 <span class="preprocessor">#if 0</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>  <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a9a0a541fc8f48d5f9b80131b7f3b7e88">HepMC::read_weight_names</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>&amp; info, istringstream&amp; iline)
<a name="l00334"></a>00334     <span class="keywordtype">size_t</span> name_size = 0;
<a name="l00335"></a>00335   iline &gt;&gt; name_size;
<a name="l00336"></a>00336   info.weights.names.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a154b4f2355eac25743ec73982d588c39">clear</a>();
<a name="l00337"></a>00337   info.weights.weights.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a154b4f2355eac25743ec73982d588c39">clear</a>();
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <span class="keywordtype">string</span> name;
<a name="l00340"></a>00340   WeightContainer namedWeight;
<a name="l00341"></a>00341   string::size_type i1 = line.find(<span class="stringliteral">&quot;\&quot;&quot;</span>), i2, len = line.size();
<a name="l00342"></a>00342   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> ii = 0; ii &lt; name_size; ++ii) {
<a name="l00343"></a>00343     <span class="comment">// weight names may contain blanks</span>
<a name="l00344"></a>00344     <span class="keywordflow">if</span>(i1 &gt;= len) {
<a name="l00345"></a>00345       cout &lt;&lt; <span class="stringliteral">&quot;debug: attempting to read past the end of the named weight line &quot;</span> &lt;&lt; endl;
<a name="l00346"></a>00346       cout &lt;&lt; <span class="stringliteral">&quot;debug: We should never get here&quot;</span> &lt;&lt; endl;
<a name="l00347"></a>00347       cout &lt;&lt; <span class="stringliteral">&quot;debug: Looking for the end of this event&quot;</span> &lt;&lt; endl;
<a name="l00348"></a>00348       <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a433e938fb3dfef8ae2590fa16cdb2229">read_until_event_end</a>(is);
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350     i2 = line.find(<span class="stringliteral">&quot;\&quot;&quot;</span>,i1+1);
<a name="l00351"></a>00351     name = line.substr(i1+1,i2-i1-1);
<a name="l00352"></a>00352     <span class="keywordflow">if</span> ( namedWeight.names.find(name) == namedWeight.names.end() )
<a name="l00353"></a>00353       namedWeight.names[name] = namedWeight.names.size();
<a name="l00354"></a>00354     namedWeight.weights[ii] = info.weights.weights[ii];
<a name="l00355"></a>00355     i1 = line.find(<span class="stringliteral">&quot;\&quot;&quot;</span>,i2+1);
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   info.weights.weights = namedWeight.weights;
<a name="l00359"></a>00359   info.weights.names   = namedWeight.names;
<a name="l00360"></a>00360 <span class="preprocessor">#endif</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 1;
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ab38b9307ace39b3227306e907c3f6840">00364</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ab38b9307ace39b3227306e907c3f6840">HepMC::read_particle</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;info, istringstream&amp; input, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a> * p)   {
<a name="l00365"></a>00365   <span class="keywordtype">float</span> ene = 0., theta = 0., phi = 0;
<a name="l00366"></a>00366   <span class="keywordtype">int</span>   size = 0, stat=0;
<a name="l00367"></a>00367   <a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html" title="Data structure to manipulate a bitmask held by reference and represented by an integer...">PropertyMask</a> status(p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#af9637a505c345dfe4a16309aa80ba89d">status</a>);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="comment">// check that the input stream is still OK after reading item</span>
<a name="l00370"></a>00370   input &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#acc6eea6683706e87e8b769c94caf3cd2" title="not persistent">id</a> &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a0af9d9907bce8d40f3bf0207fb6424c3">pdgID</a> &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a2c169e0bf0dc706a43254c4c8ca9ccc2">psx</a> &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#abc3b6008b4d4366bce059fa360e8d3c7">psy</a> &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1caec949ea63cfe52c101007c0ebcaea">psz</a> &gt;&gt; ene;
<a name="l00371"></a>00371   p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#acc6eea6683706e87e8b769c94caf3cd2" title="not persistent">id</a> = info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>().size();
<a name="l00372"></a>00372   p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a2c169e0bf0dc706a43254c4c8ca9ccc2">psx</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a>;
<a name="l00373"></a>00373   p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#abc3b6008b4d4366bce059fa360e8d3c7">psy</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a>;
<a name="l00374"></a>00374   p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1caec949ea63cfe52c101007c0ebcaea">psz</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a>;
<a name="l00375"></a>00375   ene *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a>;
<a name="l00376"></a>00376   <span class="keywordflow">if</span> ( !input )
<a name="l00377"></a>00377     <span class="keywordflow">return</span> 0;
<a name="l00378"></a>00378   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> != <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452caa170d10707fb62bbdffdc5e2a65834fd">ascii</a> )  {
<a name="l00379"></a>00379     input &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#aeb13e47e5c91dcfbfac27f41552b8298">mass</a>;
<a name="l00380"></a>00380     p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#aeb13e47e5c91dcfbfac27f41552b8298">mass</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a>;
<a name="l00381"></a>00381   }
<a name="l00382"></a>00382   <span class="keywordflow">else</span>   {
<a name="l00383"></a>00383     p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#aeb13e47e5c91dcfbfac27f41552b8298">mass</a> = std::sqrt(fabs(ene*ene - (p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a2c169e0bf0dc706a43254c4c8ca9ccc2">psx</a>*p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a2c169e0bf0dc706a43254c4c8ca9ccc2">psx</a> + p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#abc3b6008b4d4366bce059fa360e8d3c7">psy</a>*p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#abc3b6008b4d4366bce059fa360e8d3c7">psy</a> + p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1caec949ea63cfe52c101007c0ebcaea">psz</a>*p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1caec949ea63cfe52c101007c0ebcaea">psz</a>)));
<a name="l00384"></a>00384   }
<a name="l00385"></a>00385   <span class="comment">// Reuse here the secondaries to store the end-vertex ID</span>
<a name="l00386"></a>00386   input &gt;&gt; stat &gt;&gt; theta &gt;&gt; phi &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#ac27f420d9419ca31a1506cc6ac419043">secondaries</a> &gt;&gt; size;
<a name="l00387"></a>00387   <span class="keywordflow">if</span>(!input)
<a name="l00388"></a>00388     <span class="keywordflow">return</span> 0;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390   <span class="comment">//</span>
<a name="l00391"></a>00391   <span class="comment">//  Generator status</span>
<a name="l00392"></a>00392   <span class="comment">//  Simulator status 0 until simulator acts on it</span>
<a name="l00393"></a>00393   status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a3c384d81d710f444161e1f8cbf9420ae">clear</a>();
<a name="l00394"></a>00394   <span class="keywordflow">if</span> ( stat == 0 )      status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100caa8271966ffbb0167cdab36566e91ca89">G4PARTICLE_GEN_EMPTY</a>);
<a name="l00395"></a>00395   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stat == 0x1 ) status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca24f8b7a443a53143ecf382725a114aab">G4PARTICLE_GEN_STABLE</a>);
<a name="l00396"></a>00396   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stat == 0x2 ) status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca3ac47e06eaf860de208f0b0411a85b13">G4PARTICLE_GEN_DECAYED</a>);
<a name="l00397"></a>00397   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stat == 0x3 ) status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca792aaadde2925ea72cbedae5255262e0">G4PARTICLE_GEN_DOCUMENTATION</a>);
<a name="l00398"></a>00398   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stat == 0x4 ) status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca792aaadde2925ea72cbedae5255262e0">G4PARTICLE_GEN_DOCUMENTATION</a>);
<a name="l00399"></a>00399   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( stat == 0xB ) status.<a class="code" href="class_d_d4hep_1_1_reference_bit_mask.html#a9b0db38e1812101d6d93e1d00944b745">set</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation.html#a88917bdf7f18e2bbd7c9942c897f100ca792aaadde2925ea72cbedae5255262e0">G4PARTICLE_GEN_DOCUMENTATION</a>);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="comment">// read flow patterns if any exist</span>
<a name="l00402"></a>00402   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; ++i ) {
<a name="l00403"></a>00403     input &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a739e02b76f159e26d92023cd1746c8cf">colorFlow</a>[0] &gt;&gt; p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a739e02b76f159e26d92023cd1746c8cf">colorFlow</a>[1];
<a name="l00404"></a>00404     <span class="keywordflow">if</span>(!input) <span class="keywordflow">return</span> 0;
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406   <span class="keywordflow">return</span> 1;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a05115a3e0b60dbe2ee86c5094cdd16bc">00409</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a05115a3e0b60dbe2ee86c5094cdd16bc">HepMC::read_vertex</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;info, istream&amp; is, istringstream &amp; input)    {
<a name="l00410"></a>00410   <span class="keywordtype">int</span> <span class="keywordtype">id</span>=0, dummy = 0, num_orphans_in=0, num_particles_out=0, weights_size=0;
<a name="l00411"></a>00411   <a class="code" href="classstd_1_1vector.html">vector&lt;float&gt;</a> weights;
<a name="l00412"></a>00412   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>* <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a> = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html" title="Data structure to store the MC vertex information.">Geant4Vertex</a>();
<a name="l00413"></a>00413   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a>* p;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="keywordflow">if</span>( !input ) {
<a name="l00416"></a>00416     <span class="keyword">delete</span> v;
<a name="l00417"></a>00417     <span class="keywordflow">return</span> 0;
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419   input &gt;&gt; <span class="keywordtype">id</span> &gt;&gt; dummy &gt;&gt; v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a0c73b563689113d23c51d5b5864a63f8" title="Vertex data.">x</a> &gt;&gt; v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#afbb9e4460c4c7a1610b5d3d0ccb37e25">y</a> &gt;&gt; v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#af2489a2b21e08b2cc0ffe1f4bf1937df">z</a> &gt;&gt; v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a3c68aa0fed7db61bf66bfcfb03ad5ca0">time</a>
<a name="l00420"></a>00420         &gt;&gt; num_orphans_in &gt;&gt; num_particles_out &gt;&gt; weights_size;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a0c73b563689113d23c51d5b5864a63f8" title="Vertex data.">x</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a>;
<a name="l00423"></a>00423   v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#afbb9e4460c4c7a1610b5d3d0ccb37e25">y</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a>;
<a name="l00424"></a>00424   v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#af2489a2b21e08b2cc0ffe1f4bf1937df">z</a> *= info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a>;
<a name="l00425"></a>00425   weights.resize(weights_size);
<a name="l00426"></a>00426   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i1 = 0; i1 &lt; weights_size; ++i1) {
<a name="l00427"></a>00427     input &gt;&gt; weights[i1];
<a name="l00428"></a>00428     <span class="keywordflow">if</span>(!input) {
<a name="l00429"></a>00429       <span class="keyword">delete</span> v;
<a name="l00430"></a>00430       <span class="keywordflow">return</span> 0;
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433   info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>().insert(make_pair(<span class="keywordtype">id</span>,v));
<a name="l00434"></a>00434   <span class="comment">//cout &lt;&lt; &quot;Add Vertex:&quot; &lt;&lt; id &lt;&lt; endl;</span>
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="keywordflow">for</span>(<span class="keywordtype">char</span> value = is.peek(); value==<span class="charliteral">&apos;P&apos;</span>; value=is.peek())  {
<a name="l00437"></a>00437     value = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">get_input</a>(is,input);
<a name="l00438"></a>00438     <span class="keywordflow">if</span>( !input || value &lt; 0 )
<a name="l00439"></a>00439       <span class="keywordflow">return</span> 0;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ab38b9307ace39b3227306e907c3f6840">read_particle</a>(info, input,p = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html" title="Data structure to store the MC particle information.">Geant4Particle</a>());
<a name="l00442"></a>00442     <span class="keywordflow">if</span>(!input)   {
<a name="l00443"></a>00443       cerr &lt;&lt; <span class="stringliteral">&quot;Failed to read particle!&quot;</span> &lt;&lt; endl;
<a name="l00444"></a>00444       <span class="keyword">delete</span> p;
<a name="l00445"></a>00445       <span class="keywordflow">return</span> 0;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447     info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>().insert(make_pair(p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#acc6eea6683706e87e8b769c94caf3cd2" title="not persistent">id</a>,p));
<a name="l00448"></a>00448     p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a6ac77a569db28fb000fa4cd33c6dbc25">pex</a> = p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a2c169e0bf0dc706a43254c4c8ca9ccc2">psx</a>;
<a name="l00449"></a>00449     p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a17f6e47420fc54bc5b6440e26f0181e2">pey</a> = p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#abc3b6008b4d4366bce059fa360e8d3c7">psy</a>;
<a name="l00450"></a>00450     p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a83de70580c139f049a057c0e185812d1">pez</a> = p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1caec949ea63cfe52c101007c0ebcaea">psz</a>;
<a name="l00451"></a>00451     <span class="keywordflow">if</span> ( --num_orphans_in &gt;= 0 )   {
<a name="l00452"></a>00452       v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#acf382e2d22907f72105b2a107e167327" title="The list of incoming particles.">in</a>.insert(p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#acc6eea6683706e87e8b769c94caf3cd2" title="not persistent">id</a>);
<a name="l00453"></a>00453       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a28b83040272870e04caff34da5846464">vex</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a0c73b563689113d23c51d5b5864a63f8" title="Vertex data.">x</a>;
<a name="l00454"></a>00454       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a1befe26ea99280bd0a57d6d858165ef6">vey</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#afbb9e4460c4c7a1610b5d3d0ccb37e25">y</a>;
<a name="l00455"></a>00455       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a63ac22451aea71547d69c407ae4824da">vez</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#af2489a2b21e08b2cc0ffe1f4bf1937df">z</a>;
<a name="l00456"></a>00456       <span class="comment">//cout &lt;&lt; &quot;Add INGOING  Particle:&quot; &lt;&lt; p-&gt;id &lt;&lt; endl;</span>
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( num_particles_out &gt;= 0 )   {
<a name="l00459"></a>00459       v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a238ee91ad7a5d6230d58335af4af6d70" title="The list of outgoing particles.">out</a>.insert(p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#acc6eea6683706e87e8b769c94caf3cd2" title="not persistent">id</a>);
<a name="l00460"></a>00460       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a3687f6d18f29f056fda968cfccd8251a">vsx</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#a0c73b563689113d23c51d5b5864a63f8" title="Vertex data.">x</a>;
<a name="l00461"></a>00461       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#a59b9d6e764aa6ea6c2cf011aba056c29">vsy</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#afbb9e4460c4c7a1610b5d3d0ccb37e25">y</a>;
<a name="l00462"></a>00462       p-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_particle.html#aba9c37b5693ebe378cd17519228daa3d">vsz</a> = v-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_vertex.html#af2489a2b21e08b2cc0ffe1f4bf1937df">z</a>;
<a name="l00463"></a>00463       <span class="comment">//cout &lt;&lt; &quot;Add OUTGOING Particle:&quot; &lt;&lt; p-&gt;id &lt;&lt; endl;</span>
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465     <span class="keywordflow">else</span>  {
<a name="l00466"></a>00466       <span class="keyword">delete</span> p;
<a name="l00467"></a>00467       <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Invalid number of particles....&quot;</span>);
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469   }
<a name="l00470"></a>00470   <span class="keywordflow">return</span> 1;
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#aff50680cc4089a0f2c3b7a0218b3ed2e">00473</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#aff50680cc4089a0f2c3b7a0218b3ed2e">HepMC::read_event_header</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;info, istringstream &amp; input, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html">EventHeader</a>&amp; header)   {
<a name="l00474"></a>00474   <span class="comment">// read values into temp variables, then fill GenEvent</span>
<a name="l00475"></a>00475   <span class="keywordtype">int</span> random_states_size = 0;
<a name="l00476"></a>00476   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a221f01143ced151a262de45ca6749cc4">id</a>;
<a name="l00477"></a>00477   <span class="keywordflow">if</span>( info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a> || info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a> ) {
<a name="l00478"></a>00478     <span class="keywordtype">int</span> nmpi = -1;
<a name="l00479"></a>00479     input &gt;&gt; nmpi;
<a name="l00480"></a>00480     <span class="keywordflow">if</span>( input.fail() ) <span class="keywordflow">return</span> 0;
<a name="l00481"></a>00481     <span class="comment">//MSF set_mpi( nmpi );</span>
<a name="l00482"></a>00482   }
<a name="l00483"></a>00483   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a68ba7289f036ebb18a5ae1d6c602bfa8">scale</a>;
<a name="l00484"></a>00484   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#aa21d0c781608de75c13594b41011c043">alpha_qcd</a>;
<a name="l00485"></a>00485   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a6ca0fb3012c13d65f7bc3ea095d41a73">alpha_qed</a>;
<a name="l00486"></a>00486   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a339a52131b423a70529a66bae821906b">signal_process_id</a>;
<a name="l00487"></a>00487   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a22408536166a5457c2380e3a06c3ae0c">signal_process_vertex</a>;
<a name="l00488"></a>00488   input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a83354fc882a2fb46a053a524a7145eb1">num_vertices</a>;
<a name="l00489"></a>00489   <span class="keywordflow">if</span>( info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a> || info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a> )
<a name="l00490"></a>00490     input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a5c029c436a958d9903c9296823ed2195">bp1</a> &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a4b3d20b78f49d539c6487d2a5eeb844c">bp2</a>;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   input &gt;&gt; random_states_size;
<a name="l00493"></a>00493   cout &lt;&lt; input.str() &lt;&lt; endl;
<a name="l00494"></a>00494   input.clear();
<a name="l00495"></a>00495   <span class="keywordflow">if</span>( input.fail() ) <span class="keywordflow">return</span> 0;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#af705e3b582d71aef2b82d27e1056952b">random</a>.resize(random_states_size);
<a name="l00498"></a>00498   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; random_states_size; ++i )
<a name="l00499"></a>00499     input &gt;&gt; header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#af705e3b582d71aef2b82d27e1056952b">random</a>[i];
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   <span class="keywordtype">size_t</span> weights_size = 0;
<a name="l00502"></a>00502   input &gt;&gt; weights_size;
<a name="l00503"></a>00503   <span class="keywordflow">if</span>( input.fail() ) <span class="keywordflow">return</span> 0;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   <a class="code" href="classstd_1_1vector.html">vector&lt;float&gt;</a> wgt(weights_size);
<a name="l00506"></a>00506   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> ii = 0; ii &lt; weights_size; ++ii )
<a name="l00507"></a>00507     input &gt;&gt; wgt[ii];
<a name="l00508"></a>00508   <span class="keywordflow">if</span>( input.fail() ) <span class="keywordflow">return</span> 0;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="comment">// weight names will be added later if they exist</span>
<a name="l00511"></a>00511   <span class="keywordflow">if</span>( weights_size &gt; 0 ) header.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a21a1d471bc6ce75aedfdb9be2db5b0b2">weights</a> = wgt;
<a name="l00512"></a>00512   <span class="keywordflow">return</span> 1;
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a873025dee0b6f8a5ce8bd3485e518213">00515</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a873025dee0b6f8a5ce8bd3485e518213">HepMC::read_cross_section</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;info, istringstream &amp; input)   {
<a name="l00516"></a>00516   input &gt;&gt; info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f6b9fa99fe2752282e3650c51ad4918">xsection</a> &gt;&gt; info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab2ad757474584ec785c50c36181b2ae2">xsection_err</a>;
<a name="l00517"></a>00517   <span class="keywordflow">return</span> input.fail() ? 0 : 1;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a35bd1c93d31d755bf0b911399c90c789">00520</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a35bd1c93d31d755bf0b911399c90c789">HepMC::read_units</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;info, istringstream &amp; input)   {
<a name="l00521"></a>00521   <span class="keywordflow">if</span>( info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a> )  {
<a name="l00522"></a>00522     <span class="keywordtype">string</span> mom, pos;
<a name="l00523"></a>00523     input &gt;&gt; mom &gt;&gt; pos;
<a name="l00524"></a>00524     <span class="keywordflow">if</span> ( !input.fail() )  {
<a name="l00525"></a>00525       <span class="keywordflow">if</span> ( mom == <span class="stringliteral">&quot;KEV&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a> = <a class="code" href="namespacedd4hep.html#a2b928c9b9d50fa8a9d3f9840f3a5f258">keV</a>;
<a name="l00526"></a>00526       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mom == <span class="stringliteral">&quot;MEV&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a> = <a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">MeV</a>;
<a name="l00527"></a>00527       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mom == <span class="stringliteral">&quot;GEV&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a> = <a class="code" href="namespacedd4hep.html#a3b49780cbe455fda1f6b8a58ff555ae5">GeV</a>;
<a name="l00528"></a>00528       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( mom == <span class="stringliteral">&quot;TEV&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a3f8d6aeef7a8fa342bc15e7b17eb7d40">mom_unit</a> = <a class="code" href="namespacedd4hep.html#a7c925bf28d6b294f8f120a69deb6fe02">TeV</a>;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530       <span class="keywordflow">if</span> ( pos == <span class="stringliteral">&quot;MM&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a> = <a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">mm</a>;
<a name="l00531"></a>00531       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( pos == <span class="stringliteral">&quot;CM&quot;</span> ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a> = <a class="code" href="namespacedd4hep.html#a1f3cfefacfa8c2174102824c534c71b8">cm</a>;
<a name="l00532"></a>00532       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( pos == <span class="stringliteral">&quot;M&quot;</span>  ) info.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab528124a867412138e1d22b2310c1bad">pos_unit</a> = <a class="code" href="namespacedd4hep.html#a443d1517e365c8f0c3a498bff0f09088">m</a>;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534   }
<a name="l00535"></a>00535   <span class="keywordflow">return</span> input.fail() ? 0 : 1;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a973a0fe661658598d3982e072e11f77d">00538</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a973a0fe661658598d3982e072e11f77d">HepMC::read_heavy_ion</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;, istringstream &amp; input)  {
<a name="l00539"></a>00539   <span class="comment">// read values into temp variables, then create a new HeavyIon object</span>
<a name="l00540"></a>00540   <span class="keywordtype">int</span> nh =0, np =0, nt =0, nc =0,
<a name="l00541"></a>00541     neut = 0, prot = 0, nw =0, nwn =0, nwnw =0;
<a name="l00542"></a>00542   <span class="keywordtype">float</span> impact = 0., plane = 0., xcen = 0., inel = 0.;
<a name="l00543"></a>00543   input &gt;&gt; nh &gt;&gt; np &gt;&gt; nt &gt;&gt; nc &gt;&gt; neut &gt;&gt; prot &gt;&gt; nw &gt;&gt; nwn &gt;&gt; nwnw;
<a name="l00544"></a>00544   input &gt;&gt; impact &gt;&gt; plane &gt;&gt; xcen &gt;&gt; inel;
<a name="l00545"></a>00545   <span class="comment">/*</span>
<a name="l00546"></a>00546 <span class="comment">    cerr &lt;&lt; &quot;Reading heavy ion, but igoring data!&quot; &lt;&lt; endl;</span>
<a name="l00547"></a>00547 <span class="comment">    ion-&gt;set_Ncoll_hard(nh);</span>
<a name="l00548"></a>00548 <span class="comment">    ion-&gt;set_Npart_proj(np);</span>
<a name="l00549"></a>00549 <span class="comment">    ion-&gt;set_Npart_targ(nt);</span>
<a name="l00550"></a>00550 <span class="comment">    ion-&gt;set_Ncoll(nc);</span>
<a name="l00551"></a>00551 <span class="comment">    ion-&gt;set_spectator_neutrons(neut);</span>
<a name="l00552"></a>00552 <span class="comment">    ion-&gt;set_spectator_protons(prot);</span>
<a name="l00553"></a>00553 <span class="comment">    ion-&gt;set_N_Nwounded_collisions(nw);</span>
<a name="l00554"></a>00554 <span class="comment">    ion-&gt;set_Nwounded_N_collisions(nwn);</span>
<a name="l00555"></a>00555 <span class="comment">    ion-&gt;set_Nwounded_Nwounded_collisions(nwnw);</span>
<a name="l00556"></a>00556 <span class="comment">    ion-&gt;set_impact_parameter(impact);</span>
<a name="l00557"></a>00557 <span class="comment">    ion-&gt;set_event_plane_angle(plane);</span>
<a name="l00558"></a>00558 <span class="comment">    ion-&gt;set_eccentricity(xcen);</span>
<a name="l00559"></a>00559 <span class="comment">    ion-&gt;set_sigma_inel_NN(inel);</span>
<a name="l00560"></a>00560 <span class="comment">  */</span>
<a name="l00561"></a>00561   <span class="keywordflow">return</span> input.fail() ? 0 : 1;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a599dd238f1b1dc069a14f3bf57c09cfb">00564</a> <span class="keywordtype">int</span> <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a599dd238f1b1dc069a14f3bf57c09cfb">HepMC::read_pdf</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a> &amp;, istringstream &amp; input)  {
<a name="l00565"></a>00565   <span class="comment">// read values into temp variables, then create a new PdfInfo object</span>
<a name="l00566"></a>00566   <span class="keywordtype">int</span> id1 =0, id2 =0;
<a name="l00567"></a>00567   <span class="keywordtype">double</span>  x1 = 0., x2 = 0., scale = 0., pdf1 = 0., pdf2 = 0.;
<a name="l00568"></a>00568   input &gt;&gt; id1 ;
<a name="l00569"></a>00569   <span class="keywordflow">if</span> ( input.fail()  )
<a name="l00570"></a>00570     <span class="keywordflow">return</span> 0;
<a name="l00571"></a>00571   <span class="comment">// check now for empty PdfInfo line</span>
<a name="l00572"></a>00572   <span class="keywordflow">if</span>( id1 == 0 )
<a name="l00573"></a>00573     <span class="keywordflow">return</span> 0;
<a name="l00574"></a>00574   <span class="comment">// continue reading</span>
<a name="l00575"></a>00575   input &gt;&gt; id2 &gt;&gt; x1 &gt;&gt; x2 &gt;&gt; scale &gt;&gt; pdf1 &gt;&gt; pdf2;
<a name="l00576"></a>00576   <span class="keywordflow">if</span> ( input.fail()  )
<a name="l00577"></a>00577     <span class="keywordflow">return</span> 0;
<a name="l00578"></a>00578   <span class="comment">/*</span>
<a name="l00579"></a>00579 <span class="comment">    cerr &lt;&lt; &quot;Reading pdf, but igoring data!&quot; &lt;&lt; endl;</span>
<a name="l00580"></a>00580 <span class="comment">    pdf-&gt;set_id1( id1 );</span>
<a name="l00581"></a>00581 <span class="comment">    pdf-&gt;set_id2( id2 );</span>
<a name="l00582"></a>00582 <span class="comment">    pdf-&gt;set_x1( x1 );</span>
<a name="l00583"></a>00583 <span class="comment">    pdf-&gt;set_x2( x2 );</span>
<a name="l00584"></a>00584 <span class="comment">    pdf-&gt;set_scalePDF( scale );</span>
<a name="l00585"></a>00585 <span class="comment">    pdf-&gt;set_pdf1( pdf1 );</span>
<a name="l00586"></a>00586 <span class="comment">    pdf-&gt;set_pdf2( pdf2 );</span>
<a name="l00587"></a>00587 <span class="comment">  */</span>
<a name="l00588"></a>00588   <span class="comment">// check to see if we are at the end of the line</span>
<a name="l00589"></a>00589   <span class="keywordflow">if</span>( !input.eof() )  {
<a name="l00590"></a>00590     <span class="keywordtype">int</span> pdf_id1=0, pdf_id2=0;
<a name="l00591"></a>00591     input &gt;&gt; pdf_id1 &gt;&gt; pdf_id2;
<a name="l00592"></a>00592     <span class="comment">/*</span>
<a name="l00593"></a>00593 <span class="comment">    pdf-&gt;set_pdf_id1( pdf_id1 );</span>
<a name="l00594"></a>00594 <span class="comment">    pdf-&gt;set_pdf_id2( pdf_id2 );</span>
<a name="l00595"></a>00595 <span class="comment">    */</span>
<a name="l00596"></a>00596   }
<a name="l00597"></a>00597   <span class="keywordflow">return</span> input.fail() ? 0 : 1;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00601"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a42014bf4f8f95b2c8b54ec5eede2be61">00601</a> <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a42014bf4f8f95b2c8b54ec5eede2be61" title="Check if data stream is in proper state and has data.">HepMC::EventStream::ok</a>()<span class="keyword">  const   </span>{
<a name="l00602"></a>00602   <span class="comment">// make sure the stream is good</span>
<a name="l00603"></a>00603   <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.eof() || <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.fail() )  {
<a name="l00604"></a>00604     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.clear(ios::badbit);
<a name="l00605"></a>00605     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00606"></a>00606   }
<a name="l00607"></a>00607   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a154b4f2355eac25743ec73982d588c39">00610</a> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a154b4f2355eac25743ec73982d588c39">HepMC::EventStream::clear</a>()   {
<a name="l00611"></a>00611   <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a714f7fea3a85b72aa7c925c580a2fe36">m_vertices</a>);
<a name="l00612"></a>00612   <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a40291edf72d71405515c98ea77e6670c">m_particles</a>);
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a0a565ef129dd64aae36e05efc29a4be4">00615</a> <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a0a565ef129dd64aae36e05efc29a4be4">HepMC::EventStream::read</a>()   {
<a name="l00616"></a>00616   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html">EventStream</a>&amp; info = *<span class="keyword">this</span>;
<a name="l00617"></a>00617   <span class="keywordtype">bool</span> event_read = <span class="keyword">false</span>;
<a name="l00618"></a>00618   <span class="keyword">static</span> <span class="keywordtype">int</span> num_evt = 0;
<a name="l00619"></a>00619   <span class="keywordtype">int</span> num_line = 0, num_line_accepted = 0;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>());
<a name="l00622"></a>00622   <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>());
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   ++num_evt;
<a name="l00625"></a>00625   <span class="keywordflow">if</span> ( num_evt == 998 )  {
<a name="l00626"></a>00626     cout &lt;&lt; <span class="stringliteral">&quot;Hallo&quot;</span>;
<a name="l00627"></a>00627   }
<a name="l00628"></a>00628   <span class="keywordflow">while</span>( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.good() ) {
<a name="l00629"></a>00629     <span class="keywordtype">char</span> value = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.peek();
<a name="l00630"></a>00630     istringstream input_line;
<a name="l00631"></a>00631     ++num_line;
<a name="l00632"></a>00632     <span class="keywordflow">if</span>      ( value == <span class="charliteral">&apos;E&apos;</span> &amp;&amp; event_read )
<a name="l00633"></a>00633       <span class="keywordflow">break</span>;
<a name="l00634"></a>00634     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.eof() &amp;&amp; event_read )
<a name="l00635"></a>00635       <span class="keywordflow">goto</span> Done;
<a name="l00636"></a>00636     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.eof() )
<a name="l00637"></a>00637       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00638"></a>00638     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value==<span class="charliteral">&apos;#&apos;</span> || ::isspace(value) )  {
<a name="l00639"></a>00639       <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">get_input</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>,input_line);
<a name="l00640"></a>00640       <span class="keywordflow">continue</span>;
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642     value = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#ae12e8ca37b7071f67c1810fa9420acad">get_input</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>,input_line);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">// On failure switch to end</span>
<a name="l00645"></a>00645     <span class="keywordflow">if</span>( !input_line || value &lt; 0 )
<a name="l00646"></a>00646       <span class="keywordflow">goto</span> Skip;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     ++num_line_accepted;
<a name="l00649"></a>00649     <span class="keywordflow">switch</span>( value )   {
<a name="l00650"></a>00650     <span class="keywordflow">case</span> <span class="charliteral">&apos;H&apos;</span>:  {
<a name="l00651"></a>00651       <span class="keywordtype">int</span> iotype = 0;
<a name="l00652"></a>00652       <span class="keywordtype">string</span> key_value;
<a name="l00653"></a>00653       input_line &gt;&gt; key_value;
<a name="l00654"></a>00654       <span class="comment">// search for event listing key before first event only.</span>
<a name="l00655"></a>00655       key_value = key_value.substr(0,key_value.find(<span class="charliteral">&apos;\r&apos;</span>));
<a name="l00656"></a>00656       <span class="keywordflow">if</span> ( key_value == <span class="stringliteral">&quot;H&quot;</span> &amp;&amp; (this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a> || this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> == <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a>) ) {
<a name="l00657"></a>00657         <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a973a0fe661658598d3982e072e11f77d">read_heavy_ion</a>(info, input_line);
<a name="l00658"></a>00658         <span class="keywordflow">break</span>;
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_GenEvent-START_EVENT_LISTING&quot;</span> )
<a name="l00661"></a>00661         this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">set_io</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a>,key_value);
<a name="l00662"></a>00662       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_Ascii-START_EVENT_LISTING&quot;</span> )
<a name="l00663"></a>00663         this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">set_io</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452caa170d10707fb62bbdffdc5e2a65834fd">ascii</a>,key_value);
<a name="l00664"></a>00664       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_ExtendedAscii-START_EVENT_LISTING&quot;</span> )
<a name="l00665"></a>00665         this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">set_io</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a>,key_value);
<a name="l00666"></a>00666       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_Ascii-START_PARTICLE_DATA&quot;</span> )
<a name="l00667"></a>00667         this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">set_io</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca17b19f25d74815dc415a5fde0f894f2d">ascii_pdt</a>,key_value);
<a name="l00668"></a>00668       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_ExtendedAscii-START_PARTICLE_DATA&quot;</span> )
<a name="l00669"></a>00669         this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a8c27011e1d7e6ae4b72e763d9253824d">set_io</a>(<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca951f0ef82695d1e0a1353c5237a3dbcc">extascii_pdt</a>,key_value);
<a name="l00670"></a>00670       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_GenEvent-END_EVENT_LISTING&quot;</span> )
<a name="l00671"></a>00671         iotype = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca1851fc44abe80e919efb31e16f25abae">gen</a>;
<a name="l00672"></a>00672       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_Ascii-END_EVENT_LISTING&quot;</span> )
<a name="l00673"></a>00673         iotype = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452caa170d10707fb62bbdffdc5e2a65834fd">ascii</a>;
<a name="l00674"></a>00674       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_ExtendedAscii-END_EVENT_LISTING&quot;</span> )
<a name="l00675"></a>00675         iotype = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca35d3a404a7b5dcdd485900294bbba4cc">extascii</a>;
<a name="l00676"></a>00676       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_Ascii-END_PARTICLE_DATA&quot;</span> )
<a name="l00677"></a>00677         iotype = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca17b19f25d74815dc415a5fde0f894f2d">ascii_pdt</a>;
<a name="l00678"></a>00678       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( key_value == <span class="stringliteral">&quot;HepMC::IO_ExtendedAscii-END_PARTICLE_DATA&quot;</span> )
<a name="l00679"></a>00679         iotype = <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#abd57f9534b4e3e74fa2e5f25525d452ca951f0ef82695d1e0a1353c5237a3dbcc">extascii_pdt</a>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="keywordflow">if</span>( iotype != 0 &amp;&amp; this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ab72b33619d738dd59539035f4e02792f">io_type</a> != iotype )  {
<a name="l00682"></a>00682         cerr &lt;&lt; <span class="stringliteral">&quot;GenEvent::find_end_key: iotype keys have changed. &quot;</span>
<a name="l00683"></a>00683              &lt;&lt; <span class="stringliteral">&quot;MALFORMED INPUT&quot;</span> &lt;&lt; endl;
<a name="l00684"></a>00684         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.clear(ios::badbit);
<a name="l00685"></a>00685         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00686"></a>00686       }
<a name="l00687"></a>00687       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( iotype != 0 )  {
<a name="l00688"></a>00688         <span class="keywordflow">break</span>;
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690       <span class="keywordflow">continue</span>;
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692     <span class="keywordflow">case</span> <span class="charliteral">&apos;E&apos;</span>:           <span class="comment">// deal with the event line</span>
<a name="l00693"></a>00693       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#aff50680cc4089a0f2c3b7a0218b3ed2e">read_event_header</a>(info, input_line, this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ac60c5b73780a0d523e2042a93610dfe3">header</a>) )
<a name="l00694"></a>00694         <span class="keywordflow">goto</span> Skip;
<a name="l00695"></a>00695       event_read = <span class="keyword">true</span>;
<a name="l00696"></a>00696       <span class="keywordflow">continue</span>;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <span class="keywordflow">case</span> <span class="charliteral">&apos;N&apos;</span>:           <span class="comment">// get weight names</span>
<a name="l00699"></a>00699       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a9a0a541fc8f48d5f9b80131b7f3b7e88">read_weight_names</a>(info, input_line) )
<a name="l00700"></a>00700         <span class="keywordflow">goto</span> Skip;
<a name="l00701"></a>00701       <span class="keywordflow">continue</span>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>:           <span class="comment">// get unit information if it exists</span>
<a name="l00704"></a>00704       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a35bd1c93d31d755bf0b911399c90c789">read_units</a>(info, input_line) )
<a name="l00705"></a>00705         <span class="keywordflow">goto</span> Skip;
<a name="l00706"></a>00706       <span class="keywordflow">continue</span>;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>:           <span class="comment">// we have a GenCrossSection line</span>
<a name="l00709"></a>00709       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a873025dee0b6f8a5ce8bd3485e518213">read_cross_section</a>(info, input_line) )
<a name="l00710"></a>00710         <span class="keywordflow">goto</span> Skip;
<a name="l00711"></a>00711       <span class="keywordflow">continue</span>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="keywordflow">case</span> <span class="charliteral">&apos;V&apos;</span>:           <span class="comment">// Read vertex with particles</span>
<a name="l00714"></a>00714       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a05115a3e0b60dbe2ee86c5094cdd16bc">read_vertex</a>(info, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>, input_line) )
<a name="l00715"></a>00715         <span class="keywordflow">goto</span> Skip;
<a name="l00716"></a>00716       <span class="keywordflow">continue</span>;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">case</span> <span class="charliteral">&apos;F&apos;</span>:           <span class="comment">// Read PDF</span>
<a name="l00719"></a>00719       <span class="keywordflow">if</span> ( !<a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a599dd238f1b1dc069a14f3bf57c09cfb">read_pdf</a>(info, input_line) )
<a name="l00720"></a>00720         <span class="keywordflow">goto</span> Skip;
<a name="l00721"></a>00721       <span class="keywordflow">continue</span>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="keywordflow">case</span> <span class="charliteral">&apos;P&apos;</span>:           <span class="comment">// we should not find this line</span>
<a name="l00724"></a>00724       cerr &lt;&lt; <span class="stringliteral">&quot;streaming input: found unexpected Particle line.&quot;</span> &lt;&lt; endl;
<a name="l00725"></a>00725       <span class="keywordflow">continue</span>;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727     <span class="keywordflow">default</span>:            <span class="comment">// ignore everything else</span>
<a name="l00728"></a>00728       <span class="keywordflow">continue</span>;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     <span class="keywordflow">continue</span>;
<a name="l00731"></a>00731   Skip:
<a name="l00732"></a>00732     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ac24ff9a0f663cd47b4e4e37a977dff02">WARNING</a>,<span class="stringliteral">&quot;HepMC::EventStream&quot;</span>,<span class="stringliteral">&quot;+++ Skip event with ID: %d&quot;</span>,this-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#ac60c5b73780a0d523e2042a93610dfe3">header</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_header.html#a221f01143ced151a262de45ca6749cc4">id</a>);
<a name="l00733"></a>00733     <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>());
<a name="l00734"></a>00734     <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a5a35867853fd21f0c0cf2754bd568671">particles</a>());
<a name="l00735"></a>00735     <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a433e938fb3dfef8ae2590fa16cdb2229">read_until_event_end</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>);
<a name="l00736"></a>00736     event_read = <span class="keyword">false</span>;
<a name="l00737"></a>00737     <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.eof() ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00738"></a>00738   }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740   <span class="keywordflow">if</span>( not <a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#a2702d64e41d9b280f84ebbae47521125">instream</a>.good() ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00741"></a>00741  Done:
<a name="l00742"></a>00742   <a class="code" href="namespace_d_d4hep_1_1_simulation_1_1_hep_m_c.html#a07b61ea67e59ff0e064a976336f7f3f3">fix_particles</a>(info);
<a name="l00743"></a>00743   <a class="code" href="namespace_d_d4hep.html#a069d5802981cb52e1e4981aabd8157e2">releaseObjects</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_hep_m_c_1_1_event_stream.html#acc8b24a014d6af70e07a6396375692e9">vertices</a>());
<a name="l00744"></a>00744   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00745"></a>00745 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
