<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Exec.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Exec.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/src/Geant4Exec.cpp</h1><a href="_geant4_exec_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: $</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_printout_8h.html">DD4hep/Printout.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_primitives_8h.html">DD4hep/Primitives.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_instance_count_8h.html">DD4hep/InstanceCount.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_handle_8h.html">DD4hep/Handle.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_run_action_8h.html">DDG4/Geant4RunAction.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_event_action_8h.html">DDG4/Geant4EventAction.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_stepping_action_8h.html">DDG4/Geant4SteppingAction.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_tracking_action_8h.html">DDG4/Geant4TrackingAction.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_stacking_action_8h.html">DDG4/Geant4StackingAction.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_generator_action_8h.html">DDG4/Geant4GeneratorAction.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_user_initialization_8h.html">DDG4/Geant4UserInitialization.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_detector_construction_8h.html">DDG4/Geant4DetectorConstruction.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_physics_list_8h.html">DDG4/Geant4PhysicsList.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_u_i_manager_8h.html">DDG4/Geant4UIManager.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_kernel_8h.html">DDG4/Geant4Kernel.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_random_8h.html">DDG4/Geant4Random.h</a>&quot;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">// Geant4 include files</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;G4Version.hh&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;G4UserRunAction.hh&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;G4UserEventAction.hh&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;G4UserTrackingAction.hh&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;G4UserStackingAction.hh&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;G4UserSteppingAction.hh&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;G4VUserPhysicsList.hh&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;G4VModularPhysicsList.hh&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;G4VUserPrimaryGeneratorAction.hh&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;G4VUserActionInitialization.hh&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;G4VUserDetectorConstruction.hh&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// C/C++ include files</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;memory&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">namespace </span>{
<a name="l00051"></a>00051   G4Mutex action_mutex=G4MUTEX_INITIALIZER;
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00055"></a>00055 <span class="keyword">namespace </span>DD4hep {
<a name="l00056"></a>00056 
<a name="l00058"></a>00058   <span class="keyword">namespace </span>Simulation {
<a name="l00059"></a>00059 
<a name="l00061"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">00061</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a> {
<a name="l00062"></a>00062     <span class="keyword">public</span>:
<a name="l00063"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a447b2bee9267559ffef742eef84fb1cc">00063</a>       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl&lt;T&gt;</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>;
<a name="l00064"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">00064</a>       <a class="code" href="class_t.html">T</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>;
<a name="l00065"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">00065</a>       <span class="keyword">mutable</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>;
<a name="l00067"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#aeb88368d61e8f34a82e6acc1c8794521">00067</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#aeb88368d61e8f34a82e6acc1c8794521" title="Default constructor.">SequenceHdl</a>()
<a name="l00068"></a>00068         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>(0), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>(0) {
<a name="l00069"></a>00069       }
<a name="l00070"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6a75a0ed136c559a8187ebcf6713a014">00070</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6a75a0ed136c559a8187ebcf6713a014">SequenceHdl</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_t.html">T</a>* seq) : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>(0), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>(ctxt)  {
<a name="l00071"></a>00071         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#afe240bb5982f0cdaedc001a3cc1a50da">_aquire</a>(seq);
<a name="l00072"></a>00072       }
<a name="l00073"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#af01dc42f94e773bcd01406fbcc178f4d">00073</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#af01dc42f94e773bcd01406fbcc178f4d">~SequenceHdl</a>() {
<a name="l00074"></a>00074         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ad76a439f79bc1844bbcb33e3395c8454">_release</a>();
<a name="l00075"></a>00075       }
<a name="l00076"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#afe240bb5982f0cdaedc001a3cc1a50da">00076</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#afe240bb5982f0cdaedc001a3cc1a50da">_aquire</a>(<a class="code" href="class_t.html">T</a>* <a class="code" href="_volumes_8cpp.html#a17ca6bfc8040d695d3cada22a4763d40">s</a>) {
<a name="l00077"></a>00077         <a class="code" href="struct_d_d4hep_1_1_instance_count.html#aff4313ae357c0c3bcf3ce210eee4c470" title="Increment count according to type information.">InstanceCount::increment</a>(<span class="keyword">this</span>);
<a name="l00078"></a>00078         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> = s;
<a name="l00079"></a>00079         <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> ) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;addRef();
<a name="l00080"></a>00080       }
<a name="l00081"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">00081</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt)   {
<a name="l00082"></a>00082         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a> = ctxt;
<a name="l00083"></a>00083         <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> )  {
<a name="l00084"></a>00084           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;updateContext(ctxt);
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086       }
<a name="l00087"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ad76a439f79bc1844bbcb33e3395c8454">00087</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ad76a439f79bc1844bbcb33e3395c8454">_release</a>() {
<a name="l00088"></a>00088         <a class="code" href="namespace_d_d4hep.html#a330e1e3e191c07da4ffcb6e698f28cda" title="Helper to delete objects from heap and reset the pointer. Saves many many lines of...">releasePtr</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>);
<a name="l00089"></a>00089         <a class="code" href="struct_d_d4hep_1_1_instance_count.html#a13975237d7100dab59a87dec2f67dc73" title="Decrement count according to type information.">InstanceCount::decrement</a>(<span class="keyword">this</span>);
<a name="l00090"></a>00090       }
<a name="l00091"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ada6e54e8d3522cb4d0a221f630990cf3">00091</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ada6e54e8d3522cb4d0a221f630990cf3">context</a>()<span class="keyword"> const  </span>{  
<a name="l00092"></a>00092         <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>;
<a name="l00093"></a>00093       }
<a name="l00094"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">00094</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>()<span class="keyword">  const  </span>{
<a name="l00095"></a>00095         <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ada6e54e8d3522cb4d0a221f630990cf3">context</a>()-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a68417b8caff336526775843e0b65cd90" title="Access to the kernel object.">kernel</a>();
<a name="l00096"></a>00096       }
<a name="l00097"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">00097</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt)   {
<a name="l00098"></a>00098         <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> )  {
<a name="l00099"></a>00099           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;configureFiber(ctxt);
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101       }
<a name="l00102"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f817d21c75a96ad450c35fd4748d762">00102</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f817d21c75a96ad450c35fd4748d762">createClientContext</a>(<span class="keyword">const</span> G4Run* run)   {
<a name="l00103"></a>00103         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run.html" title="User run context for DDG4.">Geant4Run</a>* r = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run.html" title="User run context for DDG4.">Geant4Run</a>(run);
<a name="l00104"></a>00104         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a31bdc70c285a758ad7563d5c54a5072a" title="Set the geant4 run reference.">setRun</a>(r);
<a name="l00105"></a>00105       }
<a name="l00106"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a0f4ca2107e2527947620c788fe60bc9a">00106</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a0f4ca2107e2527947620c788fe60bc9a">destroyClientContext</a>(<span class="keyword">const</span> G4Run*)   {
<a name="l00107"></a>00107         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run.html" title="User run context for DDG4.">Geant4Run</a>* r = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a05ad84f9bc8f1f3dc8ab22416b002529" title="Access the geant4 run by ptr. Must be checked by clients!">runPtr</a>();
<a name="l00108"></a>00108         <span class="keywordflow">if</span> ( r )  {
<a name="l00109"></a>00109           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a31bdc70c285a758ad7563d5c54a5072a" title="Set the geant4 run reference.">setRun</a>(0);
<a name="l00110"></a>00110           <a class="code" href="namespace_d_d4hep.html#a2f88a88693a607df41aec66ad3b4ddf5" title="Helper to delete objects from heap and reset the pointer. Saves many many lines of...">deletePtr</a>(r);
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112       }
<a name="l00113"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a45cfca253c17c4a89ef63d9367d4c9a4">00113</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a45cfca253c17c4a89ef63d9367d4c9a4">createClientContext</a>(<span class="keyword">const</span> G4Event* evt)   {
<a name="l00114"></a>00114         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event.html" title="User event context for DDG4.">Geant4Event</a>* e = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event.html" title="User event context for DDG4.">Geant4Event</a>(evt,<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html#a76e4bbadf0c58d9f6ee05decdd200fe6" title="Access the main Geant4 random generator instance. Must be created before used!">Geant4Random::instance</a>());
<a name="l00115"></a>00115         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#aa0bb03714fc9c82ed1d07ca804b73553" title="Set the geant4 event reference.">setEvent</a>(e);
<a name="l00116"></a>00116       }
<a name="l00117"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a8134448bdd2dd9d0e2f5d5834aa6a60f">00117</a>       <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a8134448bdd2dd9d0e2f5d5834aa6a60f">destroyClientContext</a>(<span class="keyword">const</span> G4Event*)   {
<a name="l00118"></a>00118         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event.html" title="User event context for DDG4.">Geant4Event</a>* e = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#ac87c91b95aa074da6cfcd34c237414d7" title="Access the geant4 event by ptr. Must be checked by clients!">eventPtr</a>();
<a name="l00119"></a>00119         <span class="keywordflow">if</span> ( e )  {
<a name="l00120"></a>00120           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#addf2b3ddaa1263ae4213a5189f7859b5">m_activeContext</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#aa0bb03714fc9c82ed1d07ca804b73553" title="Set the geant4 event reference.">setEvent</a>(0);
<a name="l00121"></a>00121           <a class="code" href="namespace_d_d4hep.html#a2f88a88693a607df41aec66ad3b4ddf5" title="Helper to delete objects from heap and reset the pointer. Saves many many lines of...">deletePtr</a>(e);
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124     };
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html" title="Concrete implementation of the Geant4 run action.">Geant4UserRunAction</a>;
<a name="l00127"></a>00127     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html" title="Concrete implementation of the Geant4 event action.">Geant4UserEventAction</a>;
<a name="l00128"></a>00128 
<a name="l00130"></a>00130 
<a name="l00135"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html">00135</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html" title="Concrete implementation of the Geant4 run action.">Geant4UserRunAction</a> :
<a name="l00136"></a>00136       <span class="keyword">public</span> <a class="code" href="class_g4_user_run_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4UserRunAction</a>,
<a name="l00137"></a>00137       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4RunActionSequence&gt;
<a name="l00138"></a>00138     {
<a name="l00139"></a>00139     <span class="keyword">public</span>:
<a name="l00140"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a6726ebc3d952df848fc4e8288d3bb6c0">00140</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html" title="Concrete implementation of the Geant4 event action.">Geant4UserEventAction</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a6726ebc3d952df848fc4e8288d3bb6c0">eventAction</a>;
<a name="l00142"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a4619583991588e3f0e3d51da6082bac3">00142</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a4619583991588e3f0e3d51da6082bac3" title="Standard constructor.">Geant4UserRunAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run_action_sequence.html" title="Concrete basic implementation of the Geant4 run action sequencer.">Geant4RunActionSequence</a>* seq)
<a name="l00143"></a>00143         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a6726ebc3d952df848fc4e8288d3bb6c0">eventAction</a>(0)  {
<a name="l00144"></a>00144         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00145"></a>00145         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00146"></a>00146       }
<a name="l00148"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a5b3bda44a46cc253d0c1d343d4f28738">00148</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a5b3bda44a46cc253d0c1d343d4f28738" title="Default destructor.">~Geant4UserRunAction</a>() {
<a name="l00149"></a>00149       }
<a name="l00151"></a>00151       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a42955d00dd5a101ec3e9594645eac6e5" title="Begin-of-run callback.">BeginOfRunAction</a>(<span class="keyword">const</span> G4Run* run);
<a name="l00153"></a>00153       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#acb9977f8d385a4f6523617dafea602bb" title="End-of-run callback.">EndOfRunAction</a>(<span class="keyword">const</span> G4Run* run);
<a name="l00154"></a>00154     };
<a name="l00155"></a>00155 
<a name="l00157"></a>00157 
<a name="l00162"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html">00162</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html" title="Concrete implementation of the Geant4 event action.">Geant4UserEventAction</a> :
<a name="l00163"></a>00163       <span class="keyword">public</span> <a class="code" href="class_g4_user_event_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4UserEventAction</a>, 
<a name="l00164"></a>00164       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4EventActionSequence&gt;
<a name="l00165"></a>00165     {
<a name="l00166"></a>00166     <span class="keyword">public</span>:
<a name="l00167"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac97fb9f30ba15e30d50897aabc0ad004">00167</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html" title="Concrete implementation of the Geant4 run action.">Geant4UserRunAction</a>* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac97fb9f30ba15e30d50897aabc0ad004">runAction</a>;
<a name="l00169"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#a5d519de614318d3277d06587b93bde92">00169</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#a5d519de614318d3277d06587b93bde92" title="Standard constructor.">Geant4UserEventAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_action_sequence.html" title="Concrete implementation of the Geant4 event action sequence.">Geant4EventActionSequence</a>* seq)
<a name="l00170"></a>00170         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac97fb9f30ba15e30d50897aabc0ad004">runAction</a>(0)  {
<a name="l00171"></a>00171         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00172"></a>00172         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00173"></a>00173       }
<a name="l00175"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac79b641d26fd4e4cbecc99460baf4d4f">00175</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac79b641d26fd4e4cbecc99460baf4d4f" title="Default destructor.">~Geant4UserEventAction</a>() {
<a name="l00176"></a>00176       }
<a name="l00178"></a>00178       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ab88c990f7010805421170eeb8f86ff86" title="Begin-of-event callback.">BeginOfEventAction</a>(<span class="keyword">const</span> G4Event* evt);
<a name="l00180"></a>00180       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#a5fe13da05fc37d5d69ed814b061cada0" title="End-of-event callback.">EndOfEventAction</a>(<span class="keyword">const</span> G4Event* evt);
<a name="l00181"></a>00181     };
<a name="l00182"></a>00182 
<a name="l00184"></a>00184 
<a name="l00189"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html">00189</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html" title="Concrete implementation of the Geant4 tracking action.">Geant4UserTrackingAction</a> :
<a name="l00190"></a>00190       <span class="keyword">public</span> <a class="code" href="class_g4_user_tracking_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4UserTrackingAction</a>,
<a name="l00191"></a>00191       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4TrackingActionSequence&gt;
<a name="l00192"></a>00192     {
<a name="l00193"></a>00193     <span class="keyword">public</span>:
<a name="l00195"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#acee865c27f15ffd9f2d4c386f9ab7e8e">00195</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#acee865c27f15ffd9f2d4c386f9ab7e8e" title="Standard constructor.">Geant4UserTrackingAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracking_action_sequence.html" title="Concrete implementation of the Geant4 tracking action sequence.">Geant4TrackingActionSequence</a>* seq)
<a name="l00196"></a>00196         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq) {
<a name="l00197"></a>00197         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00198"></a>00198         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00199"></a>00199       }
<a name="l00201"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#a2c2e499d1ac638f2519fa8f6f221bdc0">00201</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#a2c2e499d1ac638f2519fa8f6f221bdc0" title="Default destructor.">~Geant4UserTrackingAction</a>() {
<a name="l00202"></a>00202       }
<a name="l00204"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#a3c44bbbed885071eb14c08274e1b32a2">00204</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#a3c44bbbed885071eb14c08274e1b32a2" title="Pre-track action callback.">PreUserTrackingAction</a>(<span class="keyword">const</span> G4Track* trk) {
<a name="l00205"></a>00205         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#ae695d6fe735edceeea30e84afd329e38" title="Access the context.">context</a>()-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a68417b8caff336526775843e0b65cd90" title="Access to the kernel object.">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#aa5d1173163b58ade76d90a6a449b2357" title="Access the tracking manager.">setTrackMgr</a>(fpTrackingManager);
<a name="l00206"></a>00206         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracking_action_sequence.html#a21df8be5f0514bb4295fc2de9afe4eb2" title="Pre-tracking action callback.">begin</a>(trk);
<a name="l00207"></a>00207       }
<a name="l00209"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#ab5aeccf26ec4213e75bbdf6927bc7ee6">00209</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html#ab5aeccf26ec4213e75bbdf6927bc7ee6" title="Post-track action callback.">PostUserTrackingAction</a>(<span class="keyword">const</span> G4Track* trk) {
<a name="l00210"></a>00210         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracking_action_sequence.html#aeed70df4aa406595a03464436c52dce0" title="Post-tracking action callback.">end</a>(trk);
<a name="l00211"></a>00211         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#ae695d6fe735edceeea30e84afd329e38" title="Access the context.">context</a>()-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html#a68417b8caff336526775843e0b65cd90" title="Access to the kernel object.">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#aa5d1173163b58ade76d90a6a449b2357" title="Access the tracking manager.">setTrackMgr</a>(0);
<a name="l00212"></a>00212       }
<a name="l00213"></a>00213     };
<a name="l00214"></a>00214 
<a name="l00216"></a>00216 
<a name="l00221"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html">00221</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html" title="Concrete implementation of the Geant4 stacking action sequence.">Geant4UserStackingAction</a> :
<a name="l00222"></a>00222       <span class="keyword">public</span> <a class="code" href="class_g4_user_stacking_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4UserStackingAction</a>,
<a name="l00223"></a>00223       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4StackingActionSequence&gt;
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225     <span class="keyword">public</span>:
<a name="l00227"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a34c062c0fa5934878f532ef10f9c96d5">00227</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a34c062c0fa5934878f532ef10f9c96d5" title="Standard constructor.">Geant4UserStackingAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stacking_action_sequence.html" title="Concrete implementation of the Geant4 stacking action sequence.">Geant4StackingActionSequence</a>* seq)
<a name="l00228"></a>00228         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq) {
<a name="l00229"></a>00229         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00230"></a>00230         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00231"></a>00231       }
<a name="l00233"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a023f102d73420bfab08e6a866ea03dc7">00233</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a023f102d73420bfab08e6a866ea03dc7" title="Default destructor.">~Geant4UserStackingAction</a>() {
<a name="l00234"></a>00234       }
<a name="l00236"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#ae8abf4d3f1981b66637e9ceffbc9c604">00236</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#ae8abf4d3f1981b66637e9ceffbc9c604" title="New-stage callback.">NewStage</a>() {
<a name="l00237"></a>00237         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stacking_action_sequence.html#a8077fe558cebbeeef5af0114abab6a55" title="New-stage callback.">newStage</a>();
<a name="l00238"></a>00238       }
<a name="l00240"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a565c100df77dc0bdfe343a424285cdab">00240</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html#a565c100df77dc0bdfe343a424285cdab" title="Preparation callback.">PrepareNewEvent</a>() {
<a name="l00241"></a>00241         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stacking_action_sequence.html#a77ab67508d46a2af265090b04d5a41cb" title="Preparation callback.">prepare</a>();
<a name="l00242"></a>00242       }
<a name="l00243"></a>00243     };
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00247"></a>00247 
<a name="l00252"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html">00252</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html" title="Concrete implementation of the Geant4 generator action.">Geant4UserGeneratorAction</a> : 
<a name="l00253"></a>00253       <span class="keyword">public</span> <a class="code" href="class_g4_v_user_primary_generator_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VUserPrimaryGeneratorAction</a>,
<a name="l00254"></a>00254       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4GeneratorActionSequence&gt; 
<a name="l00255"></a>00255     {
<a name="l00256"></a>00256     <span class="keyword">public</span>:
<a name="l00258"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#afc51c8fd156ae7c8a344d1378c2b2026">00258</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#afc51c8fd156ae7c8a344d1378c2b2026" title="Standard constructor.">Geant4UserGeneratorAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_generator_action_sequence.html" title="Concrete implementation of the Geant4 generator action sequence.">Geant4GeneratorActionSequence</a>* seq)
<a name="l00259"></a>00259         : <a class="code" href="class_g4_v_user_primary_generator_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VUserPrimaryGeneratorAction</a>(), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq) {
<a name="l00260"></a>00260         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00261"></a>00261         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00262"></a>00262       }
<a name="l00264"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#a4fa904700f82d5bcce7a2c5d774d529f">00264</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#a4fa904700f82d5bcce7a2c5d774d529f" title="Default destructor.">~Geant4UserGeneratorAction</a>() {
<a name="l00265"></a>00265       }
<a name="l00267"></a>00267       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#a6e5a2cb71388c8358f6fa8679ca9cf69" title="Generate primary particles.">GeneratePrimaries</a>(G4Event* event);
<a name="l00268"></a>00268     };
<a name="l00269"></a>00269 
<a name="l00271"></a>00271 
<a name="l00276"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html">00276</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html" title="Concrete implementation of the Geant4 stepping action.">Geant4UserSteppingAction</a> :
<a name="l00277"></a>00277       <span class="keyword">public</span> <a class="code" href="class_g4_user_stepping_action.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4UserSteppingAction</a>,
<a name="l00278"></a>00278       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4SteppingActionSequence&gt;
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280     <span class="keyword">public</span>:
<a name="l00282"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a846e10589493c89d4ed2081312d17a1d">00282</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a846e10589493c89d4ed2081312d17a1d" title="Standard constructor.">Geant4UserSteppingAction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stepping_action_sequence.html" title="Concrete implementation of the Geant4 stepping action sequence.">Geant4SteppingActionSequence</a>* seq)
<a name="l00283"></a>00283         : <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq) {
<a name="l00284"></a>00284         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctxt);
<a name="l00285"></a>00285         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a4672c0e560cdc353b48c8025c9d3546f">configureFiber</a>(ctxt);
<a name="l00286"></a>00286       }
<a name="l00288"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a7c9e7f202db5ebf3300c1d2c6d9aa1d2">00288</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a7c9e7f202db5ebf3300c1d2c6d9aa1d2" title="Default destructor.">~Geant4UserSteppingAction</a>() {
<a name="l00289"></a>00289       }
<a name="l00291"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a459952dec8bab794c933b464471d7b60">00291</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html#a459952dec8bab794c933b464471d7b60" title="User stepping callback.">UserSteppingAction</a>(<span class="keyword">const</span> G4Step* <a class="code" href="_volumes_8cpp.html#a17ca6bfc8040d695d3cada22a4763d40">s</a>) {
<a name="l00292"></a>00292         (*m_sequence)(s, fpSteppingManager);
<a name="l00293"></a>00293       }
<a name="l00294"></a>00294     };
<a name="l00295"></a>00295 
<a name="l00297"></a>00297 
<a name="l00302"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html">00302</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html" title="Concrete implementation of the Geant4 user detector construction action sequence...">Geant4UserDetectorConstruction</a> : 
<a name="l00303"></a>00303       <span class="keyword">public</span> <a class="code" href="class_g4_v_user_detector_construction.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VUserDetectorConstruction</a>, 
<a name="l00304"></a>00304       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4DetectorConstructionSequence&gt;
<a name="l00305"></a>00305     {
<a name="l00306"></a>00306     <span class="keyword">protected</span>:
<a name="l00307"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">00307</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_context.html" title="Geant4 detector construction context definition.">Geant4DetectorConstructionContext</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>;
<a name="l00308"></a>00308     <span class="keyword">public</span>:
<a name="l00310"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#af1e3e857893be886738096501d5932f7">00310</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#af1e3e857893be886738096501d5932f7" title="Standard constructor.">Geant4UserDetectorConstruction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html" title="Concrete basic implementation of the Geant4 detector construction sequencer.">Geant4DetectorConstructionSequence</a>* seq)
<a name="l00311"></a>00311         : <a class="code" href="class_g4_v_user_detector_construction.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VUserDetectorConstruction</a>(), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq), 
<a name="l00312"></a>00312           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>(ctxt-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().lcdd(), this) 
<a name="l00313"></a>00313       {
<a name="l00314"></a>00314       }
<a name="l00316"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#a076334cddb22f1ca55027d6bc3a1aac9">00316</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#a076334cddb22f1ca55027d6bc3a1aac9" title="Default destructor.">~Geant4UserDetectorConstruction</a>() {
<a name="l00317"></a>00317       }
<a name="l00319"></a>00319       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab384a947bde0262d2c86f3f83099e4c4" title="Call the actions for the construction of the sensitive detectors and the field.">ConstructSDandField</a>();
<a name="l00321"></a>00321       <span class="keyword">virtual</span> G4VPhysicalVolume* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#a93280a762663896986d38ece7afd1abc" title="Call the actions to construct the detector geometry.">Construct</a>();
<a name="l00322"></a>00322     };
<a name="l00323"></a>00323 
<a name="l00325"></a>00325 
<a name="l00330"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html">00330</a>     <span class="keyword">class </span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html" title="Concrete implementation of the Geant4 user initialization action sequence.">Geant4UserActionInitialization</a> : 
<a name="l00331"></a>00331       <span class="keyword">public</span> <a class="code" href="class_g4_v_user_action_initialization.html">G4VUserActionInitialization</a>, 
<a name="l00332"></a>00332       <span class="keyword">public</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html" title="Sequence handler implementing common actions to all sequences.">SequenceHdl</a>&lt;Geant4UserInitializationSequence&gt;
<a name="l00333"></a>00333     {
<a name="l00334"></a>00334     <span class="keyword">public</span>:
<a name="l00336"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#ad5dad70e283015614959f397022c506a">00336</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#ad5dad70e283015614959f397022c506a" title="Standard constructor.">Geant4UserActionInitialization</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctxt, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html" title="Class to orchestrate a modular initializion of a multi- or single threaded Geant4...">Geant4UserInitializationSequence</a>* seq)
<a name="l00337"></a>00337         : <a class="code" href="class_g4_v_user_action_initialization.html">G4VUserActionInitialization</a>(), <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html">Base</a>(ctxt, seq) {
<a name="l00338"></a>00338       }
<a name="l00340"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#a576b51911e71f7979dd327d8a76b1738">00340</a>       <span class="keyword">virtual</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#a576b51911e71f7979dd327d8a76b1738" title="Default destructor.">~Geant4UserActionInitialization</a>() {
<a name="l00341"></a>00341       }
<a name="l00343"></a>00343       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#ab3d53de87035e93453c2eebaea1ec2a0" title="Build the actions for the worker thread.">Build</a>()  <span class="keyword">const</span>;
<a name="l00345"></a>00345       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#afebdf3b3108fb471defe56bd6d8faf03" title="Build the action sequences for the master thread.">BuildForMaster</a>()  <span class="keyword">const</span>;
<a name="l00346"></a>00346     };
<a name="l00347"></a>00347 
<a name="l00349"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a42955d00dd5a101ec3e9594645eac6e5">00349</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a42955d00dd5a101ec3e9594645eac6e5" title="Begin-of-run callback.">Geant4UserRunAction::BeginOfRunAction</a>(<span class="keyword">const</span> G4Run* run) {
<a name="l00350"></a>00350       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f817d21c75a96ad450c35fd4748d762">createClientContext</a>(run);
<a name="l00351"></a>00351       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;begin-run&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;run);
<a name="l00352"></a>00352       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> ) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run_action_sequence.html#a447a8f86614e2a958dcc0761ce89344b" title="Begin-of-run callback.">begin</a>(run); <span class="comment">// Action not mandatory</span>
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00356"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#acb9977f8d385a4f6523617dafea602bb">00356</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#acb9977f8d385a4f6523617dafea602bb" title="End-of-run callback.">Geant4UserRunAction::EndOfRunAction</a>(<span class="keyword">const</span> G4Run* run) {
<a name="l00357"></a>00357       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> ) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_run_action_sequence.html#a2a21cad772d05ac39502c35e334c6e5f" title="End-of-run callback.">end</a>(run); <span class="comment">// Action not mandatory</span>
<a name="l00358"></a>00358       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;end-run&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;run);
<a name="l00359"></a>00359       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a0f4ca2107e2527947620c788fe60bc9a">destroyClientContext</a>(run);
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00363"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ab88c990f7010805421170eeb8f86ff86">00363</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ab88c990f7010805421170eeb8f86ff86" title="Begin-of-event callback.">Geant4UserEventAction::BeginOfEventAction</a>(<span class="keyword">const</span> G4Event* evt) {
<a name="l00364"></a>00364       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;begin-event&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;evt);
<a name="l00365"></a>00365       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> ) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_action_sequence.html#a77375888d2519a2095ded294c540ebec" title="Begin-of-event callback.">begin</a>(evt); <span class="comment">// Action not mandatory</span>
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00369"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#a5fe13da05fc37d5d69ed814b061cada0">00369</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#a5fe13da05fc37d5d69ed814b061cada0" title="End-of-event callback.">Geant4UserEventAction::EndOfEventAction</a>(<span class="keyword">const</span> G4Event* evt) {
<a name="l00370"></a>00370       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> ) <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_action_sequence.html#a5815e04637704ceddb2abd2677e1522b" title="End-of-event callback.">end</a>(evt); <span class="comment">// Action not mandatory</span>
<a name="l00371"></a>00371       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;end-event&quot;</span>,(<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;evt);
<a name="l00372"></a>00372       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a0f4ca2107e2527947620c788fe60bc9a">destroyClientContext</a>(evt);
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00376"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#a6e5a2cb71388c8358f6fa8679ca9cf69">00376</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html#a6e5a2cb71388c8358f6fa8679ca9cf69" title="Generate primary particles.">Geant4UserGeneratorAction::GeneratePrimaries</a>(G4Event* event) {
<a name="l00377"></a>00377       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f817d21c75a96ad450c35fd4748d762">createClientContext</a>(event);
<a name="l00378"></a>00378       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> )  {
<a name="l00379"></a>00379         (*m_sequence)(event);
<a name="l00380"></a>00380         <span class="keywordflow">return</span>;
<a name="l00381"></a>00381       }
<a name="l00382"></a>00382       <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;GeneratePrimaries: Panic! No action sequencer defined. &quot;</span>
<a name="l00383"></a>00383                                <span class="stringliteral">&quot;No primary particles can be produced.&quot;</span>);
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385 
<a name="l00387"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab384a947bde0262d2c86f3f83099e4c4">00387</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab384a947bde0262d2c86f3f83099e4c4" title="Call the actions for the construction of the sensitive detectors and the field.">Geant4UserDetectorConstruction::ConstructSDandField</a>()  {
<a name="l00388"></a>00388       G4AutoLock protection_lock(&amp;action_mutex);
<a name="l00389"></a>00389       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctx = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#ae695d6fe735edceeea30e84afd329e38" title="Access the context.">context</a>();
<a name="l00390"></a>00390       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp;  krnl = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#ac503376a3f593e2c97dcf78fb289fe49" title="Access worker instance by it&amp;#39;s identifier.">worker</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a6f7fb6760f8432658a837a65bb557fe5" title="Access thread identifier.">Geant4Kernel::thread_self</a>(),<span class="keyword">true</span>);
<a name="l00391"></a>00391       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a6fe45521592147fe47d7cc545add8ca0" title="Thread&amp;#39;s Geant4 execution context.">workerContext</a>());
<a name="l00392"></a>00392       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html#a74d488648a50cae0230ca9dedf678160" title="Electromagnetic field construction callback. Called at &amp;quot;ConstructSDandField()&amp;quot;...">constructField</a>(&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>);
<a name="l00393"></a>00393       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html#ab242c91f95283ed32133f48f2bc573fa" title="Sensitive detector construction callback. Called at &amp;quot;ConstructSDandField()&amp;quot;...">constructSensitives</a>(&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>);
<a name="l00394"></a>00394       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(ctx);
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00398"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#a93280a762663896986d38ece7afd1abc">00398</a>     G4VPhysicalVolume* <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#a93280a762663896986d38ece7afd1abc" title="Call the actions to construct the detector geometry.">Geant4UserDetectorConstruction::Construct</a>()    {
<a name="l00399"></a>00399       <span class="comment">// The G4TransportationManager is thread-local. </span>
<a name="l00400"></a>00400       <span class="comment">// Thus, regardless of whether the field class object is global or local </span>
<a name="l00401"></a>00401       <span class="comment">// to a certain volume, a field object must be assigned to G4FieldManager.</span>
<a name="l00402"></a>00402       G4AutoLock protection_lock(&amp;action_mutex);
<a name="l00403"></a>00403       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a6f0b9120d430d93caafb6d3d9f360ecf">updateContext</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#ae695d6fe735edceeea30e84afd329e38" title="Access the context.">context</a>());
<a name="l00404"></a>00404       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html#a7c2512ab15fa66370409585d60becc99" title="Geometry construction callback. Called at &amp;quot;Construct()&amp;quot;.">constructGeo</a>(&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>);
<a name="l00405"></a>00405       <span class="keywordflow">if</span> ( 0 == <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_context.html#a532857c4548770776adf8f94db5e5e56" title="Reference to the world after construction.">world</a> )    {
<a name="l00406"></a>00406         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Executing G4 detector construction did not result in a valid world volume!&quot;</span>);
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html#ab099fe83f02b9f8ffdda9f0f21a01202">m_ctxt</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_context.html#a532857c4548770776adf8f94db5e5e56" title="Reference to the world after construction.">world</a>;
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00412"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#ab3d53de87035e93453c2eebaea1ec2a0">00412</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#ab3d53de87035e93453c2eebaea1ec2a0" title="Build the actions for the worker thread.">Geant4UserActionInitialization::Build</a>()<span class="keyword">  const   </span>{
<a name="l00413"></a>00413       G4AutoLock protection_lock(&amp;action_mutex);
<a name="l00414"></a>00414       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp;  krnl = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#a642b7c9a8d35ba43e92bb33b7198bcc5">kernel</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#ac503376a3f593e2c97dcf78fb289fe49" title="Access worker instance by it&amp;#39;s identifier.">worker</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a6f7fb6760f8432658a837a65bb557fe5" title="Access thread identifier.">Geant4Kernel::thread_self</a>(),<span class="keyword">true</span>);
<a name="l00415"></a>00415       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctx  = krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a6fe45521592147fe47d7cc545add8ca0" title="Thread&amp;#39;s Geant4 execution context.">workerContext</a>();
<a name="l00416"></a>00416 
<a name="l00417"></a>00417       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> )  {
<a name="l00418"></a>00418         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* old = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#ae695d6fe735edceeea30e84afd329e38" title="Access the context.">context</a>();
<a name="l00419"></a>00419         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a30bb1539e63536cfeaddb0b5b4032214" title="Support of info messages.">info</a>(<span class="stringliteral">&quot;+++ Executing Geant4UserActionInitialization::Build. &quot;</span>
<a name="l00420"></a>00420                          <span class="stringliteral">&quot;Context:%p Kernel:%p [%ld]&quot;</span>, (<span class="keywordtype">void</span>*)ctx, (<span class="keywordtype">void</span>*)&amp;krnl, krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#ac15d27b4d51308d7eeab4c18702513d1" title="Access worker identifier.">id</a>());
<a name="l00421"></a>00421       
<a name="l00422"></a>00422         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html#ae73630ce8b3759e3793dc58f585a291b" title="Set client context.">updateContext</a>(ctx);
<a name="l00423"></a>00423         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html#aa65113bb4e4f4b3d775dcdc9cc30b4b8" title="Register callback to setup worker. Types Q and T must be polymorph!">build</a>();
<a name="l00424"></a>00424         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html#ae73630ce8b3759e3793dc58f585a291b" title="Set client context.">updateContext</a>(old);
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426       <span class="comment">// Set user generator action sequence. Not optional, since event context is defined inside</span>
<a name="l00427"></a>00427       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html" title="Concrete implementation of the Geant4 generator action.">Geant4UserGeneratorAction</a>* gen_action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_generator_action.html" title="Concrete implementation of the Geant4 generator action.">Geant4UserGeneratorAction</a>(ctx,krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#aac0430d56fb1bc7db0b71720c49033a4" title="Access generator action sequence.">generatorAction</a>(<span class="keyword">false</span>));
<a name="l00428"></a>00428       SetUserAction(gen_action);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430       <span class="comment">// Set the run action sequence. Not optional, since run context is defined/destroyed inside</span>
<a name="l00431"></a>00431       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html" title="Concrete implementation of the Geant4 run action.">Geant4UserRunAction</a>* run_action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html" title="Concrete implementation of the Geant4 run action.">Geant4UserRunAction</a>(ctx,krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a5ce39c42386a93c9e446d8651495c11e" title="Access run action sequence.">runAction</a>(<span class="keyword">false</span>));
<a name="l00432"></a>00432       SetUserAction(run_action);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <span class="comment">// Set the event action sequence. Not optional, since event context is destroyed inside</span>
<a name="l00435"></a>00435       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html" title="Concrete implementation of the Geant4 event action.">Geant4UserEventAction</a>* evt_action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html" title="Concrete implementation of the Geant4 event action.">Geant4UserEventAction</a>(ctx,krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#ab195f38387e12afbfcaccee77ec67845" title="Access run action sequence.">eventAction</a>(<span class="keyword">false</span>));
<a name="l00436"></a>00436       run_action-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_run_action.html#a6726ebc3d952df848fc4e8288d3bb6c0">eventAction</a> = evt_action;
<a name="l00437"></a>00437       evt_action-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_event_action.html#ac97fb9f30ba15e30d50897aabc0ad004">runAction</a> = run_action;
<a name="l00438"></a>00438       SetUserAction(evt_action);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440       <span class="comment">// Set the tracking action sequence</span>
<a name="l00441"></a>00441       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracking_action_sequence.html" title="Concrete implementation of the Geant4 tracking action sequence.">Geant4TrackingActionSequence</a>* trk_action = krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a4ff088a46753f37dadc07e22a0436382" title="Access tracking action sequence.">trackingAction</a>(<span class="keyword">false</span>);
<a name="l00442"></a>00442       <span class="keywordflow">if</span> ( trk_action ) {
<a name="l00443"></a>00443         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html" title="Concrete implementation of the Geant4 tracking action.">Geant4UserTrackingAction</a>* action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_tracking_action.html" title="Concrete implementation of the Geant4 tracking action.">Geant4UserTrackingAction</a>(ctx, trk_action);
<a name="l00444"></a>00444         SetUserAction(action);
<a name="l00445"></a>00445       }
<a name="l00446"></a>00446       <span class="comment">// Set the stepping action sequence</span>
<a name="l00447"></a>00447       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stepping_action_sequence.html" title="Concrete implementation of the Geant4 stepping action sequence.">Geant4SteppingActionSequence</a>* stp_action = krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a75a0fa686f783e175eedbd57ed3abbdc" title="Access stepping action sequence.">steppingAction</a>(<span class="keyword">false</span>);
<a name="l00448"></a>00448       <span class="keywordflow">if</span> ( stp_action ) {
<a name="l00449"></a>00449         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html" title="Concrete implementation of the Geant4 stepping action.">Geant4UserSteppingAction</a>* action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stepping_action.html" title="Concrete implementation of the Geant4 stepping action.">Geant4UserSteppingAction</a>(ctx, stp_action);
<a name="l00450"></a>00450         SetUserAction(action);
<a name="l00451"></a>00451       }
<a name="l00452"></a>00452       <span class="comment">// Set the stacking action sequence</span>
<a name="l00453"></a>00453       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_stacking_action_sequence.html" title="Concrete implementation of the Geant4 stacking action sequence.">Geant4StackingActionSequence</a>* stk_action = krnl.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#ad9a53bd3401686eeeb711ef467b2a800" title="Access stacking action sequence.">stackingAction</a>(<span class="keyword">false</span>);
<a name="l00454"></a>00454       <span class="keywordflow">if</span> ( stk_action ) {
<a name="l00455"></a>00455         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html" title="Concrete implementation of the Geant4 stacking action sequence.">Geant4UserStackingAction</a>* action = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_stacking_action.html" title="Concrete implementation of the Geant4 stacking action sequence.">Geant4UserStackingAction</a>(ctx, stk_action);
<a name="l00456"></a>00456         SetUserAction(action);
<a name="l00457"></a>00457       }
<a name="l00458"></a>00458       
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00462"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#afebdf3b3108fb471defe56bd6d8faf03">00462</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html#afebdf3b3108fb471defe56bd6d8faf03" title="Build the action sequences for the master thread.">Geant4UserActionInitialization::BuildForMaster</a>()<span class="keyword">  const  </span>{
<a name="l00463"></a>00463       <span class="keywordflow">if</span> ( <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a> )   {
<a name="l00464"></a>00464         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a30bb1539e63536cfeaddb0b5b4032214" title="Support of info messages.">info</a>(<span class="stringliteral">&quot;+++ Executing Geant4UserActionInitialization::BuildForMaster....&quot;</span>);
<a name="l00465"></a>00465         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_sequence_hdl.html#ae825c3a994baf6bb24fd37e547a67dff">m_sequence</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html#a7dfd58583e86652aaf675c6db82ff39c" title="Register callback to setup master. Types Q and T must be polymorph!">buildMaster</a>();
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468   }
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="preprocessor">#include &quot;<a class="code" href="_l_c_d_d_8h.html">DD4hep/LCDD.h</a>&quot;</span>
<a name="l00472"></a>00472 <span class="preprocessor">#include &quot;<a class="code" href="_plugins_8h.html">DD4hep/Plugins.h</a>&quot;</span>
<a name="l00473"></a>00473 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_detector_construction_8h.html">DDG4/Geant4DetectorConstruction.h</a>&quot;</span>
<a name="l00474"></a>00474 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_kernel_8h.html">DDG4/Geant4Kernel.h</a>&quot;</span>
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="keyword">using namespace </span>std;
<a name="l00477"></a>00477 <span class="keyword">using namespace </span>DD4hep;
<a name="l00478"></a>00478 <span class="keyword">using namespace </span>DD4hep::Simulation;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="comment">// Geant4 include files</span>
<a name="l00481"></a>00481 <span class="preprocessor">#include &quot;G4RunManager.hh&quot;</span>
<a name="l00482"></a>00482 <span class="preprocessor">#include &quot;G4PhysListFactory.hh&quot;</span>
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="class_geant4_compatibility.html">00484</a> <span class="keyword">class </span><a class="code" href="class_geant4_compatibility.html">Geant4Compatibility</a> {
<a name="l00485"></a>00485 <span class="keyword">public</span>:
<a name="l00486"></a><a class="code" href="class_geant4_compatibility.html#a8dc4d9bd93a45cb3524b317ba8cdbc8e">00486</a>   <a class="code" href="class_geant4_compatibility.html#a8dc4d9bd93a45cb3524b317ba8cdbc8e">Geant4Compatibility</a>() {}
<a name="l00487"></a>00487   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html" title="Concrete basic implementation of the Geant4 detector construction sequencer.">Geant4DetectorConstructionSequence</a>* <a class="code" href="class_geant4_compatibility.html#abe1c52fe3962756ab59bc3cdde7edca2">buildDefaultDetectorConstruction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel);
<a name="l00488"></a>00488 };
<a name="l00489"></a><a class="code" href="class_geant4_compatibility.html#abe1c52fe3962756ab59bc3cdde7edca2">00489</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html" title="Concrete basic implementation of the Geant4 detector construction sequencer.">Geant4DetectorConstructionSequence</a>* <a class="code" href="class_geant4_compatibility.html#abe1c52fe3962756ab59bc3cdde7edca2">Geant4Compatibility::buildDefaultDetectorConstruction</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel)  {
<a name="l00490"></a>00490   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html" title="Default base class for all Geant 4 actions and derivates thereof.">Geant4Action</a>* cr;
<a name="l00491"></a>00491   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction.html" title="Basic implementation of the Geant4 detector construction action.">Geant4DetectorConstruction</a>* det_cr;
<a name="l00492"></a>00492   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctx = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a6fe45521592147fe47d7cc545add8ca0" title="Thread&amp;#39;s Geant4 execution context.">workerContext</a>();
<a name="l00493"></a>00493   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html" title="Concrete basic implementation of the Geant4 detector construction sequencer.">Geant4DetectorConstructionSequence</a>* seq = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a4dba304abe94e83eaef9c22aa196454b" title="Access detector construcion action sequence (geometry+sensitives+field).">detectorConstruction</a>(<span class="keyword">true</span>);
<a name="l00494"></a>00494   <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ac24ff9a0f663cd47b4e4e37a977dff02">WARNING</a>, <span class="stringliteral">&quot;Geant4Exec&quot;</span>, <span class="stringliteral">&quot;+++ Building default Geant4DetectorConstruction for single threaded compatibility.&quot;</span>);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="comment">// Attach first the geometry converter from DD4hep to Geant4</span>
<a name="l00497"></a>00497   cr = PluginService::Create&lt;Geant4Action*&gt;(<span class="stringliteral">&quot;Geant4DetectorGeometryConstruction&quot;</span>,ctx,<a class="code" href="classstd_1_1string.html">string</a>(<span class="stringliteral">&quot;ConstructGeometry&quot;</span>));
<a name="l00498"></a>00498   det_cr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction.html" title="Basic implementation of the Geant4 detector construction action.">Geant4DetectorConstruction</a>*<span class="keyword">&gt;</span>(cr);
<a name="l00499"></a>00499   <span class="keywordflow">if</span> ( det_cr ) 
<a name="l00500"></a>00500     seq-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html#a883d0336b5983474af9479c03e90a35b" title="Add an actor responding to all callbacks. Sequence takes ownership.">adopt</a>(det_cr);
<a name="l00501"></a>00501   <span class="keywordflow">else</span>
<a name="l00502"></a>00502     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Panic! Failed to build Geant4DetectorGeometryConstruction.&quot;</span>);
<a name="l00503"></a>00503   <span class="comment">// Attach the sensitive detector manipulator:</span>
<a name="l00504"></a>00504   cr = PluginService::Create&lt;Geant4Action*&gt;(<span class="stringliteral">&quot;Geant4DetectorSensitivesConstruction&quot;</span>,ctx,<a class="code" href="classstd_1_1string.html">string</a>(<span class="stringliteral">&quot;ConstructSensitives&quot;</span>));
<a name="l00505"></a>00505   det_cr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction.html" title="Basic implementation of the Geant4 detector construction action.">Geant4DetectorConstruction</a>*<span class="keyword">&gt;</span>(cr);
<a name="l00506"></a>00506   <span class="keywordflow">if</span> ( det_cr )
<a name="l00507"></a>00507     seq-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html#a883d0336b5983474af9479c03e90a35b" title="Add an actor responding to all callbacks. Sequence takes ownership.">adopt</a>(det_cr);
<a name="l00508"></a>00508   <span class="keywordflow">else</span>
<a name="l00509"></a>00509     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Panic! Failed to build Geant4DetectorSensitivesConstruction.&quot;</span>);
<a name="l00510"></a>00510   <span class="keywordflow">return</span> seq;
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00514"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#a68d70832e5acb1c074ce12cae898af09">00514</a> <span class="keywordtype">int</span> Geant4Exec::configure(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel) {
<a name="l00515"></a>00515   <a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html" title="The main interface to the DD4hep detector description package.">Geometry::LCDD</a>&amp; lcdd = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a172f416447f9f1aa4a1a166b0df902a3" title="Access to detector description.">lcdd</a>();
<a name="l00516"></a>00516   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_context.html" title="Generic context to extend user, run and event information.">Geant4Context</a>* ctx = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a6fe45521592147fe47d7cc545add8ca0" title="Thread&amp;#39;s Geant4 execution context.">workerContext</a>();
<a name="l00517"></a>00517   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html" title="Mini interface to THE random generator of the application.">Geant4Random</a>* rndm = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html#a76e4bbadf0c58d9f6ee05decdd200fe6" title="Access the main Geant4 random generator instance. Must be created before used!">Geant4Random::instance</a>(<span class="keyword">false</span>);
<a name="l00518"></a>00518   
<a name="l00519"></a>00519   <span class="keywordflow">if</span> ( !rndm )  {
<a name="l00520"></a>00520     rndm = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html" title="Mini interface to THE random generator of the application.">Geant4Random</a>(ctx, <span class="stringliteral">&quot;Geant4Random&quot;</span>);
<a name="l00522"></a>00522     rndm-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html#a31f43f8b61c1eacccac4d89945e97f6b" title="Initialize the instance.">initialize</a>();
<a name="l00523"></a>00523   }
<a name="l00524"></a>00524   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_random.html#a544fa42f6ae0d64697e366da5e1297b2" title="Make this random generator instance the one used by Geant4.">Geant4Random::setMainInstance</a>(rndm);
<a name="l00525"></a>00525   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;configure&quot;</span>,0);
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <span class="comment">// Construct the default run manager</span>
<a name="l00528"></a>00528   G4RunManager&amp; runManager = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#aa01093467efb9b3a4f9179ba22ac7899" title="Access to the Geant4 run manager.">runManager</a>();
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="comment">// Check if the geometry was loaded</span>
<a name="l00531"></a>00531   <span class="keywordflow">if</span> (lcdd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a576c24cc18698eb14658466999fca65d" title="Accessor to the map of sub-detectors.">sensitiveDetectors</a>().size() &lt;= 1) {
<a name="l00532"></a>00532     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ac24ff9a0f663cd47b4e4e37a977dff02">WARNING</a>, <span class="stringliteral">&quot;Geant4Exec&quot;</span>, <span class="stringliteral">&quot;+++ Only %d subdetectors present. &quot;</span>
<a name="l00533"></a>00533              <span class="stringliteral">&quot;You sure you loaded the geometry properly?&quot;</span>,
<a name="l00534"></a>00534              <span class="keywordtype">int</span>(lcdd.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_l_c_d_d.html#a576c24cc18698eb14658466999fca65d" title="Accessor to the map of sub-detectors.">sensitiveDetectors</a>().size()));
<a name="l00535"></a>00535   }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537   <span class="comment">// Get the detector constructed</span>
<a name="l00538"></a>00538   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_detector_construction_sequence.html" title="Concrete basic implementation of the Geant4 detector construction sequencer.">Geant4DetectorConstructionSequence</a>* user_det = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a4dba304abe94e83eaef9c22aa196454b" title="Access detector construcion action sequence (geometry+sensitives+field).">detectorConstruction</a>(<span class="keyword">false</span>);
<a name="l00539"></a>00539   <span class="keywordflow">if</span> ( 0 == user_det &amp;&amp; kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a053a94be9966b7851bf25fdafb9a9d01">isMultiThreaded</a>() )   {
<a name="l00540"></a>00540     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Panic! No valid detector construction sequencer present. [Mandatory MT]&quot;</span>);
<a name="l00541"></a>00541   }
<a name="l00542"></a>00542   <span class="keywordflow">if</span> ( 0 == user_det &amp;&amp; !kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a053a94be9966b7851bf25fdafb9a9d01">isMultiThreaded</a>() )   {
<a name="l00543"></a>00543     user_det = <a class="code" href="class_geant4_compatibility.html">Geant4Compatibility</a>().buildDefaultDetectorConstruction(kernel);
<a name="l00544"></a>00544   }
<a name="l00545"></a>00545   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html" title="Concrete implementation of the Geant4 user detector construction action sequence...">Geant4UserDetectorConstruction</a>* det_seq = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_detector_construction.html" title="Concrete implementation of the Geant4 user detector construction action sequence...">Geant4UserDetectorConstruction</a>(ctx,user_det);
<a name="l00546"></a>00546   runManager.SetUserInitialization(det_seq);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="comment">// Get the physics list constructed</span>
<a name="l00549"></a>00549   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_physics_list_action_sequence.html" title="The implementation of the single Geant4 physics list action sequence.">Geant4PhysicsListActionSequence</a>* phys_seq = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a78cbddc837b75f151cf76b483b588fb1" title="Access to the physics list.">physicsList</a>(<span class="keyword">false</span>);
<a name="l00550"></a>00550   <span class="keywordflow">if</span> ( 0 == phys_seq )   {
<a name="l00551"></a>00551     <span class="keywordtype">string</span> phys_model = <span class="stringliteral">&quot;QGSP_BERT&quot;</span>;
<a name="l00552"></a>00552     phys_seq = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a78cbddc837b75f151cf76b483b588fb1" title="Access to the physics list.">physicsList</a>(<span class="keyword">true</span>);
<a name="l00553"></a>00553     phys_seq-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#aa9797c4749e92c0611ca7ce6f8b7bc78" title="Access single property.">property</a>(<span class="stringliteral">&quot;extends&quot;</span>).<a class="code" href="class_d_d4hep_1_1_property.html#a3f4ec149415ffae17a248fb03afd230f" title="Set value of this property.">set</a>(phys_model);
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555   G4VUserPhysicsList* physics = phys_seq-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_physics_list_action_sequence.html#a51078548bbd59fa3cb1447d2b2c6e2fb" title="Extend physics list from factory:.">extensionList</a>();
<a name="l00556"></a>00556   <span class="keywordflow">if</span> (0 == physics) {
<a name="l00557"></a>00557     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Panic! No valid user physics list present!&quot;</span>);
<a name="l00558"></a>00558   }
<a name="l00559"></a>00559 <span class="preprocessor">#if 0</span>
<a name="l00561"></a>00561 <span class="preprocessor">  printout(INFO, &quot;Geant4Exec&quot;, &quot;+++ PhysicsList RangeCut: %f&quot;, phys_seq-&gt;m_rangecut );</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span>  physics-&gt;SetDefaultCutValue(phys_seq-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_physics_list_action_sequence.html#a125a5acaa8915ef45d5832351ce3a9df" title="global range cut for secondary productions">m_rangecut</a>);
<a name="l00563"></a>00563   physics-&gt;SetCuts();
<a name="l00564"></a>00564   <span class="keywordflow">if</span>( <a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42ad22cda76fc1b3a55bc359945db9c811c">DEBUG</a> == <a class="code" href="namespace_d_d4hep.html#abdbd705fe59353c8596e4ad5b7355814" title="Access the current printer level.">printLevel</a>() ) physics-&gt;DumpCutValuesTable();
<a name="l00565"></a>00565 <span class="preprocessor">#endif</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span>  runManager.SetUserInitialization(physics);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   <span class="comment">// Construct the remaining user initialization in multi-threaded mode</span>
<a name="l00569"></a>00569   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_initialization_sequence.html" title="Class to orchestrate a modular initializion of a multi- or single threaded Geant4...">Geant4UserInitializationSequence</a>* user_init = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a04ba4fd85ae343b856d73dcb3cc0e9b3" title="Access to the user initialization object.">userInitialization</a>(<span class="keyword">false</span>);
<a name="l00570"></a>00570   <span class="keywordflow">if</span> ( 0 == user_init &amp;&amp; kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a053a94be9966b7851bf25fdafb9a9d01">isMultiThreaded</a>() )   {
<a name="l00571"></a>00571     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<span class="stringliteral">&quot;Panic! No valid user initialization sequencer present. [Mandatory MT]&quot;</span>);
<a name="l00572"></a>00572   }
<a name="l00573"></a>00573   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 0 == user_init &amp;&amp; !kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a053a94be9966b7851bf25fdafb9a9d01">isMultiThreaded</a>() )  {
<a name="l00574"></a>00574     <span class="comment">// Use default actions registered to the default kernel. Will do the right thing...</span>
<a name="l00575"></a>00575     user_init = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action_container.html#a04ba4fd85ae343b856d73dcb3cc0e9b3" title="Access to the user initialization object.">userInitialization</a>(<span class="keyword">true</span>);
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577   <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html" title="Concrete implementation of the Geant4 user initialization action sequence.">Geant4UserActionInitialization</a>* init = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_user_action_initialization.html" title="Concrete implementation of the Geant4 user initialization action sequence.">Geant4UserActionInitialization</a>(ctx,user_init);
<a name="l00578"></a>00578   runManager.SetUserInitialization(init);
<a name="l00579"></a>00579   <span class="keywordflow">return</span> 1;
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00583"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#ae5486a8c520af49cbcc5d5ba4323e773">00583</a> <span class="keywordtype">int</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#ae5486a8c520af49cbcc5d5ba4323e773" title="Initialize the application.">Geant4Exec::initialize</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel) {
<a name="l00584"></a>00584   <span class="comment">// Construct the default run manager</span>
<a name="l00585"></a>00585   G4RunManager&amp; runManager = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#aa01093467efb9b3a4f9179ba22ac7899" title="Access to the Geant4 run manager.">runManager</a>();
<a name="l00586"></a>00586   <span class="comment">//</span>
<a name="l00587"></a>00587   <span class="comment">// Initialize G4 engine</span>
<a name="l00588"></a>00588   <span class="comment">//</span>
<a name="l00589"></a>00589   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;initialize&quot;</span>,0);
<a name="l00590"></a>00590   runManager.Initialize();
<a name="l00591"></a>00591   <span class="keywordflow">return</span> 1;
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00595"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#a006a064ae70aa7839d656ae7cdd8fc59">00595</a> <span class="keywordtype">int</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#a006a064ae70aa7839d656ae7cdd8fc59" title="Run the application and simulate events.">Geant4Exec::run</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel) {
<a name="l00596"></a>00596   <a class="code" href="class_d_d4hep_1_1_property.html" title="The property class to assign options to actions.">Property</a>&amp; p = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a51c2d757b81b0c8ee31be77515d4d622" title="Access single property.">property</a>(<span class="stringliteral">&quot;UI&quot;</span>);
<a name="l00597"></a>00597   <span class="keywordtype">string</span> value = p.<a class="code" href="class_d_d4hep_1_1_property.html#a8aa2bfdecfc6cdb06c4f8c1cf7a01600" title="Retrieve value.">value</a>&lt;<span class="keywordtype">string</span>&gt;();
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;start&quot;</span>,0);
<a name="l00600"></a>00600   <span class="keywordflow">if</span> ( !value.empty() )  {
<a name="l00601"></a>00601     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html" title="Default base class for all Geant 4 actions and derivates thereof.">Geant4Action</a>* ui = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9142233acf94a391ef926eee86b04c26" title="Retrieve action from repository.">globalAction</a>(value);
<a name="l00602"></a>00602     <span class="keywordflow">if</span> ( ui )  {
<a name="l00603"></a>00603       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_call.html" title="Callback interface class with argument.">Geant4Call</a>* c = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_call.html" title="Callback interface class with argument.">Geant4Call</a>*<span class="keyword">&gt;</span>(ui);
<a name="l00604"></a>00604       <span class="keywordflow">if</span> ( c )  {
<a name="l00605"></a>00605         (*c)(0);
<a name="l00606"></a>00606         kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;stop&quot;</span>,0);
<a name="l00607"></a>00607         <span class="keywordflow">return</span> 1;
<a name="l00608"></a>00608       }
<a name="l00609"></a>00609       ui-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;++ Geant4Exec: Failed to start UI interface.&quot;</span>);
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611     <span class="keywordflow">throw</span> <a class="code" href="classstd_1_1runtime__error.html">runtime_error</a>(<a class="code" href="namespace_d_d4hep.html#a9a97cc57d7225177b869138f63751ffc">format</a>(<span class="stringliteral">&quot;Geant4Exec&quot;</span>,<span class="stringliteral">&quot;++ Failed to locate UI interface %s.&quot;</span>,value.c_str()));
<a name="l00612"></a>00612   }
<a name="l00613"></a>00613   <span class="keywordtype">long</span> nevt = kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a51c2d757b81b0c8ee31be77515d4d622" title="Access single property.">property</a>(<span class="stringliteral">&quot;NumEvents&quot;</span>).<a class="code" href="class_d_d4hep_1_1_property.html#a8aa2bfdecfc6cdb06c4f8c1cf7a01600" title="Retrieve value.">value</a>&lt;<span class="keywordtype">long</span>&gt;();
<a name="l00614"></a>00614   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#aa01093467efb9b3a4f9179ba22ac7899" title="Access to the Geant4 run manager.">runManager</a>().BeamOn(nevt);
<a name="l00615"></a>00615   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;stop&quot;</span>,0);
<a name="l00616"></a>00616   <span class="keywordflow">return</span> 1;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00620"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#a592e79f8ae539bd7491cd3af0572555c">00620</a> <span class="keywordtype">int</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_exec.html#a592e79f8ae539bd7491cd3af0572555c" title="Terminate the application.">Geant4Exec::terminate</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html" title="Class, which allows all Geant4Action derivatives to access the DDG4 kernel structures...">Geant4Kernel</a>&amp; kernel) {
<a name="l00621"></a>00621   kernel.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_kernel.html#a9fbb49abf09139f19d21a5d5d83f2590" title="Execute phase action if it exists.">executePhase</a>(<span class="stringliteral">&quot;terminate&quot;</span>,0);
<a name="l00622"></a>00622   <span class="keywordflow">return</span> 1;
<a name="l00623"></a>00623 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
