<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4TrackerWeightedSD.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4TrackerWeightedSD.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4TrackerWeightedSD.cpp</h1><a href="_geant4_tracker_weighted_s_d_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id$</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_d_d4hep_units_8h.html">DD4hep/DD4hepUnits.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_sens_det_action_8inl.html">DDG4/Geant4SensDetAction.inl</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_stepping_action_8h.html">DDG4/Geant4SteppingAction.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_tracking_action_8h.html">DDG4/Geant4TrackingAction.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_event_action_8h.html">DDG4/Geant4EventAction.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;G4Event.hh&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;G4VSolid.hh&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">using namespace </span>std;
<a name="l00029"></a>00029 
<a name="l00031"></a>00031 <span class="keyword">namespace </span>DD4hep {
<a name="l00032"></a>00032 
<a name="l00034"></a>00034   <span class="keyword">namespace </span>Simulation   {
<a name="l00035"></a>00035 
<a name="l00036"></a>00036     <span class="keyword">using namespace </span>Geometry;
<a name="l00037"></a>00037 
<a name="l00039"></a>00039 
<a name="l00070"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">00070</a>     <span class="keyword">struct </span><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a> {
<a name="l00071"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a99a4be34af7901b0aab7398894ba906a">00071</a>       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">HitCollection</a>;
<a name="l00072"></a>00072 
<a name="l00074"></a>00074       <span class="keyword">enum</span>  {
<a name="l00075"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a675d7a02b8891bd8f45bc5f27c5c1746">00075</a>         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a675d7a02b8891bd8f45bc5f27c5c1746">POSITION_WEIGHTED</a>  = 1, <span class="comment">// Use energy weights to define the position of the energy deposit</span>
<a name="l00076"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a4b7f40d92a4823d71b75c6894d032489">00076</a>         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a4b7f40d92a4823d71b75c6894d032489">POSITION_MIDDLE</a>    = 2, <span class="comment">// Set the hit position between the step pre and post point</span>
<a name="l00077"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a1419a617e564f58140744d38381ee4c1">00077</a>         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a1419a617e564f58140744d38381ee4c1">POSITION_PREPOINT</a>  = 3, <span class="comment">// Set the hit position to the position of the step pre point</span>
<a name="l00078"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421ac0ca75f525d337568debb34bf3545e29">00078</a>         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421ac0ca75f525d337568debb34bf3545e29">POSITION_POSTPOINT</a> = 4  <span class="comment">// Set the hit position to the position of the step post point</span>
<a name="l00079"></a>00079       };
<a name="l00080"></a>00080       
<a name="l00081"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">00081</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>    <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>, <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>;
<a name="l00082"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">00082</a>       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a>              <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>;
<a name="l00083"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">00083</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html" title="The base class for Geant4 sensitive detector actions implemented by users.">Geant4Sensitive</a>*      <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>;
<a name="l00084"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">00084</a>       <a class="code" href="class_g4_v_sensitive_detector.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VSensitiveDetector</a>* <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a>;
<a name="l00085"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">00085</a>       <span class="keywordtype">double</span>                <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">distance_to_inside</a>;
<a name="l00086"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">00086</a>       <span class="keywordtype">double</span>                <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a>;
<a name="l00087"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">00087</a>       <span class="keywordtype">double</span>                <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a>;
<a name="l00088"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">00088</a>       <span class="keywordtype">double</span>                <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">step_length</a>;
<a name="l00089"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a404e62198a8830c8e6b7c185873bb4d1">00089</a>       <span class="keywordtype">double</span>                <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a404e62198a8830c8e6b7c185873bb4d1">e_cut</a>;
<a name="l00090"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8fcddaa426fa0d7a901991856f3f4d1a">00090</a>       <span class="keywordtype">int</span>                   <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a>, <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8fcddaa426fa0d7a901991856f3f4d1a">parent</a>;
<a name="l00091"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">00091</a>       <span class="keywordtype">int</span>                   <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">combined</a>;
<a name="l00092"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a5120f0b661148efb35b7432c8c58c7ce">00092</a>       <span class="keywordtype">int</span>                   <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a5120f0b661148efb35b7432c8c58c7ce">hit_position_type</a>;
<a name="l00093"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">00093</a>       <span class="keywordtype">int</span>                   <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>;
<a name="l00094"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">00094</a>       <span class="keywordtype">int</span>                   <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">g4ID</a>;
<a name="l00095"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">00095</a>       EInside               <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a>;
<a name="l00096"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">00096</a>       <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a>;
<a name="l00097"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aca48801717dfd735529eb3fda99e999a">00097</a>       <span class="keywordtype">bool</span>                  <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aca48801717dfd735529eb3fda99e999a">single_deposit_mode</a>;
<a name="l00098"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ae628c5cfae79d839a0640338ba31a6ad">00098</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ae628c5cfae79d839a0640338ba31a6ad">TrackerWeighted</a>() : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>(), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>(), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a>(0), 
<a name="l00099"></a>00099                           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">distance_to_inside</a>(0.0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a>(0.0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a>(0.0), 
<a name="l00100"></a>00100                           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">step_length</a>(0.0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a404e62198a8830c8e6b7c185873bb4d1">e_cut</a>(0.0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a>(-1), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8fcddaa426fa0d7a901991856f3f4d1a">parent</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">combined</a>(0),
<a name="l00101"></a>00101                           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a5120f0b661148efb35b7432c8c58c7ce">hit_position_type</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a4b7f40d92a4823d71b75c6894d032489">POSITION_MIDDLE</a>), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">g4ID</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a>(0),
<a name="l00102"></a>00102                           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aca48801717dfd735529eb3fda99e999a">single_deposit_mode</a>(false)
<a name="l00103"></a>00103       {
<a name="l00104"></a>00104       }
<a name="l00105"></a>00105 
<a name="l00107"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a0c6304d5c3a6b0964f7388c3440235db">00107</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a>&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a0c6304d5c3a6b0964f7388c3440235db" title="Clear collected information and restart for new hit.">clear</a>()   {
<a name="l00108"></a>00108         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.SetXYZ(0,0,0);
<a name="l00109"></a>00109         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">distance_to_inside</a> = 0;
<a name="l00110"></a>00110         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a> = 0;
<a name="l00111"></a>00111         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a> = 0;
<a name="l00112"></a>00112         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">step_length</a>  = 0;
<a name="l00113"></a>00113         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#aafcd9c0b786c16d9db3de2de661c9200" title="Clear hit content.">clear</a>();
<a name="l00114"></a>00114         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#aafcd9c0b786c16d9db3de2de661c9200" title="Clear hit content.">clear</a>();
<a name="l00115"></a>00115         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a>  = -1;
<a name="l00116"></a>00116         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8fcddaa426fa0d7a901991856f3f4d1a">parent</a>   = -1;
<a name="l00117"></a>00117         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">combined</a> =  0;
<a name="l00118"></a>00118         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a>     =  0;
<a name="l00119"></a>00119         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> =  0;
<a name="l00120"></a>00120         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">g4ID</a>     =  0;
<a name="l00121"></a>00121         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a> = kOutside;
<a name="l00122"></a>00122         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124 
<a name="l00126"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#abb50962377c010e8430400035d5e3dcf">00126</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a>&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#abb50962377c010e8430400035d5e3dcf" title="Start a new hit.">start</a>(<span class="keyword">const</span> G4Step* step, <span class="keyword">const</span> G4StepPoint* point)   {
<a name="l00127"></a>00127         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a0c6304d5c3a6b0964f7388c3440235db" title="Clear collected information and restart for new hit.">clear</a>();
<a name="l00128"></a>00128         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a8f2563ce396b2d2f7f6c6534aed3cdb4" title="Store Geant4 point and step information into tracker hit structure.">storePoint</a>(step,point);
<a name="l00129"></a>00129         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit = 0.0;
<a name="l00130"></a>00130         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit = 0.0;
<a name="l00131"></a>00131         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID;
<a name="l00132"></a>00132         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(step-&gt;GetTrack());
<a name="l00133"></a>00133         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>;
<a name="l00134"></a>00134         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8fcddaa426fa0d7a901991856f3f4d1a">parent</a> = step-&gt;GetTrack()-&gt;GetParentID();
<a name="l00135"></a>00135         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">g4ID</a> = step-&gt;GetTrack()-&gt;GetTrackID();
<a name="l00136"></a>00136         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138 
<a name="l00140"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744">00140</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a>&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(<span class="keyword">const</span> G4Step* step)   {
<a name="l00141"></a>00141         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a8f2563ce396b2d2f7f6c6534aed3cdb4" title="Store Geant4 point and step information into tracker hit structure.">storePoint</a>(step,step-&gt;GetPostStepPoint());
<a name="l00142"></a>00142         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> mean    = (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>+<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>)*0.5;
<a name="l00143"></a>00143         <span class="keywordtype">double</span>   mean_tm = (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.time+<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.time)*0.5;
<a name="l00144"></a>00144         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit += <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00145"></a>00145         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.SetX(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.x()+mean.x()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00146"></a>00146         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.SetY(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.y()+mean.y()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00147"></a>00147         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.SetZ(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>.z()+mean.z()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00148"></a>00148         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a> += mean_tm*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00149"></a>00149         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">step_length</a>  += step-&gt;GetStepLength();
<a name="l00150"></a>00150         <span class="keywordflow">if</span> ( 0 == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a> )   {
<a name="l00151"></a>00151           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00152"></a>00152           <span class="keywordflow">if</span> ( 0 == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a> )  {
<a name="l00153"></a>00153             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a9aa1270e3fb490a4ebe511343903d72f" title="Returns the volumeID of the sensitive volume corresponding to the step.">volumeID</a>(step) ;
<a name="l00154"></a>00154             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00155"></a>00155           }
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157         ++<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">combined</a>;
<a name="l00158"></a>00158         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00159"></a>00159       }
<a name="l00160"></a>00160 
<a name="l00162"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#add13493ece4035deef171e3528c25b56">00162</a>       <span class="keywordtype">bool</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#add13493ece4035deef171e3528c25b56" title="Helper function to decide if the hit has to be extracted and saved in the collection...">mustSaveTrack</a>(<span class="keyword">const</span> G4Track* tr)<span class="keyword">  const   </span>{
<a name="l00163"></a>00163         <span class="keywordflow">return</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> &gt; 0 &amp;&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> != tr-&gt;GetTrackID();
<a name="l00164"></a>00164       }
<a name="l00165"></a>00165 
<a name="l00167"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d">00167</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(EInside ended)   {
<a name="l00168"></a>00168         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* collection = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(0);
<a name="l00169"></a>00169         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(collection, ended);
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">00172</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a>&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(<span class="keyword">const</span> G4VSolid* solid)    {
<a name="l00173"></a>00173         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a>.unit()), &amp;p=<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>;
<a name="l00174"></a>00174         <span class="keywordtype">double</span> dist = solid-&gt;DistanceToOut(G4ThreeVector(p.X(),p.Y(),p.Z()),
<a name="l00175"></a>00175                                            G4ThreeVector(<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.X(),<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.Y(),<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.Z()));
<a name="l00176"></a>00176         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a> = dist;
<a name="l00177"></a>00177         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00178"></a>00178       }
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aa9139da9ecb7c109b7108cc27a27c13d">00180</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html">TrackerWeighted</a>&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aa9139da9ecb7c109b7108cc27a27c13d">calc_dist_in</a>(<span class="keyword">const</span> G4VSolid* solid)    {
<a name="l00181"></a>00181         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> <a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a>.unit()), &amp;p=<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>;
<a name="l00182"></a>00182         <span class="keywordtype">double</span> dist = solid-&gt;DistanceToOut(G4ThreeVector(p.X(),p.Y(),p.Z()),
<a name="l00183"></a>00183                                            G4ThreeVector(<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.X(),<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.Y(),<a class="code" href="_multi_view_8cpp.html#a8320ee13ac034dbf6d624fe8953dd337">v</a>.Z()));
<a name="l00184"></a>00184         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">distance_to_inside</a> = dist;
<a name="l00185"></a>00185         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00186"></a>00186       }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a690b6f7fdcda6bbec2e7cb89f4fce9af">00188</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a690b6f7fdcda6bbec2e7cb89f4fce9af">extractHit</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* collection, EInside ended)   {
<a name="l00189"></a>00189         <span class="keywordtype">double</span> deposit  = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00190"></a>00190         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> != -1 )  {
<a name="l00191"></a>00191           <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> pos;
<a name="l00192"></a>00192           <a class="code" href="namespace_d_d4hep_1_1_simulation.html#aead01eb580dc503a5abba194d179c963">Momentum</a> mom  = 0.5 * (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a> + <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a>);
<a name="l00193"></a>00193           <span class="keywordtype">double</span>   time = deposit != 0 ? <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a> / deposit : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a222fd48188979006e286b3688452ff6d">mean_time</a>;
<a name="l00194"></a>00194           <span class="keywordtype">char</span>     dist_in[64], dist_out[64];
<a name="l00195"></a>00195 
<a name="l00196"></a>00196           <span class="keywordflow">switch</span>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a5120f0b661148efb35b7432c8c58c7ce">hit_position_type</a>)  {
<a name="l00197"></a>00197           <span class="keywordflow">case</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a675d7a02b8891bd8f45bc5f27c5c1746">POSITION_WEIGHTED</a>:
<a name="l00198"></a>00198             pos = deposit != 0 ? <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a> / deposit : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab378f01fcca56a21b21f3d90c600c984">mean_pos</a>;
<a name="l00199"></a>00199             <span class="keywordflow">break</span>;
<a name="l00200"></a>00200           <span class="keywordflow">case</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a1419a617e564f58140744d38381ee4c1">POSITION_PREPOINT</a>:
<a name="l00201"></a>00201             pos = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>;
<a name="l00202"></a>00202             <span class="keywordflow">break</span>;
<a name="l00203"></a>00203           <span class="keywordflow">case</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421ac0ca75f525d337568debb34bf3545e29">POSITION_POSTPOINT</a>:
<a name="l00204"></a>00204             pos = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>;
<a name="l00205"></a>00205             <span class="keywordflow">break</span>;
<a name="l00206"></a>00206           <span class="keywordflow">case</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8cdc474134c1f8b3a8344e32fc3d4421a4b7f40d92a4823d71b75c6894d032489">POSITION_MIDDLE</a>:
<a name="l00207"></a>00207           <span class="keywordflow">default</span>:
<a name="l00208"></a>00208             pos = (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#af821b8459359ddcb2713bf34f1d72949">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a> + <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>) / 2.0;
<a name="l00209"></a>00209             <span class="keywordflow">break</span>;
<a name="l00210"></a>00210           }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212           <span class="keywordflow">if</span> ( ended == kSurface || <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a> &lt; numeric_limits&lt;float&gt;::epsilon() )
<a name="l00213"></a>00213             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca387b78da12a127cacf8ca7248e1e2f53">Geant4Tracker::Hit::HIT_ENDED_SURFACE</a>;
<a name="l00214"></a>00214           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ended == kInside )
<a name="l00215"></a>00215             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca4a055391a911e049b0056831ed5112c5">Geant4Tracker::Hit::HIT_ENDED_INSIDE</a>;
<a name="l00216"></a>00216           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ended == kOutside )
<a name="l00217"></a>00217             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca41a83b74bf2428cc739f995928acf9d2">Geant4Tracker::Hit::HIT_ENDED_OUTSIDE</a>;
<a name="l00218"></a>00218           
<a name="l00219"></a>00219           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>* hit = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID,
<a name="l00220"></a>00220                                                            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.pdgID,
<a name="l00221"></a>00221                                                            deposit,time);
<a name="l00222"></a>00222           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#aee4dddb74fa4230f4a450f5eb96416af" title="User flag to classify hits.">flag</a>     = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>;
<a name="l00223"></a>00223           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a> = pos;
<a name="l00224"></a>00224           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a> = mom;
<a name="l00225"></a>00225           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a39d50debf1a95beaad59be2477877327" title="Length of the track segment contributing to this hit.">length</a>   = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a82fd5f47ec95d179a132145c54a78873">step_length</a>;
<a name="l00226"></a>00226           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a3ad003b720e4d7a1c6e66e0eabb58540" title="cellID">cellID</a>   = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aeced4bab28aa79ad7bab14ca9ce02c79">cell</a>;
<a name="l00227"></a>00227           hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#adaf354d937bc941aac70b2327aa1d1f3" title="Original Geant 4 track identifier of the creating track (debugging).">g4ID</a>     = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a1205a645db026a115eb182e439929818">g4ID</a>;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229           dist_in[0] = dist_out[0] = 0;
<a name="l00230"></a>00230           <span class="keywordflow">if</span> ( !(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca3eba160dfc155fb1883208e66583cc04">Geant4Tracker::Hit::HIT_STARTED_SURFACE</a>) )
<a name="l00231"></a>00231             ::snprintf(dist_in,<span class="keyword">sizeof</span>(dist_in),<span class="stringliteral">&quot; [%.2e um]&quot;</span>,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a77ce382a300e188a9ed772615abfa4f2">distance_to_inside</a>/<a class="code" href="namespacedd4hep.html#a7ca6a7ec6a20ddb5678bd46c47996d26">CLHEP::um</a>);
<a name="l00232"></a>00232           <span class="keywordflow">if</span> ( !(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca387b78da12a127cacf8ca7248e1e2f53">Geant4Tracker::Hit::HIT_ENDED_SURFACE</a>) )
<a name="l00233"></a>00233             ::snprintf(dist_out,<span class="keyword">sizeof</span>(dist_out),<span class="stringliteral">&quot; [%.2e um]&quot;</span>,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ad898a4f6ed0a4424a2bd8f7d52292c32">distance_to_outside</a>/<a class="code" href="namespacedd4hep.html#a7ca6a7ec6a20ddb5678bd46c47996d26">CLHEP::um</a>);
<a name="l00234"></a>00234           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#abff9f8350b90ba55ee98041b0c6291ae" title="Support for messages with variable output level using output level.">print</a>(<span class="stringliteral">&quot;+++ G4Track:%5d CREATE hit[%03d]:%3d deps E:&quot;</span>
<a name="l00235"></a>00235                            <span class="stringliteral">&quot; %.2e keV Pos:%7.2f %7.2f %7.2f [mm] Start:%s%s%s%s End:%s%s%s%s&quot;</span>,
<a name="l00236"></a>00236                            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID,<span class="keywordtype">int</span>(collection-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#a0d6716e5834a70694d942deb0a412c2d" title="Access the collection size.">GetSize</a>()),
<a name="l00237"></a>00237                            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a7059ba8b2d85cb67220b0184f038f9f9">combined</a>,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a3bb8dbd97551f655071ce36e357593ef">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit/<a class="code" href="namespacedd4hep.html#a2b928c9b9d50fa8a9d3f9840f3a5f258">CLHEP::keV</a>,
<a name="l00238"></a>00238                            pos.X()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>,pos.Y()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>,pos.Z()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>,
<a name="l00239"></a>00239                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;Geant4Tracker::Hit::HIT_STARTED_SURFACE) ? <span class="stringliteral">&quot;SURFACE&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00240"></a>00240                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fcab3d9ded6a94e70ceba2c95de8a0f9b5c">Geant4Tracker::Hit::HIT_STARTED_OUTSIDE</a>) ? <span class="stringliteral">&quot;OUTSIDE&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00241"></a>00241                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca1088e191ba77f3d839371a364940b011">Geant4Tracker::Hit::HIT_STARTED_INSIDE</a>)  ? <span class="stringliteral">&quot;INSIDE &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00242"></a>00242                            dist_in,
<a name="l00243"></a>00243                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;Geant4Tracker::Hit::HIT_ENDED_SURFACE)   ? <span class="stringliteral">&quot;SURFACE&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00244"></a>00244                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca41a83b74bf2428cc739f995928acf9d2">Geant4Tracker::Hit::HIT_ENDED_OUTSIDE</a>)   ? <span class="stringliteral">&quot;OUTSIDE&quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00245"></a>00245                            ((<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a>&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca4a055391a911e049b0056831ed5112c5">Geant4Tracker::Hit::HIT_ENDED_INSIDE</a>)    ? <span class="stringliteral">&quot;INSIDE &quot;</span> : <span class="stringliteral">&quot;&quot;</span>),
<a name="l00246"></a>00246                            dist_out);
<a name="l00247"></a>00247           collection-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(hit);
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a0c6304d5c3a6b0964f7388c3440235db" title="Clear collected information and restart for new hit.">clear</a>();
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251 
<a name="l00253"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab258cb542897a7bd369fd204eafbb245">00253</a>       G4bool <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ab258cb542897a7bd369fd204eafbb245" title="Method for generating hit(s) using the information of G4Step object.">process</a>(<span class="keyword">const</span> G4Step* step, G4TouchableHistory* )   {
<a name="l00254"></a>00254         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">Geant4StepHandler</a> h(step);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="comment">// std::cout &lt;&lt; &quot; process called - pre pos: &quot; &lt;&lt; h.prePos() &lt;&lt; &quot; post pos &quot; &lt;&lt; h.postPos() </span>
<a name="l00257"></a>00257         <span class="comment">//        &lt;&lt; &quot; edep: &quot; &lt;&lt; h.deposit() &lt;&lt; std::endl ;</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         G4VSolid*     preSolid    = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8ce2c4056ad81f1d2500abfa819a2198">solid</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a7c18f2d6e46ecbb380fbe0995029accb">pre</a>);
<a name="l00260"></a>00260         G4VSolid*     postSolid   = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8ce2c4056ad81f1d2500abfa819a2198">solid</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aed9081f8334e95c40e321c14621c0a35">post</a>);
<a name="l00261"></a>00261         G4ThreeVector local_pre   = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#ad08f4724ef8345d764de6313d1e121fa" title="Coordinate transformation to local coordinates.">globalToLocalG4</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a1cecfe16026e80f0b803b3d113b8e535" title="Returns the pre-step position as a G4ThreeVector.">prePosG4</a>());
<a name="l00262"></a>00262         G4ThreeVector local_post  = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#ad08f4724ef8345d764de6313d1e121fa" title="Coordinate transformation to local coordinates.">globalToLocalG4</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a41cd79af212c7cab9d2bb5a9d070bf0f" title="Returns the post-step position as a G4ThreeVector.">postPosG4</a>());
<a name="l00263"></a>00263         EInside       pre_inside  = preSolid-&gt;Inside(local_pre);
<a name="l00264"></a>00264         EInside       post_inside = postSolid-&gt;Inside(local_post);
<a name="l00265"></a>00265      
<a name="l00266"></a>00266         <span class="keyword">const</span> <span class="keywordtype">void</span>* postPV = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a0d568a83cad6f9cb0a300c0426c551da">postVolume</a>();
<a name="l00267"></a>00267         <span class="keyword">const</span> <span class="keywordtype">void</span>* prePV  = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a39eab28ff81a1a24daea4b6a1e376dea">preVolume</a>();
<a name="l00268"></a>00268         <span class="keyword">const</span> <span class="keywordtype">void</span>* postSD = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a9974306f45eb485f2463808f0dd96280">postSD</a>();
<a name="l00269"></a>00269         <span class="keyword">const</span> <span class="keywordtype">void</span>* preSD  = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#afa4f53d4d2e41898f948baf79fabd29b">preSD</a>();
<a name="l00270"></a>00270         G4VSolid* solid = (preSD == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a>) ? preSolid : postSolid;
<a name="l00271"></a>00271         <span class="comment">// 1) Track killed inside SD: trace incomplete. This deposition must be added as well.</span>
<a name="l00272"></a>00272         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> == h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; !h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8960f975f297caa7c6d227e329ec4f95">trkAlive</a>() )  {
<a name="l00273"></a>00273           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fcaa17858fa257d170caa5b0699ec7ddfa5">Geant4Tracker::Hit::HIT_KILLED_TRACK</a>;
<a name="l00274"></a>00274           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00275"></a>00275           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277         <span class="comment">// 2) Track leaving SD volume. Sensitive detector changed. Store hit.</span>
<a name="l00278"></a>00278         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> == h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; postSD != <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> )  {
<a name="l00279"></a>00279           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(kOutside);
<a name="l00280"></a>00280           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         <span class="comment">// 3) Track leaving SD volume. Store hit.</span>
<a name="l00283"></a>00283         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> == h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; postSD == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> &amp;&amp; post_inside == kSurface )  {
<a name="l00284"></a>00284           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(kSurface);
<a name="l00285"></a>00285           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287         <span class="comment">// 4) Track leaving SD volume. Store hit.</span>
<a name="l00288"></a>00288         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> == h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; postSD == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> &amp;&amp; post_inside == kOutside )  {
<a name="l00289"></a>00289           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00290"></a>00290           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         <span class="comment">// 5) Normal update: either intermediate deposition or track is going to be killed.</span>
<a name="l00293"></a>00293         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> == h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; postSD == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> &amp;&amp; post_inside == kInside )  {
<a name="l00294"></a>00294           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a> = post_inside;
<a name="l00295"></a>00295           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step).<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid);
<a name="l00296"></a>00296           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         <span class="comment">// 6) Track from secondary created in SD volume. Store hit from previous. </span>
<a name="l00299"></a>00299         <span class="comment">// --&gt; New hit will be created, to whom also this deposition belongs</span>
<a name="l00300"></a>00300         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> != h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>() &amp;&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> &gt;= 0 )  {
<a name="l00301"></a>00301           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a>);
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">// If the hit got extracted, a new one must be set up</span>
<a name="l00305"></a>00305         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> &lt; 0 )  {
<a name="l00306"></a>00306           EInside  inside  = pre_inside;
<a name="l00307"></a>00307           <span class="comment">// Track entering SD volume</span>
<a name="l00308"></a>00308           <span class="keywordflow">if</span> ( preSD != <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> )   {
<a name="l00309"></a>00309             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#abb50962377c010e8430400035d5e3dcf" title="Start a new hit.">start</a>(step, h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aed9081f8334e95c40e321c14621c0a35">post</a>);
<a name="l00310"></a>00310             inside = post_inside;
<a name="l00311"></a>00311             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#abff9f8350b90ba55ee98041b0c6291ae" title="Support for messages with variable output level using output level.">print</a>(<span class="stringliteral">&quot;++++++++++ Using POST step volume to start hit -- dubious ?&quot;</span>);
<a name="l00312"></a>00312           }
<a name="l00313"></a>00313           <span class="keywordflow">else</span>  {
<a name="l00314"></a>00314             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#abb50962377c010e8430400035d5e3dcf" title="Start a new hit.">start</a>(step, h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a7c18f2d6e46ecbb380fbe0995029accb">pre</a>);
<a name="l00315"></a>00315           }
<a name="l00316"></a>00316           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aa9139da9ecb7c109b7108cc27a27c13d">calc_dist_in</a>(solid);
<a name="l00317"></a>00317           <span class="keywordflow">if</span> ( inside == kSurface )
<a name="l00318"></a>00318             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca3eba160dfc155fb1883208e66583cc04">Geant4Tracker::Hit::HIT_STARTED_SURFACE</a>;
<a name="l00319"></a>00319           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( inside == kInside )
<a name="l00320"></a>00320             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca1088e191ba77f3d839371a364940b011">Geant4Tracker::Hit::HIT_STARTED_INSIDE</a>;
<a name="l00321"></a>00321           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( inside == kOutside )
<a name="l00322"></a>00322             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fcab3d9ded6a94e70ceba2c95de8a0f9b5c">Geant4Tracker::Hit::HIT_STARTED_OUTSIDE</a>;
<a name="l00323"></a>00323           
<a name="l00324"></a>00324           <span class="comment">// New (secondary) track created by some process starting inside the volume</span>
<a name="l00325"></a>00325           <span class="keywordflow">if</span> ( inside == kInside )  {
<a name="l00326"></a>00326             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fca977f4bc3d591a19ac784671d9cc39d52">Geant4Tracker::Hit::HIT_SECONDARY_TRACK</a>;
<a name="l00327"></a>00327           }
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <span class="comment">// Update Data</span>
<a name="l00331"></a>00331         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a> = post_inside;
<a name="l00332"></a>00332         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8ffc0941260d20698a82015cd39cf744" title="Update energy and track information during hit info accumulation.">update</a>(step);
<a name="l00333"></a>00333         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac7628c08fbf29a1dc2133ac7b30e1499">calc_dist_out</a>(solid);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="comment">// Track killed inside SD: trace incomplete. This deposition must be added as well.</span>
<a name="l00336"></a>00336         <span class="keywordflow">if</span> ( !h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8960f975f297caa7c6d227e329ec4f95">trkAlive</a>() )  {
<a name="l00337"></a>00337           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a9ffa7f998b3a1f16864ecbb894ca2e54">hit_flag</a> |= <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a2ae584db022f0919214459dffcaf41fcaa17858fa257d170caa5b0699ec7ddfa5">Geant4Tracker::Hit::HIT_KILLED_TRACK</a>;
<a name="l00338"></a>00338           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340         <span class="comment">// Avoid danglich hits if the track leaves the sensitive volume</span>
<a name="l00341"></a>00341         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( post_inside == kSurface )  {
<a name="l00342"></a>00342           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344         <span class="comment">// Avoid danglich hits if the track leaves the sensitive volume</span>
<a name="l00345"></a>00345         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> == preSD &amp;&amp; (preSD != postSD || prePV != postPV) )  {
<a name="l00346"></a>00346           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348         <span class="comment">// This should simply not happen!</span>
<a name="l00349"></a>00349         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> == postSD &amp;&amp; (preSD != postSD || prePV != postPV) )  {
<a name="l00350"></a>00350           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a2e1c04c087846bf9bf349d26667660a2" title="Support of error messages.">error</a>(<span class="stringliteral">&quot;+++++ WRONG!!! Extract. How did we get here?&quot;</span>);
<a name="l00351"></a>00351           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00352"></a>00352         }
<a name="l00353"></a>00353         <span class="comment">// In single hit mode we MUST write the hit after update</span>
<a name="l00354"></a>00354         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aca48801717dfd735529eb3fda99e999a">single_deposit_mode</a> )  {
<a name="l00355"></a>00355           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(post_inside);
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360 
<a name="l00362"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aa489deb875d6f5867917d2b7aae00747">00362</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#aa489deb875d6f5867917d2b7aae00747" title="Post-event action callback.">endEvent</a>()   {
<a name="l00363"></a>00363         <span class="comment">// We need to add the possibly last added hit to the collection here.</span>
<a name="l00364"></a>00364         <span class="comment">// otherwise the last hit would be assigned to the next event and the</span>
<a name="l00365"></a>00365         <span class="comment">// MC truth would be screwed.</span>
<a name="l00366"></a>00366         <span class="comment">//</span>
<a name="l00367"></a>00367         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#ac6ff7cabaf1b1b455979409184e72966">current</a> &gt; 0 )   {
<a name="l00368"></a>00368           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* coll = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(0);
<a name="l00369"></a>00369           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#abff9f8350b90ba55ee98041b0c6291ae" title="Support for messages with variable output level using output level.">print</a>(<span class="stringliteral">&quot;++++++++++ Found dangling hit: Is the hit extraction logic correct?&quot;</span>);
<a name="l00370"></a>00370           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a8299b772daa5da7c49399a40c1de172d" title="Extract hit information and add the created hit to the collection.">extractHit</a>(coll,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#afc2a6289bb11f08b03d50e0b8e271083">last_inside</a>);
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372       }
<a name="l00374"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a15fd630fa0e1ca7e3c0516952ad5f976">00374</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a15fd630fa0e1ca7e3c0516952ad5f976" title="Pre event action callback.">startEvent</a>()   {
<a name="l00375"></a>00375         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a75a27a45aa4197181191c68eb92f9863">thisSD</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_g4_v_sensitive_detector.html" title="Class of the Geant4 toolkit. See http://www-geant4.kek.jp/Reference.">G4VSensitiveDetector</a>*<span class="keyword">&gt;</span>(&amp;<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_weighted.html#a6c247f2290b5f072a9be93c75dacf631">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#addca9fecaf087a7ce495960cae4cc8cc" title="Access to the sensitive detector object.">detector</a>());
<a name="l00376"></a>00376       }
<a name="l00377"></a>00377     };
<a name="l00378"></a>00378 
<a name="l00380"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a07c8ad40e9cae09940a0397c091c2f45">00380</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a6f4a254db9610da9e0a9b8c0a66a20da" title="Initialization overload for specialization.">Geant4SensitiveAction&lt;TrackerWeighted&gt;::initialize</a>() {
<a name="l00381"></a>00381       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#acef2b66c2126c84bec80d8f57ceb9789" title="Declare property.">declareProperty</a>(<span class="stringliteral">&quot;HitPositionCombination&quot;</span>, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.hit_position_type);
<a name="l00382"></a>00382       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#acef2b66c2126c84bec80d8f57ceb9789" title="Declare property.">declareProperty</a>(<span class="stringliteral">&quot;CollectSingleDeposits&quot;</span>, <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.single_deposit_mode);
<a name="l00383"></a>00383       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.e_cut = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a02ba3b720aadf6e230b6c2c0cd258b2b" title="Reference to the sensitive detector element.">m_sensitive</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a07ed75fb993527ca9b2bc23e720c4098" title="Access energy cut off.">energyCutoff</a>();
<a name="l00384"></a>00384       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.sensitive = <span class="keyword">this</span>;
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386 
<a name="l00388"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa038cfe9345e32eccee5b0022b2b48c4">00388</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a2e9739b3741bb245e3cc7edb41e7374d" title="G4VSensitiveDetector interface: Method invoked at the begining of each event.">Geant4SensitiveAction&lt;TrackerWeighted&gt;::begin</a>(G4HCofThisEvent* <span class="comment">/* hce */</span>)   {
<a name="l00389"></a>00389       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.startEvent();
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 
<a name="l00393"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a09d62eb1a5e2511537b371585e3f60a5">00393</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a144120acdde58a966bd627c572ca191d" title="G4VSensitiveDetector interface: Method invoked at the end of each event.">Geant4SensitiveAction&lt;TrackerWeighted&gt;::end</a>(G4HCofThisEvent* <span class="comment">/* hce */</span>)   {
<a name="l00394"></a>00394       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.endEvent();
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00398"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0d2c4744420ef0f886d26e424d2357ba">00398</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;TrackerWeighted&gt;::defineCollections</a>() {
<a name="l00399"></a>00399       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Tracker::Hit&gt;();
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00403"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a686893fef6dd49fb66408e09f1f6de18">00403</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a52a9e46a54f3e1605637dc281a878b0d" title="G4VSensitiveDetector interface: Method invoked if the event was aborted.">Geant4SensitiveAction&lt;TrackerWeighted&gt;::clear</a>(G4HCofThisEvent* <span class="comment">/* hce */</span>) {
<a name="l00404"></a>00404       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.clear();
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00408"></a>00408     <span class="keyword">template</span> &lt;&gt; G4bool
<a name="l00409"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a97df218d3791d86a41d0ad52a780e87e">00409</a>     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;TrackerWeighted&gt;::process</a>(G4Step* step, G4TouchableHistory* history) {
<a name="l00410"></a>00410       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.process(step, history);
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a63833833f53787d1116da0c3bb635dc8">00413</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;TrackerWeighted&gt;</a>  <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerWeightedAction</a>;
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="keyword">using namespace </span>DD4hep::Simulation;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="preprocessor">#include &quot;<a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html">DDG4/Factories.h</a>&quot;</span>
<a name="l00420"></a>00420 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerWeightedAction</a>)
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
