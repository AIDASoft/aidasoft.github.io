<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCond/src/ConditionsTextRepository.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCond/src/ConditionsTextRepository.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDCond/src/ConditionsTextRepository.cpp</h1><a href="_conditions_text_repository_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: ConditionsRepository.cpp 2336 2016-09-07 17:27:40Z markus.frank@cern.ch $</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_conditions_text_repository_8h.html">DDCond/ConditionsTextRepository.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_conditions_i_o_v_pool_8h.html">DDCond/ConditionsIOVPool.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_conditions_tags_8h.html">DDCond/ConditionsTags.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="_printout_8h.html">DD4hep/Printout.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_document_handler_8h.html">XML/DocumentHandler.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_x_m_l_tags_8h.html">XML/XMLTags.h</a>&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">// C/C++ include files</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;cerrno&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">using namespace </span>std;
<a name="l00030"></a>00030 <span class="keyword">using namespace </span>DD4hep;
<a name="l00031"></a>00031 <span class="keyword">using namespace </span>DD4hep::Conditions;
<a name="l00032"></a><a class="code" href="_conditions_text_repository_8cpp.html#ae26a930890d6dce181abebce5a4280b8">00032</a> <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html" title="Class to easily access the properties of single XmlElements.">XML::Handle_t</a> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html" title="Class to easily access the properties of single XmlElements.">xml_h</a>;
<a name="l00033"></a><a class="code" href="_conditions_text_repository_8cpp.html#aa4442278fec64446d1160e0c6ed886d0">00033</a> <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_element.html" title="User abstraction class to manipulate XML elements within a document.">XML::Element</a> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_element.html" title="User abstraction class to manipulate XML elements within a document.">xml_elt_t</a>;
<a name="l00034"></a><a class="code" href="_conditions_text_repository_8cpp.html#a0f3e679dcd12dc1dccacf1454c9d6948">00034</a> <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document.html" title="Class supporting the basic functionality of an XML document.">XML::Document</a> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document.html" title="Class supporting the basic functionality of an XML document.">xml_doc_t</a>;
<a name="l00035"></a><a class="code" href="_conditions_text_repository_8cpp.html#a33f840d55fd2866ef20d167b7cc9fb3e">00035</a> <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_collection__t.html" title="Class to support the access to collections of XmlNodes (or XmlElements).">XML::Collection_t</a> <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_collection__t.html" title="Class to support the access to collections of XmlNodes (or XmlElements).">xml_coll_t</a>;
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="_conditions_text_repository_8cpp.html#ab9a1a48c745dcf869758cd772f1f31f6">00037</a> <span class="keyword">typedef</span> map&lt;Condition::key_type,Condition&gt; <a class="code" href="_conditions_repository_8cpp.html#ab9a1a48c745dcf869758cd772f1f31f6">AllConditions</a>;
<a name="l00038"></a>00038 
<a name="l00040"></a><a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#ae00798ba3a2736978fc0b9c3a9325abe">00040</a> ConditionsTextRepository::ConditionsTextRepository()  {
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00044"></a><a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#af70e49d05e4819f28d4516fab871bd69">00044</a> <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#af70e49d05e4819f28d4516fab871bd69" title="Default destructor.">ConditionsTextRepository::~ConditionsTextRepository</a>()   {
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">namespace </span>{
<a name="l00048"></a>00048 
<a name="l00049"></a>00049   <span class="keywordtype">int</span> createXML(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; output, <span class="keyword">const</span> <a class="code" href="_conditions_repository_8cpp.html#ab9a1a48c745dcf869758cd772f1f31f6">AllConditions</a>&amp; all) {
<a name="l00050"></a>00050     <span class="keyword">const</span> <span class="keywordtype">char</span> comment[] = <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00051"></a>00051       <span class="stringliteral">&quot;      +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n&quot;</span>
<a name="l00052"></a>00052       <span class="stringliteral">&quot;      ++++   Linear collider detector description LCDD in C++  ++++\n&quot;</span>
<a name="l00053"></a>00053       <span class="stringliteral">&quot;      ++++   DD4hep Detector description generator.            ++++\n&quot;</span>
<a name="l00054"></a>00054       <span class="stringliteral">&quot;      ++++                                                     ++++\n&quot;</span>
<a name="l00055"></a>00055       <span class="stringliteral">&quot;      ++++                                                     ++++\n&quot;</span>
<a name="l00056"></a>00056       <span class="stringliteral">&quot;      ++++                              M.Frank CERN/LHCb      ++++\n&quot;</span>
<a name="l00057"></a>00057       <span class="stringliteral">&quot;      +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n  &quot;</span>;
<a name="l00058"></a>00058     <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document_handler.html" title="Class supporting to read and parse XML documents.">DD4hep::XML::DocumentHandler</a> docH;
<a name="l00059"></a>00059     <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document.html" title="Class supporting the basic functionality of an XML document.">xml_doc_t</a> doc = docH.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document_handler.html#a35782236b2fdfaf3f6f7ed304efa4c21" title="Create new XML document by parsing empty xml buffer.">create</a>(<span class="stringliteral">&quot;collection&quot;</span>, comment);
<a name="l00060"></a>00060     <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_element.html" title="User abstraction class to manipulate XML elements within a document.">xml_elt_t</a> root = doc.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document.html#a47d622c2e7c92089b4b7feb230154be4" title="Access the ROOT eleemnt of the DOM document.">root</a>(), cond(0);
<a name="l00061"></a>00061     <span class="keywordflow">for</span>(AllConditions::const_iterator i=all.begin(); i!=all.end(); ++i)  {
<a name="l00062"></a>00062       <span class="keywordtype">char</span> text[32];
<a name="l00063"></a>00063       <a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html" title="Main condition object handle.">Condition</a> c = (*i).second;
<a name="l00064"></a>00064       ::snprintf(text,<span class="keyword">sizeof</span>(text),<span class="stringliteral">&quot;0x%08X&quot;</span>,c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#a38db941b4934fbb36ebb7eade86593a8" title="Hash identifier.">key</a>());
<a name="l00065"></a>00065       root.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_element.html#ac6be868dcd489b0756e3c70511d3605f" title="Append a new element to the existing tree.">append</a>(cond = <a class="code" href="_det_factory_helper_8h.html#afceebeb841b67ebcff7d4c467cf25034">xml_elt_t</a>(doc, <a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(ref)));
<a name="l00066"></a>00066       cond.setAttr(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(key), text);
<a name="l00067"></a>00067       cond.setAttr(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(name), c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#ab4b94316f4df66998b750336ab14dc90" title="Access the name of the condition.">name</a>());
<a name="l00068"></a>00068       cond.setAttr(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(ref), c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#a7bbc628e25bc0f887743ce52f56b07cb" title="Access the address string [e.g. database identifier].">address</a>());
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070     <a class="code" href="namespace_d_d4hep.html#a6d434af620a49074f3d86d05a04b6073">printout</a>(<a class="code" href="namespace_d_d4hep.html#a5b5a64d56252469451f2020a27d57d42a918099d24909b9384ac28d377dbf58f1">ALWAYS</a>,<span class="stringliteral">&quot;ConditionsRepository&quot;</span>,<span class="stringliteral">&quot;++ Handled %ld conditions.&quot;</span>,all.size());
<a name="l00071"></a>00071     <span class="keywordflow">if</span> ( !output.empty() )  {
<a name="l00072"></a>00072       <span class="keywordflow">return</span> docH.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document_handler.html#aa107a6939a97904b84309abacef28c8c" title="Write xml document to output file (stdout if file name empty).">output</a>(doc, output);
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074     <span class="keywordflow">return</span> 1;
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 
<a name="l00078"></a>00078   <span class="keywordtype">int</span> readXML(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; input, <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#afe5d8989bf0bcd711e59f838943b5115">ConditionsTextRepository::Data</a>&amp; data)    {
<a name="l00079"></a>00079     <span class="keyword">struct </span>Conv {
<a name="l00081"></a>00081       <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#afe5d8989bf0bcd711e59f838943b5115">ConditionsTextRepository::Data</a>&amp; data;
<a name="l00083"></a>00083       Conv(<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#afe5d8989bf0bcd711e59f838943b5115">ConditionsTextRepository::Data</a>&amp; p) : data(p) {}
<a name="l00085"></a>00085       <span class="keywordtype">void</span> operator()(<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html" title="Class to easily access the properties of single XmlElements.">xml_h</a> element)<span class="keyword"> const   </span>{
<a name="l00086"></a>00086         <span class="keywordtype">string</span> key = element.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html#ae00b87295308c1b4d342cb7be2eb0679" title="Access typed attribute value by the XmlAttr.">attr</a>&lt;<span class="keywordtype">string</span>&gt;(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(key));
<a name="l00087"></a>00087         <span class="keywordtype">size_t</span> cap = data.capacity();
<a name="l00088"></a>00088         <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html">ConditionsTextRepository::Entry</a> e;
<a name="l00089"></a>00089         ::sscanf(key.c_str(),<span class="stringliteral">&quot;0x%08X&quot;</span>,&amp;e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a46681700774cfba80ad2c32ea18dd8dd">key</a>);
<a name="l00090"></a>00090         e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a> = element.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html#ae00b87295308c1b4d342cb7be2eb0679" title="Access typed attribute value by the XmlAttr.">attr</a>&lt;<span class="keywordtype">string</span>&gt;(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(name));
<a name="l00091"></a>00091         e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a> = element.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html#ae00b87295308c1b4d342cb7be2eb0679" title="Access typed attribute value by the XmlAttr.">attr</a>&lt;<span class="keywordtype">string</span>&gt;(<a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(ref));
<a name="l00092"></a>00092         <span class="keywordflow">if</span> ( data.size() == cap ) data.reserve(cap+500);
<a name="l00093"></a>00093         data.push_back(e);
<a name="l00094"></a>00094       }
<a name="l00095"></a>00095     };
<a name="l00096"></a>00096     <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document_holder.html" title="Class supporting the basic functionality of an XML document including ownership.">XML::DocumentHolder</a> doc(<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document_handler.html" title="Class supporting to read and parse XML documents.">XML::DocumentHandler</a>().<a class="code" href="_geant4_r_o_o_t_dump_8cpp.html#a391ba400ffea00dbdacec76ea2599583">load</a>(input));
<a name="l00097"></a>00097     <a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_handle__t.html" title="Class to easily access the properties of single XmlElements.">xml_h</a> root = doc.<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_document.html#a47d622c2e7c92089b4b7feb230154be4" title="Access the ROOT eleemnt of the DOM document.">root</a>();
<a name="l00098"></a>00098     <a class="code" href="_det_factory_helper_8h.html#a8ed5d21ce63df10f59d94c43e72e8d83">xml_coll_t</a>(root, <a class="code" href="_x_m_l_tags_8h.html#ad481059c93bf0a5774cce4693f29830b">_U</a>(ref)).<a class="code" href="class_d_d4hep_1_1_x_m_l_1_1_collection__t.html#a191e6f7f84a7ebe38f422a59e4227d36" title="Loop processor using function object.">for_each</a>(Conv(data));
<a name="l00099"></a>00099     <span class="keywordflow">return</span> 1;
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   
<a name="l00102"></a>00102   <span class="keywordtype">int</span> createText(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; output, <span class="keyword">const</span> <a class="code" href="_conditions_repository_8cpp.html#ab9a1a48c745dcf869758cd772f1f31f6">AllConditions</a>&amp; all, <span class="keywordtype">char</span> sep)   {
<a name="l00103"></a>00103     <span class="keywordtype">size_t</span> siz_nam=0, siz_add=0, siz_tot=0;
<a name="l00104"></a>00104     <span class="keywordtype">char</span> fmt[64], text[2*PATH_MAX+64];
<a name="l00105"></a>00105     ofstream out(output);
<a name="l00106"></a>00106     <span class="keywordflow">if</span> ( !out.good() )  {
<a name="l00107"></a>00107       <a class="code" href="namespace_d_d4hep.html#af8602b0b80e0c252cf28e5fbbc81abcc">except</a>(<span class="stringliteral">&quot;ConditionsTextRepository&quot;</span>,
<a name="l00108"></a>00108              <span class="stringliteral">&quot;++ Failed to open output file:%s [errno:%d %s]&quot;</span>,
<a name="l00109"></a>00109              output.c_str(), errno, ::strerror(errno));
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( sep )  {
<a name="l00112"></a>00112       ::snprintf(fmt,<span class="keyword">sizeof</span>(fmt),<span class="stringliteral">&quot;%%08X%c%%s%c%%s%c&quot;</span>,sep,sep,sep);
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     <span class="keywordflow">else</span>   {
<a name="l00115"></a>00115       <span class="keywordflow">for</span>(AllConditions::const_iterator i=all.begin(); i!=all.end(); ++i)  {
<a name="l00116"></a>00116         <a class="code" href="class_d_d4hep_1_1_conditions_1_1_interna_1_1_condition_object.html" title="The data class behind a conditions handle.">Condition::Object</a>* c = (*i).second.<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>();
<a name="l00117"></a>00117         <span class="keywordtype">size_t</span> siz_n = c-&gt;<a class="code" href="class_d_d4hep_1_1_named_object.html#a4675ccdc57835ec27eef8f2799eb77a2" title="The object name.">name</a>.length();
<a name="l00118"></a>00118         <span class="keywordtype">size_t</span> siz_a = c-&gt;<a class="code" href="class_d_d4hep_1_1_conditions_1_1_interna_1_1_condition_object.html#ac30708fd16161d507f475cc81419be18" title="Condition address.">address</a>.length();
<a name="l00119"></a>00119         <span class="keywordflow">if</span> ( siz_nam &lt; siz_n ) siz_nam = siz_n;
<a name="l00120"></a>00120         <span class="keywordflow">if</span> ( siz_add &lt; siz_a ) siz_add = siz_a;
<a name="l00121"></a>00121         <span class="keywordflow">if</span> ( siz_tot &lt; (siz_n+siz_a) ) siz_tot = siz_n+siz_a;
<a name="l00122"></a>00122       }
<a name="l00123"></a>00123       siz_tot += 8+2+1;
<a name="l00124"></a>00124       ::snprintf(fmt,<span class="keyword">sizeof</span>(fmt),<span class="stringliteral">&quot;%%08X %%-%lds %%-%lds&quot;</span>,<span class="keywordtype">long</span>(siz_nam),long(siz_add));
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     out &lt;&lt; <span class="stringliteral">&quot;dd4hep.&quot;</span> &lt;&lt; char(sep ? sep : <span class="charliteral">&apos;-&apos;</span>)
<a name="l00127"></a>00127         &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; long(siz_nam)
<a name="l00128"></a>00128         &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; long(siz_add)
<a name="l00129"></a>00129         &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; long(siz_tot) &lt;&lt; endl;
<a name="l00130"></a>00130     <span class="keywordflow">for</span>(AllConditions::const_iterator i=all.begin(); i!=all.end(); ++i)  {
<a name="l00131"></a>00131       <a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html" title="Main condition object handle.">Condition</a> c = (*i).second;
<a name="l00132"></a>00132       ::snprintf(text, <span class="keyword">sizeof</span>(text), fmt, c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#a38db941b4934fbb36ebb7eade86593a8" title="Hash identifier.">key</a>(), c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#ab4b94316f4df66998b750336ab14dc90" title="Access the name of the condition.">name</a>().c_str(), c.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_condition.html#a7bbc628e25bc0f887743ce52f56b07cb" title="Access the address string [e.g. database identifier].">address</a>().c_str());
<a name="l00133"></a>00133       out &lt;&lt; text &lt;&lt; endl;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     out.close();
<a name="l00136"></a>00136     <span class="keywordflow">return</span> 1;
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138 
<a name="l00140"></a>00140   <span class="keywordtype">int</span> readText(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; input, <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#afe5d8989bf0bcd711e59f838943b5115">ConditionsTextRepository::Data</a>&amp; data)    {
<a name="l00141"></a>00141     <span class="keywordtype">size_t</span> idx;
<a name="l00142"></a>00142     <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html">ConditionsTextRepository::Entry</a> e;
<a name="l00143"></a>00143     <span class="keywordtype">long</span> siz_nam, siz_add, siz_tot;
<a name="l00144"></a>00144     <span class="keywordtype">char</span> sep, c, text[2*PATH_MAX+64];
<a name="l00145"></a>00145     ifstream in(input);
<a name="l00146"></a>00146     in &gt;&gt; c &gt;&gt; c &gt;&gt; c &gt;&gt; c &gt;&gt; c &gt;&gt; c &gt;&gt; c &gt;&gt; sep 
<a name="l00147"></a>00147        &gt;&gt; c &gt;&gt; siz_nam
<a name="l00148"></a>00148        &gt;&gt; c &gt;&gt; siz_add
<a name="l00149"></a>00149        &gt;&gt; c &gt;&gt; siz_tot;
<a name="l00150"></a>00150     text[0] = 0;
<a name="l00151"></a>00151     in.getline(text,<span class="keyword">sizeof</span>(text),<span class="charliteral">&apos;\n&apos;</span>);
<a name="l00152"></a>00152     <span class="keywordflow">do</span> {
<a name="l00153"></a>00153       text[0] = 0;
<a name="l00154"></a>00154       in.getline(text,<span class="keyword">sizeof</span>(text),<span class="charliteral">&apos;\n&apos;</span>);
<a name="l00155"></a>00155       <span class="keywordflow">if</span> ( in.good() )  {
<a name="l00156"></a>00156         <span class="keywordflow">if</span> ( siz_tot )  {
<a name="l00157"></a>00157           <span class="comment">// Direct access mode with fixed record size</span>
<a name="l00158"></a>00158           text[8] = text[9+siz_nam] = text[10+siz_nam+siz_add] = 0;
<a name="l00159"></a>00159           e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a> = text+9;
<a name="l00160"></a>00160           e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a> = text+10+siz_nam;  
<a name="l00161"></a>00161           <span class="keywordflow">if</span> ( (idx=e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a>.find(<span class="charliteral">&apos; &apos;</span>)) != string::npos )
<a name="l00162"></a>00162             e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a>[idx]=0;
<a name="l00163"></a>00163           <span class="keywordflow">if</span> ( (idx=e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>.find(<span class="charliteral">&apos; &apos;</span>)) != string::npos )
<a name="l00164"></a>00164             e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>[idx]=0;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         <span class="keywordflow">else</span>  {
<a name="l00167"></a>00167           <span class="comment">// Variable record size</span>
<a name="l00168"></a>00168           e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a>=text+9;
<a name="l00169"></a>00169           <span class="keywordflow">if</span> ( (idx=e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a>.find(sep)) != string::npos )
<a name="l00170"></a>00170             text[9+idx]=0, e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>=text+idx+10, e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#aacad5506cc8e8f5d9369ff635371a1f6">name</a>=text+9;
<a name="l00171"></a>00171           <span class="keywordflow">if</span> ( (idx=e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>.find(sep)) != string::npos )
<a name="l00172"></a>00172             e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>[idx]=0;
<a name="l00173"></a>00173           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (idx=e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>.find(<span class="charliteral">&apos;\n&apos;</span>)) != string::npos )
<a name="l00174"></a>00174             e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a29d5e08d84bea3989d09c5799f3f1393">address</a>[idx]=0;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176         <span class="keywordtype">size_t</span> cap = data.capacity();
<a name="l00177"></a>00177         ::sscanf(text,<span class="stringliteral">&quot;%08X&quot;</span>,&amp;e.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository_1_1_entry.html#a46681700774cfba80ad2c32ea18dd8dd">key</a>);
<a name="l00178"></a>00178         <span class="keywordflow">if</span> ( data.size() == cap ) data.reserve(cap+500);
<a name="l00179"></a>00179         data.push_back(e);
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181     } <span class="keywordflow">while</span>(in.good() &amp;&amp; !in.eof() );
<a name="l00182"></a>00182     in.close();
<a name="l00183"></a>00183     <span class="keywordflow">return</span> 1;
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00188"></a>00188 <span class="keywordtype">int</span> <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#abcba5f6f77c255256bbc25642e269eb4" title="Save the textrepository to file.">ConditionsTextRepository::save</a>(<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_manager.html" title="Manager class for condition handles.">ConditionsManager</a> manager, <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; output)<span class="keyword">  const  </span>{
<a name="l00189"></a>00189   <span class="keyword">typedef</span> <a class="code" href="classstd_1_1vector.html">vector&lt;const IOVType*&gt;</a> <a class="code" href="_geant4_hierarchy_dump_8cpp.html#a9a28433ec80a7e932e930e9e3a97301d">_T</a>;
<a name="l00190"></a>00190   <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_i_o_v_pool.html#aa011c5cc19bfb761be62adf9a88b5ee9">ConditionsIOVPool::Elements</a> <a class="code" href="_x_m_l_elements_8cpp.html#aadc18c9ee01d55f84c6bcd5841d0e4fd">_E</a>;
<a name="l00191"></a>00191   <span class="keyword">typedef</span> <a class="code" href="namespace_d_d4hep_1_1_conditions.html#ae765f0140a33973a430280f02b6062f4">RangeConditions</a> _R;
<a name="l00192"></a>00192   <a class="code" href="_conditions_repository_8cpp.html#ab9a1a48c745dcf869758cd772f1f31f6">AllConditions</a> all;
<a name="l00193"></a>00193   <span class="keyword">const</span> _T types = manager.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_manager.html#a01a57795e2d1ae0fba2f2f6348be5c46" title="Access the used/registered IOV types.">iovTypesUsed</a>();
<a name="l00194"></a>00194   <span class="keywordflow">for</span>( _T::const_iterator i = types.begin(); i != types.end(); ++i )    {
<a name="l00195"></a>00195     <span class="keyword">const</span> <a class="code" href="class_d_d4hep_1_1_i_o_v_type.html" title="Class describing the interval of validty type.">IOVType</a>* type = *i;
<a name="l00196"></a>00196     <span class="keywordflow">if</span> ( type )   {
<a name="l00197"></a>00197       <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_i_o_v_pool.html" title="Pool of conditions satisfying one IOV type (epoch, run, fill, etc).">ConditionsIOVPool</a>* pool = manager.<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_manager.html#a41334f9fe7baf8250249afcf5b19db20" title="Access conditions multi IOV pool by iov type.">iovPool</a>(*type);
<a name="l00198"></a>00198       <span class="keywordflow">if</span> ( pool )  {
<a name="l00199"></a>00199         <span class="keyword">const</span> _E&amp; e = pool-&gt;<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_i_o_v_pool.html#adf0b418e513769d438a8c91d766e86f4" title="Container of IOV dependent conditions pools.">elements</a>;
<a name="l00200"></a>00200         <span class="keywordflow">for</span> (_E::const_iterator j=e.begin(); j != e.end(); ++j)  {
<a name="l00201"></a>00201           <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_pool.html" title="Class implementing the conditions collection for a given IOV type.">ConditionsPool</a>* cp = (*j).second;
<a name="l00202"></a>00202           _R rc;
<a name="l00203"></a>00203           cp-&gt;<a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_pool.html#ab8a4f19ff244225b1d46f6574aa832cb" title="Select all conditions contained.">select_all</a>(rc);
<a name="l00204"></a>00204           <span class="keywordflow">for</span>(_R::const_iterator ic=rc.begin(); ic!=rc.end(); ++ic)
<a name="l00205"></a>00205             all[(*ic).key()] = *ic;
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207       }
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209   }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordflow">if</span> ( output.find(<span class="stringliteral">&quot;.xml&quot;</span>) != string::npos )   {
<a name="l00213"></a>00213     <span class="keywordflow">return</span> createXML(output, all);
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( output.find(<span class="stringliteral">&quot;.txt&quot;</span>) != string::npos )   {
<a name="l00217"></a>00217     <span class="keywordflow">return</span> createText(output, all, 0);
<a name="l00218"></a>00218   }
<a name="l00219"></a>00219   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( output.find(<span class="stringliteral">&quot;.daf&quot;</span>) != string::npos )   {
<a name="l00221"></a>00221     <span class="keywordflow">return</span> createText(output, all, 0);
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( output.find(<span class="stringliteral">&quot;.csv&quot;</span>) != string::npos )   {
<a name="l00225"></a>00225     <span class="keywordflow">return</span> createText(output, all, <span class="charliteral">&apos;;&apos;</span>);
<a name="l00226"></a>00226   }
<a name="l00227"></a>00227   <span class="keywordflow">return</span> 0;
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00231"></a>00231 <span class="keywordtype">int</span> <a class="code" href="class_d_d4hep_1_1_conditions_1_1_conditions_text_repository.html#af8b9dd41da9a9d1598e471fe164ccd04" title="Load the textrepository from file and fill user passed data structory.">ConditionsTextRepository::load</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; input, Data&amp; data)<span class="keyword">  const  </span>{
<a name="l00232"></a>00232   <span class="keywordflow">if</span> ( input.find(<span class="stringliteral">&quot;.xml&quot;</span>) != string::npos )   {
<a name="l00233"></a>00233     <span class="keywordflow">return</span> readXML(input, data);
<a name="l00234"></a>00234   }
<a name="l00235"></a>00235   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( input.find(<span class="stringliteral">&quot;.txt&quot;</span>) != string::npos )   {
<a name="l00236"></a>00236     <span class="keywordflow">return</span> readText(input, data);
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( input.find(<span class="stringliteral">&quot;.daf&quot;</span>) != string::npos )   {
<a name="l00239"></a>00239     <span class="keywordflow">return</span> readText(input, data);
<a name="l00240"></a>00240   }
<a name="l00241"></a>00241   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( input.find(<span class="stringliteral">&quot;.csv&quot;</span>) != string::npos )   {
<a name="l00242"></a>00242     <span class="keywordflow">return</span> readText(input, data);
<a name="l00243"></a>00243   }
<a name="l00244"></a>00244   <span class="keywordflow">return</span> 0;
<a name="l00245"></a>00245 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
