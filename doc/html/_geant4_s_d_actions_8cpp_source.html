<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4SDActions.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4SDActions.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDG4/plugins/Geant4SDActions.cpp</h1><a href="_geant4_s_d_actions_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: $</span>
<a name="l00002"></a>00002 <span class="comment">//==========================================================================</span>
<a name="l00003"></a>00003 <span class="comment">//  AIDA Detector description implementation for LCD</span>
<a name="l00004"></a>00004 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) Organisation europeenne pour la Recherche nucleaire (CERN)</span>
<a name="l00006"></a>00006 <span class="comment">// All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// For the licensing terms see $DD4hepINSTALL/LICENSE.</span>
<a name="l00009"></a>00009 <span class="comment">// For the list of contributors see $DD4hepINSTALL/doc/CREDITS.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Author     : M.Frank</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">//==========================================================================</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Framework include files</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_sens_det_action_8inl.html">DDG4/Geant4SensDetAction.inl</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_geant4_event_action_8h.html">DDG4/Geant4EventAction.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;G4OpticalPhoton.hh&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;G4VProcess.hh&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keyword">using namespace </span>CLHEP;
<a name="l00022"></a>00022 
<a name="l00024"></a>00024 <span class="keyword">namespace </span>DD4hep {
<a name="l00025"></a>00025 
<a name="l00027"></a>00027   <span class="keyword">namespace </span>Simulation   {
<a name="l00028"></a>00028 
<a name="l00029"></a>00029     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00030"></a>00030     <span class="comment">//               Geant4SensitiveAction&lt;Geant4Tracker&gt;</span>
<a name="l00031"></a>00031     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a414ca0e288f6b1a298bebda417f5be18">00044</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;Geant4Tracker&gt;::defineCollections</a>()    {
<a name="l00045"></a>00045       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Tracker::Hit&gt;();
<a name="l00046"></a>00046     }
<a name="l00047"></a>00047 
<a name="l00049"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a126f9c3d065be1608935c5e16149cec3">00049</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;Geant4Tracker&gt;::process</a>(G4Step* step,G4TouchableHistory* <span class="comment">/*hist*/</span> ) {
<a name="l00050"></a>00050       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a> Hit;
<a name="l00051"></a>00051       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">StepHandler</a> h(step);
<a name="l00052"></a>00052       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> prePos    = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aaa60daae1bdca84d9dee8e7eb4585f75" title="Returns the pre-step position.">prePos</a>();
<a name="l00053"></a>00053       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> postPos   = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a93fb68b4ef3a4172a19b483d77d87b01" title="Returns the post-step position.">postPos</a>();
<a name="l00054"></a>00054       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> direction = postPos - prePos;
<a name="l00055"></a>00055       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> position  = <a class="code" href="namespace_r_o_o_t_1_1_math.html#a06af24d8ff174f2f4d14850e63adc68f" title="Calculate the mean direction of two vectors.">mean_direction</a>(prePos,postPos);
<a name="l00056"></a>00056       <span class="keywordtype">double</span>   hit_len   = direction.R();
<a name="l00057"></a>00057 
<a name="l00058"></a>00058       <span class="comment">// if (hit_len &gt; 0) {</span>
<a name="l00059"></a>00059       <span class="comment">//   double new_len = mean_length(h.preMom(),h.postMom())/hit_len;</span>
<a name="l00060"></a>00060       <span class="comment">//   direction *= new_len/hit_len;</span>
<a name="l00061"></a>00061       <span class="comment">// }</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063       Hit* hit = <span class="keyword">new</span> Hit(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b639a13014e835db1a7b4a1e69469d1">trkID</a>(), h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#ac3bbde8d1c91b9375c00cfc3b65fac23">trkPdgID</a>(), h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a35ffa3abf0d0d88425b1e6bb0f686d97">deposit</a>(), h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8bb7d5d357693c499d319fdc1fa3b34b">track</a>-&gt;GetGlobalTime());
<a name="l00064"></a>00064       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html" title="Utility class describing the monte carlo contribution of a given particle to a hit...">HitContribution</a> contrib = Hit::extractContribution(step);
<a name="l00065"></a>00065       hit-&gt;cellID        = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00066"></a>00066       hit-&gt;energyDeposit = contrib.deposit;
<a name="l00067"></a>00067       hit-&gt;position      = position;
<a name="l00068"></a>00068       hit-&gt;momentum      = 0.5*( h. preMom() + h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a20327303625dbb2ae209885d2b098564">postMom</a>() ) ;
<a name="l00069"></a>00069       hit-&gt;length        = hit_len;
<a name="l00070"></a>00070       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a>)-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(hit);
<a name="l00071"></a>00071       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8bb7d5d357693c499d319fdc1fa3b34b">track</a>);
<a name="l00072"></a>00072       <span class="keywordflow">if</span> ( 0 == hit-&gt;cellID )  {
<a name="l00073"></a>00073         hit-&gt;cellID        = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a9aa1270e3fb490a4ebe511343903d72f" title="Returns the volumeID of the sensitive volume corresponding to the step.">volumeID</a>( step ) ;
<a name="l00074"></a>00074         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00075"></a>00075       }
<a name="l00076"></a>00076       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#abff9f8350b90ba55ee98041b0c6291ae" title="Support for messages with variable output level using output level.">print</a>(<span class="stringliteral">&quot;Hit with deposit:%f  Pos:%f %f %f ID=%016X&quot;</span>,
<a name="l00077"></a>00077             step-&gt;GetTotalEnergyDeposit(),position.X(),position.Y(),position.Z(),
<a name="l00078"></a>00078             (<span class="keywordtype">void</span>*)hit-&gt;cellID);
<a name="l00079"></a>00079       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html" title="Helper class to ease the extraction of information from a G4Touchable object.">Geant4TouchableHandler</a> handler(step);
<a name="l00080"></a>00080       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#abff9f8350b90ba55ee98041b0c6291ae" title="Support for messages with variable output level using output level.">print</a>(<span class="stringliteral">&quot;    Geant4 path:%s&quot;</span>,handler.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html#a2cc01ed8301f7f2df0cd9e5f5b6142ea" title="Helper: Access the placement path of a Geant4 touchable object as a string.">path</a>().c_str());
<a name="l00081"></a>00081       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00082"></a>00082     }
<a name="l00083"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#abb17b973f2ae551abf2c7662d5c05e12">00083</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;Geant4Tracker&gt;</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerAction</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00086"></a>00086     <span class="comment">//               Geant4SensitiveAction&lt;Calorimeter&gt;</span>
<a name="l00087"></a>00087     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00099"></a>00099 <span class="comment"></span>
<a name="l00100"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a4c99ecfb911ff6828db0c98b331e2ca5">00100</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;Geant4Calorimeter&gt;::defineCollections</a>() {
<a name="l00101"></a>00101       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Calorimeter::Hit&gt;();
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00105"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aca71f1e67794a93cd1682101b5c110f9">00105</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;Geant4Calorimeter&gt;::process</a>(G4Step* step,G4TouchableHistory*) {
<a name="l00106"></a>00106       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_calorimeter_1_1_hit.html" title="DDG4 calorimeter hit class used by the generic DDG4 calorimeter sensitive detector...">Geant4Calorimeter::Hit</a> Hit;
<a name="l00107"></a>00107       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">StepHandler</a> h(step);
<a name="l00108"></a>00108       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html" title="Utility class describing the monte carlo contribution of a given particle to a hit...">HitContribution</a> contrib = Hit::extractContribution(step);
<a name="l00109"></a>00109       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">HitCollection</a>*  coll    = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a>);
<a name="l00110"></a>00110       <a class="code" href="namespace_d_d4hep_1_1_d_d_segmentation.html#a61a6833a18d1800bdef176595f83e3ba">VolumeID</a> cell = 0;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112       <span class="keywordflow">try</span> {
<a name="l00113"></a>00113         cell = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00114"></a>00114       } <span class="keywordflow">catch</span>(std::runtime_error &amp;e) {
<a name="l00115"></a>00115         std::stringstream out;
<a name="l00116"></a>00116         out &lt;&lt; std::setprecision(20) &lt;&lt; std::scientific;
<a name="l00117"></a>00117         out &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; e.what()  &lt;&lt; std::endl;
<a name="l00118"></a>00118         out &lt;&lt; <span class="stringliteral">&quot;Position: &quot;</span>
<a name="l00119"></a>00119             &lt;&lt; <span class="stringliteral">&quot;Pre (&quot;</span> &lt;&lt; std::setw(24) &lt;&lt; step-&gt;GetPreStepPoint()-&gt;GetPosition() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00120"></a>00120             &lt;&lt; <span class="stringliteral">&quot;Post (&quot;</span> &lt;&lt; std::setw(24) &lt;&lt; step-&gt;GetPostStepPoint()-&gt;GetPosition() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00121"></a>00121             &lt;&lt; std::endl;
<a name="l00122"></a>00122         out &lt;&lt; <span class="stringliteral">&quot;Momentum: &quot;</span>
<a name="l00123"></a>00123             &lt;&lt; <span class="stringliteral">&quot; Pre (&quot;</span> &lt;&lt;std::setw(24) &lt;&lt; step-&gt;GetPreStepPoint() -&gt;GetMomentum()  &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00124"></a>00124             &lt;&lt; <span class="stringliteral">&quot; Post (&quot;</span> &lt;&lt;std::setw(24) &lt;&lt; step-&gt;GetPostStepPoint()-&gt;GetMomentum() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00125"></a>00125             &lt;&lt; std::endl;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         std::cout &lt;&lt; out.str();
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00130"></a>00130       }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132       <span class="comment">//Hit* hit = coll-&gt;find&lt;Hit&gt;(CellIDCompare&lt;Hit&gt;(cell));</span>
<a name="l00133"></a>00133       Hit* hit = coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#acc76f5d25e9936860343b5457829426c" title="Find hits in a collection by comparison of key value.">findByKey</a>&lt;Hit&gt;(cell);
<a name="l00134"></a>00134       <span class="keywordflow">if</span> ( !hit ) {
<a name="l00135"></a>00135         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html" title="Helper class to ease the extraction of information from a G4Touchable object.">Geant4TouchableHandler</a> handler(step);
<a name="l00136"></a>00136         <a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html" title="Simple container for a physics vector.">DDSegmentation::Vector3D</a> pos = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab7817460de763632e629982ca4c2c847" title="Reference to segmentation.">m_segmentation</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_segmentation.html#a3449910fbeb0c8067f75d88fa66b185f" title="determine the local position based on the cell ID">position</a>(cell);
<a name="l00137"></a>00137         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> global = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a4287f0adeca49bd4a4e6c5bc1054e1a1" title="Coordinate transformation to global coordinates.">localToGlobal</a>(pos);
<a name="l00138"></a>00138         hit = <span class="keyword">new</span> Hit(global);
<a name="l00139"></a>00139         hit-&gt;cellID = cell;
<a name="l00140"></a>00140         coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(cell, hit);
<a name="l00141"></a>00141         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#affc21c47844a7be6edf2824d4d042e64" title="Support for messages with variable output level using output level-2.">printM2</a>(<span class="stringliteral">&quot;%s&gt; CREATE hit with deposit:%e MeV  Pos:%8.2f %8.2f %8.2f  %s  [%s]&quot;</span>,
<a name="l00142"></a>00142                 <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a81f7a014edf0a3086149b3f45c14d826" title="Access name of the action.">c_name</a>(),contrib.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html#a34177a48fce1f52d1b58d6ab47e1cacc" title="Total energy deposit in this hit.">deposit</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#ac48f4f10c3545a48be92b2f970177868">X</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#a9cde1750ebf8b923704e6118f00d1ed6">Y</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#a80100f70c9d120e5a5f6abd1fcbac26f">Z</a>,handler.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html#a2cc01ed8301f7f2df0cd9e5f5b6142ea" title="Helper: Access the placement path of a Geant4 touchable object as a string.">path</a>().c_str(),
<a name="l00143"></a>00143                 coll-&gt;GetName().c_str());
<a name="l00144"></a>00144         <span class="keywordflow">if</span> ( 0 == hit-&gt;cellID )  { <span class="comment">// for debugging only!</span>
<a name="l00145"></a>00145           hit-&gt;cellID = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00146"></a>00146           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148       }
<a name="l00149"></a>00149       hit-&gt;truth.push_back(contrib);
<a name="l00150"></a>00150       hit-&gt;energyDeposit += contrib.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html#a34177a48fce1f52d1b58d6ab47e1cacc" title="Total energy deposit in this hit.">deposit</a>;
<a name="l00151"></a>00151       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(step);
<a name="l00152"></a>00152       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00153"></a>00153     }
<a name="l00154"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#af49169edf9a8a04f3255a2b126698128">00154</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;Geant4Calorimeter&gt;</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4CalorimeterAction</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00157"></a>00157     <span class="comment">//               Geant4SensitiveAction&lt;OpticalCalorimeter&gt;</span>
<a name="l00158"></a>00158     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00159"></a>00159 
<a name="l00161"></a>00161 
<a name="l00176"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_geant4_optical_calorimeter.html">00176</a>     <span class="keyword">struct </span><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_geant4_optical_calorimeter.html">Geant4OpticalCalorimeter</a> {};
<a name="l00177"></a>00177 
<a name="l00179"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a6fec266f731814c2fb5aa21646032690">00179</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;Geant4OpticalCalorimeter&gt;::defineCollections</a>() {
<a name="l00180"></a>00180       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Calorimeter::Hit&gt;();
<a name="l00181"></a>00181     }
<a name="l00183"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a085a617b35c067ca4b29ba4093d976d6">00183</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;Geant4OpticalCalorimeter&gt;::process</a>(G4Step* step,G4TouchableHistory*) {
<a name="l00184"></a>00184       G4Track * track =  step-&gt;GetTrack();
<a name="l00185"></a>00185       <span class="comment">// check that particle is optical photon:</span>
<a name="l00186"></a>00186       <span class="keywordflow">if</span>( track-&gt;GetDefinition() != G4OpticalPhoton::OpticalPhotonDefinition() )  {
<a name="l00187"></a>00187         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00188"></a>00188       }
<a name="l00189"></a>00189       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( track-&gt;GetCreatorProcess()-&gt;G4VProcess::GetProcessName() != <span class="stringliteral">&quot;Cerenkov&quot;</span>)  {
<a name="l00190"></a>00190         track-&gt;SetTrackStatus(fStopAndKill);
<a name="l00191"></a>00191         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00192"></a>00192       }
<a name="l00193"></a>00193       <span class="keywordflow">else</span> {
<a name="l00194"></a>00194         <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_calorimeter_1_1_hit.html" title="DDG4 calorimeter hit class used by the generic DDG4 calorimeter sensitive detector...">Geant4Calorimeter::Hit</a> Hit;
<a name="l00195"></a>00195         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">StepHandler</a> h(step);
<a name="l00196"></a>00196         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">HitCollection</a>*  coll    = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a>);
<a name="l00197"></a>00197         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html" title="Utility class describing the monte carlo contribution of a given particle to a hit...">HitContribution</a> contrib = Hit::extractContribution(step);
<a name="l00198"></a>00198         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a>        pos     = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aaa60daae1bdca84d9dee8e7eb4585f75" title="Returns the pre-step position.">prePos</a>();
<a name="l00199"></a>00199         Hit* hit = coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#a7dfff7bafded0c36cfe093d477b1e518" title="Find hits in a collection by comparison of attributes.">find</a>&lt;Hit&gt;(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_position_compare.html" title="Specialized hit selector based on the hit&amp;#39;s position.">PositionCompare&lt;Hit,Position&gt;</a>(pos));
<a name="l00200"></a>00200         <span class="keywordflow">if</span> ( !hit ) {
<a name="l00201"></a>00201           hit = <span class="keyword">new</span> Hit(pos);
<a name="l00202"></a>00202           hit-&gt;cellID = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a9aa1270e3fb490a4ebe511343903d72f" title="Returns the volumeID of the sensitive volume corresponding to the step.">volumeID</a>(step);
<a name="l00203"></a>00203           coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(hit);
<a name="l00204"></a>00204           <span class="keywordflow">if</span> ( 0 == hit-&gt;cellID )  {
<a name="l00205"></a>00205             hit-&gt;cellID = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a9aa1270e3fb490a4ebe511343903d72f" title="Returns the volumeID of the sensitive volume corresponding to the step.">volumeID</a>(step);
<a name="l00206"></a>00206             <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00207"></a>00207           }
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209         hit-&gt;energyDeposit += contrib.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html#a34177a48fce1f52d1b58d6ab47e1cacc" title="Total energy deposit in this hit.">deposit</a>;
<a name="l00210"></a>00210         hit-&gt;truth.push_back(contrib);
<a name="l00211"></a>00211         track-&gt;SetTrackStatus(fStopAndKill); <span class="comment">// don&apos;t step photon any further</span>
<a name="l00212"></a>00212         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8bb7d5d357693c499d319fdc1fa3b34b">track</a>);
<a name="l00213"></a>00213         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215     }
<a name="l00216"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a9b4de3b53a0e39ec195ab057b9b3b971">00216</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;Geant4OpticalCalorimeter&gt;</a>  <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4OpticalCalorimeterAction</a>;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00220"></a>00220     <span class="comment">//               Geant4SensitiveAction&lt;ScintillatorCalorimeter&gt;</span>
<a name="l00221"></a>00221     <span class="comment">//               For scintillator with Geant4 BirksLaw effect</span>
<a name="l00222"></a>00222     <span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00238"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_geant4_scintillator_calorimeter.html">00238</a>     <span class="keyword">struct </span><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_geant4_scintillator_calorimeter.html">Geant4ScintillatorCalorimeter</a> {};
<a name="l00239"></a>00239 
<a name="l00241"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a76b62dc60cda1378d90d578c247705d8">00241</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;Geant4ScintillatorCalorimeter&gt;::defineCollections</a>() {
<a name="l00242"></a>00242       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Calorimeter::Hit&gt;();
<a name="l00243"></a>00243     }
<a name="l00245"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a1828a968de6f07ff11e5b53f23593c3c">00245</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;Geant4ScintillatorCalorimeter&gt;::process</a>(G4Step* step,G4TouchableHistory*) {
<a name="l00246"></a>00246       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_calorimeter_1_1_hit.html" title="DDG4 calorimeter hit class used by the generic DDG4 calorimeter sensitive detector...">Geant4Calorimeter::Hit</a> Hit;
<a name="l00247"></a>00247       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">StepHandler</a> h(step);
<a name="l00248"></a>00248       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html" title="Utility class describing the monte carlo contribution of a given particle to a hit...">HitContribution</a> contrib = Hit::extractContribution(step,<span class="keyword">true</span>);
<a name="l00249"></a>00249       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">HitCollection</a>*  coll    = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a>);
<a name="l00250"></a>00250       <a class="code" href="namespace_d_d4hep_1_1_d_d_segmentation.html#a61a6833a18d1800bdef176595f83e3ba">VolumeID</a> cell = 0;
<a name="l00251"></a>00251       <span class="keywordflow">try</span> {
<a name="l00252"></a>00252         cell = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00253"></a>00253       } <span class="keywordflow">catch</span>(std::runtime_error &amp;e) {
<a name="l00254"></a>00254         std::stringstream out;
<a name="l00255"></a>00255         out &lt;&lt; std::setprecision(20) &lt;&lt; std::scientific;
<a name="l00256"></a>00256         out &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; e.what()  &lt;&lt; std::endl;
<a name="l00257"></a>00257         out &lt;&lt; <span class="stringliteral">&quot;Position: &quot;</span>
<a name="l00258"></a>00258             &lt;&lt; <span class="stringliteral">&quot;Pre (&quot;</span> &lt;&lt; std::setw(24) &lt;&lt; step-&gt;GetPreStepPoint()-&gt;GetPosition() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00259"></a>00259             &lt;&lt; <span class="stringliteral">&quot;Post (&quot;</span> &lt;&lt; std::setw(24) &lt;&lt; step-&gt;GetPostStepPoint()-&gt;GetPosition() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00260"></a>00260             &lt;&lt; std::endl;
<a name="l00261"></a>00261         out &lt;&lt; <span class="stringliteral">&quot;Momentum: &quot;</span>
<a name="l00262"></a>00262             &lt;&lt; <span class="stringliteral">&quot; Pre (&quot;</span> &lt;&lt;std::setw(24) &lt;&lt; step-&gt;GetPreStepPoint() -&gt;GetMomentum()  &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00263"></a>00263             &lt;&lt; <span class="stringliteral">&quot; Post (&quot;</span> &lt;&lt;std::setw(24) &lt;&lt; step-&gt;GetPostStepPoint()-&gt;GetMomentum() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>
<a name="l00264"></a>00264             &lt;&lt; std::endl;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         std::cout &lt;&lt; out.str();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00269"></a>00269       }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271       <span class="comment">//Hit* hit = coll-&gt;find&lt;Hit&gt;(CellIDCompare&lt;Hit&gt;(cell));</span>
<a name="l00272"></a>00272       Hit* hit = coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#acc76f5d25e9936860343b5457829426c" title="Find hits in a collection by comparison of key value.">findByKey</a>&lt;Hit&gt;(cell);
<a name="l00273"></a>00273       <span class="keywordflow">if</span> ( !hit ) {
<a name="l00274"></a>00274         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html" title="Helper class to ease the extraction of information from a G4Touchable object.">Geant4TouchableHandler</a> handler(step);
<a name="l00275"></a>00275         <a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html" title="Simple container for a physics vector.">DDSegmentation::Vector3D</a> pos = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab7817460de763632e629982ca4c2c847" title="Reference to segmentation.">m_segmentation</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_segmentation.html#a3449910fbeb0c8067f75d88fa66b185f" title="determine the local position based on the cell ID">position</a>(cell);
<a name="l00276"></a>00276         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> global = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a4287f0adeca49bd4a4e6c5bc1054e1a1" title="Coordinate transformation to global coordinates.">localToGlobal</a>(pos);
<a name="l00277"></a>00277         hit = <span class="keyword">new</span> Hit(global);
<a name="l00278"></a>00278         hit-&gt;cellID = cell;
<a name="l00279"></a>00279         coll-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(cell, hit);
<a name="l00280"></a>00280         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#affc21c47844a7be6edf2824d4d042e64" title="Support for messages with variable output level using output level-2.">printM2</a>(<span class="stringliteral">&quot;CREATE hit with deposit:%e MeV  Pos:%8.2f %8.2f %8.2f  %s&quot;</span>,
<a name="l00281"></a>00281                 contrib.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html#a34177a48fce1f52d1b58d6ab47e1cacc" title="Total energy deposit in this hit.">deposit</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#ac48f4f10c3545a48be92b2f970177868">X</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#a9cde1750ebf8b923704e6118f00d1ed6">Y</a>,pos.<a class="code" href="struct_d_d4hep_1_1_d_d_segmentation_1_1_vector3_d.html#a80100f70c9d120e5a5f6abd1fcbac26f">Z</a>,handler.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_touchable_handler.html#a2cc01ed8301f7f2df0cd9e5f5b6142ea" title="Helper: Access the placement path of a Geant4 touchable object as a string.">path</a>().c_str());
<a name="l00282"></a>00282         <span class="keywordflow">if</span> ( 0 == hit-&gt;cellID )  { <span class="comment">// for debugging only!</span>
<a name="l00283"></a>00283           hit-&gt;cellID = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00284"></a>00284           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286       }
<a name="l00287"></a>00287       hit-&gt;truth.push_back(contrib);
<a name="l00288"></a>00288       hit-&gt;energyDeposit += contrib.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data_1_1_monte_carlo_contrib.html#a34177a48fce1f52d1b58d6ab47e1cacc" title="Total energy deposit in this hit.">deposit</a>;
<a name="l00289"></a>00289       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(step);
<a name="l00290"></a>00290       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00291"></a>00291     }
<a name="l00292"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a518721ad629e0c574145b27d7e1e0c36">00292</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;Geant4ScintillatorCalorimeter&gt;</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4ScintillatorCalorimeterAction</a>;
<a name="l00293"></a>00293 
<a name="l00295"></a>00295 
<a name="l00318"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html">00318</a>     <span class="keyword">struct </span><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html">TrackerCombine</a> {
<a name="l00319"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#ae776b8d22a42d425b4d9b6344ed430e1">00319</a>       <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">HitCollection</a>;
<a name="l00320"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">00320</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>  <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>, <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>;
<a name="l00321"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">00321</a>       <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a>          <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>;
<a name="l00322"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">00322</a>       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html" title="The base class for Geant4 sensitive detector actions implemented by users.">Geant4Sensitive</a>*  <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>;
<a name="l00323"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">00323</a>       <span class="keywordtype">double</span>            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a>;
<a name="l00324"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#acd9b60d0c1b8cee45c1745a4ae167d24">00324</a>       <span class="keywordtype">double</span>            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#acd9b60d0c1b8cee45c1745a4ae167d24">e_cut</a>;
<a name="l00325"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">00325</a>       <span class="keywordtype">int</span>               <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a>;
<a name="l00326"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">00326</a>       <span class="keywordtype">int</span>               <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a>;
<a name="l00327"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">00327</a>       <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>     <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a>;
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a60747607cdefc8283d864c6f5313a392">00329</a>       <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a60747607cdefc8283d864c6f5313a392">TrackerCombine</a>() : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>(), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>(), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a>(0.0), 
<a name="l00330"></a>00330                          <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#acd9b60d0c1b8cee45c1745a4ae167d24">e_cut</a>(0.0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a>(-1), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a>(0), <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a>(0)
<a name="l00331"></a>00331       {
<a name="l00332"></a>00332       }
<a name="l00333"></a>00333 
<a name="l00335"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a104188fb9a41662e03eacc2d34e4bced">00335</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a104188fb9a41662e03eacc2d34e4bced" title="Start a new hit.">start</a>(G4Step* step, G4StepPoint* point)   {
<a name="l00336"></a>00336         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a8f2563ce396b2d2f7f6c6534aed3cdb4" title="Store Geant4 point and step information into tracker hit structure.">storePoint</a>(step,point);
<a name="l00337"></a>00337         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit = 0.0;
<a name="l00338"></a>00338         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID;
<a name="l00339"></a>00339         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#ab5c51f863ef61aa15b89fd88f6709e70" title="Mark the track to be kept for MC truth propagation during hit processing.">mark</a>(step-&gt;GetTrack());
<a name="l00340"></a>00340         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.SetXYZ(0,0,0);
<a name="l00341"></a>00341         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a> = 0;
<a name="l00342"></a>00342         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>;
<a name="l00343"></a>00343         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a> = 0;
<a name="l00344"></a>00344         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> = 0;
<a name="l00345"></a>00345       }
<a name="l00346"></a>00346 
<a name="l00348"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a3bd30148dcc0b7fa917b000c9946e77f">00348</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a3bd30148dcc0b7fa917b000c9946e77f" title="Update energy and track information during hit info accumulation.">update</a>(G4Step* step) {
<a name="l00349"></a>00349         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a8f2563ce396b2d2f7f6c6534aed3cdb4" title="Store Geant4 point and step information into tracker hit structure.">storePoint</a>(step,step-&gt;GetPostStepPoint());
<a name="l00350"></a>00350         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit += <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00351"></a>00351         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.SetX(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.x()+<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>.x()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00352"></a>00352         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.SetY(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.y()+<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>.y()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00353"></a>00353         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.SetZ(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.z()+<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>.z()*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit);
<a name="l00354"></a>00354         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a> += <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.time*<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00355"></a>00355         <span class="keywordflow">if</span> ( 0 == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> )   {
<a name="l00356"></a>00356           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a1e79173455ccff4d70cd1325b26ad3e9" title="Returns the cellID of the sensitive volume corresponding to the step.">cellID</a>(step);
<a name="l00357"></a>00357           <span class="keywordflow">if</span> ( 0 == <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> )  {
<a name="l00358"></a>00358             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a9aa1270e3fb490a4ebe511343903d72f" title="Returns the volumeID of the sensitive volume corresponding to the step.">volumeID</a>(step) ;
<a name="l00359"></a>00359             <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a05d5b6e6de246d0b7a7d76f66b9dc608" title="Support of exceptions: Print fatal message and throw runtime_error.">except</a>(<span class="stringliteral">&quot;+++ Invalid CELL ID for hit!&quot;</span>);
<a name="l00360"></a>00360           }
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         ++<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a>;
<a name="l00363"></a>00363       }
<a name="l00364"></a>00364 
<a name="l00366"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a7b178cd57d961437d3cfabb65d9c2d09">00366</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a7b178cd57d961437d3cfabb65d9c2d09" title="Clear collected information and restart for new hit.">clear</a>()  {
<a name="l00367"></a>00367         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>.SetXYZ(0,0,0);
<a name="l00368"></a>00368         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a> = 0;
<a name="l00369"></a>00369         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#aafcd9c0b786c16d9db3de2de661c9200" title="Clear hit content.">clear</a>();
<a name="l00370"></a>00370         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#aafcd9c0b786c16d9db3de2de661c9200" title="Clear hit content.">clear</a>();
<a name="l00371"></a>00371         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> = -1;
<a name="l00372"></a>00372         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a> = 0;
<a name="l00373"></a>00373         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a> = 0;
<a name="l00374"></a>00374       }
<a name="l00375"></a>00375 
<a name="l00377"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a063b82a781184cc0fbf21c0876a6acd6">00377</a>       <span class="keywordtype">bool</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a063b82a781184cc0fbf21c0876a6acd6" title="Helper function to decide if the hit has to be extracted and saved in the collection...">mustSaveTrack</a>(<span class="keyword">const</span> G4Track* tr)<span class="keyword">  const   </span>{
<a name="l00378"></a>00378         <span class="keywordflow">return</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> &gt; 0 &amp;&amp; <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> != tr-&gt;GetTrackID();
<a name="l00379"></a>00379       }
<a name="l00380"></a>00380 
<a name="l00382"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f">00382</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f" title="Extract hit information and add the created hit to the collection.">extractHit</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* collection)   {
<a name="l00383"></a>00383         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> == -1 ) {
<a name="l00384"></a>00384           <span class="keywordflow">return</span>;
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         <span class="keywordtype">double</span> deposit = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit;
<a name="l00387"></a>00387         <span class="keywordtype">double</span>   time  = deposit != 0 ? <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a> / deposit : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a88f539f333235ec8d8746fe11fd70e12">mean_time</a>;
<a name="l00388"></a>00388         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#ad6fd94b3439e31d1ba4b2e640d578558">Position</a> pos   = deposit != 0 ? <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>  / deposit : <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a66a9636b7e0e4712718366da7db0ddf6">mean_pos</a>;
<a name="l00389"></a>00389         <a class="code" href="namespace_d_d4hep_1_1_simulation.html#aead01eb580dc503a5abba194d179c963">Momentum</a> mom   = 0.5 * (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a> + <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a>);
<a name="l00390"></a>00390         <span class="keywordtype">double</span> path_len = (<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a04a629d7ed0ac04fd945466a40bb7e48">post</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a> - <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a>).R();
<a name="l00391"></a>00391         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>* hit = <span class="keyword">new</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html" title="DDG4 tracker hit class used by the generic DDG4 tracker sensitive detector.">Geant4Tracker::Hit</a>(<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID,
<a name="l00392"></a>00392                                                          <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.pdgID,
<a name="l00393"></a>00393                                                          deposit,time);
<a name="l00394"></a>00394         hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a7f992369c5178cac0cc00ffc8a9c36a0" title="Hit position.">position</a> = pos;
<a name="l00395"></a>00395         hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#abdd1f621f202ef83c2078a52cbb242b3" title="Hit direction.">momentum</a> = mom;
<a name="l00396"></a>00396         hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#a39d50debf1a95beaad59be2477877327" title="Length of the track segment contributing to this hit.">length</a>   = path_len;
<a name="l00397"></a>00397         hit-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_data.html#a3ad003b720e4d7a1c6e66e0eabb58540" title="cellID">cellID</a>   = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a93f684a7d6865b0f92a82560b3558d0d">cell</a>;
<a name="l00398"></a>00398         collection-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html#ac9eec55500c5cc2af9cd0892c8956b76" title="Add a new hit with a check, that the hit is of the same type.">add</a>(hit);
<a name="l00399"></a>00399         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#affc21c47844a7be6edf2824d4d042e64" title="Support for messages with variable output level using output level-2.">printM2</a>(<span class="stringliteral">&quot;+++ TrackID:%6d [%s] CREATE hit combination with %2d deposit(s):&quot;</span>
<a name="l00400"></a>00400                            <span class="stringliteral">&quot; %e MeV  Pos:%8.2f %8.2f %8.2f&quot;</span>,
<a name="l00401"></a>00401                            <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.trackID,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a81f7a014edf0a3086149b3f45c14d826" title="Access name of the action.">c_name</a>(),<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a09c500ccd4bca917b081930ae9e2c5ce">combined</a>,<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a05e41bf826c42ad8e4ddefb914a9e079">pre</a>.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_tracker_1_1_hit.html#ab786ed42d3c88d911b662e8a083bc54e" title="Monte Carlo / Geant4 information.">truth</a>.deposit/<a class="code" href="namespacedd4hep.html#a6dee62809c6ee54d2fc90671f4dc8b91">CLHEP::MeV</a>,
<a name="l00402"></a>00402                            pos.X()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>,pos.Y()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>,pos.Z()/<a class="code" href="namespacedd4hep.html#a124f4e9c11400c971e1a829ba8d4a3d0">CLHEP::mm</a>);
<a name="l00403"></a>00403         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a7b178cd57d961437d3cfabb65d9c2d09" title="Clear collected information and restart for new hit.">clear</a>();
<a name="l00404"></a>00404       }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406 
<a name="l00408"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a8d3a583a2f70cb49bcc3d6eda5363a85">00408</a>       G4bool <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a8d3a583a2f70cb49bcc3d6eda5363a85" title="Method for generating hit(s) using the information of G4Step object.">process</a>(G4Step* step, G4TouchableHistory* ) {
<a name="l00409"></a>00409         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html" title="Helper class to ease the extraction of information from a G4Step object.">Geant4StepHandler</a> h(step);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <span class="comment">// std::cout &lt;&lt; &quot; process called - pre pos: &quot; &lt;&lt; h.prePos() &lt;&lt; &quot; post pos &quot; &lt;&lt; h.postPos() </span>
<a name="l00412"></a>00412         <span class="comment">//        &lt;&lt; &quot; edep: &quot; &lt;&lt; h.deposit() &lt;&lt; std::endl ;</span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414         <span class="keywordtype">void</span> *prePV = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a95ee141aadb5e72b9bd204b44ef62f0a">volume</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a7c18f2d6e46ecbb380fbe0995029accb">pre</a>), *postPV = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a95ee141aadb5e72b9bd204b44ef62f0a">volume</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aed9081f8334e95c40e321c14621c0a35">post</a>);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* coll = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(0);
<a name="l00418"></a>00418         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a063b82a781184cc0fbf21c0876a6acd6" title="Helper function to decide if the hit has to be extracted and saved in the collection...">mustSaveTrack</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8bb7d5d357693c499d319fdc1fa3b34b">track</a>) )  {
<a name="l00419"></a>00419           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f" title="Extract hit information and add the created hit to the collection.">extractHit</a>(coll);
<a name="l00420"></a>00420         }
<a name="l00422"></a>00422         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> &lt; 0 )  {
<a name="l00423"></a>00423           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a104188fb9a41662e03eacc2d34e4bced" title="Start a new hit.">start</a>(step, h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a7c18f2d6e46ecbb380fbe0995029accb">pre</a>);
<a name="l00424"></a>00424         }
<a name="l00426"></a>00426         <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a3bd30148dcc0b7fa917b000c9946e77f" title="Update energy and track information during hit info accumulation.">update</a>(step);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="keywordflow">if</span> ( prePV != postPV ) {
<a name="l00429"></a>00429           <span class="keywordtype">void</span>* postSD = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b7355a5af216dddcf41af1c1d9e2b8d">sd</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aed9081f8334e95c40e321c14621c0a35">post</a>);
<a name="l00430"></a>00430           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f" title="Extract hit information and add the created hit to the collection.">extractHit</a>(coll);
<a name="l00431"></a>00431           <span class="keywordflow">if</span> ( 0 != postSD )   {
<a name="l00432"></a>00432             <span class="keywordtype">void</span>* preSD = h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a6b7355a5af216dddcf41af1c1d9e2b8d">sd</a>(h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a7c18f2d6e46ecbb380fbe0995029accb">pre</a>);
<a name="l00433"></a>00433             <span class="keywordflow">if</span> ( preSD == postSD ) {
<a name="l00434"></a>00434               <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a104188fb9a41662e03eacc2d34e4bced" title="Start a new hit.">start</a>(step,h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#aed9081f8334e95c40e321c14621c0a35">post</a>);
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436           }
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( h.<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_step_handler.html#a8bb7d5d357693c499d319fdc1fa3b34b">track</a>-&gt;GetTrackStatus() == fStopAndKill ) {
<a name="l00439"></a>00439           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f" title="Extract hit information and add the created hit to the collection.">extractHit</a>(coll);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00442"></a>00442       }
<a name="l00443"></a>00443 
<a name="l00445"></a><a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a03b50811a7b164514baebc2f252fba62">00445</a>       <span class="keywordtype">void</span> <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a03b50811a7b164514baebc2f252fba62" title="Post-event action callback.">endEvent</a>(<span class="keyword">const</span> G4Event* <span class="comment">/* event */</span>)   {
<a name="l00446"></a>00446         <span class="comment">// We need to add the possibly last added hit to the collection here.</span>
<a name="l00447"></a>00447         <span class="comment">// otherwise the last hit would be assigned to the next event and the</span>
<a name="l00448"></a>00448         <span class="comment">// MC truth would be screwed.</span>
<a name="l00449"></a>00449         <span class="comment">//</span>
<a name="l00450"></a>00450         <span class="comment">// Alternatively the &apos;update&apos; method would become rather CPU consuming,</span>
<a name="l00451"></a>00451         <span class="comment">// beacuse the extract action would have to be recalculated over and over.</span>
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ( <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#aa8bb9faf2d8ce6bac98f969e5bb9943c">current</a> &gt; 0 )   {
<a name="l00453"></a>00453           <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_hit_collection.html" title="Generic hit container class using Geant4HitWrapper objects.">Geant4HitCollection</a>* coll = <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#afa91afc4a7df2a80a889ab1a1ba4d4b6">sensitive</a>-&gt;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a49d2a794d7824475b7bac71d7342306b" title="Retrieve the hits collection associated with this detector by its serial number.">collection</a>(0);
<a name="l00454"></a>00454           <a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a75803adf3212ecca99d2b6fbcd53899f" title="Extract hit information and add the created hit to the collection.">extractHit</a>(coll);
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456       }
<a name="l00457"></a>00457     };
<a name="l00458"></a>00458 
<a name="l00460"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a031c0b9cb9de513bc845012042fc7825">00460</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a6f4a254db9610da9e0a9b8c0a66a20da" title="Initialization overload for specialization.">Geant4SensitiveAction&lt;TrackerCombine&gt;::initialize</a>() {
<a name="l00461"></a>00461       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_action.html#a5ac8a0e311d6f5b7d297de21dfcd56a7" title="Access to the main event action sequence from the kernel object.">eventAction</a>().<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_event_action_sequence.html#a8d53a540711a752831ac7ef62a42e3f3" title="Register end-of-event callback.">callAtEnd</a>(&amp;<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>,&amp;<a class="code" href="struct_d_d4hep_1_1_simulation_1_1_tracker_combine.html#a03b50811a7b164514baebc2f252fba62" title="Post-event action callback.">TrackerCombine::endEvent</a>);
<a name="l00462"></a>00462       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.e_cut = <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive.html#a02ba3b720aadf6e230b6c2c0cd258b2b" title="Reference to the sensitive detector element.">m_sensitive</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_sensitive_detector.html#a07ed75fb993527ca9b2bc23e720c4098" title="Access energy cut off.">energyCutoff</a>();
<a name="l00463"></a>00463       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.sensitive = <span class="keyword">this</span>;
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465 
<a name="l00467"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a827b5e46eae9a7b69e91d6f0ee58733d">00467</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a103768b61e0f22768de9a91ce588a88c" title="Define collections created by this sensitivie action object.">Geant4SensitiveAction&lt;TrackerCombine&gt;::defineCollections</a>() {
<a name="l00468"></a>00468       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa73c450b64116d4e52be7accbef7bea9" title="Collection identifier.">m_collectionID</a> = declareReadoutFilteredCollection&lt;Geant4Tracker::Hit&gt;();
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00472"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#aa7ffb4125e622d9eb08bfd4901a643fd">00472</a>     <span class="keyword">template</span> &lt;&gt; <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a52a9e46a54f3e1605637dc281a878b0d" title="G4VSensitiveDetector interface: Method invoked if the event was aborted.">Geant4SensitiveAction&lt;TrackerCombine&gt;::clear</a>(G4HCofThisEvent*) {
<a name="l00473"></a>00473       <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.clear();
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00477"></a>00477     <span class="keyword">template</span> &lt;&gt; G4bool
<a name="l00478"></a><a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a66fa5dd6c3ea881689b16f73e9c7887b">00478</a>     <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a36759982ed0876a5ce81c14973c18077" title="G4VSensitiveDetector interface: Method for generating hit(s) using the G4Step object...">Geant4SensitiveAction&lt;TrackerCombine&gt;::process</a>(G4Step* step, G4TouchableHistory* history) {
<a name="l00479"></a>00479       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html#a0e1c5a4683c5a4e50a0e3325b61f5275" title="User data block.">m_userData</a>.process(step, history);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#ae4372869044729bc07b6343c4e077fdc">00482</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SensitiveAction&lt;TrackerCombine&gt;</a>  <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerCombineAction</a>;
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a6f4f8c57d8b3239f579f31519e803afa">00484</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerAction</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleTrackerAction</a>;
<a name="l00485"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a567bbed97768b8a89f60e745b6d3dd51">00485</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4CalorimeterAction</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleCalorimeterAction</a>;
<a name="l00486"></a><a class="code" href="namespace_d_d4hep_1_1_simulation.html#a3017d956ee0a02d03e54c12486dd9230">00486</a>     <span class="keyword">typedef</span> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4OpticalCalorimeterAction</a> <a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleOpticalCalorimeterAction</a>;
<a name="l00487"></a>00487   }
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="keyword">using namespace </span>DD4hep::Simulation;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="preprocessor">#include &quot;<a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html">DDG4/Factories.h</a>&quot;</span>
<a name="l00493"></a>00493 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerAction</a>)
<a name="l00494"></a>00494 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4TrackerCombineAction</a>)
<a name="l00495"></a>00495 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4CalorimeterAction</a>)
<a name="l00496"></a>00496 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4OpticalCalorimeterAction</a>)
<a name="l00497"></a>00497 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4ScintillatorCalorimeterAction</a>)
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="comment">// Need these factories for backwards compatibility</span>
<a name="l00500"></a>00500 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleTrackerAction</a>)
<a name="l00501"></a>00501 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleCalorimeterAction</a>)
<a name="l00502"></a>00502 <a class="code" href="_d_d_g4_2include_2_d_d_g4_2_factories_8h.html#a4b45b064ac34cecb1cf0a31c2edc346a">DECLARE_GEANT4SENSITIVE</a>(<a class="code" href="class_d_d4hep_1_1_simulation_1_1_geant4_sensitive_action.html" title="Template class to ease the construction of sensitive detectors using particle template...">Geant4SimpleOpticalCalorimeterAction</a>)
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
