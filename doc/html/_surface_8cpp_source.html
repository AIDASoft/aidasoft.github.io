<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<!--BEGIN PROJECT_NAME--><title>DD4hep: DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDRec/src/Surface.cpp Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>DD4hep: /afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDRec/src/Surface.cpp Source File</title><!--END !PROJECT_NAME-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="DD4hep.css" rel="stylesheet" type="text/css" />
$treeview
$search
$mathjax
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 100px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="../doc/LaTex/CERN-logo.png" height="72"/></td>
  <td id="projectlogo"><img alt="Logo" src="$projectlogo" height="72"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
   <div id="projectname">DD4hep
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber">Rev:exported</span><!--END PROJECT_NUMBER-->
   </div>
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/afs/cern.ch/user/m/mpetric/nightly_cppcheck/dd4hep/DDRec/src/Surface.cpp</h1><a href="_surface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="_surface_8h.html">DDRec/Surface.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="_detector_interna_8h.html">DD4hep/objects/DetectorInterna.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="_memory_8h.html">DD4hep/Memory.h</a>&quot;</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="_material_manager_8h.html">DDRec/MaterialManager.h</a>&quot;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;memory&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;exception&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;TGeoMatrix.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;TGeoShape.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;TRotation.h&quot;</span>
<a name="l00014"></a>00014 <span class="comment">//TGeoTrd1 is apparently not included by defautl</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;TGeoTrd1.h&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">namespace </span>DD4hep {
<a name="l00018"></a>00018   <span class="keyword">namespace </span>DDRec {
<a name="l00019"></a>00019  
<a name="l00020"></a>00020     <span class="keyword">using namespace </span>Geometry ;
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023       <span class="comment">//======================================================================================================</span>
<a name="l00024"></a>00024   
<a name="l00025"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8a39b98345cf8bb2ea7912b3974552e9">00025</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8a39b98345cf8bb2ea7912b3974552e9" title="setter for daughter classes">VolSurfaceBase::setU</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; u_val) {  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a15a2648f8b9ead47a28826e4ad0cc6c7">_u</a> = u_val  ; }
<a name="l00026"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a032025d40e5fee926713517ae36f5d4b">00026</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a032025d40e5fee926713517ae36f5d4b" title="setter for daughter classes">VolSurfaceBase::setV</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; v_val) {  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a> = v_val ; }
<a name="l00027"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a1ccc4ac2bd7ff9293b01798844d243e1">00027</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a1ccc4ac2bd7ff9293b01798844d243e1" title="setter for daughter classes">VolSurfaceBase::setNormal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; n) { <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a9371dc34ec00ff652bc4e0ae1423364c">_n</a> = n ; }
<a name="l00028"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a3dc33b9f3661403fbeeaeb787e71d247">00028</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a3dc33b9f3661403fbeeaeb787e71d247" title="setter for daughter classes">VolSurfaceBase::setOrigin</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; o) { <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a2a59cf024e571ecddb719beadca6aa5e">_o</a> = o ; }
<a name="l00029"></a>00029     
<a name="l00030"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ab6e54400eb78cdb78e8f4c53063f863b">00030</a>     <a class="code" href="namespace_d_d4hep.html#ac2a70e722b33dc7ddaa20db8954ac836">long64</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ab6e54400eb78cdb78e8f4c53063f863b" title="The id of this surface.">VolSurfaceBase::id</a>()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ab8b2a71397c0d4c0be2683aabb4e7882">_id</a> ; } 
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a32c932ec7f8a44321c9ea07ac56ab259">00032</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_surface_type.html">SurfaceType</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a32c932ec7f8a44321c9ea07ac56ab259">VolSurfaceBase::type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a> ; }
<a name="l00033"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">00033</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">VolSurfaceBase::u</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a15a2648f8b9ead47a28826e4ad0cc6c7">_u</a> ; }
<a name="l00034"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">00034</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">VolSurfaceBase::v</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point  )<span class="keyword"> const </span>{ point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ;  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a> ; }
<a name="l00035"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61">00035</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61" title="Access to the normal direction at the given point.">VolSurfaceBase::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a9371dc34ec00ff652bc4e0ae1423364c">_n</a> ; }
<a name="l00036"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">00036</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">VolSurfaceBase::origin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a2a59cf024e571ecddb719beadca6aa5e">_o</a> ;}
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aa5a6ee5edfdab58a13282beaef1331d4">00038</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aa5a6ee5edfdab58a13282beaef1331d4">VolSurfaceBase::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00039"></a>00039 
<a name="l00040"></a>00040       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> p = point - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() ;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042       <span class="comment">// create new orthogonal unit vectors</span>
<a name="l00043"></a>00043       <span class="comment">// FIXME: these vectors should be cached really ... </span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045       <span class="keywordtype">double</span> uv = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>() * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>() ;
<a name="l00046"></a>00046       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> uprime = ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>() - uv * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>() ).unit() ; 
<a name="l00047"></a>00047       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> vprime = ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>() - uv * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>() ).unit() ; 
<a name="l00048"></a>00048       <span class="keywordtype">double</span> uup = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>() * uprime ;
<a name="l00049"></a>00049       <span class="keywordtype">double</span> vvp = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>() * vprime ;
<a name="l00050"></a>00050       
<a name="l00051"></a>00051       <span class="keywordflow">return</span>  <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>(   p*uprime / uup ,  p*vprime / vvp ) ;
<a name="l00052"></a>00052     }
<a name="l00053"></a>00053     
<a name="l00054"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a62f5625f6f620535765193e97990fb1d">00054</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a62f5625f6f620535765193e97990fb1d">VolSurfaceBase::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00055"></a>00055 
<a name="l00056"></a>00056       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">g</a> = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() + point[0] * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>() + point[1] * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>() ;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058       <span class="keywordflow">return</span> g ;
<a name="l00059"></a>00059     }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a55f7258fad63f0224e7f5db301596baf">00061</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a55f7258fad63f0224e7f5db301596baf" title="Access to the material in opposite direction of the normal.">VolSurfaceBase::innerMaterial</a>()<span class="keyword"> const</span>{  <span class="keywordflow">return</span>  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#abfa00728ddc6fc977fb9d297038448c2">_innerMat</a> ;  }
<a name="l00062"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a26269d37153a91b4f23ea05b97504ab4">00062</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a26269d37153a91b4f23ea05b97504ab4" title="Access to the material in direction of the normal.">VolSurfaceBase::outerMaterial</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span>  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a3745bfba5f2d3b296e4f628c399faa39">_outerMat</a>  ; }
<a name="l00063"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad47a7a1236d529ba5263bc5bf9bd3fbc">00063</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad47a7a1236d529ba5263bc5bf9bd3fbc">VolSurfaceBase::innerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a50793721953f298992a3c98f3b77053d">_th_i</a> ; }
<a name="l00064"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a2b6e77c50e5b060711b9fcae604d5864">00064</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a2b6e77c50e5b060711b9fcae604d5864">VolSurfaceBase::outerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ab60dbb9ad72a790cbfa119edaa225e36">_th_o</a> ; }
<a name="l00065"></a>00065     
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a11c8c2074c8f0e4af494aa6802be9372">00067</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a11c8c2074c8f0e4af494aa6802be9372">VolSurfaceBase::length_along_u</a>()<span class="keyword"> const </span>{
<a name="l00068"></a>00068       
<a name="l00069"></a>00069       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; o = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() ;
<a name="l00070"></a>00070       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; u_val = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>( o ) ;      
<a name="l00071"></a>00071       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>  <a class="code" href="namespacedd4hep.html#a7ca6a7ec6a20ddb5678bd46c47996d26">um</a> = -1. * u_val ;
<a name="l00072"></a>00072       
<a name="l00073"></a>00073       <span class="keywordtype">double</span> dist_p = 0. ;
<a name="l00074"></a>00074       <span class="keywordtype">double</span> dist_m = 0. ;
<a name="l00075"></a>00075       
<a name="l00076"></a>00076 
<a name="l00077"></a>00077       <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : o =  &quot; &lt;&lt; o &lt;&lt; &quot; u = &quot; &lt;&lt;    this-&gt;u( o ) </span>
<a name="l00078"></a>00078       <span class="comment">//                &lt;&lt; &quot; -u = &quot; &lt;&lt; um &lt;&lt; std::endl ;</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081       <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;Contains( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ){
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         dist_p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00084"></a>00084                                                               const_cast&lt;double*&gt; ( u_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ) ;
<a name="l00085"></a>00085         dist_m = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00086"></a>00086                                                               const_cast&lt;double*&gt; ( um.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>()      ) ) ;
<a name="l00087"></a>00087         
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00090"></a>00090         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00091"></a>00091         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00092"></a>00092         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00093"></a>00093         
<a name="l00094"></a>00094 
<a name="l00095"></a>00095       } <span class="keywordflow">else</span>{
<a name="l00096"></a>00096 
<a name="l00097"></a>00097         dist_p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromOutside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00098"></a>00098                                                                const_cast&lt;double*&gt; ( u_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ) ;
<a name="l00099"></a>00099         dist_m = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromOutside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00100"></a>00100                                                                const_cast&lt;double*&gt; ( um.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>()      ) ) ;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         dist_p *= 1.0001 ;
<a name="l00103"></a>00103         dist_m *= 1.0001 ;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00106"></a>00106         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00107"></a>00107         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00108"></a>00108         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> o_1 = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() + dist_p * u_val ;
<a name="l00111"></a>00111         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> o_2 = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() + dist_m * um ;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         dist_p += <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_1.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00114"></a>00114                                                         const_cast&lt;double*&gt; ( u_val.const_array() ) ) ;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         dist_m += <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_2.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00117"></a>00117                                                         const_cast&lt;double*&gt; ( um.array()      ) ) ;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00120"></a>00120         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00121"></a>00121         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00122"></a>00122         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124         
<a name="l00125"></a>00125       <span class="keywordflow">return</span> dist_p + dist_m ;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129     
<a name="l00130"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a28732fc0788f9f53c3811303b852b470">00130</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a28732fc0788f9f53c3811303b852b470">VolSurfaceBase::length_along_v</a>()<span class="keyword"> const </span>{
<a name="l00131"></a>00131 
<a name="l00132"></a>00132       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; o = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() ;
<a name="l00133"></a>00133       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; v_val = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>( o ) ;      
<a name="l00134"></a>00134       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>  vm = -1. * v_val ;
<a name="l00135"></a>00135       
<a name="l00136"></a>00136       <span class="keywordtype">double</span> dist_p = 0. ;
<a name="l00137"></a>00137       <span class="keywordtype">double</span> dist_m = 0. ;
<a name="l00138"></a>00138       
<a name="l00139"></a>00139 
<a name="l00140"></a>00140       <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : o =  &quot; &lt;&lt; o &lt;&lt; &quot; u = &quot; &lt;&lt;    this-&gt;u( o ) </span>
<a name="l00141"></a>00141       <span class="comment">//                &lt;&lt; &quot; -u = &quot; &lt;&lt; vm &lt;&lt; std::endl ;</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144       <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;Contains( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ){
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         dist_p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00147"></a>00147                                                               const_cast&lt;double*&gt; ( v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ) ;
<a name="l00148"></a>00148         dist_m = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00149"></a>00149                                                               const_cast&lt;double*&gt; ( vm.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>()      ) ) ;
<a name="l00150"></a>00150         
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00153"></a>00153         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00154"></a>00154         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00155"></a>00155         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00156"></a>00156         
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       } <span class="keywordflow">else</span>{
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         dist_p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromOutside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00161"></a>00161                                                                const_cast&lt;double*&gt; ( v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ) ;
<a name="l00162"></a>00162         dist_m = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromOutside( const_cast&lt;double*&gt; ( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00163"></a>00163                                                                const_cast&lt;double*&gt; ( vm.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>()      ) ) ;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         dist_p *= 1.0001 ;
<a name="l00166"></a>00166         dist_m *= 1.0001 ;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00169"></a>00169         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00170"></a>00170         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00171"></a>00171         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> o_1 = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() + dist_p * v_val ;
<a name="l00174"></a>00174         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> o_2 = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() + dist_m * vm ;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         dist_p += <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_1.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00177"></a>00177                                                         const_cast&lt;double*&gt; ( v_val.const_array() ) ) ;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         dist_m += <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_2.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00180"></a>00180                                                         const_cast&lt;double*&gt; ( vm.array()      ) ) ;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="comment">// std::cout &lt;&lt; &quot; VolSurfaceBase::length_along_u() : shape contains(o)  =  &quot; &lt;&lt; volume()-&gt;GetShape()-&gt;Contains( o.const_array() )</span>
<a name="l00183"></a>00183         <span class="comment">//        &lt;&lt; &quot; dist_p &quot; &lt;&lt;    dist_p</span>
<a name="l00184"></a>00184         <span class="comment">//        &lt;&lt; &quot; dist_m &quot; &lt;&lt;    dist_m</span>
<a name="l00185"></a>00185         <span class="comment">//        &lt;&lt; std::endl ;</span>
<a name="l00186"></a>00186       }
<a name="l00187"></a>00187         
<a name="l00188"></a>00188       <span class="keywordflow">return</span> dist_p + dist_m ;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191     
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afb85bf6e8e6b87fb52e67e26609b1048">00193</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afb85bf6e8e6b87fb52e67e26609b1048">VolSurfaceBase::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const  </span>{  point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> 1.e99 ; }
<a name="l00194"></a>00194 
<a name="l00196"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aae8b494969fd257e4aa3e5b3d80cebb8">00196</a>     <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aae8b494969fd257e4aa3e5b3d80cebb8" title="Checks if the given point lies within the surface.">VolSurfaceBase::insideBounds</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point, <span class="keywordtype">double</span> epsilon)<span class="keyword"> const </span>{
<a name="l00197"></a>00197       
<a name="l00198"></a>00198 <span class="preprocessor">#if 0</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>      <span class="keywordtype">double</span> dist = std::abs ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afb85bf6e8e6b87fb52e67e26609b1048">distance</a>( point ) ) ;
<a name="l00200"></a>00200       
<a name="l00201"></a>00201       <span class="keywordtype">bool</span> inShape = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;Contains( point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ;
<a name="l00202"></a>00202       
<a name="l00203"></a>00203       std::cout &lt;&lt; <span class="stringliteral">&quot; ** Surface::insideBound( &quot;</span> &lt;&lt; point &lt;&lt; <span class="stringliteral">&quot; ) - distance = &quot;</span> &lt;&lt; dist 
<a name="l00204"></a>00204                 &lt;&lt; <span class="stringliteral">&quot; origin = &quot;</span> &lt;&lt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() &lt;&lt; <span class="stringliteral">&quot; normal = &quot;</span> &lt;&lt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61" title="Access to the normal direction at the given point.">normal</a>() 
<a name="l00205"></a>00205                 &lt;&lt; <span class="stringliteral">&quot; p * n = &quot;</span> &lt;&lt; point * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61" title="Access to the normal direction at the given point.">normal</a>() 
<a name="l00206"></a>00206                 &lt;&lt; <span class="stringliteral">&quot; isInShape : &quot;</span> &lt;&lt; inShape &lt;&lt; std::endl ;
<a name="l00207"></a>00207         
<a name="l00208"></a>00208       <span class="keywordflow">return</span> dist &lt; epsilon &amp;&amp; inShape ;
<a name="l00209"></a>00209 <span class="preprocessor">#else</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>        
<a name="l00211"></a>00211       <span class="comment">//fixme: older versions of ROOT (~&lt;5.34.10 ) take a non const pointer as argument - therefore use a const cast here for the time being ...</span>
<a name="l00212"></a>00212       <span class="keywordflow">return</span> ( std::abs ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afb85bf6e8e6b87fb52e67e26609b1048">distance</a>( point ) ) &lt; epsilon )  &amp;&amp;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad07cf1518f472a2b5b99d28f7f60b889" title="the volume to which this surface is attached.">volume</a>()-&gt;GetShape()-&gt;Contains( const_cast&lt;double*&gt; (point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() )  ) ; 
<a name="l00213"></a>00213 <span class="preprocessor">#endif</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span> 
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad0863cf8ceb6a443a048fe89cdc79f26">00218</a>     std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad0863cf8ceb6a443a048fe89cdc79f26">VolSurfaceBase::getLines</a>(<span class="keywordtype">unsigned</span> ) {
<a name="l00219"></a>00219       <span class="comment">// dummy implementation returning empty set</span>
<a name="l00220"></a>00220       std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt;  lines ;
<a name="l00221"></a>00221       <span class="keywordflow">return</span> lines ;
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">//===================================================================</span>
<a name="l00225"></a>00225     <span class="comment">// simple wrapper methods forwarding the call to the implementation object</span>
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2f65703996e3212715d994f03afa2242">00227</a>     <a class="code" href="namespace_d_d4hep.html#ac2a70e722b33dc7ddaa20db8954ac836">long64</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2f65703996e3212715d994f03afa2242" title="The id of this surface - always 0 for VolSurfaces.">VolSurface::id</a>()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ab6e54400eb78cdb78e8f4c53063f863b" title="The id of this surface.">id</a>() ; } 
<a name="l00228"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a3911ecafb91850168cadebc3ab2d5092">00228</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_surface_type.html">SurfaceType</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a3911ecafb91850168cadebc3ab2d5092">VolSurface::type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a32c932ec7f8a44321c9ea07ac56ab259">type</a>() ; }
<a name="l00229"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a23fdeba39bcffea350b53dcac8b3d0">00229</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a23fdeba39bcffea350b53dcac8b3d0">VolSurface::u</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a6b72381e54cf0c94ab56db4bdbc8b4a4">u</a>(point) ; }
<a name="l00230"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">00230</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">VolSurface::v</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point  )<span class="keyword"> const </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>(point) ; }
<a name="l00231"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2c5a55647d8f69637f4fc8d88bc70b67">00231</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2c5a55647d8f69637f4fc8d88bc70b67" title="Access to the normal direction at the given point.">VolSurface::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61" title="Access to the normal direction at the given point.">normal</a>(point) ; }
<a name="l00232"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a4be2b8d1ebddf2ac394a55efc28a2e6e">00232</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a4be2b8d1ebddf2ac394a55efc28a2e6e">VolSurface::origin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() ;}
<a name="l00233"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aa4251b5a2eb3f18a84e7b369929b6ba3">00233</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aa4251b5a2eb3f18a84e7b369929b6ba3">VolSurface::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aa5a6ee5edfdab58a13282beaef1331d4">globalToLocal</a>( point ) ; }
<a name="l00234"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a784a48baa6fa269f2c626acce19f1154">00234</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a784a48baa6fa269f2c626acce19f1154">VolSurface::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a62f5625f6f620535765193e97990fb1d">localToGlobal</a>( point) ; }
<a name="l00235"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a9f25046b9bac451dd240aa7b020d704a">00235</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a9f25046b9bac451dd240aa7b020d704a" title="Access to the material in opposite direction of the normal.">VolSurface::innerMaterial</a>()<span class="keyword"> const</span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a55f7258fad63f0224e7f5db301596baf" title="Access to the material in opposite direction of the normal.">innerMaterial</a>() ; }
<a name="l00236"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a65195963a086380a08fb14762108bad2">00236</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a65195963a086380a08fb14762108bad2" title="Access to the material in direction of the normal.">VolSurface::outerMaterial</a>()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a26269d37153a91b4f23ea05b97504ab4" title="Access to the material in direction of the normal.">outerMaterial</a>()  ; }
<a name="l00237"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a21b75812c52fa387e58ce0ac7a25aaca">00237</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a21b75812c52fa387e58ce0ac7a25aaca">VolSurface::innerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad47a7a1236d529ba5263bc5bf9bd3fbc">innerThickness</a>() ; }
<a name="l00238"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#abf78c6b50d2959a7e1f50ed36fc759f6">00238</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#abf78c6b50d2959a7e1f50ed36fc759f6">VolSurface::outerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a2b6e77c50e5b060711b9fcae604d5864">outerThickness</a>() ; }
<a name="l00239"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#ab4c1720db7c0170646211f26855ee38e">00239</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#ab4c1720db7c0170646211f26855ee38e">VolSurface::length_along_u</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a11c8c2074c8f0e4af494aa6802be9372">length_along_u</a>() ; }
<a name="l00240"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#acf14d37efeb8c9baaeba295f9e0fa38f">00240</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#acf14d37efeb8c9baaeba295f9e0fa38f">VolSurface::length_along_v</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a28732fc0788f9f53c3811303b852b470">length_along_v</a>() ; }
<a name="l00241"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aeabe1f73edf8b917bede275fb8f2d4a3">00241</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aeabe1f73edf8b917bede275fb8f2d4a3">VolSurface::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const  </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afb85bf6e8e6b87fb52e67e26609b1048">distance</a>( point ) ; }
<a name="l00242"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a3d39ebb8b0be132e4141cb9ea650a6">00242</a>     <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a3d39ebb8b0be132e4141cb9ea650a6" title="Checks if the given point lies within the surface.">VolSurface::insideBounds</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point, <span class="keywordtype">double</span> epsilon)<span class="keyword"> const </span>{
<a name="l00243"></a>00243       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#aae8b494969fd257e4aa3e5b3d80cebb8" title="Checks if the given point lies within the surface.">insideBounds</a>( point, epsilon ) ; 
<a name="l00244"></a>00244     }
<a name="l00245"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a0800bcb853b43a688721247dd4031122">00245</a>     std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a0800bcb853b43a688721247dd4031122">VolSurface::getLines</a>(<span class="keywordtype">unsigned</span> nMax) {
<a name="l00246"></a>00246       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a434add1326a87d6d6e5ee0209777cd45">_surf</a>-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#ad0863cf8ceb6a443a048fe89cdc79f26">getLines</a>(nMax) ;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="comment">//===================================================================</span>
<a name="l00250"></a>00250 
<a name="l00252"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_plane_impl.html#ad75ba6e93463cf8ce312d312111c8391">00252</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_plane_impl.html#ad75ba6e93463cf8ce312d312111c8391">VolPlaneImpl::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{
<a name="l00253"></a>00253       <span class="keywordflow">return</span> ( point - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>() ) *  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0689bccd5a024798609f3ce1b39c7d61" title="Access to the normal direction at the given point.">normal</a>()  ;
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255    <span class="comment">//======================================================================================================</span>
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#ac5d085d722bab6fe924dcd0bc58d0874">00257</a>     <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a9a2fc6a4cef827e0636f7591add7f73b" title="default c&amp;#39;tor">VolCylinderImpl::VolCylinderImpl</a>( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Geometry::Volume</a> vol, <a class="code" href="class_d_d_surfaces_1_1_surface_type.html">SurfaceType</a> typ, 
<a name="l00258"></a>00258                                       <span class="keywordtype">double</span> thickness_inner ,<span class="keywordtype">double</span> thickness_outer,  <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> o ) :
<a name="l00259"></a>00259 
<a name="l00260"></a>00260       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html">VolSurfaceBase</a>(typ, thickness_inner, thickness_outer, <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , o , vol, 0) {
<a name="l00261"></a>00261       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> v_val( 0., 0., 1. ) ;
<a name="l00262"></a>00262       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> o_rphi( o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() , o.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() , 0. ) ;
<a name="l00263"></a>00263       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> n =  o_rphi.unit() ; 
<a name="l00264"></a>00264       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> u_val = v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#af5442c28fbaf25088d92faea39ad8fee">cross</a>( n ) ;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8a39b98345cf8bb2ea7912b3974552e9" title="setter for daughter classes">setU</a>( u_val ) ;
<a name="l00267"></a>00267       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a032025d40e5fee926713517ae36f5d4b" title="setter for daughter classes">setV</a>( v_val ) ;
<a name="l00268"></a>00268       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a1ccc4ac2bd7ff9293b01798844d243e1" title="setter for daughter classes">setNormal</a>( n ) ;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051ac902bc6c754d9eaeb6a128c484340990">SurfaceType::Plane</a>    , <span class="keyword">false</span> ) ;
<a name="l00271"></a>00271       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051ab7a40aada670ad2c3f61c4c084c996da">SurfaceType::Cylinder</a> , <span class="keyword">true</span> ) ;
<a name="l00272"></a>00272       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051a6c977d222ddf332875c75f8e1eab4fcf">SurfaceType::Cone</a>     , <span class="keyword">false</span> ) ;
<a name="l00273"></a>00273       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aaf82c50cdbb7f1f896995431da719003">checkParallelToZ</a>( *<span class="keyword">this</span> ) ;
<a name="l00274"></a>00274       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a9c98b2758bce1af96aa487bb0e131f6b">checkOrthogonalToZ</a>( *<span class="keyword">this</span> ) ;
<a name="l00275"></a>00275     }      
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a7c2990e721f48f65bd4fda4cfd00c976">00277</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a7c2990e721f48f65bd4fda4cfd00c976">VolCylinderImpl::u</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> n( 1. , point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() , 0. , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aa9467dc445dfa66633113f4d17dd3be8">Vector3D::cylindrical</a> ) ;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a0dd53eec9381d83d0632329223d0b24b">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#af5442c28fbaf25088d92faea39ad8fee">cross</a>( n ) ; 
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     
<a name="l00284"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a1863142729883b2e20c78dadabd04927">00284</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a1863142729883b2e20c78dadabd04927">VolCylinderImpl::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l00285"></a>00285 
<a name="l00286"></a>00286       <span class="comment">// normal is just given by phi of the point </span>
<a name="l00287"></a>00287       <span class="keywordflow">return</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>( 1. , point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() , 0. , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aa9467dc445dfa66633113f4d17dd3be8">Vector3D::cylindrical</a> ) ;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a66cd91cef2963fa1d1495d4764e2d94f">00290</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#a66cd91cef2963fa1d1495d4764e2d94f">VolCylinderImpl::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00291"></a>00291       
<a name="l00292"></a>00292       <span class="comment">// cylinder is parallel to v here so u is Z and v is r *Phi</span>
<a name="l00293"></a>00293       <span class="keywordtype">double</span> phi = point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() ;
<a name="l00294"></a>00294       
<a name="l00295"></a>00295       <span class="keywordflow">while</span>( phi &lt; -<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi += 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00296"></a>00296       <span class="keywordflow">while</span>( phi &gt;  <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi -= 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00297"></a>00297       
<a name="l00298"></a>00298       <span class="keywordflow">return</span>  <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().rho() * phi, point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ) ;
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     
<a name="l00301"></a>00301     
<a name="l00302"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#ae0918a43a874b96dc2f55506d4f509a2">00302</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#ae0918a43a874b96dc2f55506d4f509a2">VolCylinderImpl::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00303"></a>00303       
<a name="l00304"></a>00304       <span class="keywordtype">double</span> z = point.<a class="code" href="class_d_d_surfaces_1_1_vector2_d.html#a146ba717d65ee406f9fa799780e97974">v</a>() + <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ;
<a name="l00305"></a>00305       <span class="keywordtype">double</span> phi = point.<a class="code" href="class_d_d_surfaces_1_1_vector2_d.html#a5b394ade28f5c03eaa174902de6fe079">u</a>() / <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() + <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() ;
<a name="l00306"></a>00306       
<a name="l00307"></a>00307       <span class="keywordflow">while</span>( phi &lt; -<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi += 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00308"></a>00308       <span class="keywordflow">while</span>( phi &gt;  <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi -= 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00309"></a>00309       
<a name="l00310"></a>00310       <span class="keywordflow">return</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().rho() , phi, z  , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aa9467dc445dfa66633113f4d17dd3be8">Vector3D::cylindrical</a> )    ;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00315"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#adb7ecbd032387e6e2a2903251e66e490">00315</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cylinder_impl.html#adb7ecbd032387e6e2a2903251e66e490">VolCylinderImpl::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{
<a name="l00316"></a>00316       
<a name="l00317"></a>00317       <span class="keywordflow">return</span> point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>()  ;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     
<a name="l00320"></a>00320     <span class="comment">//================================================================================================================</span>
<a name="l00321"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#acdcb9ac446fc79054df650fa90a0d381">00321</a>     <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a53aac2e0c112ae12be098853a5b93d64" title="default c&amp;#39;tor">VolConeImpl::VolConeImpl</a>( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Geometry::Volume</a> vol, <a class="code" href="class_d_d_surfaces_1_1_surface_type.html">SurfaceType</a> typ, 
<a name="l00322"></a>00322                               <span class="keywordtype">double</span> thickness_inner ,<span class="keywordtype">double</span> thickness_outer, <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> v_val,  <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> o_val ) :
<a name="l00323"></a>00323       
<a name="l00324"></a>00324       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html">VolSurfaceBase</a>(typ, thickness_inner, thickness_outer, <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , v_val ,  <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , vol, 0) {
<a name="l00325"></a>00325 
<a name="l00326"></a>00326       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> o_rphi( o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() , o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() , 0. ) ;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328       <span class="comment">// sanity check: v and o have to have a common phi</span>
<a name="l00329"></a>00329       <span class="keywordtype">double</span> dphi = v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() - o_rphi.phi() ;
<a name="l00330"></a>00330       <span class="keywordflow">while</span>( dphi &lt; -<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) dphi += 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00331"></a>00331       <span class="keywordflow">while</span>( dphi &gt;  <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) dphi -= 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333       <span class="keywordflow">if</span>( std::fabs( dphi ) &gt; 1e-6 ){
<a name="l00334"></a>00334         std::stringstream sst ; sst &lt;&lt; <span class="stringliteral">&quot;VolConeImpl::VolConeImpl() - incompatibel vector v and o given &quot;</span> 
<a name="l00335"></a>00335                                     &lt;&lt; v_val &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; o_val ;
<a name="l00336"></a>00336         <span class="keywordflow">throw</span> std::runtime_error( sst.str() ) ;
<a name="l00337"></a>00337       }
<a name="l00338"></a>00338       
<a name="l00339"></a>00339       <span class="keywordtype">double</span> theta = v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> n( 1. , v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() , ( theta + <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2. ) , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a2c73305f5aef051f55f33b721a68b660">Vector3D::spherical</a> ) ;
<a name="l00342"></a>00342       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> u_val = v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#af5442c28fbaf25088d92faea39ad8fee">cross</a>( n ) ;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8a39b98345cf8bb2ea7912b3974552e9" title="setter for daughter classes">setU</a>( u_val ) ;
<a name="l00345"></a>00345       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a3dc33b9f3661403fbeeaeb787e71d247" title="setter for daughter classes">setOrigin</a>( o_rphi ) ;
<a name="l00346"></a>00346       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a1ccc4ac2bd7ff9293b01798844d243e1" title="setter for daughter classes">setNormal</a>( n ) ;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348       <span class="comment">// set helper variable for faster computations (describe cone with tip at origin)</span>
<a name="l00349"></a>00349       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a5f020df8481dcc088af7a02632f03ae2">_tanTheta</a> = std::tan( theta ) ; 
<a name="l00350"></a>00350       <span class="keywordtype">double</span> tipoffset = o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() / <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a5f020df8481dcc088af7a02632f03ae2">_tanTheta</a> ; <span class="comment">// distance from tip to origin.z()</span>
<a name="l00351"></a>00351       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae42d0cc1db6c972c012f3177cdeb935b">_ztip</a>     = o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>()  - tipoffset ;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353       <span class="keywordtype">double</span> dist_p = vol-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00354"></a>00354                                                        const_cast&lt;double*&gt; ( v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) ) ;
<a name="l00355"></a>00355       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> vm = -1. * v_val ;
<a name="l00356"></a>00356       <span class="keywordtype">double</span> dist_m = vol-&gt;GetShape()-&gt;DistFromInside( const_cast&lt;double*&gt; ( o_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>() ) , 
<a name="l00357"></a>00357                                                             const_cast&lt;double*&gt; ( vm.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>()      ) ) ;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359       <span class="keywordtype">double</span> costh = std::cos( theta) ;
<a name="l00360"></a>00360       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ad204cc67411301eaa8f135430392a55c">_zt0</a> = tipoffset - dist_m *  costh ;           
<a name="l00361"></a>00361       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#aa9466fe65e7238bf90ec604132ea1825">_zt1</a> = tipoffset + dist_p *  costh ;     
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 
<a name="l00364"></a>00364       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051ac902bc6c754d9eaeb6a128c484340990">SurfaceType::Plane</a>   , <span class="keyword">false</span> ) ;
<a name="l00365"></a>00365       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051ab7a40aada670ad2c3f61c4c084c996da">SurfaceType::Cylinder</a>, <span class="keyword">false</span> ) ;
<a name="l00366"></a>00366       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051a6c977d222ddf332875c75f8e1eab4fcf">SurfaceType::Cone</a>    , <span class="keyword">true</span> ) ;
<a name="l00367"></a>00367       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051aedf49a5300dce095439f45b9390faa5f">SurfaceType::ParallelToZ</a>, <span class="keyword">true</span> ) ;
<a name="l00368"></a>00368       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a7a377fec84bd131b42eb0fb672585850">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aac5ebe16c0c230033f68c4e3f5a349af" title="set the given peorperty">setProperty</a>( <a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a2e946294c5368a34e227be2b17e73051ac72842b667410b4ce6e55451902460ee">SurfaceType::OrthogonalToZ</a>, <span class="keyword">false</span> ) ;
<a name="l00369"></a>00369     }      
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     
<a name="l00372"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a305c9b455b4e958dbb511f9136ecaf8b">00372</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a305c9b455b4e958dbb511f9136ecaf8b">VolConeImpl::v</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l00373"></a>00373       <span class="comment">// just take phi from point</span>
<a name="l00374"></a>00374       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> av( 1. , point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() , <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a2c73305f5aef051f55f33b721a68b660">Vector3D::spherical</a> ) ;
<a name="l00375"></a>00375       <span class="keywordflow">return</span> av ; 
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377     
<a name="l00378"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae3f99967ddeb67c1ad76414cea068395">00378</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae3f99967ddeb67c1ad76414cea068395">VolConeImpl::u</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l00379"></a>00379       <span class="comment">// compute from v X n </span>
<a name="l00380"></a>00380       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; av = this-&gt;<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a305c9b455b4e958dbb511f9136ecaf8b">v</a>( point ) ;
<a name="l00381"></a>00381       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; n = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#aea04fc521c39ffc8e97ae3f700533e7a">normal</a>( point ) ;
<a name="l00382"></a>00382       <span class="keywordflow">return</span> av.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#af5442c28fbaf25088d92faea39ad8fee">cross</a>( n ) ; 
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     
<a name="l00385"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#aea04fc521c39ffc8e97ae3f700533e7a">00385</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#aea04fc521c39ffc8e97ae3f700533e7a">VolConeImpl::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l00386"></a>00386       <span class="comment">// just take phi from point</span>
<a name="l00387"></a>00387       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> n( 1. , point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() , <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a9371dc34ec00ff652bc4e0ae1423364c">_n</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a2c73305f5aef051f55f33b721a68b660">Vector3D::spherical</a> ) ;
<a name="l00388"></a>00388       <span class="keywordflow">return</span> n ;
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00391"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a427ac9a8bccf658a2161b21d6ae1267f">00391</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a427ac9a8bccf658a2161b21d6ae1267f">VolConeImpl::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00392"></a>00392       
<a name="l00393"></a>00393       <span class="comment">// cone is parallel to z here, so u is r *Phi and v is &quot;along&quot; z</span>
<a name="l00394"></a>00394       <span class="keywordtype">double</span> phi = point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() ;
<a name="l00395"></a>00395       
<a name="l00396"></a>00396       <span class="keywordflow">while</span>( phi &lt; -<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi += 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00397"></a>00397       <span class="keywordflow">while</span>( phi &gt;  <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi -= 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00398"></a>00398       
<a name="l00399"></a>00399 
<a name="l00400"></a>00400       <span class="keywordtype">double</span> r = ( point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae42d0cc1db6c972c012f3177cdeb935b">_ztip</a> ) * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a5f020df8481dcc088af7a02632f03ae2">_tanTheta</a> ;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402       <span class="keywordflow">return</span>  <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>(  r*phi, ( point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ) / cos( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ) ) ;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     
<a name="l00405"></a>00405     
<a name="l00406"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a1428d72f28ed90522cdaa6bb4d855dce">00406</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a1428d72f28ed90522cdaa6bb4d855dce">VolConeImpl::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00407"></a>00407       
<a name="l00408"></a>00408       <span class="keywordtype">double</span> z = point.<a class="code" href="class_d_d_surfaces_1_1_vector2_d.html#a146ba717d65ee406f9fa799780e97974">v</a>() * cos( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ) + <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ;
<a name="l00409"></a>00409       
<a name="l00410"></a>00410       <span class="keywordtype">double</span> r =  ( z - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae42d0cc1db6c972c012f3177cdeb935b">_ztip</a> ) * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a5f020df8481dcc088af7a02632f03ae2">_tanTheta</a> ;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412       <span class="keywordtype">double</span> phi = point.<a class="code" href="class_d_d_surfaces_1_1_vector2_d.html#a5b394ade28f5c03eaa174902de6fe079">u</a>() / r + <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#ae2bc1c0c08626818eda33bd2e7c6ace5">phi</a>() ;
<a name="l00413"></a>00413       
<a name="l00414"></a>00414       <span class="keywordflow">while</span>( phi &lt; -<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi += 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00415"></a>00415       <span class="keywordflow">while</span>( phi &gt;  <a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ) phi -= 2.*<a class="code" href="_handle_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ;
<a name="l00416"></a>00416       
<a name="l00417"></a>00417       <span class="keywordflow">return</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>( r , phi, z  , <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aa9467dc445dfa66633113f4d17dd3be8">Vector3D::cylindrical</a> )    ;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00422"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a28c958945f374cc59491e7ac4850bbde">00422</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a28c958945f374cc59491e7ac4850bbde">VolConeImpl::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{
<a name="l00423"></a>00423 
<a name="l00424"></a>00424       <span class="comment">// // if the point is in the other hemispere we return the distance to origin </span>
<a name="l00425"></a>00425       <span class="comment">// // -&gt; this assumes that the cones do not cross the xy-plane ...</span>
<a name="l00426"></a>00426       <span class="comment">// // otherwise we get the distance to the mirrored part of the cone</span>
<a name="l00427"></a>00427       <span class="comment">// // needs more thought ..</span>
<a name="l00428"></a>00428       <span class="comment">// if( origin().z() * point.z() &lt; 0. ) </span>
<a name="l00429"></a>00429       <span class="comment">//        return point.r() ;</span>
<a name="l00430"></a>00430 
<a name="l00431"></a>00431       <span class="comment">//fixme: there are probably faster ways to compute this</span>
<a name="l00432"></a>00432       <span class="comment">// e.g by using the intercept theorem - tbd. ...</span>
<a name="l00433"></a>00433       <span class="comment">// const Vector2D&amp; lp = globalToLocal( point ) ;</span>
<a name="l00434"></a>00434       <span class="comment">// const Vector3D&amp; gp = localToGlobal( lp ) ;</span>
<a name="l00435"></a>00435 
<a name="l00436"></a>00436       <span class="comment">// Vector3D dz = point - gp ;</span>
<a name="l00437"></a>00437 
<a name="l00438"></a>00438       <span class="comment">//return dz * normal( point )   ;</span>
<a name="l00439"></a>00439 
<a name="l00440"></a>00440        <span class="keywordtype">double</span> zp = point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae42d0cc1db6c972c012f3177cdeb935b">_ztip</a> ;
<a name="l00441"></a>00441        <span class="keywordtype">double</span> r = point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() - zp * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a5f020df8481dcc088af7a02632f03ae2">_tanTheta</a> ;
<a name="l00442"></a>00442        <span class="keywordflow">return</span> r * std::cos( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#afc7d4d47e7fa6c7a8c87a52e15177bdb">_v</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ) ;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445     
<a name="l00447"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae644bf91eb0b033f16ac4d89d00dd080">00447</a>     std::vector&lt; std::pair&lt;DDSurfaces::Vector3D, DDSurfaces::Vector3D&gt; &gt;  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#ae644bf91eb0b033f16ac4d89d00dd080" title="create outer bounding lines for the given symmetry of the polyhedron">VolConeImpl::getLines</a>(<span class="keywordtype">unsigned</span> nMax){
<a name="l00448"></a>00448       
<a name="l00449"></a>00449       std::vector&lt; std::pair&lt;DDSurfaces::Vector3D, DDSurfaces::Vector3D&gt; &gt;  lines ;
<a name="l00450"></a>00450       
<a name="l00451"></a>00451       lines.reserve( nMax ) ;
<a name="l00452"></a>00452       
<a name="l00453"></a>00453       <span class="keywordtype">double</span> theta = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_cone_impl.html#a305c9b455b4e958dbb511f9136ecaf8b">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l00454"></a>00454       <span class="keywordtype">double</span> half_length = 0.5 * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a28732fc0788f9f53c3811303b852b470">length_along_v</a>() * cos( theta ) ;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> zv( 0. , 0. , half_length ) ;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <span class="keywordtype">double</span> dr =  half_length * tan( theta ) ;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460       <span class="keywordtype">double</span> r0 = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() - dr ;  
<a name="l00461"></a>00461       <span class="keywordtype">double</span> r1 = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface_base.html#a8c0138c1595c6acbc94d5d7af57d468a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() + dr ;
<a name="l00462"></a>00462       
<a name="l00463"></a>00463 
<a name="l00464"></a>00464       <span class="keywordtype">unsigned</span> n = nMax / 4 ;
<a name="l00465"></a>00465       <span class="keywordtype">double</span> dPhi = 2.* ROOT::Math::Pi() / double( n ) ; 
<a name="l00466"></a>00466       
<a name="l00467"></a>00467       <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0 ; i &lt; n ; ++i ) {
<a name="l00468"></a>00468         
<a name="l00469"></a>00469         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> r0v0(  r0*sin(  i   *dPhi ) , r0*cos(  i   *dPhi )  , 0. ) ;
<a name="l00470"></a>00470         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> r0v1(  r0*sin( (i+1)*dPhi ) , r0*cos( (i+1)*dPhi )  , 0. ) ;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> r1v0(  r1*sin(  i   *dPhi ) , r1*cos(  i   *dPhi )  , 0. ) ;
<a name="l00473"></a>00473         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> r1v1(  r1*sin( (i+1)*dPhi ) , r1*cos( (i+1)*dPhi )  , 0. ) ;
<a name="l00474"></a>00474         
<a name="l00475"></a>00475         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl0 =  zv + r1v0 ;
<a name="l00476"></a>00476         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl1 =  zv + r1v1 ;
<a name="l00477"></a>00477         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl2 = -zv + r0v1  ;
<a name="l00478"></a>00478         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl3 = -zv + r0v0 ;
<a name="l00479"></a>00479         
<a name="l00480"></a>00480         lines.push_back( std::make_pair( pl0, pl1 ) ) ;
<a name="l00481"></a>00481         lines.push_back( std::make_pair( pl1, pl2 ) ) ;
<a name="l00482"></a>00482         lines.push_back( std::make_pair( pl2, pl3 ) ) ;
<a name="l00483"></a>00483         lines.push_back( std::make_pair( pl3, pl0 ) ) ;
<a name="l00484"></a>00484       } 
<a name="l00485"></a>00485       <span class="keywordflow">return</span> lines; 
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487     
<a name="l00488"></a>00488     <span class="comment">//================================================================================================================</span>
<a name="l00489"></a>00489     
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="struct_d_d4hep_1_1_d_d_rec_1_1_vol_surface_list.html#a7729277c83e494f147f21166220debd0">00491</a>     <a class="code" href="struct_d_d4hep_1_1_d_d_rec_1_1_vol_surface_list.html#a7729277c83e494f147f21166220debd0">VolSurfaceList::~VolSurfaceList</a>(){
<a name="l00492"></a>00492       <span class="comment">// // delete all surfaces attached to this volume</span>
<a name="l00493"></a>00493       <span class="comment">// for( VolSurfaceList::iterator i=begin(), n=end() ; i !=n ; ++i ) {</span>
<a name="l00494"></a>00494       <span class="comment">//   i-&gt;clear() ;</span>
<a name="l00495"></a>00495       <span class="comment">// }</span>
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497     <span class="comment">//=======================================================</span>
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface_list.html#a8ba1884b4e65fbd42703cb8059cb0fb2">00499</a>     <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface_list.html#a8ba1884b4e65fbd42703cb8059cb0fb2" title="d&amp;#39;tor deletes all owned surfaces">SurfaceList::~SurfaceList</a>(){
<a name="l00500"></a>00500       
<a name="l00501"></a>00501       <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface_list.html#a6eb49bbfb8b3b4f548dd9d52f0e0e507">_isOwner</a> ) {
<a name="l00502"></a>00502         <span class="comment">// delete all surfaces attached to this volume</span>
<a name="l00503"></a>00503         <span class="keywordflow">for</span>( SurfaceList::iterator i=begin(), n=end() ; i !=n ; ++i ) {
<a name="l00504"></a>00504           <span class="keyword">delete</span> (*i) ;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506       }
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="comment">//================================================================================================================</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     <a class="code" href="struct_d_d4hep_1_1_d_d_rec_1_1_vol_surface_list.html">VolSurfaceList</a>* <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a59c95bbf8cdb6547cfa3f9fa969d4031">volSurfaceList</a>( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">DetElement</a>&amp; det ) {
<a name="l00512"></a>00512 
<a name="l00513"></a>00513       
<a name="l00514"></a>00514       <a class="code" href="struct_d_d4hep_1_1_d_d_rec_1_1_vol_surface_list.html">VolSurfaceList</a>* <a class="code" href="classstd_1_1list.html">list</a> = 0 ;
<a name="l00515"></a>00515 
<a name="l00516"></a>00516       <span class="keywordflow">try</span> {
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         list = det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a5d801350ab0e5f8918785f3a95e0fb30" title="Access extension element by the type.">extension</a>&lt; <a class="code" href="struct_d_d4hep_1_1_d_d_rec_1_1_vol_surface_list.html">VolSurfaceList</a> &gt;() ;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520       } <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::runtime_error&amp; e){ 
<a name="l00521"></a>00521         
<a name="l00522"></a>00522         list = det.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a0ef6d28c7c6778cf0f42b77a71212699" title="Extend the detector element with an arbitrary structure accessible by the type.">addExtension</a>&lt;VolSurfaceList &gt;(  <span class="keyword">new</span> VolSurfaceList ) ; 
<a name="l00523"></a>00523       }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525       <span class="keywordflow">return</span> list ;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="comment">//======================================================================================================================</span>
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a7b23370837eb2d8876a1e18bb258fd3f">00531</a>     <span class="keywordtype">bool</span> <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a7b23370837eb2d8876a1e18bb258fd3f">findVolume</a>( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pv,  <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> theVol, std::list&lt; PlacedVolume &gt;&amp; volList ) {
<a name="l00532"></a>00532       
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       volList.push_back( pv ) ;
<a name="l00535"></a>00535       
<a name="l00536"></a>00536       <span class="comment">//   unsigned count = volList.size() ;</span>
<a name="l00537"></a>00537       <span class="comment">//   for(unsigned i=0 ; i &lt; count ; ++i) {</span>
<a name="l00538"></a>00538       <span class="comment">//        std::cout &lt;&lt; &quot; **&quot; ;</span>
<a name="l00539"></a>00539       <span class="comment">//   }</span>
<a name="l00540"></a>00540       <span class="comment">//   std::cout &lt;&lt; &quot; searching for volume: &quot; &lt;&lt; theVol.name() &lt;&lt; &quot; &quot; &lt;&lt; std::hex &lt;&lt; theVol.ptr() &lt;&lt; &quot;  &lt;-&gt; pv.volume : &quot;  &lt;&lt; pv.name() &lt;&lt; &quot; &quot; &lt;&lt;  pv.volume().ptr() </span>
<a name="l00541"></a>00541       <span class="comment">//                &lt;&lt; &quot; pv.volume().ptr() == theVol.ptr() &quot; &lt;&lt;  (pv.volume().ptr() == theVol.ptr() )</span>
<a name="l00542"></a>00542       <span class="comment">//                &lt;&lt; std::endl ;</span>
<a name="l00543"></a>00543       
<a name="l00544"></a>00544 
<a name="l00545"></a>00545       <span class="keywordflow">if</span>( pv.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html#a7896af4481e228014289900a8943a7da" title="Logical volume of this placement.">volume</a>().<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>() == theVol.<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>() ) { 
<a name="l00546"></a>00546         
<a name="l00547"></a>00547         <span class="keywordflow">return</span> true ;
<a name="l00548"></a>00548         
<a name="l00549"></a>00549       } <span class="keywordflow">else</span> {
<a name="l00550"></a>00550         
<a name="l00551"></a>00551         <span class="comment">//--------------------------------</span>
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="keyword">const</span> TGeoNode* node = pv.<a class="code" href="class_d_d4hep_1_1_handle.html#a51a7d12a15a2a18977a0036bc6435cc8" title="Access to the held object.">ptr</a>();
<a name="l00554"></a>00554         
<a name="l00555"></a>00555         <span class="keywordflow">if</span> ( !node ) {
<a name="l00556"></a>00556           
<a name="l00557"></a>00557           <span class="comment">//      std::cout &lt;&lt;  &quot; *** findVolume: Invalid  placement:  - node pointer Null for volume:  &quot; &lt;&lt; pv.name() &lt;&lt; std::endl ;</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559           <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;*** findVolume: Invalid  placement:  - node pointer Null ! &quot;</span> + std::string( pv.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>()  ) );
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561         <span class="comment">//      Volume vol = pv.volume();</span>
<a name="l00562"></a>00562         
<a name="l00563"></a>00563         <span class="comment">//      std::cout &lt;&lt; &quot;              ndau = &quot; &lt;&lt; node-&gt;GetNdaughters() &lt;&lt; std::endl ;</span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565         <span class="keywordflow">for</span> (Int_t idau = 0, ndau = node-&gt;GetNdaughters(); idau &lt; ndau; ++idau) {
<a name="l00566"></a>00566           
<a name="l00567"></a>00567           TGeoNode* daughter = node-&gt;GetDaughter(idau);
<a name="l00568"></a>00568           <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> placement( daughter );
<a name="l00569"></a>00569           
<a name="l00570"></a>00570           <span class="keywordflow">if</span> ( !placement.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html#ac13225b8f8408419cc0dd096f59cc934" title="Check if placement is properly instrumented.">data</a>() ) {
<a name="l00571"></a>00571             <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;*** findVolume: Invalid not instrumented placement:&quot;</span>+std::string(daughter-&gt;GetName())
<a name="l00572"></a>00572                                      +<span class="stringliteral">&quot; [Internal error -- bad detector constructor]&quot;</span>);
<a name="l00573"></a>00573           }
<a name="l00574"></a>00574           
<a name="l00575"></a>00575           <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pv_dau = <a class="code" href="group___d_d4_h_e_p___g_e_o_m_e_t_r_y.html#ga40af83be6718bb8828a3d83dc7f8c930" title="Default Ref_t definition describing named objects.">Ref_t</a>(daughter); <span class="comment">// why use a Ref_t here  ???</span>
<a name="l00576"></a>00576           
<a name="l00577"></a>00577           <span class="keywordflow">if</span>( <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a7b23370837eb2d8876a1e18bb258fd3f">findVolume</a>(  pv_dau , theVol , volList ) ) {
<a name="l00578"></a>00578             
<a name="l00579"></a>00579             <span class="comment">//      std::cout &lt;&lt; &quot;  ----- found in daughter volume !!!  &quot; &lt;&lt; std::hex &lt;&lt; pv_dau.volume().ptr() &lt;&lt; std::endl ;</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581             <span class="keywordflow">return</span> true ;
<a name="l00582"></a>00582           } 
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         <span class="comment">//  ------- not found:</span>
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         volList.pop_back() ;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         <span class="keywordflow">return</span> false ;
<a name="l00590"></a>00590         <span class="comment">//--------------------------------</span>
<a name="l00591"></a>00591 
<a name="l00592"></a>00592       }
<a name="l00593"></a>00593     } 
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="comment">//======================================================================================================================</span>
<a name="l00596"></a>00596 
<a name="l00597"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1a4cca5bac129f897331f1df355c75d0">00597</a>     <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a9cbdd49c7183347839f20c80c114f0b6" title="default c&amp;#39;tor">Surface::Surface</a>( <a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html" title="Handle class describing a detector element.">Geometry::DetElement</a> det, <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html">VolSurface</a> volSurf ) : _det( det) , _volSurf( volSurf ), 
<a name="l00598"></a>00598                                                                        _wtM(0) , _id( 0) , _type( _volSurf.type() )  {
<a name="l00599"></a>00599 
<a name="l00600"></a>00600       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aeee7cc15facd37699acda7146f540fe1">initialize</a>() ;
<a name="l00601"></a>00601     }      
<a name="l00602"></a>00602  
<a name="l00603"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a563f289fbf049099a6bd37433d853a53">00603</a>     <a class="code" href="namespace_d_d4hep.html#ac2a70e722b33dc7ddaa20db8954ac836">long64</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a563f289fbf049099a6bd37433d853a53" title="The id of this surface - corresponds to DetElement id.">Surface::id</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a14744685350bb3023c3e2efe02f8d707">_id</a> ; }
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ac2500033e175992484aba8956a27bdd6">00605</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_surface_type.html">SurfaceType</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ac2500033e175992484aba8956a27bdd6">Surface::type</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1abb4367c088376f8607c45f9faaddb8">_type</a> ; }
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">00607</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">Surface::u</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{ point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#abbf2e76e33b536bac67c387b860c1ff4">_u</a> ; }
<a name="l00608"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">00608</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">Surface::v</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a12656a8ed5ccc5a1993e1bacf9d4624b">_v</a> ; }
<a name="l00609"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1a4f7412be6079af165bb7a3b3e7770c">00609</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1a4f7412be6079af165bb7a3b3e7770c" title="Access to the normal direction at the given point.">Surface::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  point.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() ; <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a9191ee82058481753f4d5d5234415382">_n</a> ; }
<a name="l00610"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">00610</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">Surface::origin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> ;}
<a name="l00611"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a4efd4a2e74c6435916cef09328cc436c">00611</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a4efd4a2e74c6435916cef09328cc436c">Surface::innerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a21b75812c52fa387e58ce0ac7a25aaca">innerThickness</a>() ; }
<a name="l00612"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1f75aae21b3cfc2fca58a8e8a340703e">00612</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1f75aae21b3cfc2fca58a8e8a340703e">Surface::outerThickness</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#abf78c6b50d2959a7e1f50ed36fc759f6">outerThickness</a>() ; }
<a name="l00613"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a2b027f9ee36a0e5a791b0cfa30199389">00613</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a2b027f9ee36a0e5a791b0cfa30199389">Surface::length_along_u</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#ab4c1720db7c0170646211f26855ee38e">length_along_u</a>() ; }
<a name="l00614"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">00614</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">Surface::length_along_v</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#acf14d37efeb8c9baaeba295f9e0fa38f">length_along_v</a>() ; }
<a name="l00615"></a>00615 
<a name="l00618"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a923794ef06f1fb5364e68f60b99b7159">00618</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a923794ef06f1fb5364e68f60b99b7159" title="Access to the material in opposite direction of the normal.">Surface::innerMaterial</a>()<span class="keyword"> const </span>{
<a name="l00619"></a>00619       
<a name="l00620"></a>00620       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp; mat = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a9f25046b9bac451dd240aa7b020d704a" title="Access to the material in opposite direction of the normal.">innerMaterial</a>() ;
<a name="l00621"></a>00621       
<a name="l00622"></a>00622       <span class="keywordflow">if</span>( ! ( mat.<a class="code" href="class_d_d_surfaces_1_1_i_material.html#a3e5d3e85db97ff9edb25a073109a14b0" title="averaged proton number">Z</a>() &gt; 0 ) ) {
<a name="l00623"></a>00623         
<a name="l00624"></a>00624         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html">MaterialManager</a> matMgr ;
<a name="l00625"></a>00625         
<a name="l00626"></a>00626         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a4efd4a2e74c6435916cef09328cc436c">innerThickness</a>() * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a9191ee82058481753f4d5d5234415382">_n</a>  ;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="keyword">const</span> <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a69fdab2f851316d2b9e50956920359f7">MaterialVec</a>&amp; materials = matMgr.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html#a9e975753f152c9deb9c490e9222606c1">materialsBetween</a>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> , p  ) ;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a17eba889b8f154c12db6c82dd6769845" title="set the innerMaterial">setInnerMaterial</a>(  materials.size() &gt; 1  ? 
<a name="l00631"></a>00631                                     matMgr.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html#a44243f88b984a698c8b823885c439702">createAveragedMaterial</a>( materials ) :
<a name="l00632"></a>00632                                     materials[0].first  )  ;
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634       <span class="keywordflow">return</span>  mat ;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a8844d989cfc893e8fc5e34d05cb2e410">00637</a>     <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a8844d989cfc893e8fc5e34d05cb2e410" title="Access to the material in direction of the normal.">Surface::outerMaterial</a>()<span class="keyword"> const </span>{
<a name="l00638"></a>00638       
<a name="l00639"></a>00639       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_i_material.html">IMaterial</a>&amp; mat = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a65195963a086380a08fb14762108bad2" title="Access to the material in direction of the normal.">outerMaterial</a>() ;
<a name="l00640"></a>00640       
<a name="l00641"></a>00641       <span class="keywordflow">if</span>( ! ( mat.<a class="code" href="class_d_d_surfaces_1_1_i_material.html#a3e5d3e85db97ff9edb25a073109a14b0" title="averaged proton number">Z</a>() &gt; 0 ) ) {
<a name="l00642"></a>00642         
<a name="l00643"></a>00643         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html">MaterialManager</a> matMgr ;
<a name="l00644"></a>00644         
<a name="l00645"></a>00645         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> p = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1f75aae21b3cfc2fca58a8e8a340703e">outerThickness</a>() * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a9191ee82058481753f4d5d5234415382">_n</a>  ;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         <span class="keyword">const</span> <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a69fdab2f851316d2b9e50956920359f7">MaterialVec</a>&amp; materials = matMgr.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html#a9e975753f152c9deb9c490e9222606c1">materialsBetween</a>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> , p  ) ;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#af6a4ee6256e72d0b10e7ebfb54fc28da" title="set the outer Materal">setOuterMaterial</a>(  materials.size() &gt; 1  ? 
<a name="l00650"></a>00650                                     matMgr.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_material_manager.html#a44243f88b984a698c8b823885c439702">createAveragedMaterial</a>( materials ) :
<a name="l00651"></a>00651                                     materials[0].first  )  ;
<a name="l00652"></a>00652       }
<a name="l00653"></a>00653       <span class="keywordflow">return</span>  mat ;
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655       
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a3c42b99943d5670d31ee67a90bdbafbd">00657</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a3c42b99943d5670d31ee67a90bdbafbd">Surface::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> p = point - <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>() ;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       <span class="comment">// create new orthogonal unit vectors</span>
<a name="l00662"></a>00662       <span class="comment">// FIXME: these vectors should be cached really ... </span>
<a name="l00663"></a>00663 
<a name="l00664"></a>00664       <span class="keywordtype">double</span> uv = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">u</a>() * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">v</a>() ;
<a name="l00665"></a>00665       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> uprime = ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">u</a>() - uv * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">v</a>() ).unit() ; 
<a name="l00666"></a>00666       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> vprime = ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">v</a>() - uv * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">u</a>() ).unit() ; 
<a name="l00667"></a>00667       <span class="keywordtype">double</span> uup = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">u</a>() * uprime ;
<a name="l00668"></a>00668       <span class="keywordtype">double</span> vvp = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">v</a>() * vprime ;
<a name="l00669"></a>00669       
<a name="l00670"></a>00670       <span class="keywordflow">return</span>  <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>(   p*uprime / uup ,  p*vprime / vvp ) ;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     
<a name="l00674"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad5107e6eed2e092460a69530258b4852">00674</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad5107e6eed2e092460a69530258b4852">Surface::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="namespacedd4hep.html#a70d02ec06109b52625ae28861ff25d56">g</a> = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>() + point[0] * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#af08e3ae0be217b8bc54d9a447a66be03">u</a>() + point[1] * <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a76edfb105ebae153080713c99a310044">v</a>() ;
<a name="l00677"></a>00677       <span class="keywordflow">return</span> g ;
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 
<a name="l00681"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ab2b3a468ee678eb76912d659ddf404fc">00681</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ab2b3a468ee678eb76912d659ddf404fc">Surface::volumeOrigin</a>()<span class="keyword"> const </span>{ 
<a name="l00682"></a>00682 
<a name="l00683"></a>00683       <span class="keywordtype">double</span> o_array[3] ;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster    ( <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>() , o_array ) ;
<a name="l00686"></a>00686       
<a name="l00687"></a>00687       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> o(o_array) ;
<a name="l00688"></a>00688      
<a name="l00689"></a>00689       <span class="keywordflow">return</span> o ;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 
<a name="l00693"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a6c791cb45a57af72d629fc44ea208df4">00693</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a6c791cb45a57af72d629fc44ea208df4">Surface::distance</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{
<a name="l00694"></a>00694 
<a name="l00695"></a>00695       <span class="keywordtype">double</span> pa[3] ;
<a name="l00696"></a>00696       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , pa ) ;
<a name="l00697"></a>00697       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> localPoint( pa ) ;
<a name="l00698"></a>00698       
<a name="l00699"></a>00699       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aeabe1f73edf8b917bede275fb8f2d4a3">distance</a>( localPoint ) ;
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701       
<a name="l00702"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a2a86417b353cd25ee5bc96e8cc9dff2f">00702</a>     <span class="keywordtype">bool</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a2a86417b353cd25ee5bc96e8cc9dff2f" title="Checks if the given point lies within the surface.">Surface::insideBounds</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point, <span class="keywordtype">double</span> epsilon)<span class="keyword"> const </span>{
<a name="l00703"></a>00703 
<a name="l00704"></a>00704       <span class="keywordtype">double</span> pa[3] ;
<a name="l00705"></a>00705       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , pa ) ;
<a name="l00706"></a>00706       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> localPoint( pa ) ;
<a name="l00707"></a>00707       
<a name="l00708"></a>00708       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a3d39ebb8b0be132e4141cb9ea650a6" title="Checks if the given point lies within the surface.">insideBounds</a>( localPoint , epsilon) ;
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aeee7cc15facd37699acda7146f540fe1">00711</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aeee7cc15facd37699acda7146f540fe1">Surface::initialize</a>() {
<a name="l00712"></a>00712       
<a name="l00713"></a>00713       <span class="comment">// first we need to find the right volume for the local surface in the DetElement&apos;s volumes</span>
<a name="l00714"></a>00714       std::list&lt; PlacedVolume &gt; pVList ;
<a name="l00715"></a>00715       <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pv = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a41a9849864ae0888964242798aaaa8e8">_det</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a32a39fbab7eeb59dd4ad2fc807e0b66d" title="Access to the physical volume of this detector element.">placement</a>() ;
<a name="l00716"></a>00716       <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> theVol = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a05dae0ef8a5e373148eb8ec788c2797f" title="the volume to which this surface is attached.">volume</a>() ;
<a name="l00717"></a>00717       
<a name="l00718"></a>00718       <span class="keywordflow">if</span>( ! <a class="code" href="namespace_d_d4hep_1_1_d_d_rec.html#a7b23370837eb2d8876a1e18bb258fd3f">findVolume</a>(  pv, theVol , pVList ) ){
<a name="l00719"></a>00719         theVol = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a05dae0ef8a5e373148eb8ec788c2797f" title="the volume to which this surface is attached.">volume</a>() ;
<a name="l00720"></a>00720         std::stringstream sst ; sst &lt;&lt; <span class="stringliteral">&quot; ***** ERROR: Volume &quot;</span> &lt;&lt; theVol.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>() &lt;&lt; <span class="stringliteral">&quot; not found for DetElement &quot;</span> &lt;&lt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a41a9849864ae0888964242798aaaa8e8">_det</a>.<a class="code" href="class_d_d4hep_1_1_handle.html#a9c62b8d37e0f2354bae0093498dc15a1" title="Access the object name (or &amp;quot;&amp;quot; if not supported by the object).">name</a>()  &lt;&lt; <span class="stringliteral">&quot; with surface &quot;</span>  ;
<a name="l00721"></a>00721         <span class="keywordflow">throw</span> std::runtime_error( sst.str() ) ;
<a name="l00722"></a>00722       } 
<a name="l00723"></a>00723 
<a name="l00724"></a>00724       <span class="comment">//=========== compute and cache world transform for surface ==========</span>
<a name="l00725"></a>00725       
<a name="l00726"></a>00726       <span class="keyword">const</span> TGeoHMatrix&amp; wm = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a41a9849864ae0888964242798aaaa8e8">_det</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a60e3c04d0c0487207e62b98512a8f08c" title="Set detector element for reference transformations. Will delete existing reference...">worldTransformation</a>() ;
<a name="l00727"></a>00727       
<a name="l00728"></a>00728 <span class="preprocessor">#if 0 // debug</span>
<a name="l00729"></a>00729 <span class="preprocessor"></span>      wm.Print() ;
<a name="l00730"></a>00730       <span class="keywordflow">for</span>( std::list&lt;PlacedVolume&gt;::iterator it= pVList.begin(), n = pVList.end() ; it != n ; ++it ){
<a name="l00731"></a>00731         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pv = *it ;
<a name="l00732"></a>00732         TGeoMatrix* <a class="code" href="namespacedd4hep.html#a443d1517e365c8f0c3a498bff0f09088">m</a> = pv-&gt;GetMatrix();
<a name="l00733"></a>00733         std::cout &lt;&lt; <span class="stringliteral">&quot;  +++ matrix for placed volume : &quot;</span> &lt;&lt; std::endl ;
<a name="l00734"></a>00734         m-&gt;Print() ;
<a name="l00735"></a>00735       }
<a name="l00736"></a>00736 <span class="preprocessor">#endif</span>
<a name="l00737"></a>00737 <span class="preprocessor"></span>
<a name="l00738"></a>00738       <span class="comment">// need to get the inverse transformation ( see Detector.cpp )</span>
<a name="l00739"></a>00739       <span class="comment">// std::auto_ptr&lt;TGeoHMatrix&gt; wtI( new TGeoHMatrix( wm.Inverse() ) ) ;</span>
<a name="l00740"></a>00740       <span class="comment">// has been fixed now, no need to get the inverse anymore:</span>
<a name="l00741"></a>00741       <a class="code" href="class_d_d4hep_1_1dd4hep__ptr.html" title="Out version of the std auto_ptr implementation base either on auto_ptr or unique_ptr...">dd4hep_ptr&lt;TGeoHMatrix&gt;</a> wtI( <span class="keyword">new</span> TGeoHMatrix( wm ) ) ;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       <span class="comment">//---- if the volSurface is not in the DetElement&apos;s volume, we need to mutliply the path to the volume to the</span>
<a name="l00744"></a>00744       <span class="comment">// DetElements world transform</span>
<a name="l00745"></a>00745       <span class="keywordflow">for</span>( std::list&lt;PlacedVolume&gt;::iterator it = ++( pVList.begin() ) , n = pVList.end() ; it != n ; ++it ){
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <a class="code" href="class_d_d4hep_1_1_geometry_1_1_placed_volume.html" title="Handle class holding a placed volume (also called physical volume).">PlacedVolume</a> pvol = *it ;
<a name="l00748"></a>00748         TGeoMatrix* <a class="code" href="namespacedd4hep.html#a443d1517e365c8f0c3a498bff0f09088">m</a> = pvol-&gt;GetMatrix();
<a name="l00749"></a>00749         <span class="comment">// std::cout &lt;&lt; &quot;  +++ matrix for placed volume : &quot; &lt;&lt; std::endl ;</span>
<a name="l00750"></a>00750         <span class="comment">// m-&gt;Print() ;</span>
<a name="l00751"></a>00751         <span class="comment">//wtI-&gt;MultiplyLeft( m );</span>
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         wtI-&gt;Multiply( m );
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       <span class="comment">//      std::cout &lt;&lt; &quot;  +++ new world transform matrix  : &quot; &lt;&lt; std::endl ;</span>
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 <span class="preprocessor">#if 0 //fixme: which convention to use here - the correct should be wtI, however it is the inverse of what is stored in DetElement ???</span>
<a name="l00759"></a>00759 <span class="preprocessor"></span>      <a class="code" href="class_d_d4hep_1_1dd4hep__ptr.html" title="Out version of the std auto_ptr implementation base either on auto_ptr or unique_ptr...">dd4hep_ptr&lt;TGeoHMatrix&gt;</a> wt( <span class="keyword">new</span> TGeoHMatrix( wtI-&gt;Inverse() ) ) ;
<a name="l00760"></a>00760       wt-&gt;Print() ;
<a name="l00761"></a>00761       <span class="comment">// cache the world transform for the surface</span>
<a name="l00762"></a>00762       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a> = wt.release()  ;
<a name="l00763"></a>00763 <span class="preprocessor">#else</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>      <span class="comment">//      wtI-&gt;Print() ;</span>
<a name="l00765"></a>00765       <span class="comment">// cache the world transform for the surface</span>
<a name="l00766"></a>00766       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a> = wtI.release()  ;
<a name="l00767"></a>00767 <span class="preprocessor">#endif</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>
<a name="l00769"></a>00769 
<a name="l00770"></a>00770       <span class="comment">//  ============ now fill the global surface vectors ==========================</span>
<a name="l00771"></a>00771 
<a name="l00772"></a>00772       <span class="keywordtype">double</span> ua[3], va[3], na[3], oa[3] ;
<a name="l00773"></a>00773 
<a name="l00774"></a>00774       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a23fdeba39bcffea350b53dcac8b3d0">u</a>()      , ua ) ;
<a name="l00775"></a>00775       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>()      , va ) ;
<a name="l00776"></a>00776       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2c5a55647d8f69637f4fc8d88bc70b67" title="Access to the normal direction at the given point.">normal</a>() , na ) ;
<a name="l00777"></a>00777       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster    ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a4be2b8d1ebddf2ac394a55efc28a2e6e">origin</a>() , oa ) ;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#abbf2e76e33b536bac67c387b860c1ff4">_u</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( ua ) ;
<a name="l00780"></a>00780       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a12656a8ed5ccc5a1993e1bacf9d4624b">_v</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( va ) ;
<a name="l00781"></a>00781       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a9191ee82058481753f4d5d5234415382">_n</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( na ) ;
<a name="l00782"></a>00782       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a>.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( oa ) ;
<a name="l00783"></a>00783 
<a name="l00784"></a>00784       <span class="comment">// std::cout &lt;&lt; &quot; --- local and global surface vectors : ------- &quot; &lt;&lt; std::endl </span>
<a name="l00785"></a>00785       <span class="comment">//                        &lt;&lt; &quot;    u : &quot; &lt;&lt; _volSurf.u()       &lt;&lt; &quot;  -  &quot; &lt;&lt; _u &lt;&lt; std::endl </span>
<a name="l00786"></a>00786       <span class="comment">//                        &lt;&lt; &quot;    v : &quot; &lt;&lt; _volSurf.v()       &lt;&lt; &quot;  -  &quot; &lt;&lt; _v &lt;&lt; std::endl </span>
<a name="l00787"></a>00787       <span class="comment">//                        &lt;&lt; &quot;    n : &quot; &lt;&lt; _volSurf.normal()  &lt;&lt; &quot;  -  &quot; &lt;&lt; _n &lt;&lt; std::endl </span>
<a name="l00788"></a>00788       <span class="comment">//                        &lt;&lt; &quot;    o : &quot; &lt;&lt; _volSurf.origin()  &lt;&lt; &quot;  -  &quot; &lt;&lt; _o &lt;&lt; std::endl ;</span>
<a name="l00789"></a>00789       
<a name="l00790"></a>00790 
<a name="l00791"></a>00791       <span class="comment">//  =========== check parallel and orthogonal to Z ===================</span>
<a name="l00792"></a>00792       
<a name="l00793"></a>00793       <span class="keywordflow">if</span>( ! <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1abb4367c088376f8607c45f9faaddb8">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#ad19fbd07dae4be06196ed3eea391b7b5" title="true if this a conical surface">isCone</a>() ) { 
<a name="l00794"></a>00794         <span class="comment">//fixme: workaround for conical surfaces that should always be parallel to z</span>
<a name="l00795"></a>00795         <span class="comment">//       however the check with the normal does not work here ...</span>
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1abb4367c088376f8607c45f9faaddb8">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#aaf82c50cdbb7f1f896995431da719003">checkParallelToZ</a>( *<span class="keyword">this</span> ) ;
<a name="l00798"></a>00798         
<a name="l00799"></a>00799         <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a1abb4367c088376f8607c45f9faaddb8">_type</a>.<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a9c98b2758bce1af96aa487bb0e131f6b">checkOrthogonalToZ</a>( *<span class="keyword">this</span> ) ;
<a name="l00800"></a>00800       }
<a name="l00801"></a>00801       
<a name="l00802"></a>00802       <span class="comment">//======== set the unique surface ID from the DetElement ( and placements below ? )</span>
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <span class="comment">// just use the DetElement ID for now ...</span>
<a name="l00805"></a>00805       <span class="comment">// or the id set by the user to the VolSurface ...</span>
<a name="l00806"></a>00806       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a14744685350bb3023c3e2efe02f8d707">_id</a> = ( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2f65703996e3212715d994f03afa2242" title="The id of this surface - always 0 for VolSurfaces.">id</a>()==0 ?  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a41a9849864ae0888964242798aaaa8e8">_det</a>.<a class="code" href="class_d_d4hep_1_1_geometry_1_1_det_element.html#a003e38a1be1b10caa917dd457637d104" title="The cached VolumeID of this subdetector element.">volumeID</a>() : <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2f65703996e3212715d994f03afa2242" title="The id of this surface - always 0 for VolSurfaces.">id</a>() ) ;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808       <span class="comment">// typedef PlacedVolume::VolIDs IDV ;</span>
<a name="l00809"></a>00809       <span class="comment">// DetElement d = _det ;</span>
<a name="l00810"></a>00810       <span class="comment">// while( d.isValid() &amp;&amp;  d.parent().isValid() ){</span>
<a name="l00811"></a>00811       <span class="comment">//        PlacedVolume pv = d.placement() ;</span>
<a name="l00812"></a>00812       <span class="comment">//        if( pv.isValid() ){</span>
<a name="l00813"></a>00813       <span class="comment">//          const IDV&amp; idV = pv.volIDs() ; </span>
<a name="l00814"></a>00814       <span class="comment">//          std::cout     &lt;&lt; &quot; VolIDs : &quot; &lt;&lt; d.name() &lt;&lt; std::endl ;</span>
<a name="l00815"></a>00815       <span class="comment">//          for( unsigned i=0, n=idV.size() ; i&lt;n ; ++i){</span>
<a name="l00816"></a>00816       <span class="comment">//            std::cout  &lt;&lt; &quot;  &quot; &lt;&lt; idV[i].first &lt;&lt; &quot; - &quot; &lt;&lt; idV[i].second &lt;&lt; std::endl ;</span>
<a name="l00817"></a>00817       <span class="comment">//          }</span>
<a name="l00818"></a>00818       <span class="comment">//        }</span>
<a name="l00819"></a>00819       <span class="comment">//        d = d.parent() ;</span>
<a name="l00820"></a>00820       <span class="comment">// }</span>
<a name="l00821"></a>00821      
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823     <span class="comment">//===================================================================================================================</span>
<a name="l00824"></a>00824       
<a name="l00825"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a54c81a4857e760fd9abb6773a9c19301">00825</a>     std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt; <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a54c81a4857e760fd9abb6773a9c19301">Surface::getLines</a>(<span class="keywordtype">unsigned</span> nMax) {
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a>00828       <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">double</span> epsilon = 1e-6 ; 
<a name="l00829"></a>00829 
<a name="l00830"></a>00830       std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt; lines ;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832       <span class="comment">//--------------------------------------------</span>
<a name="l00833"></a>00833       <span class="comment">// check if there are lines defined in the VolSurface :</span>
<a name="l00834"></a>00834       <span class="keyword">const</span> std::vector&lt; std::pair&lt;Vector3D, Vector3D&gt; &gt;&amp; local_lines = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a0800bcb853b43a688721247dd4031122">getLines</a>() ;
<a name="l00835"></a>00835       
<a name="l00836"></a>00836       <span class="keywordflow">if</span>( local_lines.size() &gt; 0 ) {
<a name="l00837"></a>00837         <span class="keywordtype">unsigned</span> n=local_lines.size() ;
<a name="l00838"></a>00838         lines.reserve( n ) ;
<a name="l00839"></a>00839         
<a name="l00840"></a>00840         <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i=0;i&lt;n;++i){
<a name="l00841"></a>00841           
<a name="l00842"></a>00842           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> av,bv;
<a name="l00843"></a>00843           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( local_lines[i].first ,  av.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00844"></a>00844           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( local_lines[i].<a class="code" href="namespacedd4hep.html#ac03364576705a245265d8ed6ea26b871">second</a> , bv.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00845"></a>00845           
<a name="l00846"></a>00846           lines.push_back( std::make_pair( av, bv ) );
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848         
<a name="l00849"></a>00849         <span class="keywordflow">return</span> lines ;
<a name="l00850"></a>00850       }
<a name="l00851"></a>00851       <span class="comment">//--------------------------------------------</span>
<a name="l00852"></a>00852 
<a name="l00853"></a>00853 
<a name="l00854"></a>00854       <span class="comment">// get local and global surface vectors</span>
<a name="l00855"></a>00855       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; lu = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a23fdeba39bcffea350b53dcac8b3d0">u</a>() ;
<a name="l00856"></a>00856       <span class="comment">//      const DDSurfaces::Vector3D&amp; lv = _volSurf.v() ;</span>
<a name="l00857"></a>00857       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; ln = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2c5a55647d8f69637f4fc8d88bc70b67" title="Access to the normal direction at the given point.">normal</a>() ;
<a name="l00858"></a>00858       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> lo = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a4be2b8d1ebddf2ac394a55efc28a2e6e">origin</a>() ;
<a name="l00859"></a>00859       
<a name="l00860"></a>00860       <a class="code" href="class_d_d4hep_1_1_geometry_1_1_volume.html" title="Handle class holding a placed volume (also called physical volume).">Volume</a> vol = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a503e338d4d10ef0826b59004e6978d43" title="The volume that has the surface attached.">volume</a>() ; 
<a name="l00861"></a>00861       <span class="keyword">const</span> TGeoShape* shape = vol-&gt;GetShape() ;
<a name="l00862"></a>00862       
<a name="l00863"></a>00863       
<a name="l00864"></a>00864       <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ac2500033e175992484aba8956a27bdd6">type</a>().isPlane() ) {
<a name="l00865"></a>00865         
<a name="l00866"></a>00866         <span class="keywordflow">if</span>( shape-&gt;IsA() == TGeoBBox::Class() ) {
<a name="l00867"></a>00867           
<a name="l00868"></a>00868           TGeoBBox* box = ( TGeoBBox* ) shape  ;
<a name="l00869"></a>00869           
<a name="l00870"></a>00870           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> boxDim(  box-&gt;GetDX() , box-&gt;GetDY() , box-&gt;GetDZ() ) ;  
<a name="l00871"></a>00871           
<a name="l00872"></a>00872           
<a name="l00873"></a>00873           <span class="keywordtype">bool</span> isYZ = std::fabs(  ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() - 1.0 ) &lt; epsilon  ; <span class="comment">// normal parallel to x</span>
<a name="l00874"></a>00874           <span class="keywordtype">bool</span> isXZ = std::fabs(  ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() - 1.0 ) &lt; epsilon  ; <span class="comment">// normal parallel to y</span>
<a name="l00875"></a>00875           <span class="keywordtype">bool</span> isXY = std::fabs(  ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - 1.0 ) &lt; epsilon  ; <span class="comment">// normal parallel to z</span>
<a name="l00876"></a>00876           
<a name="l00877"></a>00877           
<a name="l00878"></a>00878           <span class="keywordflow">if</span>( isYZ || isXZ || isXY ) {  <span class="comment">// plane is parallel to one of the box&apos; sides -&gt; need 4 vertices from box dimensions</span>
<a name="l00879"></a>00879             
<a name="l00880"></a>00880             <span class="comment">// if isYZ :</span>
<a name="l00881"></a>00881             <span class="keywordtype">unsigned</span> uidx = 1 ;
<a name="l00882"></a>00882             <span class="keywordtype">unsigned</span> vidx = 2 ;
<a name="l00883"></a>00883             
<a name="l00884"></a>00884             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ubl(  0., 1., 0. ) ; 
<a name="l00885"></a>00885             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vbl(  0., 0., 1. ) ;
<a name="l00886"></a>00886             
<a name="l00887"></a>00887             <span class="keywordflow">if</span>( isXZ ) {
<a name="l00888"></a>00888               
<a name="l00889"></a>00889               ubl.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( 1., 0., 0. ) ;
<a name="l00890"></a>00890               vbl.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( 0., 0., 1. ) ;
<a name="l00891"></a>00891               uidx = 0 ;
<a name="l00892"></a>00892               vidx = 2 ;
<a name="l00893"></a>00893               
<a name="l00894"></a>00894             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( isXY ) {
<a name="l00895"></a>00895               
<a name="l00896"></a>00896               ubl.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( 1., 0., 0. ) ;
<a name="l00897"></a>00897               vbl.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( 0., 1., 0. ) ;
<a name="l00898"></a>00898               uidx = 0 ;
<a name="l00899"></a>00899               vidx = 1 ;
<a name="l00900"></a>00900             }
<a name="l00901"></a>00901             
<a name="l00902"></a>00902             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ub ;
<a name="l00903"></a>00903             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vb ;
<a name="l00904"></a>00904             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( ubl , ub.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00905"></a>00905             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( vbl , vb.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00906"></a>00906             
<a name="l00907"></a>00907             lines.reserve(4) ;
<a name="l00908"></a>00908             
<a name="l00909"></a>00909             lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + boxDim[ uidx ] * ub  + boxDim[ vidx ] * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - boxDim[ uidx ] * ub  + boxDim[ vidx ] * vb ) ) ;
<a name="l00910"></a>00910             lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - boxDim[ uidx ] * ub  + boxDim[ vidx ] * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - boxDim[ uidx ] * ub  - boxDim[ vidx ] * vb ) ) ;
<a name="l00911"></a>00911             lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - boxDim[ uidx ] * ub  - boxDim[ vidx ] * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + boxDim[ uidx ] * ub  - boxDim[ vidx ] * vb ) ) ;
<a name="l00912"></a>00912             lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + boxDim[ uidx ] * ub  - boxDim[ vidx ] * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + boxDim[ uidx ] * ub  + boxDim[ vidx ] * vb ) ) ;
<a name="l00913"></a>00913             
<a name="l00914"></a>00914             <span class="keywordflow">return</span> lines ;
<a name="l00915"></a>00915           }         
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( shape-&gt;IsA() == TGeoConeSeg::Class() ) {
<a name="l00918"></a>00918 
<a name="l00919"></a>00919           TGeoCone* cone = ( TGeoCone* ) shape  ;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921           <span class="comment">// can only deal with special case of z-disk and origin in center of cone</span>
<a name="l00922"></a>00922           <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ac2500033e175992484aba8956a27bdd6">type</a>().<a class="code" href="class_d_d_surfaces_1_1_surface_type.html#a02a7fe9ec9f7ad6ebd98b0a1b36a39b3" title="true if this is a plane orthogonal to Z">isZDisk</a>() ) { <span class="comment">// &amp;&amp; lo.rho() &lt; epsilon ) {</span>
<a name="l00923"></a>00923             
<a name="l00924"></a>00924             <span class="keywordflow">if</span>( lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() &gt; epsilon ) {
<a name="l00925"></a>00925               <span class="comment">// move origin to z-axis </span>
<a name="l00926"></a>00926               lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() = 0. ; 
<a name="l00927"></a>00927               lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() = 0. ;
<a name="l00928"></a>00928             }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930 
<a name="l00931"></a>00931             <span class="keywordtype">double</span> zhalf = cone-&gt;GetDZ() ;
<a name="l00932"></a>00932             <span class="keywordtype">double</span> rmax1 = cone-&gt;GetRmax1() ;
<a name="l00933"></a>00933             <span class="keywordtype">double</span> rmax2 = cone-&gt;GetRmax2() ;
<a name="l00934"></a>00934             <span class="keywordtype">double</span> rmin1 = cone-&gt;GetRmin1() ;
<a name="l00935"></a>00935             <span class="keywordtype">double</span> rmin2 = cone-&gt;GetRmin2() ;
<a name="l00936"></a>00936             
<a name="l00937"></a>00937             <span class="comment">// two circles around origin </span>
<a name="l00938"></a>00938             <span class="comment">// get radii at position of plane </span>
<a name="l00939"></a>00939             <span class="keywordtype">double</span> r0 =  rmin1 +  ( rmin2 - rmin1 ) / ( 2. * zhalf )   *  ( zhalf + lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>()  ) ;  
<a name="l00940"></a>00940             <span class="keywordtype">double</span> r1 =  rmax1 +  ( rmax2 - rmax1 ) / ( 2. * zhalf )   *  ( zhalf + lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>()  ) ;  
<a name="l00941"></a>00941 
<a name="l00942"></a>00942             
<a name="l00943"></a>00943             <span class="keywordtype">unsigned</span> n = nMax / 4 ;
<a name="l00944"></a>00944             <span class="keywordtype">double</span> dPhi = 2.* ROOT::Math::Pi() / double( n ) ; 
<a name="l00945"></a>00945             
<a name="l00946"></a>00946             <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0 ; i &lt; n ; ++i ) {
<a name="l00947"></a>00947               
<a name="l00948"></a>00948               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv00(  r0*sin(  i   *dPhi ) , r0*cos(  i   *dPhi )  , 0. ) ;
<a name="l00949"></a>00949               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv01(  r0*sin( (i+1)*dPhi ) , r0*cos( (i+1)*dPhi )  , 0. ) ;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv10(  r1*sin(  i   *dPhi ) , r1*cos(  i   *dPhi )  , 0. ) ;
<a name="l00952"></a>00952               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv11(  r1*sin( (i+1)*dPhi ) , r1*cos( (i+1)*dPhi )  , 0. ) ;
<a name="l00953"></a>00953               
<a name="l00954"></a>00954              
<a name="l00955"></a>00955               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl0 =  lo + rv00 ;
<a name="l00956"></a>00956               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl1 =  lo + rv01 ;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl2 =  lo + rv10 ;
<a name="l00959"></a>00959               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl3 =  lo + rv11 ;
<a name="l00960"></a>00960               
<a name="l00961"></a>00961 
<a name="l00962"></a>00962               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pg0,pg1,pg2,pg3 ;
<a name="l00963"></a>00963               
<a name="l00964"></a>00964               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl0, pg0.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00965"></a>00965               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl1, pg1.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00966"></a>00966               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl2, pg2.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00967"></a>00967               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl3, pg3.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00968"></a>00968               
<a name="l00969"></a>00969               lines.push_back( std::make_pair( pg0, pg1 ) ) ;
<a name="l00970"></a>00970               lines.push_back( std::make_pair( pg2, pg3 ) ) ;
<a name="l00971"></a>00971             }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973             <span class="comment">//add some vertical and horizontal lines so that the disc is seen in the rho-z projection</span>
<a name="l00974"></a>00974 
<a name="l00975"></a>00975             n = 4 ; dPhi = 2.* ROOT::Math::Pi() / double( n ) ;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977             <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0 ; i &lt; n ; ++i ) {
<a name="l00978"></a>00978               
<a name="l00979"></a>00979               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv0(  r0*sin( i * dPhi ) , r0*cos(  i * dPhi )  , 0. ) ;
<a name="l00980"></a>00980               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv1(  r1*sin( i * dPhi ) , r1*cos(  i * dPhi )  , 0. ) ;
<a name="l00981"></a>00981               
<a name="l00982"></a>00982               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl0 =  lo + rv0 ;
<a name="l00983"></a>00983               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl1 =  lo + rv1 ;
<a name="l00984"></a>00984 
<a name="l00985"></a>00985               <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pg0,pg1 ;
<a name="l00986"></a>00986               
<a name="l00987"></a>00987               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl0, pg0.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00988"></a>00988               <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl1, pg1.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l00989"></a>00989               
<a name="l00990"></a>00990               lines.push_back( std::make_pair( pg0, pg1 ) ) ;
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993           }
<a name="l00994"></a>00994           
<a name="l00995"></a>00995           <span class="keywordflow">return</span> lines ;
<a name="l00996"></a>00996         }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(shape-&gt;IsA() == TGeoTrap::Class()) {
<a name="l00999"></a>00999           TGeoTrap* trapezoid = ( TGeoTrap* ) shape;
<a name="l01000"></a>01000           
<a name="l01001"></a>01001           <span class="keywordtype">double</span> dx1 = trapezoid-&gt;GetBl1();
<a name="l01002"></a>01002           <span class="keywordtype">double</span> dx2 = trapezoid-&gt;GetTl1();
<a name="l01003"></a>01003           <span class="keywordtype">double</span> dz = trapezoid-&gt;GetH1();
<a name="l01004"></a>01004 
<a name="l01005"></a>01005           <span class="comment">//according to the TGeoTrap definition, the lengths are given such that the normal vector of the surface</span>
<a name="l01006"></a>01006           <span class="comment">//points in the e_z direction.</span>
<a name="l01007"></a>01007           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ubl(  1., 0., 0. ) ; 
<a name="l01008"></a>01008           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vbl(  0., 1., 0. ) ; 
<a name="l01009"></a>01009 
<a name="l01010"></a>01010           <span class="comment">//the local span vectors are transformed into the main coordinate system (in LocalToMasterVect())</span>
<a name="l01011"></a>01011           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ub ;
<a name="l01012"></a>01012           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vb ;
<a name="l01013"></a>01013           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( ubl , ub.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01014"></a>01014           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( vbl , vb.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016           <span class="comment">//the trapezoid is drawn as a set of four lines connecting its four corners</span>
<a name="l01017"></a>01017           lines.reserve(4) ;
<a name="l01018"></a>01018           <span class="comment">//_o is vector to the origin</span>
<a name="l01019"></a>01019           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ) ) ;
<a name="l01020"></a>01020           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ) ) ;
<a name="l01021"></a>01021           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb) ) ;
<a name="l01022"></a>01022           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb , <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb) ) ;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024           <span class="keywordflow">return</span> lines;
<a name="l01025"></a>01025         }
<a name="l01026"></a>01026         <span class="comment">//added code by Thorben Quast for simplified set of lines for trapezoids with unequal lengths in x</span>
<a name="l01027"></a>01027         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(shape-&gt;IsA() == TGeoTrd1::Class()){
<a name="l01028"></a>01028           TGeoTrd1* trapezoid = ( TGeoTrd1* ) shape;
<a name="l01029"></a>01029           <span class="comment">//all lengths are half length</span>
<a name="l01030"></a>01030           <span class="keywordtype">double</span> dx1 = trapezoid-&gt;GetDx1();
<a name="l01031"></a>01031           <span class="keywordtype">double</span> dx2 = trapezoid-&gt;GetDx2();
<a name="l01032"></a>01032           <span class="comment">//double dy = trapezoid-&gt;GetDy();</span>
<a name="l01033"></a>01033           <span class="keywordtype">double</span> dz = trapezoid-&gt;GetDz();
<a name="l01034"></a>01034 
<a name="l01035"></a>01035           <span class="comment">//the normal vector is parallel to e_y for all geometry cases in CLIC</span>
<a name="l01036"></a>01036           <span class="comment">//if that is at some point not the case anymore, then local plane vectors ubl, vbl</span>
<a name="l01037"></a>01037           <span class="comment">//must be initialized like it is done for the boxes (line 674 following)</span>
<a name="l01038"></a>01038           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ubl(  1., 0., 0. ) ; 
<a name="l01039"></a>01039           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vbl(  0., 0., 1. ) ; 
<a name="l01040"></a>01040           
<a name="l01041"></a>01041           <span class="comment">//the local span vectors are transformed into the main coordinate system (in LocalToMasterVect())</span>
<a name="l01042"></a>01042           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ub ;
<a name="l01043"></a>01043           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vb ;
<a name="l01044"></a>01044           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( ubl , ub.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01045"></a>01045           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( vbl , vb.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047           <span class="comment">//the trapezoid is drawn as a set of four lines connecting its four corners</span>
<a name="l01048"></a>01048           lines.reserve(4) ;
<a name="l01049"></a>01049           <span class="comment">//_o is vector to the origin</span>
<a name="l01050"></a>01050           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ) ) ;
<a name="l01051"></a>01051           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ) ) ;
<a name="l01052"></a>01052           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb) ) ;
<a name="l01053"></a>01053           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb , <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb) ) ;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055           <span class="keywordflow">return</span> lines;
<a name="l01056"></a>01056         }
<a name="l01057"></a>01057         <span class="comment">//added code by Thorben Quast for simplified set of lines for trapezoids with unequal lengths in x AND y</span>
<a name="l01058"></a>01058         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(shape-&gt;IsA() == TGeoTrd2::Class()){
<a name="l01059"></a>01059           TGeoTrd2* trapezoid = ( TGeoTrd2* ) shape;
<a name="l01060"></a>01060           <span class="comment">//all lengths are half length</span>
<a name="l01061"></a>01061           <span class="keywordtype">double</span> dx1 = trapezoid-&gt;GetDx1();
<a name="l01062"></a>01062           <span class="keywordtype">double</span> dx2 = trapezoid-&gt;GetDx2();
<a name="l01063"></a>01063           <span class="comment">//double dy1 = trapezoid-&gt;GetDy1();  </span>
<a name="l01064"></a>01064           <span class="comment">//double dy2 = trapezoid-&gt;GetDy2();  </span>
<a name="l01065"></a>01065           <span class="keywordtype">double</span> dz = trapezoid-&gt;GetDz();
<a name="l01066"></a>01066 
<a name="l01067"></a>01067           <span class="comment">//the normal vector is parallel to e_y for all geometry cases in CLIC</span>
<a name="l01068"></a>01068           <span class="comment">//if that is at some point not the case anymore, then local plane vectors ubl, vbl</span>
<a name="l01069"></a>01069           <span class="comment">//must be initialized like it is done for the boxes (line 674 following)</span>
<a name="l01070"></a>01070           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ubl(  1., 0., 0. ) ; 
<a name="l01071"></a>01071           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vbl(  0., 0., 1. ) ; 
<a name="l01072"></a>01072           
<a name="l01073"></a>01073           <span class="comment">//the local span vectors are transformed into the main coordinate system (in LocalToMasterVect())</span>
<a name="l01074"></a>01074           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> ub ;
<a name="l01075"></a>01075           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> vb ;
<a name="l01076"></a>01076           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( ubl , ub.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01077"></a>01077           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( vbl , vb.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079           <span class="comment">//the trapezoid is drawn as a set of four lines connecting its four corners</span>
<a name="l01080"></a>01080           lines.reserve(4) ;
<a name="l01081"></a>01081           <span class="comment">//_o is vector to the origin</span>
<a name="l01082"></a>01082           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ) ) ;
<a name="l01083"></a>01083           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ) ) ;
<a name="l01084"></a>01084           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx2 * ub  + dz * vb ,  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb) ) ;
<a name="l01085"></a>01085           lines.push_back( std::make_pair( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> - dx1 * ub  - dz * vb , <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#aab036a2e1a02dcc393f03a901fea39d4">_o</a> + dx1 * ub  - dz * vb) ) ;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087           <span class="keywordflow">return</span> lines;
<a name="l01088"></a>01088         }
<a name="l01089"></a>01089         <span class="comment">// ===== default for arbitrary planes in arbitrary shapes ================= </span>
<a name="l01090"></a>01090         
<a name="l01091"></a>01091         <span class="comment">// We create nMax vertices by rotating the local u vector around the normal</span>
<a name="l01092"></a>01092         <span class="comment">// and checking the distance to the volume boundary in that direction.</span>
<a name="l01093"></a>01093         <span class="comment">// This is brute force and not very smart, as many points are created on straight </span>
<a name="l01094"></a>01094         <span class="comment">// lines and the edges are still rounded. </span>
<a name="l01095"></a>01095         <span class="comment">// The alterative would be to compute the true intersections a plane and the most</span>
<a name="l01096"></a>01096         <span class="comment">// common shapes - at least for boxes that should be not too hard. To be done...</span>
<a name="l01097"></a>01097         
<a name="l01098"></a>01098         lines.reserve( nMax ) ;
<a name="l01099"></a>01099         
<a name="l01100"></a>01100         <span class="keywordtype">double</span> dAlpha =  2.* ROOT::Math::Pi() / double( nMax ) ; 
<a name="l01101"></a>01101 
<a name="l01102"></a>01102         TVector3 norm( ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() , ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() , ln.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ) ;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104         
<a name="l01105"></a>01105         <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> first, previous ;
<a name="l01106"></a>01106 
<a name="l01107"></a>01107         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0 ; i&lt; nMax ; ++i ){ 
<a name="l01108"></a>01108           
<a name="l01109"></a>01109           <span class="keywordtype">double</span> alpha = double(i) * dAlpha ;
<a name="l01110"></a>01110           
<a name="l01111"></a>01111           TVector3 vec( lu.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a5bd719fa589abb81c0516d64bb0845d5">x</a>() , lu.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a3bf128e592add1be24f212696e61462c">y</a>() , lu.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() ) ;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113           TRotation rot ;
<a name="l01114"></a>01114           rot.Rotate( alpha , norm );
<a name="l01115"></a>01115         
<a name="l01116"></a>01116           TVector3 vecR = rot * vec ;
<a name="l01117"></a>01117           
<a name="l01118"></a>01118           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> luRot ;
<a name="l01119"></a>01119           luRot.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#aca1a3d8cf1991c79d55c1c8b0c4cb436" title="fill vector from arbitrary class that defines operator[]">fill</a>( vecR ) ;
<a name="l01120"></a>01120           
<a name="l01121"></a>01121           <span class="keywordtype">double</span> dist = shape-&gt;DistFromInside( const_cast&lt;double*&gt; (lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>()) , const_cast&lt;double*&gt; (luRot.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a16dc8cedd8420c5f52dbbdc7674593dd" title="direct access to data as const double*">const_array</a>())  , 3, 0.1 ) ;
<a name="l01122"></a>01122           
<a name="l01123"></a>01123           <span class="comment">// local point at volume boundary</span>
<a name="l01124"></a>01124           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> lp = lo + dist * luRot ;
<a name="l01125"></a>01125 
<a name="l01126"></a>01126           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a> gp ;
<a name="l01127"></a>01127           
<a name="l01128"></a>01128           <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( lp , gp.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130           <span class="comment">// std::cout &lt;&lt; &quot; **** normal:&quot; &lt;&lt; ln &lt;&lt; &quot; lu:&quot; &lt;&lt; lu  &lt;&lt; &quot; alpha:&quot; &lt;&lt; alpha &lt;&lt; &quot; luRot:&quot; &lt;&lt; luRot &lt;&lt; &quot; lp :&quot; &lt;&lt; lp  &lt;&lt; &quot; gp:&quot; &lt;&lt; gp &lt;&lt; &quot; dist : &quot; &lt;&lt; dist </span>
<a name="l01131"></a>01131           <span class="comment">//        &lt;&lt; &quot; is point &quot; &lt;&lt; gp &lt;&lt; &quot; inside : &quot; &lt;&lt; shape-&gt;Contains( gp.const_array()  )  </span>
<a name="l01132"></a>01132           <span class="comment">//        &lt;&lt; &quot; dist from outside for lo,lu &quot; &lt;&lt;  shape-&gt;DistFromOutside( lo.const_array()  , lu.const_array()   , 3 )    </span>
<a name="l01133"></a>01133           <span class="comment">//        &lt;&lt; &quot; dist from inside for lo,ln &quot; &lt;&lt;  shape-&gt;DistFromInside( lo.const_array()  , ln.const_array()   , 3 )    </span>
<a name="l01134"></a>01134           <span class="comment">//        &lt;&lt; std::endl;</span>
<a name="l01135"></a>01135           <span class="comment">//      shape-&gt;Dump() ;</span>
<a name="l01136"></a>01136           
<a name="l01137"></a>01137 
<a name="l01138"></a>01138           <span class="keywordflow">if</span>( i &gt;  0 ) 
<a name="l01139"></a>01139             lines.push_back( std::make_pair( previous, gp )  ) ;
<a name="l01140"></a>01140           <span class="keywordflow">else</span>
<a name="l01141"></a>01141             first = gp ;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143           previous = gp ;
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145         lines.push_back( std::make_pair( previous, first )  ) ;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 
<a name="l01148"></a>01148       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ac2500033e175992484aba8956a27bdd6">type</a>().isCylinder() ) {  
<a name="l01149"></a>01149 
<a name="l01150"></a>01150         <span class="comment">//      if( shape-&gt;IsA() == TGeoTube::Class() ) {</span>
<a name="l01151"></a>01151         <span class="keywordflow">if</span>( shape-&gt;IsA() == TGeoConeSeg::Class() ) {
<a name="l01152"></a>01152 
<a name="l01153"></a>01153           lines.reserve( nMax ) ;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155           TGeoTube* tube = ( TGeoTube* ) shape  ;
<a name="l01156"></a>01156           
<a name="l01157"></a>01157           <span class="keywordtype">double</span> zHalf = tube-&gt;GetDZ() ;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159           <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> zv( 0. , 0. , zHalf ) ;
<a name="l01160"></a>01160           
<a name="l01161"></a>01161           <span class="keywordtype">double</span> r = lo.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() ;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 
<a name="l01164"></a>01164 
<a name="l01165"></a>01165           <span class="keywordtype">unsigned</span> n = nMax / 4 ;
<a name="l01166"></a>01166           <span class="keywordtype">double</span> dPhi = 2.* ROOT::Math::Pi() / double( n ) ; 
<a name="l01167"></a>01167 
<a name="l01168"></a>01168           <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0 ; i &lt; n ; ++i ) {
<a name="l01169"></a>01169 
<a name="l01170"></a>01170             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv0(  r*sin(  i   *dPhi ) , r*cos(  i   *dPhi )  , 0. ) ;
<a name="l01171"></a>01171             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> rv1(  r*sin( (i+1)*dPhi ) , r*cos( (i+1)*dPhi )  , 0. ) ;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173             <span class="comment">// 4 points on local cylinder</span>
<a name="l01174"></a>01174 
<a name="l01175"></a>01175             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl0 =  zv + rv0 ;
<a name="l01176"></a>01176             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl1 =  zv + rv1 ;
<a name="l01177"></a>01177             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl2 = -zv + rv1  ;
<a name="l01178"></a>01178             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pl3 = -zv + rv0 ;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180             <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> pg0,pg1,pg2,pg3 ;
<a name="l01181"></a>01181 
<a name="l01182"></a>01182             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl0, pg0.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01183"></a>01183             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl1, pg1.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01184"></a>01184             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl2, pg2.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01185"></a>01185             <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( pl3, pg3.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187             lines.push_back( std::make_pair( pg0, pg1 ) ) ;
<a name="l01188"></a>01188             lines.push_back( std::make_pair( pg1, pg2 ) ) ;
<a name="l01189"></a>01189             lines.push_back( std::make_pair( pg2, pg3 ) ) ;
<a name="l01190"></a>01190             lines.push_back( std::make_pair( pg3, pg0 ) ) ;
<a name="l01191"></a>01191           }
<a name="l01192"></a>01192         }
<a name="l01193"></a>01193       }
<a name="l01194"></a>01194       <span class="keywordflow">return</span> lines ;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196     }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="comment">//================================================================================================================</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200  
<a name="l01201"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#adb01b4c563ea150f1c2a4d595beca0e6">01201</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#adb01b4c563ea150f1c2a4d595beca0e6">CylinderSurface::u</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point  )<span class="keyword"> const </span>{ 
<a name="l01202"></a>01202  
<a name="l01203"></a>01203       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> lp , u_val ;
<a name="l01204"></a>01204       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , lp.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01205"></a>01205       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; lu = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a6a23fdeba39bcffea350b53dcac8b3d0">u</a>( lp  ) ;
<a name="l01206"></a>01206       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( lu , u_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01207"></a>01207       <span class="keywordflow">return</span> u_val ; 
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209     
<a name="l01210"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a8cf924dc19c5eb87e435dd1918e14407">01210</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a8cf924dc19c5eb87e435dd1918e14407">CylinderSurface::v</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l01211"></a>01211       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> lp , v_val ;
<a name="l01212"></a>01212       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , lp.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01213"></a>01213       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; lv =  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>( lp  ) ;
<a name="l01214"></a>01214       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( lv , v_val.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01215"></a>01215       <span class="keywordflow">return</span> v_val ; 
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217     
<a name="l01218"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a42de2f110f904bf4d4862bd0b149d49a">01218</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a42de2f110f904bf4d4862bd0b149d49a">CylinderSurface::normal</a>(<span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point )<span class="keyword"> const </span>{  
<a name="l01219"></a>01219       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> lp , n ;
<a name="l01220"></a>01220       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , lp.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01221"></a>01221       <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">DDSurfaces::Vector3D</a>&amp; ln =  <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a2c5a55647d8f69637f4fc8d88bc70b67" title="Access to the normal direction at the given point.">normal</a>( lp  ) ;
<a name="l01222"></a>01222       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMasterVect( ln , n.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01223"></a>01223       <span class="keywordflow">return</span> n ; 
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225  
<a name="l01226"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#ad5772b2599d37ee4280dc074873aef40">01226</a>     <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#ad5772b2599d37ee4280dc074873aef40">CylinderSurface::globalToLocal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l01227"></a>01227       
<a name="l01228"></a>01228       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> lp;
<a name="l01229"></a>01229       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;MasterToLocal( point , lp.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01230"></a>01230  
<a name="l01231"></a>01231       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#aa4251b5a2eb3f18a84e7b369929b6ba3">globalToLocal</a>( lp )  ;
<a name="l01232"></a>01232     }
<a name="l01233"></a>01233     
<a name="l01234"></a>01234     
<a name="l01235"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a175adc46f395f0795e4aad32147516fa">01235</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a175adc46f395f0795e4aad32147516fa">CylinderSurface::localToGlobal</a>( <span class="keyword">const</span> <a class="code" href="class_d_d_surfaces_1_1_vector2_d.html">Vector2D</a>&amp; point)<span class="keyword"> const </span>{
<a name="l01236"></a>01236  
<a name="l01237"></a>01237       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> lp = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a784a48baa6fa269f2c626acce19f1154">localToGlobal</a>( point ) ;
<a name="l01238"></a>01238       <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> p ;
<a name="l01239"></a>01239       <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#acbbdd616ea4e084228084cd6d94dff99">_wtM</a>-&gt;LocalToMaster( lp , p.<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a467bf79fd3e74223a070ecc612d54526" title="direct access to data as double* - allows modification">array</a>() ) ;
<a name="l01240"></a>01240  
<a name="l01241"></a>01241       <span class="keywordflow">return</span> p ;
<a name="l01242"></a>01242     }
<a name="l01243"></a>01243 
<a name="l01244"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#ad07737fba21e42e21d521ce9dba2083b">01244</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#ad07737fba21e42e21d521ce9dba2083b" title="the radius of the cylinder (rho of the origin vector)">CylinderSurface::radius</a>()<span class="keyword"> const </span>{    <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a4be2b8d1ebddf2ac394a55efc28a2e6e">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() ;  }
<a name="l01245"></a>01245 
<a name="l01246"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a2f781fa234e46d60caa6d07271c2e922">01246</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cylinder_surface.html#a2f781fa234e46d60caa6d07271c2e922" title="the center of the cylinder">CylinderSurface::center</a>()<span class="keyword"> const </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ab2b3a468ee678eb76912d659ddf404fc">volumeOrigin</a>() ;  }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="comment">//================================================================================================================</span>
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 
<a name="l01252"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#afd2818bb0856bcc8bcf4dc8f13021487">01252</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#afd2818bb0856bcc8bcf4dc8f13021487" title="the start radius of the cone">ConeSurface::radius0</a>()<span class="keyword"> const </span>{
<a name="l01253"></a>01253       
<a name="l01254"></a>01254       <span class="keywordtype">double</span> theta = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l01255"></a>01255       <span class="keywordtype">double</span> l = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">length_along_v</a>() * cos( theta ) ;
<a name="l01256"></a>01256       
<a name="l01257"></a>01257       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() - 0.5 * l * tan( theta ) ;  
<a name="l01258"></a>01258     }
<a name="l01259"></a>01259 
<a name="l01260"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a06f5fb8f4f87c1adbe0c50f26c41a7ad">01260</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a06f5fb8f4f87c1adbe0c50f26c41a7ad" title="the end radius of the cone">ConeSurface::radius1</a>()<span class="keyword"> const </span>{
<a name="l01261"></a>01261       
<a name="l01262"></a>01262       <span class="keywordtype">double</span> theta = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l01263"></a>01263       <span class="keywordtype">double</span> l = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">length_along_v</a>() * cos( theta ) ;
<a name="l01264"></a>01264       
<a name="l01265"></a>01265       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a85a0cae7559e019ae6e9b905b2b190bb">rho</a>() + 0.5 * l * tan( theta ) ;  
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a208dd6edd7dafbb3bbfd7208f5e54d77">01268</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a208dd6edd7dafbb3bbfd7208f5e54d77" title="the start z of the cone">ConeSurface::z0</a>()<span class="keyword"> const </span>{
<a name="l01269"></a>01269       
<a name="l01270"></a>01270       <span class="keywordtype">double</span> theta = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l01271"></a>01271       <span class="keywordtype">double</span> l = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">length_along_v</a>() * cos( theta ) ;
<a name="l01272"></a>01272       
<a name="l01273"></a>01273       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() - 0.5 * l ;  
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275 
<a name="l01276"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a57025cbc8425945bffdca2ded15530bf">01276</a>     <span class="keywordtype">double</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#a57025cbc8425945bffdca2ded15530bf" title="the end z of the cone">ConeSurface::z1</a>()<span class="keyword"> const </span>{
<a name="l01277"></a>01277       
<a name="l01278"></a>01278       <span class="keywordtype">double</span> theta = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a5555dbcfaaa833c3169aec39f447b2c3">_volSurf</a>.<a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_vol_surface.html#a46cb5a2e9e28ec469657b7331a83b0ed">v</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a96c64249c95afb43efdeb1f063741871">theta</a>() ;
<a name="l01279"></a>01279       <span class="keywordtype">double</span> l = <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#a7c24c48062ae82692d31af6430b52ec6">length_along_v</a>() * cos( theta ) ;
<a name="l01280"></a>01280       
<a name="l01281"></a>01281       <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ad3b8710337ded85b4b277eca2d38cc8a">origin</a>().<a class="code" href="class_d_d_surfaces_1_1_vector3_d.html#a1aaceadb3e209d24aa14e9bd8683f6df">z</a>() + 0.5 * l ;
<a name="l01282"></a>01282     }
<a name="l01283"></a>01283 
<a name="l01284"></a><a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#abfdad3ecbda7070c2b2b4b4d48b23ccb">01284</a>     <a class="code" href="class_d_d_surfaces_1_1_vector3_d.html">Vector3D</a> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_cone_surface.html#abfdad3ecbda7070c2b2b4b4d48b23ccb" title="the center of the cone">ConeSurface::center</a>()<span class="keyword"> const </span>{  <span class="keywordflow">return</span> <a class="code" href="class_d_d4hep_1_1_d_d_rec_1_1_surface.html#ab2b3a468ee678eb76912d659ddf404fc">volumeOrigin</a>() ;  }
<a name="l01285"></a>01285 
<a name="l01286"></a>01286 
<a name="l01287"></a>01287     <span class="comment">//================================================================================================================</span>
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   } <span class="comment">// namespace</span>
<a name="l01290"></a>01290 } <span class="comment">// namespace</span>
<a name="l01291"></a>01291 
<a name="l01292"></a>01292 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!--BEGIN GENERATE_TREEVIEW-->
    <li class="footer">$generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
   </ul>
 </div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>
$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
